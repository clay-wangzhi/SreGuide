<template><h1 id="_4-6-æµæ°´çº¿å¼€å‘å·¥å…·" tabindex="-1"><a class="header-anchor" href="#_4-6-æµæ°´çº¿å¼€å‘å·¥å…·" aria-hidden="true">#</a> 4.6 æµæ°´çº¿å¼€å‘å·¥å…·</h1>
<blockquote>
<p>è½¬è½½è‡ªï¼š<a href="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/" target="_blank" rel="noopener noreferrer">æµæ°´çº¿å¼€å‘å·¥å…· | æ³½é˜³<ExternalLinkIcon/></a></p>
</blockquote>
<p>æ‚¨å¥½ï¼Œæœ¬æ¨¡å—ä¸»è¦äº†è§£åœ¨æµæ°´çº¿ä¸­å¸¸ç”¨çš„æ–¹æ³•ğŸ˜€</p>
<hr>
<h2 id="ç‰‡æ®µç”Ÿæˆå™¨" tabindex="-1"><a class="header-anchor" href="#ç‰‡æ®µç”Ÿæˆå™¨" aria-hidden="true">#</a> ç‰‡æ®µç”Ÿæˆå™¨</h2>
<p>ä½¿ç”¨ç‰‡æ®µç”Ÿæˆå™¨å¯ä»¥æ ¹æ®ä¸ªäººéœ€è¦ç”Ÿæˆæ–¹æ³•ï¼Œæœ‰äº›æ–¹æ³•æ¥æºäºæ’ä»¶ï¼Œåˆ™éœ€è¦å…ˆå®‰è£…ç›¸å…³çš„æ’ä»¶æ‰èƒ½ä½¿ç”¨å“¦ã€‚</p>
<p><a href="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/images/01.png" target="_blank" rel="noopener noreferrer"><img src="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/images/01.png" alt="images" loading="lazy"><ExternalLinkIcon/></a></p>
<p>å¡«å†™å¥½å‚æ•°åï¼Œç‚¹å‡»ç”Ÿæˆï¼Œç„¶åå¤åˆ¶ç²˜è´´åˆ°Jenkinsfile<a href="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/images/02.png" target="_blank" rel="noopener noreferrer"><img src="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/images/02.png" alt="images" loading="lazy"><ExternalLinkIcon/></a></p>
<h2 id="å£°æ˜å¼è¯­æ³•ç”Ÿæˆå™¨" tabindex="-1"><a class="header-anchor" href="#å£°æ˜å¼è¯­æ³•ç”Ÿæˆå™¨" aria-hidden="true">#</a> å£°æ˜å¼è¯­æ³•ç”Ÿæˆå™¨</h2>
<p><a href="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/images/03.png" target="_blank" rel="noopener noreferrer"><img src="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/images/03.png" alt="images" loading="lazy"><ExternalLinkIcon/></a></p>
<h2 id="å…¨å±€å˜é‡å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#å…¨å±€å˜é‡å‚è€ƒ" aria-hidden="true">#</a> å…¨å±€å˜é‡å‚è€ƒ</h2>
<p><a href="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/images/04.png" target="_blank" rel="noopener noreferrer"><img src="http://docs.idevops.site/jenkins/pipelinesyntax/chapter05/images/04.png" alt="images" loading="lazy"><ExternalLinkIcon/></a></p>
<h3 id="envå˜é‡" tabindex="-1"><a class="header-anchor" href="#envå˜é‡" aria-hidden="true">#</a> envå˜é‡</h3>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>BUILD_NUMBER          //æ„å»ºå·
BUILD_ID              //æ„å»ºå·
BUILD_DISPLAY_NAME    //æ„å»ºæ˜¾ç¤ºåç§°
JOB_NAME              //é¡¹ç›®åç§°
              
EXECUTOR_NUMBER       //æ‰§è¡Œå™¨æ•°é‡
NODE_NAME             //æ„å»ºèŠ‚ç‚¹åç§°
WORKSPACE             //å·¥ä½œç›®å½•
JENKINS_HOME          //Jenkins home
JENKINS_URL           //Jenkinsåœ°å€
BUILD_URL             //æ„å»ºåœ°å€
JOB_URL               //é¡¹ç›®åœ°å€
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="currentbuildå˜é‡" tabindex="-1"><a class="header-anchor" href="#currentbuildå˜é‡" aria-hidden="true">#</a> currentbuildå˜é‡</h3>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>result  currentResult   //æ„å»ºç»“æœ
displayName      //æ„å»ºåç§°  #111
description      //æ„å»ºæè¿°
duration         //æŒç»­æ—¶é—´
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="å¸¸ç”¨çš„æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨çš„æ–¹æ³•" aria-hidden="true">#</a> å¸¸ç”¨çš„æ–¹æ³•</h2>
<p><strong>jsonæ•°æ®å¤„ç†</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>def response = readJSON text: "${scanResult}"
println(scanResult)

//åŸç”Ÿæ–¹æ³•
import groovy.json.*

@NonCPS
def GetJson(text){
    def prettyJson = JsonOutput.prettyPrint(text) 
    new JsonSlurperClassic().parseText(prettyJson)
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>ä½¿ç”¨å‡­æ®</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>withCredentials([string(credentialsId: "xxxxx", variable: "sonarToken")]) {
    println(sonarToken)
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>ä¸‹è½½ä»£ç </strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>//Git
checkout([$class: 'GitSCM', branches: [[name: "brnachName"]], 
            doGenerateSubmoduleConfigurations: false, 
            extensions: [], submoduleCfg: [], 
            userRemoteConfigs: [[credentialsId: "${credentialsId}", 
            url: "${srcUrl}"]]])
//Svn
checkout([$class: 'SubversionSCM', additionalCredentials: [], 
            filterChangelog: false, ignoreDirPropChanges: false, 
            locations: [[credentialsId: "${credentialsId}", 
            depthOption: 'infinity', ignoreExternalsOption: true, 
            remote: "${svnUrl}"]], workspaceUpdater: [$class: 'CheckoutUpdater']]
)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>å±•ç¤ºæŠ¥å‘Š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>publishHTML([allowMissing: false, 
        alwaysLinkToLastBuild: false, 
        keepAll: true, 
        reportDir: './report/', 
        reportFiles: "a.html, b.html", 
        reportName: 'InterfaceTestReport', 
        reportTitles: 'HTML'])
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>äº¤äº’è¾“å…¥</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>def result = input  message: 'é€‰æ‹©xxxxx', 
                    ok: 'æäº¤',
                    parameters: [extendedChoice( description: 'xxxxx', 
                                                descriptionPropertyValue: '', 
                                                multiSelectDelimiter: ',', 
                                                name: 'failePositiveCases', 
                                                quoteValue: false, 
                                                saveJSONParameterToFile: false, 
                                                type: 'PT_CHECKBOX', 
                                                value: "1,2,3", 
                                                visibleItemCount: 99)]   
println(result)
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>æ„å»ºç”¨æˆ·</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>wrap([$class: 'BuildUser']){
            echo "full name is $BUILD_USER"
            echo "user id is $BUILD_USER_ID"
            echo "user email is $BUILD_USER_EMAIL"
}
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>åˆ¶å“ä¸Šä¼ </strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>rtUpload (
        serverId: "artifactory01",
        spec:
            """{
            "files": [
                {
                "pattern": "report/a.html",
                "target": "${repoName}/a/b/v"
                }
            ]
            }"""
    )
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>å‘é€httpè¯·æ±‚</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>ApiUrl = "http://xxxxxx/api/project_branches/list?project=${projectName}"
Result = httpRequest authentication: 'xxxxxxxxx',
                         quiet: true, 
                         contentType: 'APPLICATION_JSON' ,  
                         url: "${ApiUrl}"
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></template>

<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://clay-wangzhi.com/web/nginx/first.html"><meta property="og:site_name" content="SRE运维进阶之路"><meta property="og:title" content="1. 初识Nginx"><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-04-19T13:08:31.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Nginx"><meta property="article:published_time" content="2020-03-20T00:00:00.000Z"><meta property="article:modified_time" content="2023-04-19T13:08:31.000Z"><link rel="stylesheet" href="//at.alicdn.com/t/font_2541777_75xscujk71.css"><title>1. 初识Nginx | SRE运维进阶之路</title><meta name="description" content="Keep Learning">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.13bf19b5.css">
    <link rel="modulepreload" href="/assets/app.bb7a353b.js"><link rel="modulepreload" href="/assets/first.html.a5efdaf5.js"><link rel="modulepreload" href="/assets/first.html.92939a5d.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/lufei.jpg" alt="SRE运维进阶之路"><!----><span class="site-name hide-in-pad">SRE运维进阶之路</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="云原生"><span class="title"><i class="icon iconfont icon-yunyuanshengpingtai"></i>云原生</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/cloudnative/kubernetes/" class="nav-link" arialabel="Kubernetes"><i class="icon iconfont icon-kubernetes"></i>Kubernetes<!----></a></li><li class="dropdown-item"><a href="/cloudnative/docker/" class="nav-link" arialabel="Docker"><i class="icon iconfont icon-docker"></i>Docker<!----></a></li><li class="dropdown-item"><a href="/cloudnative/etcd/" class="nav-link" arialabel="etcd"><i class="icon iconfont icon-icon_etcd"></i>etcd<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="基础知识"><span class="title"><i class="icon iconfont icon-jichu"></i>基础知识</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/basic/system/" class="nav-link" arialabel="操作系统"><i class="icon iconfont icon-caozuoxitong"></i>操作系统<!----></a></li><li class="dropdown-item"><a href="/basic/network/" class="nav-link" arialabel="计算机网络"><i class="icon iconfont icon-wangluo"></i>计算机网络<!----></a></li><li class="dropdown-item"><a href="/basic/linux/" class="nav-link" arialabel="Linux运维"><i class="icon iconfont icon-linux"></i>Linux运维<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="编程语言"><span class="title"><i class="icon iconfont icon-code"></i>编程语言</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/code/shell/" class="nav-link" arialabel="Shell"><i class="icon iconfont icon-shell"></i>Shell<!----></a></li><li class="dropdown-item"><a href="/code/python/" class="nav-link" arialabel="Python"><i class="icon iconfont icon-python"></i>Python<!----></a></li><li class="dropdown-item"><a href="/code/golang/" class="nav-link" arialabel="Golang"><i class="icon iconfont icon-golang"></i>Golang<!----></a></li><li class="dropdown-item"><a href="/code/frontend/" class="nav-link" arialabel="前端开发"><i class="icon iconfont icon-vue"></i>前端开发<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="可观测性"><span class="title"><i class="icon iconfont icon-jiankong"></i>可观测性</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/monitor/prometheus/" class="nav-link" arialabel="Prometheus"><i class="icon iconfont icon-prometheus"></i>Prometheus<!----></a></li><li class="dropdown-item"><a href="/monitor/grafana/" class="nav-link" arialabel="Grafana"><i class="icon iconfont icon-grafana"></i>Grafana<!----></a></li><li class="dropdown-item"><a href="/monitor/elk/" class="nav-link" arialabel="ELK"><i class="icon iconfont icon-elastic"></i>ELK<!----></a></li><li class="dropdown-item"><a href="/monitor/zabbix/" class="nav-link" arialabel="Zabbix"><i class="icon iconfont icon-zabbix1"></i>Zabbix<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/devops/" class="nav-link" arialabel="devops"><i class="icon iconfont icon-devops"></i>devops<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="负载均衡"><span class="title"><i class="icon iconfont icon-webkuangjia"></i>负载均衡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/web/nginx/" class="nav-link active" arialabel="Nginx"><i class="icon iconfont icon-nginx"></i>Nginx<!----></a></li><li class="dropdown-item"><a href="/web/tomcat/" class="nav-link" arialabel="Tomcat"><i class="icon iconfont icon-tomcat"></i>Tomcat<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="数据库"><span class="title"><i class="icon iconfont icon-shujuku"></i>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/db/mysql/" class="nav-link" arialabel="MySQL"><i class="icon iconfont icon-mysql"></i>MySQL<!----></a></li><li class="dropdown-item"><a href="/db/redis/" class="nav-link" arialabel="Redis"><i class="icon iconfont icon-redis"></i>Redis<!----></a></li></ul></button></div></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/clay-wangzhi/wiki" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewbox="0 0 1024 1024" arialabelledby="outlook"><title id="outlook" lang="en">outlook icon</title><g fill="currentColor"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></g></svg><div class="outlook-dropdown"><!----></div></button></div><div id="docsearch-container"></div><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><i class="icon iconfont icon-nginx"></i><span class="title">Nginx</span><span class="arrow down"></span></button><!--[--><!--[--><ul class="sidebar-links"><li><!--[--><a href="/web/nginx/" class="nav-link sidebar-link sidebar-page" arialabel="Nginx 学习笔记"><i class="icon iconfont icon-nginx"></i>Nginx 学习笔记<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/web/nginx/first.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" arialabel="1. 初识Nginx"><!---->1. 初识Nginx<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_1-nginx的三个主要应用场景" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1 Nginx的三个主要应用场景"><!---->1 Nginx的三个主要应用场景<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_1-1-反向代理服务" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="1.1 反向代理服务"><!---->1.1 反向代理服务<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_2-nginx的优点" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="2 Nginx的优点"><!---->2 Nginx的优点<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_3-nginx的组成" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="3 Nginx的组成"><!---->3 Nginx的组成<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_4-编译安装nginx" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4 编译安装Nginx"><!---->4 编译安装Nginx<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_4-1-下载nginx" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.1 下载Nginx"><!---->4.1 下载Nginx<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_4-2-介绍各目录" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.2 介绍各目录"><!---->4.2 介绍各目录<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_4-3-configure" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.3 Configure"><!---->4.3 Configure<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_4-4-中间件介绍" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.4 中间件介绍"><!---->4.4 中间件介绍<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_4-5-编译" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.5 编译"><!---->4.5 编译<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_4-6-安装" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="4.6 安装"><!---->4.6 安装<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_5-nginx配置语法" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5 Nginx配置语法"><!---->5 Nginx配置语法<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_5-1-配置参数" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="5.1 配置参数"><!---->5.1 配置参数<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_6-nginx配置文件结构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6 Nginx配置文件结构"><!---->6 Nginx配置文件结构<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_6-1-基本结构" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.1 基本结构"><!---->6.1 基本结构<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_6-2-全局块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.2 全局块"><!---->6.2 全局块<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_6-3-events块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.3 events块"><!---->6.3 events块<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_6-4-http块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.4 http块"><!---->6.4 http块<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_6-5-server块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.5 server块"><!---->6.5 server块<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_6-6-location块" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="6.6 location块"><!---->6.6 location块<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_7-nginx命令行" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7 Nginx命令行"><!---->7 Nginx命令行<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_7-1-重载配置文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.1 重载配置文件"><!---->7.1 重载配置文件<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_7-2-热部署" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.2  热部署"><!---->7.2  热部署<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web/nginx/first.html#_7-3-切割日志文件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" arialabel="7.3 切割日志文件"><!---->7.3 切割日志文件<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a href="/web/nginx/framework.html" class="nav-link sidebar-link sidebar-page" arialabel="2. nginx架构基础"><!---->2. nginx架构基础<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><a href="/web/nginx/config.html" class="title">3. nginx配置文件详解</a><span class="arrow right"></span></button><!--[--><!--[--><!----><!--]--><!----><!--]--></section><!--]--></li><li><!--[--><a href="/web/nginx/core.html" class="nav-link sidebar-link sidebar-page" arialabel="4. 内核参数优化"><!---->4. 内核参数优化<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web/nginx/status.html" class="nav-link sidebar-link sidebar-page" arialabel="5. 状态码"><!---->5. 状态码<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web/nginx/qa.html" class="nav-link sidebar-link sidebar-page" arialabel="6. nginx的常见问题"><!---->6. nginx的常见问题<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul><!--]--><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><i class="icon iconfont icon-tomcat"></i><span class="title">Tomcat</span><span class="arrow right"></span></button><!--[--><!--[--><!----><!--]--><!----><!--]--></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->1. 初识Nginx</h1><div class="article-info"><span class="author-info" arialabel="作者🖊" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://clay-wangzhi.com" target="_blank" rel="noopener noreferrer">Clay</a></span><span property="author" content="Clay"></span></span><!----><span class="date-info" arialabel="写作日期📅" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2020年3月20日</span><meta property="datePublished" content="2020-03-20T00:00:00.000Z"></span><span class="category-info" arialabel="分类🌈" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category category8 clickable" role="navigation">web中间件</li><meta property="articleSection" content="web中间件"></ul></span><span arialabel="标签🏷" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag tag4 clickable" role="navigation">Nginx</li></ul><meta property="keywords" content="Nginx"></span><span class="reading-time-info" arialabel="阅读时间⌛" data-balloon-pos="down" isoriginal="false" pageview="false" color="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" arialabelledby="timer"><title id="timer" lang="en">timer icon</title><g fill="currentColor"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></g></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_1-nginx的三个主要应用场景" class="router-link-active router-link-exact-active toc-link level2">1 Nginx的三个主要应用场景</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_1-1-反向代理服务" class="router-link-active router-link-exact-active toc-link level3">1.1 反向代理服务</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_2-nginx的优点" class="router-link-active router-link-exact-active toc-link level2">2 Nginx的优点</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_3-nginx的组成" class="router-link-active router-link-exact-active toc-link level2">3 Nginx的组成</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_4-编译安装nginx" class="router-link-active router-link-exact-active toc-link level2">4 编译安装Nginx</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_4-1-下载nginx" class="router-link-active router-link-exact-active toc-link level3">4.1 下载Nginx</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_4-2-介绍各目录" class="router-link-active router-link-exact-active toc-link level3">4.2 介绍各目录</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_4-3-configure" class="router-link-active router-link-exact-active toc-link level3">4.3 Configure</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_4-4-中间件介绍" class="router-link-active router-link-exact-active toc-link level3">4.4 中间件介绍</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_4-5-编译" class="router-link-active router-link-exact-active toc-link level3">4.5 编译</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_4-6-安装" class="router-link-active router-link-exact-active toc-link level3">4.6 安装</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_5-nginx配置语法" class="router-link-active router-link-exact-active toc-link level2">5 Nginx配置语法</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_5-1-配置参数" class="router-link-active router-link-exact-active toc-link level3">5.1 配置参数</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_6-nginx配置文件结构" class="router-link-active router-link-exact-active toc-link level2">6 Nginx配置文件结构</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_6-1-基本结构" class="router-link-active router-link-exact-active toc-link level3">6.1 基本结构</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_6-2-全局块" class="router-link-active router-link-exact-active toc-link level3">6.2 全局块</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_6-3-events块" class="router-link-active router-link-exact-active toc-link level3">6.3 events块</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_6-4-http块" class="router-link-active router-link-exact-active toc-link level3">6.4 http块</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_6-5-server块" class="router-link-active router-link-exact-active toc-link level3">6.5 server块</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_6-6-location块" class="router-link-active router-link-exact-active toc-link level3">6.6 location块</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_7-nginx命令行" class="router-link-active router-link-exact-active toc-link level2">7 Nginx命令行</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_7-1-重载配置文件" class="router-link-active router-link-exact-active toc-link level3">7.1 重载配置文件</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_7-2-热部署" class="router-link-active router-link-exact-active toc-link level3">7.2  热部署</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/first.html#_7-3-切割日志文件" class="router-link-active router-link-exact-active toc-link level3">7.3 切割日志文件</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h1 id="_1-初识nginx" tabindex="-1"><a class="header-anchor" href="#_1-初识nginx" aria-hidden="true">#</a> 1. 初识Nginx</h1><h2 id="_1-nginx的三个主要应用场景" tabindex="-1"><a class="header-anchor" href="#_1-nginx的三个主要应用场景" aria-hidden="true">#</a> 1 Nginx的三个主要应用场景</h2><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20200102212417067.png" alt="" loading="lazy"></p><p>三个主要应用场景为：</p><ul><li>静态资源服务（通过本地文件系统提供服务）</li><li>反向代理服务</li><li>API服务（OpenRestydeng ）</li></ul><h3 id="_1-1-反向代理服务" tabindex="-1"><a class="header-anchor" href="#_1-1-反向代理服务" aria-hidden="true">#</a> 1.1 反向代理服务</h3><h4 id="_1-1-1-负载均衡" tabindex="-1"><a class="header-anchor" href="#_1-1-1-负载均衡" aria-hidden="true">#</a> 1.1.1 负载均衡</h4><p>负载均衡，一般包含两方面的含义。</p><ul><li><p>一方面是，将单一的重负载分担到多个网络节点上做并行处理，每个节点处理结束后将结构汇总返回给用户，这样可以大幅提高网络系统的处理能力；</p></li><li><p>第二个方面的含义是，将大量的前段并发访问或数据流量分担到多个后端网络节点上分别处理，这样可以有效减少前端用户等待响应的时间。</p></li></ul><p>Web服务器、FTP服务器、企业关键应用服务器等关键应用服务器等网络应用方面谈到的负载均衡问题，基本隶属于后一方面的含义。</p><p>因此，Nginx服务器的负载均衡主要是对大量前端访问和流量进行分流，以保证前端用户访问效率。可以说，在绝大多数的Nginx应用中，都会或多或少涉及它的负载均衡服务。</p><h5 id="复制均衡策略" tabindex="-1"><a class="header-anchor" href="#复制均衡策略" aria-hidden="true">#</a> 复制均衡策略</h5><p>即内置策略和扩展策略。</p><ol><li><p>内置策略主要包括轮询、加权轮询和IP hash三种；</p></li><li><p>扩展策略主要通过第三方模块实现，种类比较丰富，常见的有url hash、fair等。</p></li></ol><blockquote><p>在默认情况下，内置策略会被编译进Nginx内核，使用时只需要在Nginx服务器配置中设置相关参数即可；</p><p>扩展策略不会编译进Nginx内核，需要手动将第三方模块编译到Nginx内核。</p></blockquote><p><strong>轮询</strong></p><p>轮询策略比较简单，就是将前端请求按顺序（时间顺序或者排列次序）逐一分配到不同的后端节点上，对于出现问题的后端节点自动排除。</p><p><strong>加权轮询</strong></p><p>加权轮询策略，顾名思义，就是在基本的轮询策略上考虑各后端节点接受请求的权重，指定各后端节点被轮询到的几率。</p><p>加权轮询策略主要用于后端节点不均的情况。根据后端节点性能的实际情况，我们可以在Nginx服务器的配置文件中调整权值，使得整个网络对前端请求达到最佳的响应能力。</p><p><strong>IP hash</strong></p><p><code>IP hash</code>策略，是将前端的访问<code>IP</code>进行<code>hash</code>操作，然后根据<code>hash</code>结果将请求分配给不同的后端节点。</p><p>事实上，这种策略可以看作是一种特殊的轮询策略。</p><p>通过Nginx的实现，每个前端访问IP会固定访问一个后端节点。这样做的好处是避免考虑前端用户的session在后端多个节点上共享的问题。</p><p><strong>url hash</strong></p><p>扩展策略中的<code>url hash</code>在形式上和<code>IP hash</code>相近，不同之处在于，<code>IP hash</code>策略是对前端访问IP进行了hash操作，而<code>url hash</code>策略是对前端请求的<code>url</code>进行了<code>hash</code>操作。<code>url hash</code>策略的优点在于，如果后端有缓存服务器，它能够高缓存效率，同时也解决了<code>session</code>的问题；但其缺点是，如果后端节点出现异常，它不能自动排除该节点。后端节点出现异常会导致Nginx服务器返回503错误。</p><p><strong>fair</strong></p><p>扩展的第三方模块<code>fair</code>则是从另一个角度来实现Nginx服务器负载均衡策略的。该模块将前端请求转发到一个最近负载最小的后台节点。Nginx通过后端节点对请求的响应时间来判断负载情况。响应时间短的节点负载相对就轻。得出判断结果后，Nginx就将前端请求转发到选中的负载最轻的节点。</p><p><strong>least_conn</strong></p><p>最少连接</p><h4 id="_1-1-2-web缓存" tabindex="-1"><a class="header-anchor" href="#_1-1-2-web缓存" aria-hidden="true">#</a> 1.1.2 Web缓存</h4><p>Squid在Web服务器领域中是一款相当流行的开源代理服务器和Web缓存服务器。作为网页服务器的前置缓存服务器，在很多优秀的站点中，它被用以缓存前端请求，从而提高Web服务器的性能；而且，它还可以缓存万维网、域名系统或者其他网络搜索等，为一个集体提供网路资源共享服务。</p><p>Nginx服务器从0.7.48版本开始，也支持了和Squid类似的缓存功能。</p><p>Nginx服务器的Web缓存服务主要由Proxy_Cache相关指令集和FastCGI_Cache相关指令集构成。</p><p>其中，Proxy_Cache主要用于在Nginx服务器提供反向代理服务时，对后端源服务器的返回内容进行URL缓存；</p><p>FastCGI_Cache主要用于对FastCGI的动态程序进行缓存。</p><p>另外还有一款常用的第三方模块ngx_cache_purge也是Nginx服务器Web缓存功能中经常用到的。它主要用于清除Nginx服务器上指定的URL缓存。</p><p>到Nginx 0.8.32版本，Proxy_Cache和FastCGI_Cache两部分的功能已经比较完善，再配合第三方的ngx_cache_purge模块，Nginx服务器已经具备了Squid所拥有的Web缓存加速功能和清除指定URL缓存的功能；</p><p>同时，Nginx服务器对多核CPU的调度比Squid更胜一筹，性能高于Squid，而在反向代理、负载均衡等其他方面，Nginx也不逊于Squid。这使得Nginx服务器可以同时作为负载均衡服务器和Web缓存服务器来使用，基本可以取代Squid。</p><h2 id="_2-nginx的优点" tabindex="-1"><a class="header-anchor" href="#_2-nginx的优点" aria-hidden="true">#</a> 2 Nginx的优点</h2><p><strong>nginx的优点</strong></p><ul><li><p>轻量级，同样起web服务比apache占用更少内存及资源；</p></li><li><p>Nginx 异步非阻塞的方式处理高并发请求，能保持低资源、低消耗、高性能；</p></li><li><p>高度模块化设计，编写模块相对简单，生态圈强大。</p></li><li><p>核心优点：高并发、高性能、高可扩展、高可靠性、热部署、BSD许可证。</p></li></ul><p><strong>Nginx为什么性能高、占用内存少？</strong></p><ul><li>Nginx采用多进程模式，对每个worker进程来说，独立的进程不需要加锁，互不影响；</li><li>一个进程退出后，其他进程继续工作，服务不会中断，master进程则很快启动新的worker进程；</li><li>worker进程异常退出肯定是程序有bug导致，但也只会影响当前worker上的请求，不会影响到其他进程的请求，降低风险；</li><li>Nginx采用异步非阻塞的方式去处理请求，更加高效。</li></ul><h2 id="_3-nginx的组成" tabindex="-1"><a class="header-anchor" href="#_3-nginx的组成" aria-hidden="true">#</a> 3 Nginx的组成</h2><ol><li>Nginx二进制可执行文件 <ul><li>由各模块源码编译出的一个文件</li></ul></li><li><code>nginx.conf</code>配置文件 <ul><li>控制<code>nginx</code>的行为</li></ul></li><li><code>access.log</code>访问日志 <ul><li>记录每一条http请求信息</li></ul></li><li><code>error.log</code>错误日志 <ul><li>定位问题</li></ul></li></ol><h2 id="_4-编译安装nginx" tabindex="-1"><a class="header-anchor" href="#_4-编译安装nginx" aria-hidden="true">#</a> 4 编译安装Nginx</h2><h3 id="_4-1-下载nginx" tabindex="-1"><a class="header-anchor" href="#_4-1-下载nginx" aria-hidden="true">#</a> 4.1 下载Nginx</h3><blockquote><p>nginx下载地址：http://nginx.org/download/</p><p>在官网找最新稳定版使用：http://nginx.org/en/download.html</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt
wget http://nginx.org/download/nginx-1.16.1.tar.gz
tar -xvf nginx-1.16.1.tar.gz
cd nginx-1.16.1/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_4-2-介绍各目录" tabindex="-1"><a class="header-anchor" href="#_4-2-介绍各目录" aria-hidden="true">#</a> 4.2 介绍各目录</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ls</span>
auto  CHANGES  CHANGES.ru  conf  configure  contrib  html  LICENSE  <span class="token function">man</span>  README  src
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><p>auto：包含了很多会在执行configure进行编译配置时调用的检测代码。</p></li><li><p>CHANGES：Nginx的版本更新细节记录。英文版。</p></li><li><p>CHANGES.ru：Nginx的版本更新细节记录。俄文版。</p></li><li><p>conf：Nginx提供的一些默认配置文件。</p></li><li><p>configure：根据系统环境设定Nginx编译选项的执行脚本。</p></li><li><p>contrib：网友贡献的一些有用脚本（对我来说，里面的vim设置很有用，README中有使用方法）。</p><ul><li><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>把contrib/vim下的文件移入~/.vim目录下，让vim识别nginx的配置文件节点；
cp -r contrib/vim/* ~/.vim
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li><li><p>html：提供了两个默认html页面，比如index.html的Welcome to nginx!。</p></li><li><p>LICENSE：声明的Nginx源码许可协议。</p></li><li><p>man：Nginx的Man手册，本文文件，可直接用vi或记事本打开。</p></li><li><p>README：读我文件，内容很简单，通告一下官网地址。</p></li><li><p>src：Nginx源码，分门别类，比如实现事件的event等，很清晰。</p></li></ul><h3 id="_4-3-configure" tabindex="-1"><a class="header-anchor" href="#_4-3-configure" aria-hidden="true">#</a> 4.3 Configure</h3><p>先安装相关依赖</p><blockquote><p>gzip模块需要zlib库</p><p>rewrite模块需要pcre库</p><p>ssl功能需要openssl库</p></blockquote><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>yum -y install gcc gcc-c++ make zlib-devel pcre-devel openssl-devel
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>然后运行<code>configure</code>文件</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># ./configure --help
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>--prefix ：指定安装目录</li><li>--with：新增模块</li><li>--without：删除默认模块</li></ul><p>运行期中与路径相关的各种参数</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>--prefix=PATH                        #指向安装目录
--sbin-path=PATH                     #指向（执行）程序文件（nginx）
--conf-path=PATH                     #指向配置文件（nginx.conf）
--error-log-path=PATH                #指向错误日志目录
--http-log-path=PATH                 #指定访问日志目录
--pid-path=PATH                      #指向pid文件（nginx.pid）
--lock-path=PATH                     #指向lock文件（nginx.lock）（安装文件锁定，防止安装文件被别人利用，或自己误操作。）
--builddir=PATH                      #指向编译目录
--http-client-body-temp-path=PATH    #设定http客户端请求临时文件路径
--http-proxy-temp-path=PATH          #设定http代理临时文件路径
--http-fastcgi-temp-path=PATH        #设定http fastcgi临时文件路径
--http-uwsgi-temp-path=PATH          #设定http uwsgi临时文件路径
--http-scgi-temp-path=PATH           #设定http scgi临时文件路径

--user=USER                          #指定程序运行时的非特权用户
--group=USER                         #指定程序运行时的非特权用户组

--with-rtsig_module                  #启用rtsig模块支持（实时信号）
--with-file-aio                      #启用file aio支持（一种APL文件传输格式）
--with-ipv6                          #启用ipv6支持
--with-select_module                 #启用select模块支持（一种轮询模式,不推荐在高载环境下使用）禁用：--without-select_module
--with-poll_module                   #启用poll模块支持（功能与select相同，与select特性相同，为一种轮询模式,不推荐在高载环境下使用）
--with-http_ssl_module               #启用支持https请求，需已安装openssl
--with-http_realip_module            #启用ngx_http_realip_module支持（这个模块允许从请求标头更改客户端的IP地址值，默认为关）
--with-http_addition_module          #启用ngx_http_addition_module支持（作为一个输出过滤器，支持不完全缓冲，分部分响应请求）
--with-http_xslt_module              #启用ngx_http_xslt_module支持（过滤转换XML请求）
--with-http_image_filter_module      #启用支持传输JPEG/GIF/PNG 图片过滤，默认为不启用，gd库要用到
--with-http_sub_module               #启用ngx_http_sub_module支持（允许用一些其他文本替换nginx响应中的一些文本）
--with-http_dav_module               #启用ngx_http_dav_module支持（增加PUT,DELETE,MKCOL：创建集合,COPY和MOVE方法）
--with-http_flv_module               #启用ngx_http_flv_module支持（提供寻求内存使用基于时间的偏移量文件）
--with-http_gzip_static_module       #启用ngx_http_gzip_static_module支持（在线实时压缩输出数据流）
--with-http_random_index_module      #启用ngx_http_random_index_module支持（从目录中随机挑选一个目录索引）
--with-http_secure_link_module       #启用ngx_http_secure_link_module支持（计算和检查要求所需的安全链接网址）
--with-http_degradation_module       #启用ngx_http_degradation_module支持（允许在内存不足的情况下返回204或444码）
--with-http_stub_status_module       #启用ngx_http_stub_status_module支持（获取nginx自上次启动以来的工作状态）
--with-http_perl_module              #启用ngx_http_perl_module支持（该模块使nginx可以直接使用perl或通过ssi调用perl）

--with-mail                          #启用POP3/IMAP4/SMTP代理模块支持
--with-mail_ssl_module               #启用ngx_mail_ssl_module支持
--add-module=                        #启用外部模块支持
--with-cpu-opt=                      #指定编译的CPU，可用的值为: pentium,opteron, amd64, sparc32, sparc64, ppc64等
--with-pcre                          #启用pcre库（默认会自动去找rpm包安装的pcre库文件以及模块）
--with-pcre=                         #指向pcre库文件目录（如果是源码安装就需要指定，rpm包安装就不需要指定了）
--with-pcre-opt=                     #在编译时为pcre库设置附加参数
--with-perl_modules_path=            #设定perl模块路径
--with-perl=                         #设定perl库文件路径
--with-debug                         #启用debug日志
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>安装额外的echo模块</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt
git clone https://github.com/openresty/echo-nginx-module
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>./configure \
--prefix=/etc/nginx \
--sbin-path=/usr/sbin/nginx \
--conf-path=/etc/nginx/nginx.conf \
--error-log-path=/var/log/nginx/error.log \
--http-log-path=/var/log/nginx/access.log \
--pid-path=/var/run/nginx.pid \
--lock-path=/var/run/nginx.lock \
--http-client-body-temp-path=/var/cache/nginx/client_temp \
--http-proxy-temp-path=/var/cache/nginx/proxy_temp \
--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \
--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \
--http-scgi-temp-path=/var/cache/nginx/scgi_temp \
--user=nginx \
--group=nginx \
--with-compat \
--with-file-aio \
--with-threads \
--with-http_addition_module \
--with-http_auth_request_module \
--with-http_dav_module \
--with-http_flv_module \
--with-http_gunzip_module \
--with-http_gzip_static_module \
--with-http_mp4_module \
--with-http_random_index_module \
--with-http_realip_module \
--with-http_secure_link_module \
--with-http_slice_module \
--with-http_ssl_module \
--with-http_stub_status_module \
--with-http_sub_module \
--with-http_v2_module \
--with-pcre \
--with-mail \
--with-mail_ssl_module \
--with-stream \
--with-stream_realip_module \
--with-stream_ssl_module \
--with-stream_ssl_preread_module \
--with-cc-opt=&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#39; \
--with-ld-opt=&#39;-Wl,-z,relro -Wl,-z,now -pie&#39; \
--add-module=/opt/echo-nginx-module

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>执行完后，会生成<code>objs</code>目录</p><p>目录下的关键文件<code>ngx_modules.c</code>，它决定了我们编译nginx时，哪些模块会被编译进nginx</p><h3 id="_4-4-中间件介绍" tabindex="-1"><a class="header-anchor" href="#_4-4-中间件介绍" aria-hidden="true">#</a> 4.4 中间件介绍</h3><p>中间件放在<code>objs/src</code>目下</p><h3 id="_4-5-编译" tabindex="-1"><a class="header-anchor" href="#_4-5-编译" aria-hidden="true">#</a> 4.5 编译</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>make -j 4
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>-j 参数，指定编译时的CPU数量，可加快编译速度</li></ul><p>执行完后，在<code>objs</code>目录下生成二进制可执行文件</p><blockquote><p>注意：如何这时，我们是升级nginx，现在就不需要<code>make install</code>了</p></blockquote><h3 id="_4-6-安装" tabindex="-1"><a class="header-anchor" href="#_4-6-安装" aria-hidden="true">#</a> 4.6 安装</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>make install
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>执行完成后，会在<code>--prefix</code>目录下生成四个目录，我这里是<code>/home/clay</code>目录下</p><ul><li>conf： 配置文件目录</li><li>html：默认的静态页面存放目录</li><li>logs：默认access和error log存放目录</li><li>sbin：二进制可执行文件<code>nginx</code>存放目录</li></ul><blockquote><p>安装nginx，个人还是推荐yum源安装（里面自动包含了日志切割等）</p><p>可以yum源安装完成之后，再定制化模块，二次编译</p></blockquote><h2 id="_5-nginx配置语法" tabindex="-1"><a class="header-anchor" href="#_5-nginx配置语法" aria-hidden="true">#</a> 5 Nginx配置语法</h2><ol><li>配置文件由指令与指令块构成</li><li>每条指令以<code>;</code>分号结尾，指令与参数见以空格符号分隔</li><li>指令块以<code>{ }</code>大括号将多条指令组织在一起</li><li><code>include</code>语句允许组合多个配置文件以提升可维护性</li><li>使用<code>#</code>符号添加注释，提高可读性</li><li>使用<code>$</code>符号，使用变量</li><li>部分指令的参数支持正则表达式</li></ol><p><strong>Example</strong></p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span> mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">upstream</span> thwp</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> http2</span><span class="token punctuation">;</span>
        <span class="token comment"># Nginx配置语法</span>
        <span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=one:10m rate=1r/s</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|jpeg)$</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">proxy_cache</span> my_cache</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">expires</span> <span class="token number">3m</span></span><span class="token punctuation">;</span>proxy_cache_key $host$uri$is_args$args<span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">304</span> <span class="token number">302</span> <span class="token number">1d</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span> http://thwp</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_5-1-配置参数" tabindex="-1"><a class="header-anchor" href="#_5-1-配置参数" aria-hidden="true">#</a> 5.1 配置参数</h3><h4 id="_5-1-1-时间单位" tabindex="-1"><a class="header-anchor" href="#_5-1-1-时间单位" aria-hidden="true">#</a> 5.1.1 时间单位</h4><ul><li>ms：milliseconds</li><li>s：seconds</li><li>m：minutes</li><li>h：hours</li><li>d：days</li><li>w：weeks</li><li>M：months，30 days</li><li>y：years，365 days</li></ul><h4 id="_5-1-2-空间单位" tabindex="-1"><a class="header-anchor" href="#_5-1-2-空间单位" aria-hidden="true">#</a> 5.1.2 空间单位</h4><ul><li>b/B：bytes</li><li>k/K：kilobytes</li><li>m/M：megabytes</li><li>g/G：gifabytes</li></ul><h2 id="_6-nginx配置文件结构" tabindex="-1"><a class="header-anchor" href="#_6-nginx配置文件结构" aria-hidden="true">#</a> 6 Nginx配置文件结构</h2><p>nginx配置文件如下：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">user</span> nginx</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span> auto</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/error.log</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span> /run/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">include</span> /usr/share/nginx/modules/\*.conf</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">log_format</span>  main  <span class="token string">&#39;<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; &#39;</span>
                      <span class="token string">&#39;<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; &#39;</span>
                      <span class="token string">&#39;&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;&#39;</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">access_log</span>  /var/log/nginx/access.log  main</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">sendfile</span>            <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span>          <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nodelay</span>         <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span>   <span class="token number">65</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">types_hash_max_size</span> <span class="token number">2048</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span>             /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>        application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/conf.d/\*.conf</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span> default_server</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">listen</span>       [::]:80 default_server</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span>  _</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span>         /usr/share/nginx/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">include</span> /etc/nginx/default.d/\*.conf</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /404.html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">location</span> = /40x.html</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="_6-1-基本结构" tabindex="-1"><a class="header-anchor" href="#_6-1-基本结构" aria-hidden="true">#</a> 6.1 基本结构</h3><ol><li>全局块</li><li><code>events</code>块</li><li><code>http</code>块</li></ol><p>在http块中，又包含http全局块、多个server块。</p><p>每个server块中，可以包含server全局块和多个location块。</p><p>在同一配置块中嵌套的配置块，各个之间不存在次序关系。</p><p>配置文件支持大量可配置的指令，绝大多数指令不是特定属于某一个块的。同一个指令放在不同层级的块中，其作用域也不同，一般情况下，高一级块中的指令可以作用域自身所在的块和此块包含的所有低层级块。如果某个指令在两个不同层级的块中同时出现，则采用“就近原则”，即以较低层级块中的配置为准。</p><h3 id="_6-2-全局块" tabindex="-1"><a class="header-anchor" href="#_6-2-全局块" aria-hidden="true">#</a> 6.2 全局块</h3><p>通常包括配置运行Nginx服务器的用户（组）、允许生成的worker process数、Nginx进程PID存放路径、日志的存放路径和类型以及配置文件引入等。</p><h3 id="_6-3-events块" tabindex="-1"><a class="header-anchor" href="#_6-3-events块" aria-hidden="true">#</a> 6.3 events块</h3><p>events块涉及的指令主要影响Nginx服务器与用户的网络连接。常用到的设置包括是否开启对多worker process下的网络连接进行序列化，是否允许同时接收多个网络连接，选取哪种事件驱动模型处理连接请求，每个worker process可以同时支持的最大连接数等。</p><p>这一部分的指令对Nginx服务器的性能影响较大，在实际配置中应该根据实际情况灵活调整。</p><h3 id="_6-4-http块" tabindex="-1"><a class="header-anchor" href="#_6-4-http块" aria-hidden="true">#</a> 6.4 http块</h3><p>http块是Nginx服务器配置中重要部分，代理、缓存和日志定义等绝大多数的功能和第三方模块可以放在这个模块中。</p><ul><li>http</li><li>upstream</li><li>server</li><li>location</li></ul><h3 id="_6-5-server块" tabindex="-1"><a class="header-anchor" href="#_6-5-server块" aria-hidden="true">#</a> 6.5 server块</h3><p>server块和“虚拟主机”的概念密切联系。为了加深相关配置的理解，在介绍server块之前，简单了解一下虚拟主机的相关内容。</p><p>虚拟主机，又称虚拟服务器、主机空间或网页空间，它是一种技术。该技术是为了节省互联网服务器硬件成本而出现的。这里的“主机”或“空间”是由实体的服务器延伸而来，硬件系统可以基于服务器群，或者单个服务器等。对外表现为多个服务器，从而充分利用服务器硬件资源。从用户角度看，一台虚拟主机和一台独立的硬件主机是完全一样的。</p><p>在使用Nginx服务器提供Web服务是，利用虚拟主机的技术就可以避免为每一个要运行的网站提供单独的Nginx服务器，也无需为每个网站对应运行一组Nginx进程。虚拟主机技术使得Nginx服务器可以在同一台服务器上只运行一组Nginx进程，就可以运行多个网站。</p><p>和http块相同，server块也可以包含自己的全局块，同时可以包含多个location块。在server全局块中，最常见的两个配置项是本虚拟主机的监听配置和本虚拟主机的名称或IP配置。</p><h3 id="_6-6-location块" tabindex="-1"><a class="header-anchor" href="#_6-6-location块" aria-hidden="true">#</a> 6.6 location块</h3><p>每个server块中可以包含多个location块。从严格意义上说，location其实是server块的一个指令，只是由于其在整个Nginx配置文档中起着重要的作用，而且Nginx服务器在许多功能上的灵活性往往在location指令的配置中体现出来。</p><h2 id="_7-nginx命令行" tabindex="-1"><a class="header-anchor" href="#_7-nginx命令行" aria-hidden="true">#</a> 7 Nginx命令行</h2><ol><li>格式：<code>nginx -s reload</code></li><li>帮助：<code>-?</code> <code>-h</code></li><li>使用指定的配置位置：<code>-c</code></li><li>指定配置指令：<code>-g</code></li><li>指定运行目录：<code>-p</code></li><li>发送信号：<code>-s</code><ul><li>立刻停止服务：<code>stop</code></li><li>优雅的停止服务：<code>quit</code></li><li>重载配置文件：<code>reload</code></li><li>重新开始记录日志文件：<code>reopen</code></li></ul></li><li>测试配置文件是否有语法错误：<code>-t</code> <code>-T</code></li><li>打印<code>nginx</code>的版本信息、编译信息：<code>-v</code> <code>-V</code></li></ol><h3 id="_7-1-重载配置文件" tabindex="-1"><a class="header-anchor" href="#_7-1-重载配置文件" aria-hidden="true">#</a> 7.1 重载配置文件</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx -s reload
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_7-2-热部署" tabindex="-1"><a class="header-anchor" href="#_7-2-热部署" aria-hidden="true">#</a> 7.2 热部署</h3><p>只是更换二进制文件</p><ol><li>备份旧的nginx文件</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /home/clay/sbin/
cp nginx nginx.old
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2）将新的编译好的二进制文件，替换掉现在正在运行的二进制文件</p><p>首先重新编译出一个<code>nginx</code>二进制可执行文件，<code>./configure</code>然后<code>make</code>，千万不要<code>make install</code>，执行那<code>make</code>就可以了</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>cd /opt/nginx-1.16.1/
cp -f objs/nginx /home/clay/sbin/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>3）给master进程发送<code>USR2</code>信号</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># ps -ef|grep nginx
root      6159 57006  0 11:18 pts/0    00:00:00 grep --color=auto nginx
root     63076     1  0 09:46 ?        00:00:00 nginx: master process /home/clay/sbin/nginx
nobody   63103 63076  0 09:46 ?        00:00:00 nginx: worker process
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># kill -USR2 63076
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># ps -ef|grep nginx
root      6216 63076  0 11:19 ?        00:00:00 nginx: master process /home/clay/sbin/nginx
nobody    6217  6216  0 11:19 ?        00:00:00 nginx: worker process
root      6225 57006  0 11:19 pts/0    00:00:00 grep --color=auto nginx
root     63076     1  0 09:46 ?        00:00:00 nginx: master process /home/clay/sbin/nginx
nobody   63103 63076  0 09:46 ?        00:00:00 nginx: worker process
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># netstat -nplt| grep 80
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      6216/nginx: master  
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>4）关闭旧的woker进程，<code>kill -WINCH</code>旧的master进程号</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># kill -WINCH 63076
# ps -ef|grep nginx
root      6216 63076  0 11:19 ?        00:00:00 nginx: master process /home/clay/sbin/nginx
nobody    6217  6216  0 11:19 ?        00:00:00 nginx: worker process
root      6842 57006  0 11:28 pts/0    00:00:00 grep --color=auto nginx
root     63076     1  0 09:46 ?        00:00:00 nginx: master process /home/clay/sbin/nginx
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>5）关闭旧的master进程，<code>kill -QUIT</code>旧的master进程号</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code># kill -QUIT 63076
# ps -ef|grep nginx
root      6216     1  0 11:19 ?        00:00:00 nginx: master process /home/clay/sbin/nginx
nobody    6217  6216  0 11:19 ?        00:00:00 nginx: worker process
root      6947 57006  0 11:30 pts/0    00:00:00 grep --color=auto nginx
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_7-3-切割日志文件" tabindex="-1"><a class="header-anchor" href="#_7-3-切割日志文件" aria-hidden="true">#</a> 7.3 切割日志文件</h3><p>1）mv掉原来的日志</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mv access.log access.log.bak
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2）重新打开日志文件</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>nginx -s reopen
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>简单说明一下：</strong></p><p>1、在没有执行kill -USR1 <code>cat ${pid_path}</code>之前，即便已经对文件执行了mv命令也只是改变了文件的名称，nginx还是会向新命名的文件” access.log.20161024”中照常写入日志数据。原因在于linux系统中，内核是根据文件描述符来找文件的</p><p>2、USR1是自定义信号，也就是进程编写者自己确定收到这个信号该干什么。而在nginx中它自己编写了代码当接到USR1信号的时候让nginx重新打开日志文件（重新打开的日志就是配置文件中设置的位置和名称）。</p><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/clay-wangzhi/wiki/edit/master/src/web/nginx/first.md" rel="noopener noreferrer" target="_blank" arialabel="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2023/4/19 13:08:31</span></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: clay.wangzhi@gmail.com">clay-wangzhi</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/web/nginx/" class="nav-link active prev" arialabel="Nginx 学习笔记"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><i class="icon iconfont icon-nginx"></i>Nginx 学习笔记</div></a><a href="/web/nginx/framework.html" class="nav-link next" arialabel="2. nginx架构基础"><div class="hint">下一页<span class="arrow right"></span></div><div class="link">2. nginx架构基础<!----></div></a></nav><!----><!----></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href="http://beian.miit.gov.cn/" target="_blank">备案号:冀ICP备2021007336号</a></div><div class="copyright">Copyright © 2023 Clay</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.bb7a353b.js" defer></script>
  </body>
</html>

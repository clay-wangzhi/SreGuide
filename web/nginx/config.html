<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.38" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://clay-wangzhi.com/web/nginx/config.html"><meta property="og:site_name" content="SREè¿ç»´è¿›é˜¶ä¹‹è·¯"><meta property="og:title" content="3. nginxé…ç½®æ–‡ä»¶è¯¦è§£"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-04-27T15:33:00.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="Nginx"><meta property="article:published_time" content="2020-03-20T00:00:00.000Z"><meta property="article:modified_time" content="2022-04-27T15:33:00.000Z"><link rel="stylesheet" href="//at.alicdn.com/t/font_2541777_75xscujk71.css"><title>3. nginxé…ç½®æ–‡ä»¶è¯¦è§£ | SREè¿ç»´è¿›é˜¶ä¹‹è·¯</title><meta name="description" content="Keep Learning">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.13bf19b5.css">
    <link rel="modulepreload" href="/assets/app.ac0f71d5.js"><link rel="modulepreload" href="/assets/config.html.24b0a48c.js"><link rel="modulepreload" href="/assets/config.html.376373e9.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc sidebar-open"><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/lufei.jpg" alt="SREè¿ç»´è¿›é˜¶ä¹‹è·¯"><!----><span class="site-name hide-in-pad">SREè¿ç»´è¿›é˜¶ä¹‹è·¯</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/web/nginx/cloudnative" class="nav-link" arialabel="äº‘åŸç”Ÿ"><i class="icon iconfont icon-yunyuanshengpingtai"></i>äº‘åŸç”Ÿ<!----></a></div><div class="nav-item hide-in-mobile"><a href="/basic/" class="nav-link" arialabel="åŸºç¡€çŸ¥è¯†"><i class="icon iconfont icon-jichu"></i>åŸºç¡€çŸ¥è¯†<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="ç¼–ç¨‹è¯­è¨€"><span class="title"><i class="icon iconfont icon-code"></i>ç¼–ç¨‹è¯­è¨€</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/code/shell/" class="nav-link" arialabel="Shell"><i class="icon iconfont icon-shell"></i>Shell<!----></a></li><li class="dropdown-item"><a href="/code/python/" class="nav-link" arialabel="Python"><i class="icon iconfont icon-python"></i>Python<!----></a></li><li class="dropdown-item"><a href="/code/golang/" class="nav-link" arialabel="Golang"><i class="icon iconfont icon-golang"></i>Golang<!----></a></li><li class="dropdown-item"><a href="/code/frontend/" class="nav-link" arialabel="å‰ç«¯å¼€å‘"><i class="icon iconfont icon-vue"></i>å‰ç«¯å¼€å‘<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="ç›‘æ§å·¥å…·"><span class="title"><i class="icon iconfont icon-jiankong"></i>ç›‘æ§å·¥å…·</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/monitor/zabbix/" class="nav-link" arialabel="Zabbix"><i class="icon iconfont icon-zabbix1"></i>Zabbix<!----></a></li><li class="dropdown-item"><a href="/monitor/elk/" class="nav-link" arialabel="ELK"><i class="icon iconfont icon-elastic"></i>ELK<!----></a></li><li class="dropdown-item"><a href="/monitor/prometheus/" class="nav-link" arialabel="Prometheus"><i class="icon iconfont icon-prometheus"></i>Prometheus<!----></a></li><li class="dropdown-item"><a href="/monitor/grafana/" class="nav-link" arialabel="Grafana"><i class="icon iconfont icon-grafana"></i>Grafana<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="è‡ªåŠ¨åŒ–å·¥å…·"><span class="title"><i class="icon iconfont icon-devops"></i>è‡ªåŠ¨åŒ–å·¥å…·</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/automate/jenkins/" class="nav-link" arialabel="Jenkins"><i class="icon iconfont icon-jenkins"></i>Jenkins<!----></a></li><li class="dropdown-item"><a href="/automate/ansible/" class="nav-link" arialabel="Ansible"><i class="icon iconfont icon-ansible"></i>Ansible<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="webä¸­é—´ä»¶"><span class="title"><i class="icon iconfont icon-webkuangjia"></i>webä¸­é—´ä»¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/web/nginx/" class="nav-link active" arialabel="Nginx"><i class="icon iconfont icon-nginx"></i>Nginx<!----></a></li><li class="dropdown-item"><a href="/web/tomcat/" class="nav-link" arialabel="Tomcat"><i class="icon iconfont icon-tomcat"></i>Tomcat<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" arialabel="æ•°æ®åº“"><span class="title"><i class="icon iconfont icon-shujuku"></i>æ•°æ®åº“</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/db/mysql/" class="nav-link" arialabel="MySQL"><i class="icon iconfont icon-mysql"></i>MySQL<!----></a></li><li class="dropdown-item"><a href="/db/redis/" class="nav-link" arialabel="Redis"><i class="icon iconfont icon-redis"></i>Redis<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/linux/basic/" class="nav-link" arialabel="Linux"><i class="icon iconfont icon-linux"></i>Linux<!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/clay-wangzhi/wiki" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" arialabelledby="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><title id="github" lang="en">github icon</title><g fill="currentColor"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></g></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" arialabelledby="auto" style="display:block;"><title id="auto" lang="en">auto icon</title><g fill="currentColor"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" arialabelledby="dark" style="display:none;"><title id="dark" lang="en">dark icon</title><g fill="currentColor"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></g></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" arialabelledby="light" style="display:none;"><title id="light" lang="en">light icon</title><g fill="currentColor"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></g></svg></button></div><div id="docsearch-container"></div><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><i class="icon iconfont icon-nginx"></i><span class="title">Nginx å­¦ä¹ ç¬”è®°</span><span class="arrow right"></span></button><!--[--><!--[--><!----><!--]--><!----><!--]--></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><i class="icon iconfont icon-tomcat"></i><span class="title">Tomcat å­¦ä¹ ç¬”è®°</span><span class="arrow right"></span></button><!--[--><!--[--><!----><!--]--><!----><!--]--></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->3. nginxé…ç½®æ–‡ä»¶è¯¦è§£</h1><div class="article-info"><span class="author-info" arialabel="ä½œè€…ğŸ–Š" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" arialabelledby="author"><title id="author" lang="en">author icon</title><g fill="currentColor"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></g></svg><span><a class="author-item" href="https://clay-wangzhi.com" target="_blank" rel="noopener noreferrer">Clay</a></span><span property="author" content="Clay"></span></span><!----><span class="date-info" arialabel="å†™ä½œæ—¥æœŸğŸ“…" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" arialabelledby="calendar"><title id="calendar" lang="en">calendar icon</title><g fill="currentColor"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></g></svg><span>2020å¹´3æœˆ20æ—¥</span><meta property="datePublished" content="2020-03-20T00:00:00.000Z"></span><span class="category-info" arialabel="åˆ†ç±»ğŸŒˆ" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" arialabelledby="category"><title id="category" lang="en">category icon</title><g fill="currentColor"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></g></svg><ul class="categories-wrapper"><li class="category clickable" role="navigation">webä¸­é—´ä»¶</li><meta property="articleSection" content="webä¸­é—´ä»¶"></ul></span><span arialabel="æ ‡ç­¾ğŸ·" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" arialabelledby="tag"><title id="tag" lang="en">tag icon</title><g fill="currentColor"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></g></svg><ul class="tags-wrapper"><li class="tag clickable" role="navigation">Nginx</li></ul><meta property="keywords" content="Nginx"></span><span class="reading-time-info" arialabel="é˜…è¯»æ—¶é—´âŒ›" isoriginal="false" pageview="false" color="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" arialabelledby="timer"><title id="timer" lang="en">timer icon</title><g fill="currentColor"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></g></svg><span>å¤§çº¦ 11 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT11M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc-list"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/config.html#_1-æ ·ä¾‹æ–‡ä»¶è§£é‡Š" class="router-link-active router-link-exact-active toc-link level2">1 æ ·ä¾‹æ–‡ä»¶è§£é‡Š</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web/nginx/config.html#_2-å…¨å±€å˜é‡" class="router-link-active router-link-exact-active toc-link level2">2 å…¨å±€å˜é‡</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><!--[--><h1 id="_3-nginxé…ç½®æ–‡ä»¶è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#_3-nginxé…ç½®æ–‡ä»¶è¯¦è§£" aria-hidden="true">#</a> 3. nginxé…ç½®æ–‡ä»¶è¯¦è§£</h1><p>é…ç½®æ–‡ä»¶è¯¦è§£</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">user</span> nginx</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">8</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_cpu_affinity</span> auto</span><span class="token punctuation">;</span>
<span class="token comment">#worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 10000000;</span>
<span class="token directive"><span class="token keyword">error_log</span>  /var/log/nginx/error.log  error</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span>        /var/run/nginx.pid</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_rlimit_nofile</span> <span class="token number">65535</span></span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">use</span> epoll</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">20480</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">log_format</span>  prod <span class="token string">&#39;<span class="token variable">$remote_addr|</span><span class="token variable">$remote_user|[</span><span class="token variable">$time_local]|</span><span class="token variable">$request</span>|&#39;</span>
                     <span class="token string">&#39;<span class="token variable">$status</span>|<span class="token variable">$body_bytes_sent|</span><span class="token variable">$http_referer|</span>&#39;</span>
                     <span class="token string">&#39;<span class="token variable">$http_user_agent|</span><span class="token variable">$request_time|</span><span class="token variable">$host</span>|<span class="token variable">$upstream_addr|</span><span class="token variable">$upstream_response_time</span>&#39;</span></span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">access_log</span>  /var/log/nginx/access.log  prod</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">charset</span>  utf-8</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_intercept_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_names_hash_bucket_size</span> <span class="token number">256</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_header_buffer_size</span> <span class="token number">32k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">large_client_header_buffers</span> <span class="token number">4</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment">#æ”¯æŒssiåŒ…å«æ–‡ä»¶</span>
    <span class="token directive"><span class="token keyword">ssi</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssi_silent_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token comment">#   ssi_types text/html;</span>

    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">90</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_header_timeout</span> <span class="token number">10</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_body_timeout</span> <span class="token number">20</span></span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">200m</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_body_buffer_size</span>  <span class="token number">128k</span></span><span class="token punctuation">;</span>

    <span class="token comment"># include /etc/nginx/gzip.conf;</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">4</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">&quot;MSIE [1-6]\.&quot;</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">1000</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/javascript application/x-javascript text/xml application/xml application/xml+rss text/javascript application/json image/jpeg image/gif image/png image/jpg</span><span class="token punctuation">;</span>
    

    <span class="token comment"># include /etc/nginx/proxy.conf;</span>
    <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">90</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">90</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">90</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">proxy_buffer_size</span> <span class="token number">32k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">proxy_buffers</span> <span class="token number">4</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
    
    
    <span class="token comment"># include /etc/nginx/backend.conf;</span>
    <span class="token directive"><span class="token keyword">upstream</span> my_server_pool</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">server</span> 192.168.1.109:80 weight=1 max_fails=2 fail_timeout=30</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> 192.168.1.108:80 weight=2 max_fails=2 fail_timeout=30</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/conf.d/h5.conf</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><h2 id="_1-æ ·ä¾‹æ–‡ä»¶è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#_1-æ ·ä¾‹æ–‡ä»¶è§£é‡Š" aria-hidden="true">#</a> 1 æ ·ä¾‹æ–‡ä»¶è§£é‡Š</h2><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token comment"># å¼•å…¥æ–‡ä»¶ mime.typesï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹çš„æ˜ å°„è¡¨</span>
    <span class="token directive"><span class="token keyword">include</span>       mime.types</span><span class="token punctuation">;</span>
    <span class="token comment"># æŒ‡å®šé»˜è®¤MIMEç±»å‹ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµ(å³ä¸‹è½½æ–‡ä»¶)  </span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token comment"># å®šä¹‰è¾“å‡ºæ—¥å¿—çš„æ ¼å¼</span>
    <span class="token comment"># 1.$remote_addr ä¸$http_x_forwarded_for(åå‘ä»£ç†æœåŠ¡å™¨) ç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼›</span>
    <span class="token comment"># 2.$remote_user ï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼›</span>
    <span class="token comment"># 3.$time_local ï¼šç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼›</span>
    <span class="token comment"># 4.$request  ï¼šç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®</span>
    <span class="token comment"># 5.$status ï¼šç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼› </span>
    <span class="token comment"># 6.$body_bytes_sent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›</span>
    <span class="token comment"># 7.$http_referer ï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼›</span>
    <span class="token comment"># 8.$http_user_agent ï¼šè®°å½•å®¢æˆ·ç«¯æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯</span>
    <span class="token comment"># 9.$request_time ï¼šæ•´ä¸ªè¯·æ±‚çš„æ€»æ—¶é—´</span>
    <span class="token comment"># 10.$hostå˜é‡çš„å€¼æŒ‰ç…§å¦‚ä¸‹ä¼˜å…ˆçº§è·å¾—ï¼šè¯·æ±‚è¡Œä¸­çš„host.è¯·æ±‚å¤´ä¸­çš„Hostå¤´éƒ¨.ä¸ä¸€æ¡è¯·æ±‚åŒ¹é…çš„server name.</span>
    <span class="token comment"># 11.$upstream_addr ï¼šåå°upstreamçš„åœ°å€ï¼Œå³çœŸæ­£æä¾›æœåŠ¡çš„ä¸»æœºåœ°å€ï¼Œå¦‚10.10.10.100:80</span>
    <span class="token comment"># 12.$upstream_response_time ï¼šè¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œupstreamå“åº”æ—¶é—´    </span>
    <span class="token directive"><span class="token keyword">log_format</span>  main  <span class="token string">&#39;<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; &#39;</span>
                      <span class="token string">&#39;<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; &#39;</span>
                      <span class="token string">&#39;&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;&#39;</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">log_format</span>  prod <span class="token string">&#39;<span class="token variable">$remote_addr|</span><span class="token variable">$remote_user|[</span><span class="token variable">$time_local]|</span><span class="token variable">$request</span>|&#39;</span>
                     <span class="token string">&#39;<span class="token variable">$status</span>|<span class="token variable">$body_bytes_sent|</span><span class="token variable">$http_referer|</span>&#39;</span>
                     <span class="token string">&#39;<span class="token variable">$http_user_agent|</span><span class="token variable">$request_time|</span><span class="token variable">$host</span>|<span class="token variable">$upstream_addr|</span><span class="token variable">$upstream_response_time</span>&#39;</span></span><span class="token punctuation">;</span>
    
    <span class="token comment"># æŒ‡å®šaccess_logçš„å­˜æ”¾è·¯å¾„ã€æ ¼å¼å’Œç¼“å­˜å¤§å°</span>
    <span class="token directive"><span class="token keyword">access_log</span>  /var/log/nginx/access.log  prod</span><span class="token punctuation">;</span>
    
    <span class="token comment"># æŒ‡å®šç¼–ç æ ¼å¼ï¼Œè‹¥ç½‘é¡µæ ¼å¼ä¸æ­¤ä¸åŒï¼Œå°†è¢«è‡ªåŠ¨è½¬ç </span>
    <span class="token directive"><span class="token keyword">charset</span>  utf-8</span><span class="token punctuation">;</span>
    <span class="token comment"># å…è®¸nginxä½¿ç”¨error_pageå¤„ç†é”™è¯¯ä¿¡æ¯ï¼Œä¼ é€’4xxå’Œ5xxé”™è¯¯ä¿¡æ¯åˆ°å®¢æˆ·ç«¯</span>
    <span class="token directive"><span class="token keyword">fastcgi_intercept_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">server_names_hash_bucket_size</span> <span class="token number">256</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_header_buffer_size</span> <span class="token number">32k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">large_client_header_buffers</span> <span class="token number">4</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
    
    <span class="token comment">#å®šä¹‰ç™½åå•ipåˆ—è¡¨å˜é‡</span>
	<span class="token directive"><span class="token keyword">geo</span> <span class="token variable">$whiteip_list</span></span> <span class="token punctuation">{</span>     
    	<span class="token directive"><span class="token keyword">default</span> <span class="token number">1</span></span><span class="token punctuation">;</span>
    	<span class="token directive"><span class="token keyword">127.0.0.1</span> <span class="token number">0</span></span><span class="token punctuation">;</span>
    	<span class="token directive"><span class="token keyword">192.168.0.167</span> <span class="token number">0</span></span><span class="token punctuation">;</span>
    	<span class="token directive"><span class="token keyword">192.168.0.48</span> <span class="token number">0</span></span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">#ç”¨mapæŒ‡ä»¤æ˜ å°„å°†ç™½åå•åˆ—è¡¨ä¸­å®¢æˆ·ç«¯è¯·æ±‚ipä¸ºç©ºä¸² </span>
	<span class="token directive"><span class="token keyword">map</span> <span class="token variable">$whiteip_list</span> <span class="token variable">$limit</span></span> <span class="token punctuation">{</span>
    	<span class="token directive"><span class="token keyword">1</span> <span class="token variable">$binary_remote_addr</span></span><span class="token punctuation">;</span>
    	<span class="token directive"><span class="token keyword">0</span> <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    

	<span class="token comment">#å½“æŸä¸ªIPè®¿é—®example.comè¿™ä¸ªåŸŸåæ—¶ï¼Œæ­¤IPå¾—å¹¶å‘è¿æ¥è¶…è¿‡10ï¼Œåˆ™ä¼šæŠ¥503ï¼ˆService Temporarily Unavailableï¼‰ï¼Œ</span>
	<span class="token comment">#è¡¨ç¤ºæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œæ­¤æ—¶ä¼šè¿”å›ç»™ç”¨æˆ·æˆ‘ä»¬äº‹å…ˆå®šä¹‰å¥½é”™è¯¯é¡µé¢ã€‚ç”±â€œlimit_conn conn_ip 10;â€å®ç°ã€‚</span>
	<span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$limit</span> zone=conn_ip:10m</span><span class="token punctuation">;</span>
	<span class="token comment">#å½“è®¿é—®example.comè¿™ä¸ªåŸŸåçš„è¿æ¥æ€»æ•°è¶…è¿‡1000æ—¶ï¼ŒåŒæ ·ä¼šæŠ¥503ï¼Œè¿”å›å®šä¹‰å¥½çš„é”™è¯¯é¡µé¢ã€‚</span>
	<span class="token comment">#ç”±â€œlimit_conn conn_server 1000;â€å®ç°</span>
	<span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$limit</span> zone=conn_server:10m</span><span class="token punctuation">;</span>
	<span class="token comment">#å½“è¾¾åˆ°æœ€å¤§é™åˆ¶è¿æ¥æ•°åï¼Œè®°å½•æ—¥å¿—çš„ç­‰çº§</span>
	<span class="token directive"><span class="token keyword">limit_conn_log_level</span> info</span><span class="token punctuation">;</span>  <span class="token comment">#[info | notice | warn | error(é»˜è®¤)]</span>
	<span class="token comment">#å½“è¶…è¿‡é™åˆ¶æ—¶ï¼Œè¿”å›çš„çŠ¶æ€ç ï¼ˆé»˜è®¤æ˜¯503ï¼‰ï¼Œcodeå€¼åªèƒ½è®¾ç½®åœ¨400åˆ°599ä¹‹é—´</span>
	<span class="token directive"><span class="token keyword">limit_conn_status</span> <span class="token number">503</span></span><span class="token punctuation">;</span>

	<span class="token comment">#åˆ©ç”¨ä»¤ç‰Œæ¡¶åŸç†ï¼Œæ¥é™åˆ¶ç”¨æˆ·çš„è¿æ¥é¢‘ç‡</span>
	<span class="token comment">#rateæ¯ä¸ªIPå¹³å‡å¤„ç†çš„è¯·æ±‚é¢‘ç‡ä¸ºæ¯ç§’ä¸€æ¬¡ï¼Œæ­¤å€¼å¯ä»¥è®¾ç½®æˆæ¯ç§’å¤„ç†è¯·æ±‚æ•°æˆ–è€…æ¯åˆ†é’Ÿå¤„ç†è¯·æ±‚æ•°ï¼Œä½†å¿…é¡»æ˜¯æ•´æ•°ã€‚</span>
	<span class="token comment">#æ‰€ä»¥å¦‚æœä½ éœ€è¦æŒ‡å®šæ¯ç§’å¤„ç†å°‘äº1ä¸ªçš„è¯·æ±‚ï¼Œ2ç§’å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ â€œ30r/mâ€ã€‚</span>
	<span class="token directive"><span class="token keyword">limit_req_zone</span>  <span class="token variable">$limit</span> zone=req_ip:10m rate=10r/s</span><span class="token punctuation">;</span>

    <span class="token comment"># ç”¨æˆ·è®¤è¯</span>
    <span class="token comment"># yum install httpd-tools               #é€‚ç”¨centos</span>
    <span class="token comment"># sudo apt-get install apache2-utils    #é€‚ç”¨ubuntu</span>
    <span class="token comment"># ç”Ÿæˆç”¨æˆ·å¯†ç æ–‡ä»¶</span>
    <span class="token comment"># htpasswd -c /data/.htpasswd user1 </span>
    <span class="token directive"><span class="token keyword">auth_basic</span>  <span class="token string">&quot;User Login&quot;</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">auth_basic_user_file</span>  /data/.htpasswd</span><span class="token punctuation">;</span>

    <span class="token comment"># éšè—nginxç‰ˆæœ¬å·</span>
    <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
     <span class="token comment"># sendfile æŒ‡ä»¤ç”¨äºæŒ‡å®š Nginx æ˜¯å¦è°ƒç”¨Linux çš„ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œæé«˜æ–‡ä»¶ä¼ è¾“æ•ˆç‡ </span>
    <span class="token directive"><span class="token keyword">sendfile</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment"># å‘Šè¯‰nginxåœ¨ä¸€ä¸ªæ•°æ®åŒ…é‡Œå‘é€æ‰€æœ‰å¤´æ–‡ä»¶ï¼Œè€Œä¸ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å‘é€ã€‚å°±æ˜¯è¯´æ•°æ®åŒ…ä¸ä¼šé©¬ä¸Šä¼ é€å‡ºå»ï¼Œç­‰åˆ°æ•°æ®åŒ…æœ€å¤§æ—¶ï¼Œä¸€æ¬¡æ€§çš„ä¼ è¾“å‡ºå»ï¼Œè¿™æ ·æœ‰åŠ©äºè§£å†³ç½‘ç»œå µå¡ã€‚</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment"># ä¸ç¼“å­˜data-sendsï¼ˆå…³é—­ Nagle ç®—æ³•ï¼‰ï¼Œè¿™ä¸ªèƒ½å¤Ÿæé«˜é«˜é¢‘å‘é€å°æ•°æ®æŠ¥æ–‡çš„å®æ—¶æ€§</span>
    <span class="token directive"><span class="token keyword">tcp_nodelay</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment">#æ”¯æŒssiåŒ…å«æ–‡ä»¶</span>
    <span class="token directive"><span class="token keyword">ssi</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssi_silent_errors</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token comment">#   ssi_types text/html;</span>
    
    <span class="token comment"># å¯ç”¨ç›®å½•æµè§ˆ</span>
    <span class="token comment"># autoindex on;</span>
    <span class="token comment"># æ˜¾ç¤ºå‡ºæ–‡ä»¶çš„ç¡®åˆ‡ï¼å¤§æ¦‚å¤§å°ï¼šonç¡®åˆ‡å¤§å°ï¼Œå•ä½æ˜¯bytesï¼›offå¤§æ¦‚å¤§å°ï¼Œå•ä½æ˜¯kBæˆ–è€…MBæˆ–è€…GB</span>
    <span class="token comment"># autoindex_exact_size off;</span>
    <span class="token comment"># offæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºGMTæ—¶é—´ï¼Œonæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºæ–‡ä»¶çš„æœåŠ¡å™¨æ—¶é—´</span>
    <span class="token comment"># autoindex_localtime on; </span>

     <span class="token comment"># æŒ‡å®šå®¢æˆ·ç«¯è¿æ¥ä¿æŒæ´»åŠ¨çš„è¶…æ—¶æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰ï¼Œè¶…è¿‡æ—¶é—´ï¼ŒæœåŠ¡å™¨ä¼šå…³é—­è¿æ¥,å¤ªçŸ­æˆ–è€…å¤ªé•¿éƒ½ä¸ä¸€å®šåˆé€‚ï¼Œå½“ç„¶ï¼Œæœ€å¥½æ˜¯æ ¹æ®ä¸šåŠ¡è‡ªèº«çš„æƒ…å†µæ¥åŠ¨æ€åœ°è°ƒæ•´è¯¥å‚æ•°</span>
    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">90</span></span><span class="token punctuation">;</span>
    <span class="token comment"># å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªå®Œæ•´çš„ request header çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœå®¢æˆ·ç«¯åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰å‘é€ä¸€ä¸ªå®Œæ•´çš„ request headerï¼ŒNginx è¿”å› HTTP 408ï¼ˆRequest Timed Outï¼‰ã€‚</span>
    <span class="token directive"><span class="token keyword">client_header_timeout</span> <span class="token number">10</span></span><span class="token punctuation">;</span>
    <span class="token comment"># æŒ‡å®šå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥åå‘é€ request body çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœå®¢æˆ·ç«¯åœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰å‘é€ä»»ä½•å†…å®¹ï¼ŒNginx è¿”å› HTTP 408ï¼ˆRequest Timed Outï¼‰ã€‚</span>
    <span class="token directive"><span class="token keyword">client_body_timeout</span> <span class="token number">20</span></span><span class="token punctuation">;</span>

    <span class="token comment"># å®¢æˆ·ç«¯è¯·æ±‚å•ä¸ªæ–‡ä»¶çš„æœ€å¤§å­—èŠ‚æ•°,è¿™ä¸ªå‚æ•°çš„è®¾ç½®é™åˆ¶äº†ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ã€‚</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">200m</span></span><span class="token punctuation">;</span>
    <span class="token comment"># å½“å®¢æˆ·ç«¯ä»¥POSTæ–¹æ³•æäº¤ä¸€äº›æ•°æ®åˆ°æœåŠ¡ç«¯æ—¶ï¼Œä¼šå…ˆå†™å…¥åˆ°client_body_bufferä¸­ï¼Œå¦‚æœbufferå†™æ»¡ä¼šå†™åˆ°ä¸´æ—¶æ–‡ä»¶é‡Œï¼Œå»ºè®®è°ƒæ•´ä¸º128k</span>
    <span class="token directive"><span class="token keyword">client_body_buffer_size</span>  <span class="token number">128k</span></span><span class="token punctuation">;</span>
    

    <span class="token comment">#åˆ©ç”¨ä»¤ç‰Œæ¡¶åŸç†ï¼Œæ¥é™åˆ¶ç”¨æˆ·çš„è¿æ¥é¢‘ç‡</span>
	<span class="token comment">#rateæ¯ä¸ªIPå¹³å‡å¤„ç†çš„è¯·æ±‚é¢‘ç‡ä¸ºæ¯ç§’ä¸€æ¬¡ï¼Œæ­¤å€¼å¯ä»¥è®¾ç½®æˆæ¯ç§’å¤„ç†è¯·æ±‚æ•°æˆ–è€…æ¯åˆ†é’Ÿå¤„ç†è¯·æ±‚æ•°ï¼Œä½†å¿…é¡»æ˜¯æ•´æ•°ã€‚</span>
	<span class="token comment">#æ‰€ä»¥å¦‚æœä½ éœ€è¦æŒ‡å®šæ¯ç§’å¤„ç†å°‘äº1ä¸ªçš„è¯·æ±‚ï¼Œ2ç§’å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ â€œ30r/mâ€ã€‚</span>
    <span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=one:10m rate=10000r/s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone=addr:10m</span><span class="token punctuation">;</span>
    
    <span class="token comment"># include /etc/nginx/gzip.conf;</span>
    <span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">4</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">&quot;MSIE [1-6]\.&quot;</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">1000</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
	<span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css application/javascript application/x-javascript text/xml application/xml application/xml+rss text/javascript application/json image/jpeg image/gif image/png image/jpg</span><span class="token punctuation">;</span>

    <span class="token comment">#FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚</span>
    <span class="token directive"><span class="token keyword">fastcgi_connect_timeout</span> <span class="token number">300</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_send_timeout</span> <span class="token number">300</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_read_timeout</span> <span class="token number">300</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_buffer_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_buffers</span> <span class="token number">4</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_busy_buffers_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_temp_file_write_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>

    <span class="token comment"># include /etc/nginx/proxy.conf;</span>
    <span class="token comment">#åå‘ä»£ç†</span>
    <span class="token comment"># nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span>
	<span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">90</span></span><span class="token punctuation">;</span>
    <span class="token comment"># è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span>
	<span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">90</span></span><span class="token punctuation">;</span>
    <span class="token comment"># åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶)</span>
	<span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">90</span></span><span class="token punctuation">;</span>
    <span class="token comment"># è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span>
	<span class="token directive"><span class="token keyword">proxy_buffer_size</span> <span class="token number">32k</span></span><span class="token punctuation">;</span>
    <span class="token comment"># proxy_buffersç¼“å†²åŒº</span>
	<span class="token directive"><span class="token keyword">proxy_buffers</span> <span class="token number">4</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
    <span class="token comment"># é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span>
	<span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
    <span class="token comment"># è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ </span>
    <span class="token directive"><span class="token keyword">proxy_temp_file_write_size</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
    
    
    <span class="token comment">#åå‘ä»£ç†ç¼“å­˜ç›®å½•</span>
    <span class="token directive"><span class="token keyword">proxy_cache_path</span> /data/proxy/cache levels=1:2 keys_zone=cache_one:500m inactive=1d max_size=1g</span><span class="token punctuation">;</span>
    <span class="token comment">#levels=1:2 è®¾ç½®ç›®å½•æ·±åº¦ï¼Œç¬¬ä¸€å±‚ç›®å½•æ˜¯1ä¸ªå­—ç¬¦ï¼Œç¬¬2å±‚æ˜¯2ä¸ªå­—ç¬¦</span>
    <span class="token comment">#keys_zone:è®¾ç½®webç¼“å­˜åç§°å’Œå†…å­˜ç¼“å­˜ç©ºé—´å¤§å°</span>
    <span class="token comment">#inactive:è‡ªåŠ¨æ¸…é™¤ç¼“å­˜æ–‡ä»¶æ—¶é—´ã€‚</span>
    <span class="token comment">#max_size:ç¡¬ç›˜ç©ºé—´æœ€å¤§å¯ä½¿ç”¨å€¼ã€‚</span>
    <span class="token comment">#æŒ‡å®šä¸´æ—¶ç¼“å­˜æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„(è·¯å¾„éœ€å’Œä¸Šé¢è·¯å¾„åœ¨åŒä¸€åˆ†åŒº)</span>
    <span class="token directive"><span class="token keyword">proxy_temp_path</span> /data/proxy/temp

    <span class="token comment"># include /etc/nginx/backend.conf;  </span>
    <span class="token comment"># è´Ÿè½½å‡è¡¡æœåŠ¡å™¨æ± </span>
    upstream my_server_pool</span> <span class="token punctuation">{</span>
        <span class="token comment">#è°ƒåº¦ç®—æ³•</span>
        <span class="token comment">#1.è½®å¾ªï¼ˆé»˜è®¤ï¼‰ï¼ˆweightè½®å¾ªæƒå€¼ï¼‰</span>
        <span class="token comment">#2.ip_hashï¼šæ ¹æ®æ¯ä¸ªè¯·æ±‚è®¿é—®IPçš„hashç»“æœåˆ†é…ã€‚ï¼ˆä¼šè¯ä¿æŒï¼‰</span>
        <span class="token comment">#3.fair:æ ¹æ®åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´æœ€çŸ­è¯·æ±‚ã€‚ï¼ˆupstream_fairæ¨¡å—ï¼‰</span>
        <span class="token comment">#4.url_hash:æ ¹æ®è®¿é—®çš„urlçš„hashç»“æœåˆ†é…ã€‚ï¼ˆéœ€hashè½¯ä»¶åŒ…ï¼‰</span>
        <span class="token comment">#å‚æ•°ï¼š</span>
        <span class="token comment">#downï¼šè¡¨ç¤ºä¸å‚ä¸è´Ÿè½½å‡è¡¡</span>
        <span class="token comment">#backup:å¤‡ä»½æœåŠ¡å™¨</span>
        <span class="token comment">#max_fails:å…è®¸æœ€å¤§è¯·æ±‚é”™è¯¯æ¬¡æ•°</span>
        <span class="token comment">#fail_timeout:è¯·æ±‚å¤±è´¥åæš‚åœæœåŠ¡æ—¶é—´ã€‚</span>
        <span class="token directive"><span class="token keyword">server</span> 192.168.1.109:80 weight=1 max_fails=2 fail_timeout=30</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server</span> 192.168.1.108:80 weight=2 max_fails=2 fail_timeout=30</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># æŒ‡æ˜åŒ…å«è¿›æ¥çš„å…¶ä»–é…ç½®æ–‡ä»¶</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/conf.d/h5.conf</span><span class="token punctuation">;</span>
    <span class="token comment"># è™šæ‹Ÿä¸»æœºå®šä¹‰</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token comment"># ç›‘å¬ç«¯å£</span>
        <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span> 
        <span class="token comment">#listen     443;</span>
        <span class="token comment"># è®¿é—®åŸŸå</span>
        <span class="token directive"><span class="token keyword">server_name</span>  example.com</span><span class="token punctuation">;</span>

        <span class="token comment"># ç¼–ç æ ¼å¼ï¼Œè‹¥ç½‘é¡µæ ¼å¼ä¸æ­¤ä¸åŒï¼Œå°†è¢«è‡ªåŠ¨è½¬ç </span>
        <span class="token comment">#charset utf-8;</span>

        <span class="token comment"># è™šæ‹Ÿä¸»æœºè®¿é—®æ—¥å¿—å®šä¹‰</span>
        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        <span class="token comment"># ç”³è¯·çš„è¯ä¹¦zipåŒ…ä¸­ä¸€èˆ¬å«æœ‰å¦‚ä¸‹ä¸‰ä¸ªæ–‡ä»¶ï¼š</span>
        <span class="token comment"># SSL å‡­è¯(ä¾‹å¦‚: ssl_certificate.crt,æˆ–ç§°æœ€ç»ˆå®ä½“å‡­è¯, å…¬é’¥å‡­è¯æˆ–èº«ä»½éªŒè¯å‡­è¯)</span>
        <span class="token comment"># ä¸­ç»§CAå‡­è¯(ä¾‹å¦‚: IntermediateCA.crt, æˆ–ç§°ä¿¡ä»»é“¾å‡­è¯æˆ–SSLå‡­è¯çš„ç­¾åè€…/å‘è¡Œäºº)</span>
        <span class="token comment"># ç§é’¥æ–‡ä»¶(ä¾‹å¦‚: private.key, ç”Ÿæˆå‡­è¯ç­¾ç« è¦æ±‚(CSR)çš„æ—¶å€™å»ºç«‹çš„)</span>
        <span class="token comment">#</span>
        <span class="token comment"># nginxçš„é…ç½®ç‰¹æ®Šåœ°æ–¹: éœ€è¦åˆå¹¶SSLå‡­è¯å’Œä¸­ç»§CAå‡­è¯, å³:</span>
        <span class="token comment">#   cat ssl_certificate.crt IntermediateCA.crt &gt;&gt; your_domain_name.crt</span>
        <span class="token comment"># æ³¨æ„ï¼š-----END CERTIFICATE----------BEGIN CERTIFICATE-----éœ€è¦è°ƒæ•´ä¸ºï¼š</span>
        <span class="token comment">#   -----END CERTIFICATE-----</span>
        <span class="token comment">#   -----BEGIN CERTIFICATE-----</span>
        <span class="token comment"># å¦åˆ™å¯åŠ¨æ—¶å‡ºé”™ï¼Œå³SSL: error:0906D066:PEM routines:PEM_read_bio:bad end line</span>
        <span class="token comment">#</span>
        <span class="token directive"><span class="token keyword">ssl</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>  
        <span class="token comment">#è™šæ‹Ÿä¸»æœºçš„è¯ä¹¦æ–‡ä»¶  </span>
        <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/ssl/your_domain_name.crt</span><span class="token punctuation">;</span> <span class="token comment">#åˆå¹¶SSLå‡­è¯å’Œä¸­ç»§CAå‡­è¯çš„æ–‡ä»¶</span>
        <span class="token comment">#è™šæ‹Ÿä¸»æœºç§é’¥æ–‡ä»¶  </span>
        <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/ssl/your_domain_name.key</span><span class="token punctuation">;</span> <span class="token comment">#ç§é’¥æ–‡ä»¶</span>
        <span class="token comment"># æ”¯æŒsslåè®®ç‰ˆæœ¬</span>
        <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1 TLSv1.1 TLSv1.2</span><span class="token punctuation">;</span>
        <span class="token comment"># å®¢æˆ·ç«¯ä¸€ä¾§çš„è¿æ¥å¯ä»¥å¤ç”¨ssl session cacheä¸­ç¼“å­˜ çš„sslå‚æ•°çš„æœ‰æ•ˆæ—¶é•¿ï¼›</span>
		<span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">5m</span></span><span class="token punctuation">;</span>
        <span class="token comment"># æŒ‡å®šæ”¯æŒåŠ å¯†ç®—æ³•ï¼›</span>
        <span class="token directive"><span class="token keyword">ssl_ciphers</span> AESGCM:ALL:!DH:!EXPORT:!RC4:+HIGH:!MEDIUM:!LOW:!aNULL:!eNULL</span><span class="token punctuation">;</span>
        <span class="token comment"># æœåŠ¡ç«¯å€¾å‘ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼›</span>
   		<span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>



        <span class="token comment"># åŒ¹é…URL</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
            <span class="token comment"># å®šä¹‰é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
            <span class="token comment"># å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºåŒ¹é…</span>
            <span class="token directive"><span class="token keyword">index</span>  index.html index.htm index.php</span><span class="token punctuation">;</span>

            <span class="token comment">#åå‘ä»£ç†ç¼“å­˜è®¾ç½®å‘½ä»¤(proxy_cache zone|off,é»˜è®¤å…³é—­æ‰€ä»¥è¦è®¾ç½®)</span>
            <span class="token directive"><span class="token keyword">proxy_cache</span> cache_one</span><span class="token punctuation">;</span>
            <span class="token comment">#å¯¹ä¸åŒçš„çŠ¶æ€ç ç¼“å­˜ä¸åŒæ—¶é—´</span>
            <span class="token directive"><span class="token keyword">proxy_cache_valid</span> <span class="token number">200</span> <span class="token number">304</span> <span class="token number">12h</span></span><span class="token punctuation">;</span>
            <span class="token comment">#è®¾ç½®ä»¥ä»€ä¹ˆæ ·å‚æ•°è·å–ç¼“å­˜æ–‡ä»¶å</span>
            <span class="token directive"><span class="token keyword">proxy_cache_key</span> <span class="token variable">$host</span><span class="token variable">$uri</span><span class="token variable">$is_args</span><span class="token variable">$args</span></span><span class="token punctuation">;</span>
            <span class="token comment">#å7ç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span> 
            <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
            <span class="token comment">#nginxåå‘ä»£ç†éšè—å“åº”å¤´ï¼Œå¤šä¸ªä»£ç†æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å†™åˆ°httpæ®µé‡Œé¢</span>
            <span class="token directive"><span class="token keyword">proxy_hide_header</span> X-Application-Context</span><span class="token punctuation">;</span>
            <span class="token comment">#ä»£ç†è®¾ç½®</span>
            <span class="token directive"><span class="token keyword">proxy_pass</span>   http://my_server_pool</span><span class="token punctuation">;</span> 
            <span class="token comment">#æ–‡ä»¶è¿‡æœŸæ—¶é—´æ§åˆ¶</span>
            <span class="token directive"><span class="token keyword">expires</span>    <span class="token number">1d</span></span><span class="token punctuation">;</span>

            <span class="token comment">#é™åˆ¶æŸä¸ªIPæ¥æºçš„è¿æ¥å¹¶å‘æ•°ï¼Œæ­¤å¤„ä¸º10ä¸ª</span>
            <span class="token directive"><span class="token keyword">limit_conn</span> conn_ip <span class="token number">10</span></span><span class="token punctuation">;</span>
            <span class="token comment">#é™åˆ¶æŸä¸ªè™šæ‹ŸæœåŠ¡å™¨çš„æ€»è¿æ¥æ•°ï¼Œæ­¤å¤„ä¸º1000ä¸ª</span>
            <span class="token directive"><span class="token keyword">limit_conn</span> conn_server <span class="token number">1000</span></span><span class="token punctuation">;</span>
            <span class="token comment">#é™åˆ¶å¸¦å®½, æ¯ä¸ªè¿æ¥åªå…è®¸æœ€å¤§5kb/sçš„é€Ÿåº¦è¿›è¡Œä¸‹è½½</span>
            <span class="token directive"><span class="token keyword">limit_rate</span> <span class="token number">5k</span></span><span class="token punctuation">;</span>

            <span class="token comment">#burst=5è¿™ä¸ªé…ç½®çš„æ„æ€æ˜¯è®¾ç½®ä¸€ä¸ªå¤§å°ä¸º5çš„ç¼“å†²åŒºï¼Œå½“æœ‰å¤§é‡è¯·æ±‚ï¼ˆçˆ†å‘ï¼‰è¿‡æ¥æ—¶ï¼Œ</span>
            <span class="token comment">#è¶…è¿‡äº†è®¿é—®é¢‘æ¬¡é™åˆ¶çš„è¯·æ±‚å¯ä»¥å…ˆæ”¾åˆ°è¿™ä¸ªç¼“å†²åŒºå†…ï¼Œå¦‚æœæ­¤ç¼“å†²åŒºä¹Ÿæ»¡äº†åˆ™ä¼šè¿”å›503</span>
            <span class="token comment">#nodelay å¦‚æœè®¾ç½®æ­¤å‚æ•°ï¼Œè¶…è¿‡è®¿é—®é¢‘æ¬¡è€Œä¸”ç¼“å†²åŒºä¹Ÿæ»¡äº†çš„æ—¶å€™å°±ä¼šç›´æ¥è¿”å›503ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œåˆ™æ‰€æœ‰è¯·æ±‚ä¼šç­‰å¾…æ’é˜Ÿ</span>
            <span class="token directive"><span class="token keyword">limit_req</span> zone=req_ip burst=5</span><span class="token punctuation">;</span>
            <span class="token comment">#limit_req zone=req_ip burst=5 nodelay;</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">location</span> /download</span> <span class="token punctuation">{</span>
            <span class="token comment">#é™åˆ¶IPè®¿é—®</span>
            <span class="token directive"><span class="token keyword">deny</span> 192.168.0.2ï¼›
            allow 192.168.0.0/24</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">allow</span> 192.168.1.1</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#é™æ€æ–‡ä»¶ï¼Œnginxè‡ªå·±å¤„ç†</span>
        <span class="token directive"><span class="token keyword">location</span> ~ ^/(images|javascript|js|css|flash|media|static)/</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>  <span class="token comment">#å…³é—­access_logï¼Œå³ä¸è®°å½•è®¿é—®æ—¥å¿—</span>
            <span class="token comment">#è¿‡æœŸ30å¤©ï¼Œé™æ€æ–‡ä»¶ä¸æ€ä¹ˆæ›´æ–°ï¼Œè¿‡æœŸå¯ä»¥è®¾å¤§ä¸€ç‚¹ï¼Œ</span>
            <span class="token comment">#å¦‚æœé¢‘ç¹æ›´æ–°ï¼Œåˆ™å¯ä»¥è®¾ç½®å¾—å°ä¸€ç‚¹ã€‚</span>
            <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># å‘ç”Ÿ 404 é”™è¯¯æ—¶è¿”å› 404.htmlé¡µé¢</span>
        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        <span class="token comment"># å‘ç”Ÿ 50x é”™è¯¯æ—¶ä½¿ç”¨ 50x.html</span>
        <span class="token directive"><span class="token keyword">error_page</span>   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> = /50x.html</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">root</span>   html</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># å°† PHP è„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘ç»™ FastCGIï¼ˆ127.0.0.1:9000ï¼‰å¤„ç†</span>
        <span class="token comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>
        <span class="token comment">#</span>
        <span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">fastcgi_pass</span>   127.0.0.1:9000</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">fastcgi_index</span>  index.php</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">fastcgi_param</span>  SCRIPT_FILENAME  <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>
            <span class="token comment"># å¼•å…¥æ–‡ä»¶ï¼Œfastcgiçš„é»˜è®¤é…ç½®å‚æ•°</span>
            <span class="token directive"><span class="token keyword">include</span>        fastcgi_params</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br></div></div><h2 id="_2-å…¨å±€å˜é‡" tabindex="-1"><a class="header-anchor" href="#_2-å…¨å±€å˜é‡" aria-hidden="true">#</a> 2 å…¨å±€å˜é‡</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$args ï¼š #è¿™ä¸ªå˜é‡ç­‰äºè¯·æ±‚è¡Œä¸­çš„å‚æ•°ï¼ŒåŒ$query_string
$content_length ï¼š è¯·æ±‚å¤´ä¸­çš„Content-lengthå­—æ®µã€‚
$content_type ï¼š è¯·æ±‚å¤´ä¸­çš„Content-Typeå­—æ®µã€‚
$document_root ï¼š å½“å‰è¯·æ±‚åœ¨rootæŒ‡ä»¤ä¸­æŒ‡å®šçš„å€¼ã€‚
$host ï¼š è¯·æ±‚ä¸»æœºå¤´å­—æ®µï¼Œå¦åˆ™ä¸ºæœåŠ¡å™¨åç§°ã€‚
$http_user_agent ï¼š å®¢æˆ·ç«¯agentä¿¡æ¯
$http_cookie ï¼š å®¢æˆ·ç«¯cookieä¿¡æ¯
$limit_rate ï¼š è¿™ä¸ªå˜é‡å¯ä»¥é™åˆ¶è¿æ¥é€Ÿç‡ã€‚
$request_method ï¼š å®¢æˆ·ç«¯è¯·æ±‚çš„åŠ¨ä½œï¼Œé€šå¸¸ä¸ºGETæˆ–POSTã€‚
$remote_addr ï¼š å®¢æˆ·ç«¯çš„IPåœ°å€ã€‚
$remote_port ï¼š å®¢æˆ·ç«¯çš„ç«¯å£ã€‚
$remote_user ï¼š å·²ç»ç»è¿‡Auth Basic ModuleéªŒè¯çš„ç”¨æˆ·åã€‚
$request_filename ï¼š å½“å‰è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆã€‚
$scheme ï¼š HTTPæ–¹æ³•ï¼ˆå¦‚httpï¼Œhttpsï¼‰ã€‚
$server_protocol ï¼š è¯·æ±‚ä½¿ç”¨çš„åè®®ï¼Œé€šå¸¸æ˜¯HTTP/1.0æˆ–HTTP/1.1ã€‚
$server_addr ï¼š æœåŠ¡å™¨åœ°å€ï¼Œåœ¨å®Œæˆä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨åå¯ä»¥ç¡®å®šè¿™ä¸ªå€¼ã€‚
$server_name ï¼š æœåŠ¡å™¨åç§°ã€‚
$server_port ï¼š è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å·ã€‚
$request_uri ï¼š åŒ…å«è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œå¦‚ï¼šâ€/foo/bar.php?arg=bazâ€ã€‚
$uri ï¼š ä¸å¸¦è¯·æ±‚å‚æ•°çš„å½“å‰URIï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚â€/foo/bar.htmlâ€ã€‚
$document_uri ï¼š ä¸$uriç›¸åŒã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><blockquote><p>å‚è€ƒé“¾æ¥ï¼š</p><p>https://jasonhzy.github.io/2017/09/03/nginx/</p><p>https://blog.csdn.net/tzy233/article/details/79780444</p><p>https://blog.csdn.net/Powerful_Fy/article/details/102845921</p><p>https://www.linuxidc.com/Linux/2018-01/150100.htm</p><p>https://www.jianshu.com/p/73e2cd39722c</p><p>https://www.cnblogs.com/my_life/articles/7070805.html</p><p>https://www.jianshu.com/nb/27610173</p><p>http://nginx.org/en/docs/http/ngx_http_core_module.html#variables</p><p>http://nginx.org/en/docs/</p></blockquote><!--]--></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/clay-wangzhi/wiki/edit/master/src/web/nginx/config.md" rel="noopener noreferrer" target="_blank" arialabel="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewbox="0 0 1024 1024" arialabelledby="edit"><title id="edit" lang="en">edit icon</title><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/4/27 15:33:00</span></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: clay.wangzhi@gmail.com">clay-wangzhi</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/web/nginx/framework.html" class="nav-link prev" arialabel="2. nginxæ¶æ„åŸºç¡€"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->2. nginxæ¶æ„åŸºç¡€</div></a><a href="/web/nginx/core.html" class="nav-link next" arialabel="4. å†…æ ¸å‚æ•°ä¼˜åŒ–"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow right"></span></div><div class="link">4. å†…æ ¸å‚æ•°ä¼˜åŒ–<!----></div></a></nav><!----><!----></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href="http://beian.miit.gov.cn/" target="_blank">å¤‡æ¡ˆå·:å†€ICPå¤‡2021007336å·</a></div><div class="copyright">Copyright Â© 2022 Clay</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.ac0f71d5.js" defer></script>
  </body>
</html>

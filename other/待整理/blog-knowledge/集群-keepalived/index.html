<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>keepalived详解 | IT外卖小哥</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://clay-wangzhi.com/atom.xml" title="IT外卖小哥 Atom Feed">
    <link rel="alternate" type="application/json" href="https://clay-wangzhi.com/feed.json" title="IT外卖小哥 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://clay-wangzhi.com/rss.xml" title="IT外卖小哥 RSS Feed">
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192">
    <link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512">
    <link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png">
    <meta name="description" content="当你发现自己的才华撑不起野心时，就请安静下来学习吧！">
    <meta property="og:url" content="/other/%E5%BE%85%E6%95%B4%E7%90%86/blog-knowledge/%E9%9B%86%E7%BE%A4-keepalived.html">
    <meta property="og:site_name" content="IT外卖小哥">
    <meta property="og:title" content="keepalived详解">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="IT外卖小哥">
    <meta property="article:author" content="Clay">
    <meta property="article:tag" content="集群">
    <meta property="article:published_time" content="2017-09-15T21:00:00.000Z">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.ca69d379.css" as="style"><link rel="preload" href="/assets/js/app.8a92dcc3.js" as="script"><link rel="preload" href="/assets/js/layout-Layout.3b564286.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.25725a2a.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.cf79f7df.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.cbd798c5.js" as="script"><link rel="preload" href="/assets/js/page-keepalived详解.6376a09a.js" as="script"><link rel="prefetch" href="/assets/js/320.bef365d0.js"><link rel="prefetch" href="/assets/js/321.f35c9d29.js"><link rel="prefetch" href="/assets/js/322.a29ba1a1.js"><link rel="prefetch" href="/assets/js/323.cc39ce2c.js"><link rel="prefetch" href="/assets/js/324.f63d5169.js"><link rel="prefetch" href="/assets/js/layout-Blog.5354c823.js"><link rel="prefetch" href="/assets/js/layout-NotFound.44ee922f.js"><link rel="prefetch" href="/assets/js/layout-Slide.1b84b1ce.js"><link rel="prefetch" href="/assets/js/page--00e7df1c.86b285c3.js"><link rel="prefetch" href="/assets/js/page--0585b5dc.92418997.js"><link rel="prefetch" href="/assets/js/page--0a7aecb9.7c5800bf.js"><link rel="prefetch" href="/assets/js/page--0cab49f5.e4beed51.js"><link rel="prefetch" href="/assets/js/page--15976610.3556c67d.js"><link rel="prefetch" href="/assets/js/page--19ea0457.d26d2aa6.js"><link rel="prefetch" href="/assets/js/page--1e867335.effa26da.js"><link rel="prefetch" href="/assets/js/page--26349a62.9fb2a344.js"><link rel="prefetch" href="/assets/js/page--2662697e.35d08732.js"><link rel="prefetch" href="/assets/js/page--2ce6c413.9ec73a22.js"><link rel="prefetch" href="/assets/js/page--2d434a77.100ac365.js"><link rel="prefetch" href="/assets/js/page--3917fb31.59968f83.js"><link rel="prefetch" href="/assets/js/page--40ad438d.dbbf4074.js"><link rel="prefetch" href="/assets/js/page--42da580f.7ef85d6c.js"><link rel="prefetch" href="/assets/js/page--44a2687f.39a1e08a.js"><link rel="prefetch" href="/assets/js/page--5c23cf26.e249decb.js"><link rel="prefetch" href="/assets/js/page--6d547f66.eb44ffa0.js"><link rel="prefetch" href="/assets/js/page--79708478.72df4a6e.js"><link rel="prefetch" href="/assets/js/page--7c7856ad.08d4d3ae.js"><link rel="prefetch" href="/assets/js/page--86e5ca40.7896518c.js"><link rel="prefetch" href="/assets/js/page--924b4be6.0b7def10.js"><link rel="prefetch" href="/assets/js/page--a2e3c926.821df156.js"><link rel="prefetch" href="/assets/js/page--ab85f1a6.7b4e8e34.js"><link rel="prefetch" href="/assets/js/page--be63dd2e.b2148af5.js"><link rel="prefetch" href="/assets/js/page--c26e6710.6b4dbb1b.js"><link rel="prefetch" href="/assets/js/page--c4128808.94cda38c.js"><link rel="prefetch" href="/assets/js/page--cfea16a6.acb71a6d.js"><link rel="prefetch" href="/assets/js/page--de2eec66.2975fce3.js"><link rel="prefetch" href="/assets/js/page--e5093032.f3390ad3.js"><link rel="prefetch" href="/assets/js/page--f7d54b0e.4b407467.js"><link rel="prefetch" href="/assets/js/page-01Python基础语法.444b5537.js"><link rel="prefetch" href="/assets/js/page-02线性数据结构.12734f07.js"><link rel="prefetch" href="/assets/js/page-03哈希表和解析式.1b96f95c.js"><link rel="prefetch" href="/assets/js/page-04函数.189d68a6.js"><link rel="prefetch" href="/assets/js/page-05装饰器.e43a5c58.js"><link rel="prefetch" href="/assets/js/page-06目录文件处理.d0ac1f21.js"><link rel="prefetch" href="/assets/js/page-07序列化和反序列化.2df988d5.js"><link rel="prefetch" href="/assets/js/page-08异常处理.46d3502a.js"><link rel="prefetch" href="/assets/js/page-09面向对象-封装.479a60e1.js"><link rel="prefetch" href="/assets/js/page-1011使用awk处理字符串.30bef6c9.js"><link rel="prefetch" href="/assets/js/page-1012参考资料.2d51dea1.js"><link rel="prefetch" href="/assets/js/page-101字符串处理.7781721f.js"><link rel="prefetch" href="/assets/js/page-102参数替换.48c2fa1c.js"><link rel="prefetch" href="/assets/js/page-10Todolist.8533e571.js"><link rel="prefetch" href="/assets/js/page-10继承多态和Mixin.0236fad7.js"><link rel="prefetch" href="/assets/js/page-10读写分离和Amoeba.871c02f0.js"><link rel="prefetch" href="/assets/js/page-111循环.e6dd6ebc.js"><link rel="prefetch" href="/assets/js/page-112嵌套循环.4e9ffd9e.js"><link rel="prefetch" href="/assets/js/page-113循环控制.c9262c59.js"><link rel="prefetch" href="/assets/js/page-114测试与分支.0da65522.js"><link rel="prefetch" href="/assets/js/page-11MySQL逻辑架构.067f46e5.js"><link rel="prefetch" href="/assets/js/page-11魔术方法.fdb63e09.js"><link rel="prefetch" href="/assets/js/page-12MySQL锁等待.9f25b91e.js"><link rel="prefetch" href="/assets/js/page-12线程.19a06ffb.js"><link rel="prefetch" href="/assets/js/page-13MySQL常见问题.ee67e315.js"><link rel="prefetch" href="/assets/js/page-13线程同步.d6e9b3f3.js"><link rel="prefetch" href="/assets/js/page-14MySQLbin-log日志清理.d1cc77d4.js"><link rel="prefetch" href="/assets/js/page-14多进程.93f7ed19.js"><link rel="prefetch" href="/assets/js/page-15TCP编程.f5ff9fde.js"><link rel="prefetch" href="/assets/js/page-16SocketServer.929c157d.js"><link rel="prefetch" href="/assets/js/page-17IO模型.519ac500.js"><link rel="prefetch" href="/assets/js/page-181正则表达式简介.8383dfe3.js"><link rel="prefetch" href="/assets/js/page-182文件名替换.f9d56d71.js"><link rel="prefetch" href="/assets/js/page-183正则表达式对照表.c4896737.js"><link rel="prefetch" href="/assets/js/page-18正则表达式.3e034780.js"><link rel="prefetch" href="/assets/js/page-19嵌入文档.7a07915d.js"><link rel="prefetch" href="/assets/js/page-1MySQL基本操作.6865cb46.js"><link rel="prefetch" href="/assets/js/page-1zabbix44新功能.90d05737.js"><link rel="prefetch" href="/assets/js/page-1初识Ansible.a74d15aa.js"><link rel="prefetch" href="/assets/js/page-1初识Nginx.3e13bfc4.js"><link rel="prefetch" href="/assets/js/page-201使用exec.80e43fbd.js"><link rel="prefetch" href="/assets/js/page-202重定向代码块.d4c3c607.js"><link rel="prefetch" href="/assets/js/page-203应用程序.d1aeb10f.js"><link rel="prefetch" href="/assets/js/page-20IO重定向.f31e0f96.js"><link rel="prefetch" href="/assets/js/page-21调用一个脚本.aad22a6f.js"><link rel="prefetch" href="/assets/js/page-22牛刀小试.aa3da677.js"><link rel="prefetch" href="/assets/js/page-241复杂函数和函数复杂性.0ba9ae0e.js"><link rel="prefetch" href="/assets/js/page-242局部变量.3bf81a11.js"><link rel="prefetch" href="/assets/js/page-243不使用局部变量的递归.8bac692f.js"><link rel="prefetch" href="/assets/js/page-24函数.b982eeca.js"><link rel="prefetch" href="/assets/js/page-25别名.8b411ba8.js"><link rel="prefetch" href="/assets/js/page-27数组.3d6b2d20.js"><link rel="prefetch" href="/assets/js/page-2AnsibleInventory配置详解.022d685d.js"><link rel="prefetch" href="/assets/js/page-2nginx架构基础.9e44813d.js"><link rel="prefetch" href="/assets/js/page-2zabbix借助ansible安装.4917627a.js"><link rel="prefetch" href="/assets/js/page-2列表类型和数据完整性.5bd43081.js"><link rel="prefetch" href="/assets/js/page-30网络编程.c2c0f952.js"><link rel="prefetch" href="/assets/js/page-31Ansiblelineinfile模块详解.9ae4b93f.js"><link rel="prefetch" href="/assets/js/page-31nginx全局块和events块配置.a9cbf9a6.js"><link rel="prefetch" href="/assets/js/page-32nginxHTTP块配置.f166ad6a.js"><link rel="prefetch" href="/assets/js/page-32调试.d5c34387.js"><link rel="prefetch" href="/assets/js/page-33nginxSERVER块配置.2e10371d.js"><link rel="prefetch" href="/assets/js/page-33选项.69b262ef.js"><link rel="prefetch" href="/assets/js/page-34nginxLOCATION块配置.724dab32.js"><link rel="prefetch" href="/assets/js/page-35nginx常用模块.d8383870.js"><link rel="prefetch" href="/assets/js/page-361交互和非交互shell以及脚本.85ef90a9.js"><link rel="prefetch" href="/assets/js/page-362shellwrappers.606303c0.js"><link rel="prefetch" href="/assets/js/page-363测试和比较的其他方法.55858718.js"><link rel="prefetch" href="/assets/js/page-364递归：可以调用自己的脚本.5217b02e.js"><link rel="prefetch" href="/assets/js/page-3AnsibleAd-hoc命令集.c4554a3b.js"><link rel="prefetch" href="/assets/js/page-3nginx配置文件详解.7d628b83.js"><link rel="prefetch" href="/assets/js/page-3zabbix添加报警媒介.79330abf.js"><link rel="prefetch" href="/assets/js/page-3数据库设计与查询语句.df33b8ec.js"><link rel="prefetch" href="/assets/js/page-41Playbook的结构及handler用法.6865379d.js"><link rel="prefetch" href="/assets/js/page-41变量替换.84f6be01.js"><link rel="prefetch" href="/assets/js/page-42Playbook循环语句.5ec7dd98.js"><link rel="prefetch" href="/assets/js/page-42变量赋值.469de207.js"><link rel="prefetch" href="/assets/js/page-43Bash变量是弱类型的.a809ace7.js"><link rel="prefetch" href="/assets/js/page-43Playbook条件语句.cdfafd47.js"><link rel="prefetch" href="/assets/js/page-44Playbook高级用法.83944afb.js"><link rel="prefetch" href="/assets/js/page-44特殊的变量类型.282dd720.js"><link rel="prefetch" href="/assets/js/page-45Playbook之tags.be04edf0.js"><link rel="prefetch" href="/assets/js/page-46巧用Roles.bb69563e.js"><link rel="prefetch" href="/assets/js/page-48yaml语法.bf4d1b90.js"><link rel="prefetch" href="/assets/js/page-4AnsiblePlaybook.1585813c.js"><link rel="prefetch" href="/assets/js/page-4MySQL监控模块.f6ae40d8.js"><link rel="prefetch" href="/assets/js/page-4内核参数优化.88e39489.js"><link rel="prefetch" href="/assets/js/page-4视图、事务、索引、函数.6c423898.js"><link rel="prefetch" href="/assets/js/page-51引用变量.50e02e5c.js"><link rel="prefetch" href="/assets/js/page-51自定义变量.67935fbc.js"><link rel="prefetch" href="/assets/js/page-52Fact变量.335558e5.js"><link rel="prefetch" href="/assets/js/page-52转义.d72e6c59.js"><link rel="prefetch" href="/assets/js/page-53魔法变量.0cb33273.js"><link rel="prefetch" href="/assets/js/page-54使用lookup生成变量.43e2fce0.js"><link rel="prefetch" href="/assets/js/page-55使用vault配置加密.b61b6a55.js"><link rel="prefetch" href="/assets/js/page-5Ansible变量.6d56177f.js"><link rel="prefetch" href="/assets/js/page-5MySQL存储引擎.3c2e9329.js"><link rel="prefetch" href="/assets/js/page-5Redis监控模块.62916af4.js"><link rel="prefetch" href="/assets/js/page-5状态码.d6af00c9.js"><link rel="prefetch" href="/assets/js/page-61Nginx出现403forbidden的三种原因.b5641797.js"><link rel="prefetch" href="/assets/js/page-6Ansible使用优化.1d330b90.js"><link rel="prefetch" href="/assets/js/page-6nginx的常见问题.a0047136.js"><link rel="prefetch" href="/assets/js/page-6常见问题.2738a5cd.js"><link rel="prefetch" href="/assets/js/page-6用户权限和访问控制.76e1d7f8.js"><link rel="prefetch" href="/assets/js/page-71测试结构.7c2341e4.js"><link rel="prefetch" href="/assets/js/page-72文件测试操作.10383e01.js"><link rel="prefetch" href="/assets/js/page-73其他比较操作.e0e05cf1.js"><link rel="prefetch" href="/assets/js/page-74嵌套ifthen条件测试.cb12769e.js"><link rel="prefetch" href="/assets/js/page-75牛刀小试.9f0618fb.js"><link rel="prefetch" href="/assets/js/page-7备份恢复.e667c774.js"><link rel="prefetch" href="/assets/js/page-7常见问题.8e5a1c3d.js"><link rel="prefetch" href="/assets/js/page-7用zabbixapi批量添加web监控.fa6a4e83.js"><link rel="prefetch" href="/assets/js/page-81运算符.7eba540e.js"><link rel="prefetch" href="/assets/js/page-82数字常量.dc18bc0a.js"><link rel="prefetch" href="/assets/js/page-8AB复制.12c1fac4.js"><link rel="prefetch" href="/assets/js/page-8activemq监控.fbba0372.js"><link rel="prefetch" href="/assets/js/page-91内部变量.e006fda3.js"><link rel="prefetch" href="/assets/js/page-921declare的另类用法.8cc64d6d.js"><link rel="prefetch" href="/assets/js/page-92变量类型标注：declare与typeset.471dde90.js"><link rel="prefetch" href="/assets/js/page-93$RANDOM：生成随机数.b1eefcd7.js"><link rel="prefetch" href="/assets/js/page-9zookeeper集群监控.ee175ac3.js"><link rel="prefetch" href="/assets/js/page-9主主和keepalived.ee0e77f4.js"><link rel="prefetch" href="/assets/js/page-Ansible学习笔记.aea4b5b3.js"><link rel="prefetch" href="/assets/js/page-Centos76下Elasticseatch72集群搭建步骤.542bf33e.js"><link rel="prefetch" href="/assets/js/page-Centos7搭建openldap.94b722e9.js"><link rel="prefetch" href="/assets/js/page-Commitmessage和Changelog编写指南.cc2f6e70.js"><link rel="prefetch" href="/assets/js/page-DEVSITUATPETSIMPRDPROD常见环境英文缩写含义.f6bf9d26.js"><link rel="prefetch" href="/assets/js/page-ELK.70b1b2d4.js"><link rel="prefetch" href="/assets/js/page-ElasticStack家族成员及其应用场景.4e625c00.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch分词.590bb19a.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch基础概念.9326e278.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch的安装和简单配置.8691ddf1.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch简介及其发展历史.94f4fd17.js"><link rel="prefetch" href="/assets/js/page-Harbor搭建.4d0d418f.js"><link rel="prefetch" href="/assets/js/page-Harbor高可用搭建.f4101fd2.js"><link rel="prefetch" href="/assets/js/page-JenkinsJob迁移.c0d0be61.js"><link rel="prefetch" href="/assets/js/page-Jenkins关闭和重启的实现方式.9fefb7a3.js"><link rel="prefetch" href="/assets/js/page-Kibana的安装和界面快速浏览.841fee14.js"><link rel="prefetch" href="/assets/js/page-Linux下配置jdk的环境变量.a4bc15a0.js"><link rel="prefetch" href="/assets/js/page-Linux，du、df统计的硬盘使用情况不一致问题.2bda0db4.js"><link rel="prefetch" href="/assets/js/page-Nginx升级加固SSLTLS协议信息泄露漏洞(CVE-2016-2183)和HTTP服务器的缺省banner漏洞.170c8dc3.js"><link rel="prefetch" href="/assets/js/page-PrometheusAlert.19d7c3d5.js"><link rel="prefetch" href="/assets/js/page-Python学习笔记.a68de5bf.js"><link rel="prefetch" href="/assets/js/page-Redis-集群.adaf856c.js"><link rel="prefetch" href="/assets/js/page-RequestBody和QueryDSL简介.f2c8eeb3.js"><link rel="prefetch" href="/assets/js/page-SearchAPI概览.83c461b1.js"><link rel="prefetch" href="/assets/js/page-Summary.3aa71970.js"><link rel="prefetch" href="/assets/js/page-Tomcat错误代号及状态码.4c9d4a42.js"><link rel="prefetch" href="/assets/js/page-URISearch详解.eab40964.js"><link rel="prefetch" href="/assets/js/page-activemq5159集群搭建步骤.a4bb28b2.js"><link rel="prefetch" href="/assets/js/page-centos65下安装python36、pip、ipython.b48822f7.js"><link rel="prefetch" href="/assets/js/page-centos7下搭建shadowsocks.5ea23ecd.js"><link rel="prefetch" href="/assets/js/page-centos7下时区问题.233ff2a6.js"><link rel="prefetch" href="/assets/js/page-centos7安装rabbitmq-379.16d38d14.js"><link rel="prefetch" href="/assets/js/page-centos7安装redis-500主从.a0fb1022.js"><link rel="prefetch" href="/assets/js/page-centos7安装升级ruby.60c26e28.js"><link rel="prefetch" href="/assets/js/page-curl方式执行shell脚本时如何传参.f71ad855.js"><link rel="prefetch" href="/assets/js/page-docker安装rabbitmq集群.12e60c4a.js"><link rel="prefetch" href="/assets/js/page-docker搭建redis集群.5cbe1584.js"><link rel="prefetch" href="/assets/js/page-echo命令.fad68208.js"><link rel="prefetch" href="/assets/js/page-elk借助安装ansible.ddd06d53.js"><link rel="prefetch" href="/assets/js/page-etcsecuritylimitsconf详解与配置.c10cf9a7.js"><link rel="prefetch" href="/assets/js/page-filebeat的安装注意.0fc194e8.js"><link rel="prefetch" href="/assets/js/page-gitlab备份迁移升级集成openldap.f693e678.js"><link rel="prefetch" href="/assets/js/page-git的基本使用.b8558f6e.js"><link rel="prefetch" href="/assets/js/page-hash类型.8c3ebc05.js"><link rel="prefetch" href="/assets/js/page-hexo(next)+github博客的搭建.67dddf0f.js"><link rel="prefetch" href="/assets/js/page-jenkins常见问题.c4862803.js"><link rel="prefetch" href="/assets/js/page-jenkins的安装配置.8a46a723.js"><link rel="prefetch" href="/assets/js/page-kafka212集群搭建步骤.b9fe22aa.js"><link rel="prefetch" href="/assets/js/page-linux下如何增加swap交换分区.f2c766b3.js"><link rel="prefetch" href="/assets/js/page-linux简介.4549b749.js"><link rel="prefetch" href="/assets/js/page-list类型.8a1b3498.js"><link rel="prefetch" href="/assets/js/page-logstash安装注意.2be45e18.js"><link rel="prefetch" href="/assets/js/page-mysql最大连接数的改变.0bba2b98.js"><link rel="prefetch" href="/assets/js/page-phpldapadmin操作指导.43774fd3.js"><link rel="prefetch" href="/assets/js/page-pipeline配置java项目.163a1322.js"><link rel="prefetch" href="/assets/js/page-python实际工作中的实例.76941176.js"><link rel="prefetch" href="/assets/js/page-redis-dump方式导入导出数据.6a356ab3.js"><link rel="prefetch" href="/assets/js/page-redis504集群搭建.84626038.js"><link rel="prefetch" href="/assets/js/page-redis面试题.4c89a5ba.js"><link rel="prefetch" href="/assets/js/page-rocketmq集群的搭建.b9704c68.js"><link rel="prefetch" href="/assets/js/page-sed命令详解.f4b16a6d.js"><link rel="prefetch" href="/assets/js/page-set类型.622a2b36.js"><link rel="prefetch" href="/assets/js/page-string类型.8c81e2ee.js"><link rel="prefetch" href="/assets/js/page-tomcat假死现象.252195fe.js"><link rel="prefetch" href="/assets/js/page-tomcat注意事项.b80ab75c.js"><link rel="prefetch" href="/assets/js/page-tomcat简介.55341a61.js"><link rel="prefetch" href="/assets/js/page-zookeeper3414集群搭建步骤.304f83f9.js"><link rel="prefetch" href="/assets/js/page-zset类型.93a92604.js"><link rel="prefetch" href="/assets/js/page-《AdvancedBash-ScriptingGuide》inChinese.04482829.js"><link rel="prefetch" href="/assets/js/page-中文技术文档的写作规范.19e2ce80.js"><link rel="prefetch" href="/assets/js/page-使用JenkinsPipeline自动化构建发布.d210451d.js"><link rel="prefetch" href="/assets/js/page-使用Jenkins扩展共享库进行钉钉消息推送.e0474a4d.js"><link rel="prefetch" href="/assets/js/page-使用docker安装jenkins.f1fee4bd.js"><link rel="prefetch" href="/assets/js/page-使用方法.aee979c9.js"><link rel="prefetch" href="/assets/js/page-倒排索引入门.c4f8ff5d.js"><link rel="prefetch" href="/assets/js/page-写作前.f5803d46.js"><link rel="prefetch" href="/assets/js/page-分布式FastDfs+nginx缓存高可用集群构建.d327b1f1.js"><link rel="prefetch" href="/assets/js/page-创建、复制、移动、删除.7a187d83.js"><link rel="prefetch" href="/assets/js/page-博客主页.3e0eea67.js"><link rel="prefetch" href="/assets/js/page-双圆括号结构.ad4ba8e4.js"><link rel="prefetch" href="/assets/js/page-命名.3acdc469.js"><link rel="prefetch" href="/assets/js/page-在Docker容器中运行Elasticsearch，Kibana和Cerebro.6649486f.js"><link rel="prefetch" href="/assets/js/page-基于docker搭建confluence.303de0cb.js"><link rel="prefetch" href="/assets/js/page-基本权限UGO.76db806e.js"><link rel="prefetch" href="/assets/js/page-基本概念.1bbf2084.js"><link rel="prefetch" href="/assets/js/page-安装python解释器，配置好path变量。.bcc796c7.js"><link rel="prefetch" href="/assets/js/page-容器部署ELK710.eaac35af.js"><link rel="prefetch" href="/assets/js/page-常用知识.82061ffa.js"><link rel="prefetch" href="/assets/js/page-开机集成zabbix和jumpserver脚本.aa7bb7e1.js"><link rel="prefetch" href="/assets/js/page-打包、压缩.83599572.js"><link rel="prefetch" href="/assets/js/page-数据类型.9add61a1.js"><link rel="prefetch" href="/assets/js/page-文档的基本操作CRUP与批量操作.83593188.js"><link rel="prefetch" href="/assets/js/page-日志logrotate.0453540a.js"><link rel="prefetch" href="/assets/js/page-显示当前正在编辑的文件名.a2945260.js"><link rel="prefetch" href="/assets/js/page-服务器端和客户端命令.61ff9110.js"><link rel="prefetch" href="/assets/js/page-查看哪些表被锁住了.cafe44fb.js"><link rel="prefetch" href="/assets/js/page-查看文件内容.a86bbdcf.js"><link rel="prefetch" href="/assets/js/page-查看文件类型.fffccfaf.js"><link rel="prefetch" href="/assets/js/page-查看文件详细属性.e1e8930d.js"><link rel="prefetch" href="/assets/js/page-核心知识点概览.66066bf3.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（21）-find之xargs.22f080ce.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（29）-chown.d28f16f4.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（33）-du.51edeef2.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（35）-diff.820c7f66.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（36）-date.04f6ebeb.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（42）-killall.af7a5b08.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（45）-vmstat.8b108720.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（46）-iostat.036f8493.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（49）-lsof.cc170e00.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（52）-ping.2b465221.js"><link rel="prefetch" href="/assets/js/page-每天一个linux命令（53）-traceroute.fa702a14.js"><link rel="prefetch" href="/assets/js/page-生产环境中的tomcat配置.cd32981a.js"><link rel="prefetch" href="/assets/js/page-用户管理.820eb7b4.js"><link rel="prefetch" href="/assets/js/page-白天做运维，晚上搞副业赚钱.48b0719e.js"><link rel="prefetch" href="/assets/js/page-第34章陷阱.7423f43c.js"><link rel="prefetch" href="/assets/js/page-第36章杂项.72943f50.js"><link rel="prefetch" href="/assets/js/page-第一章为什么使用shell编程.42c96624.js"><link rel="prefetch" href="/assets/js/page-第一部分初见Shell.e1fc2537.js"><link rel="prefetch" href="/assets/js/page-第七章测试.2138487d.js"><link rel="prefetch" href="/assets/js/page-第三章特殊字符.5bf4d900.js"><link rel="prefetch" href="/assets/js/page-第三部分shell进阶.a9673a83.js"><link rel="prefetch" href="/assets/js/page-第九章换个角度看变量.241632e2.js"><link rel="prefetch" href="/assets/js/page-第二十一章子shell.4bab7f70.js"><link rel="prefetch" href="/assets/js/page-第二十三章进程替换.52d51af8.js"><link rel="prefetch" href="/assets/js/page-第二十二章限制模式的Shell.fc74b6a1.js"><link rel="prefetch" href="/assets/js/page-第二十六章列表结构.25585e4d.js"><link rel="prefetch" href="/assets/js/page-第二章和Sha-Bang（!）一起出发.2a82416b.js"><link rel="prefetch" href="/assets/js/page-第二部分shell基础.f9cb00ce.js"><link rel="prefetch" href="/assets/js/page-第五章引用.d278bb5f.js"><link rel="prefetch" href="/assets/js/page-第五部分高级话题.593435e6.js"><link rel="prefetch" href="/assets/js/page-第八章运算符相关话题.7b1dc763.js"><link rel="prefetch" href="/assets/js/page-第六章退出与退出状态.cba13c59.js"><link rel="prefetch" href="/assets/js/page-第六部分GoogleShell风格指南.3d47e28f.js"><link rel="prefetch" href="/assets/js/page-第十一章循环与分支.578003eb.js"><link rel="prefetch" href="/assets/js/page-第十三章算术扩展.e6c0e04a.js"><link rel="prefetch" href="/assets/js/page-第十二章命令替换.547b72ef.js"><link rel="prefetch" href="/assets/js/page-第十章变量处理.2827f125.js"><link rel="prefetch" href="/assets/js/page-第四章变量与参数.e9158075.js"><link rel="prefetch" href="/assets/js/page-第四部分命令.a7b23384.js"><link rel="prefetch" href="/assets/js/page-管道及IO重定向.d606cd7e.js"><link rel="prefetch" href="/assets/js/page-编程语言的分类.61b0ed29.js"><link rel="prefetch" href="/assets/js/page-网络管理.09f5328b.js"><link rel="prefetch" href="/assets/js/page-聊透监控体系.be13ede9.js"><link rel="prefetch" href="/assets/js/page-计划任务.0fa1736d.js"><link rel="prefetch" href="/assets/js/page-证书相关问题.3e46bece.js"><link rel="prefetch" href="/assets/js/page-调优的目的：.6f4933fa.js"><link rel="prefetch" href="/assets/js/page-软件包管理.20e88d55.js"><link rel="prefetch" href="/assets/js/page-运算符优先级.31aa4f43.js"><link rel="prefetch" href="/assets/js/page-进程管理.f75bc3ab.js"><link rel="prefetch" href="/assets/js/page-通过分析器进行分词.09448c13.js"><link rel="prefetch" href="/assets/js/page-键命令.308812ae.js"><link rel="prefetch" href="/assets/js/page-附录FIO与IO重定向详细介绍.e3966125.js"><link rel="prefetch" href="/assets/js/page-附录TASCII表.3dceba5a.js"><link rel="prefetch" href="/assets/js/page-高可用开源方案KeepalivedVSHeartbeat对比.d1c904d1.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.7998d740.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.e957fda3.js"><link rel="prefetch" href="/assets/js/vendors~reveal.0d670fa7.js"><link rel="prefetch" href="/assets/js/vendors~valine.4e5d56c5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ca69d379.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-anchor"><header class="navbar"><button class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/lufei.jpg" alt="IT外卖小哥" class="logo"> <!----> <span class="site-name can-hide">IT外卖小哥</span></a> <div class="links"><button class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">Theme Color:</label> <li><a href="#" class="default-theme"></a></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">Theme Mode:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="推荐教程" class="dropdown-title"><span class="title"><i class="iconfont icon-software"></i>
        推荐教程
      </span> <span class="arrow down"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/code/shell/" class="nav-link"><i class="iconfont icon-shell"></i>
  Shell
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title"><i class="iconfont icon-code"></i>
        学习笔记
      </span> <span class="arrow down"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>编程语言</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/code/python/" class="nav-link"><i class="iconfont icon-python"></i>
  Python
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>web中间件</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/nginx/" class="nav-link"><i class="iconfont icon-nginx"></i>
  Nginx
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>自动化工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/automate/ansible/" class="nav-link"><i class="iconfont icon-ansible"></i>
  Ansible
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>监控工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/monitor/zabbix/" class="nav-link"><i class="iconfont icon-zabbix"></i>
  Zabbix
</a></li><li class="dropdown-subitem"><a href="/monitor/elk/" class="nav-link"><i class="iconfont icon-elastic"></i>
  ELK
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/" class="nav-link"><i class="iconfont icon-mysql"></i>
  MySQL
</a></li><li class="dropdown-subitem"><a href="/db/redis/" class="nav-link"><i class="iconfont icon-redis"></i>
  Redis
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Linux</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/basic/" class="nav-link"><i class="iconfont icon-linux"></i>
  Linux
</a></li></ul></li></ul></div></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/clay-wangzhi/wiki" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div vocab="https://schema.org/" typeof="Person" class="blogger-info mobile"><div data-balloon-pos="down" class="blogger hasIntro"><img property="image" alt="Blogger Avatar" src="/lufei.jpg" class="avatar round"> <div property="name" class="name">Clay</div> <meta property="url" content="/intro/"></div> <div class="num-wrapper"><div><div class="num">276</div> <div>Articles</div></div> <div><div class="num">8</div> <div>Category</div></div> <div><div class="num">29</div> <div>Tags</div></div> <div><div class="num">276</div> <div>Timeline</div></div></div> <div class="media-links-wrapper"><a href="mailto:clay_wangzhi@163.com" rel="noopener noreferrer" target="_blank" aria-label="Email" data-balloon-pos="up" class="media-link"><span class="sr-only">Email</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-email"><path d="M0 512a512 512 0 101024 0A512 512 0 100 512z" fill="#1384FF"></path> <path d="M299.372 313.572H722.93c28.945 0 52.61 21.845 52.975 48.787L511.333 500.35 246.76 362.481c.182-27.003 23.666-48.97 52.611-48.97zm-52.671 101.702l-.243 244.121c0 27.186 23.848 49.395 52.914 49.395H722.93c29.127 0 52.975-22.21 52.975-49.395V415.152L517.522 546.71a13.957 13.957 0 01-12.682 0L246.7 415.274z" fill="#FFF"></path></svg></a></div></div> <hr>  <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  博客主页
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="推荐教程" class="dropdown-title"><span class="title"><i class="iconfont icon-software"></i>
      推荐教程
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/code/shell/" class="nav-link"><i class="iconfont icon-shell"></i>
  Shell
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title"><i class="iconfont icon-code"></i>
      学习笔记
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>编程语言</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/code/python/" class="nav-link"><i class="iconfont icon-python"></i>
  Python
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>web中间件</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/nginx/" class="nav-link"><i class="iconfont icon-nginx"></i>
  Nginx
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>自动化工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/automate/ansible/" class="nav-link"><i class="iconfont icon-ansible"></i>
  Ansible
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>监控工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/monitor/zabbix/" class="nav-link"><i class="iconfont icon-zabbix"></i>
  Zabbix
</a></li><li class="dropdown-subitem"><a href="/monitor/elk/" class="nav-link"><i class="iconfont icon-elastic"></i>
  ELK
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/mysql/" class="nav-link"><i class="iconfont icon-mysql"></i>
  MySQL
</a></li><li class="dropdown-subitem"><a href="/db/redis/" class="nav-link"><i class="iconfont icon-redis"></i>
  Redis
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Linux</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/linux/basic/" class="nav-link"><i class="iconfont icon-linux"></i>
  Linux
</a></li></ul></li></ul></div></div> <a rel="noopener noreferrer" href="https://github.com/clay-wangzhi/wiki" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <!----> </aside> <main class="page"><nav class="breadcrumb disable"><!----></nav>  <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">keepalived详解</span></h1> <div class="page-info"><!----> <span aria-label="Writing Date📅" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2017-09-15 21:00:00</span></span><span aria-label="Author🖊" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">Clay</span></span><span aria-label="Page views🔢" data-balloon-pos="down" class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 0 0-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z" fill="currentColor"></path></svg> <span id="/other/%E5%BE%85%E6%95%B4%E7%90%86/blog-knowledge/%E9%9B%86%E7%BE%A4-keepalived/" data-flag-title="keepalived详解" class="leancloud_visitors"><span class="leancloud-visitors-count">...</span></span></span><span aria-label="Reading Time⌛" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>About 15 min</span> <meta property="timeRequired" content="PT15M"></span><span aria-label="Words🔠" data-balloon-pos="down" class="words-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon word-icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 0 1 603.43 1.097a512 512 0 0 1 419.474 419.474 73.143 73.143 0 0 1-72.046 85.212H591.36a73.143 73.143 0 0 1-73.143-73.143z" fill="currentColor"></path> <path d="M493.714 566.857h340.297a73.143 73.143 0 0 1 73.143 85.577A457.143 457.143 0 1 1 371.566 117.76a73.143 73.143 0 0 1 85.577 73.143v339.383a36.571 36.571 0 0 0 36.571 36.571z" fill="currentColor"></path></svg> <span>About 4505 words</span> <meta property="wordCount" content="4505"></span><!----><span aria-label="Tags🏷" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.902 458.563 910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 0 0 0 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0"><span role="navigation">集群</span></li> <meta property="keywords" content="集群"></ul></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/other/%E5%BE%85%E6%95%B4%E7%90%86/blog-knowledge/%E9%9B%86%E7%BE%A4-keepalived/#keepalived介绍" class="anchor-link heading2"><div>keepalived介绍</div></a></li><li class="anchor"><a href="/other/%E5%BE%85%E6%95%B4%E7%90%86/blog-knowledge/%E9%9B%86%E7%BE%A4-keepalived/#vrrp协议介绍" class="anchor-link heading2"><div>VRRP协议介绍</div></a></li><li class="anchor"><a href="/other/%E5%BE%85%E6%95%B4%E7%90%86/blog-knowledge/%E9%9B%86%E7%BE%A4-keepalived/#keepalived工作原理" class="anchor-link heading2"><div>keepalived工作原理</div></a></li><li class="anchor"><a href="/other/%E5%BE%85%E6%95%B4%E7%90%86/blog-knowledge/%E9%9B%86%E7%BE%A4-keepalived/#keepalived作用" class="anchor-link heading2"><div>Keepalived作用</div></a></li><li class="anchor"><a href="/other/%E5%BE%85%E6%95%B4%E7%90%86/blog-knowledge/%E9%9B%86%E7%BE%A4-keepalived/#keepalived的配置文件" class="anchor-link heading2"><div>Keepalived的配置文件</div></a></li></ul></div></aside></div> <div class="theme-default-content content__default"><p>Let’s learn keepalived together！</p> <h2 id="keepalived介绍"><a href="#keepalived介绍" class="header-anchor">#</a> keepalived介绍</h2> <p>keepalived观察其名可知，保持存活，在网络里面就是保持在线了，也就是所谓的高可用或热备，它集群管理中保证集群高可用的一个服务软件，其功能类似于heartbeat，用来防止单点故障(单点故障是指一旦某一点出现故障就会导致整个系统架构的不可用)的发生。说到keepalived就不得不说VRRP协议，可以说这个协议就是keepalived实现的基础，那么首先我们来看看VRRP协议。</p> <h2 id="vrrp协议介绍"><a href="#vrrp协议介绍" class="header-anchor">#</a> VRRP协议介绍</h2> <p>学过网络的朋友都知道，网络在设计的时候必须考虑到冗余容灾，包括线路冗余，设备冗余等，防止网络存在单点故障，那在路由器或三层交换机处实现冗余就显得尤为重要。</p> <p>在网络里面有个协议就是来做这事的，这个协议就是VRRP协议，Keepalived就是巧用VRRP协议来实现高可用性(HA)的发生。</p> <p>VRRP全称Virtual Router Redundancy Protocol，即虚拟路由冗余协议。对于VRRP，需要清楚知道的是：</p> <p>1）VRRP是用来实现路由器冗余的协议。
2）VRRP协议是为了消除在静态缺省路由环境下路由器单点故障引起的网络失效而设计的主备模式的协议，使得发生故障而进行设计设备功能切换时可以不影响内外数据通信，不需要再修改内部网络的网络参数。
3）VRRP协议需要具有IP备份，优先路由选择，减少不必要的路由器通信等功能。
4）VRRP协议将两台或多台路由器设备虚拟成一个设备，对外提供虚拟路由器IP（一个或多个）。然而，在路由器组内部，如果实际拥有这个对外IP的路由器如果工作正常的话，就是master，或者是通过算法选举产生的，MASTER实现针对虚拟路由器IP的各种网络功能，如ARP请求，ICMP，以及数据的转发等，其他设备不具有该IP，状态是BACKUP。除了接收MASTER的VRRP状态通告信息外，不执行对外的网络功能，当主级失效时，BACKUP将接管原先MASTER的网络功能。
5）VRRP协议配置时，需要配置每个路由器的虚拟路由ID(VRID)和优先权值，使用VRID将路由器进行分组，具有相同VRID值的路由器为同一个组，VRID是一个0-255的整整数，；同一个组中的路由器通过使用优先权值来选举MASTER。，优先权大者为MASTER，优先权也是一个0-255的正整数。</p> <h2 id="keepalived工作原理"><a href="#keepalived工作原理" class="header-anchor">#</a> keepalived工作原理</h2> <p>keepalived可提供vrrp以及health-check功能，可以只用它提供双机浮动的vip（vrrp虚拟路由功能），这一样可以简单实现一个双机热备高可用的功能：keepalived是以VRRP虚拟路由冗余协议为基础实现高可用的，可以认为是现实路由高可用的协议，即将N台提供相同功能的路由器组成一个路由器组，这个组里面有一个master和多个backup，master上面有一个对外提供服务的vip（该路由器所在局域网内其他机器的默认路由为该vip），master会发组播，当backup收不到VRRP包时就认为master宕掉了，这时就需要根据VRRP的优先级来选举一个backup当master。这样的话就可以保证路由器的高可用了。</p> <p>下图是keepalived的组件图</p> <p><img src="/images/keepalived1.png" alt=""></p> <p>keepalived也是模块化设计，不同模块负责不同的功能，它主要有三个模块，分别是core、check和VRRP，其中：</p> <p>core模块：为keepalived的核心组件，负责主进程的启动、维护以及全局配置文件的加载和解析；</p> <p>check：负责健康检查，包括常见的各种检查方式；</p> <p>VRRP模块：是来实现VRRP协议的。</p> <p>system call：系统调用</p> <p>watch dog：监控check和vrrp进程的看管者，check负责检测子进程的健康状态，当其检测到master上的服务不可用时则通告vrrp将其转移至backup服务器上。</p> <p>除此之外，keepalived还有下面两个组件：</p> <p>libipfwc:iptables（ipchains）库，配置LVS会用到</p> <p>libipvs*：配置LVS会用到</p> <p>注意，keepalived和LVS完全是两码事，只不过他们各负其责相互配合而已。</p> <p>keepalived正常启动的时候，共启动3个进程：
一个是父进程，负责监控其子进程；一个是VRRP子进程，另外一个是checkers子进程；
两个子进程都被系统watchlog看管，两个子进程各自负责复杂自己的事。
Healthcheck子进程检查各自服务器的健康状况，，例如http,lvs。如果healthchecks进程检查到master上服务不可用了，就会通知本机上的VRRP子进程，让他删除通告，并且去掉虚拟IP，转换为BACKUP状态。</p> <h2 id="keepalived作用"><a href="#keepalived作用" class="header-anchor">#</a> Keepalived作用</h2> <p>Keepalived主要用作RealServer的健康状态检查以及LoadBalance主机和BackUP主机之间failover的实现。Keepalived的作用是检测web服务器的状态，如果有一台web服务器死机，或工作出现故障，Keepalived将检测到，并将有故障的web服务器从系统中剔除，当web服务器工作正常后Keepalived自动将web服务器加入到服务器群中，这些工作全部自动完成，不需要人工干涉，需要人工做的只是修复故障的web服务器。</p> <p>----------------------------------------------------------------------------------------------------------------------------
Keepalived和Heartbeat之间的对比
1）Keepalived使用更简单：从安装、配置、使用、维护等角度上对比，Keepalived都比Heartbeat要简单得多，尤其是Heartbeat2.1.4后拆分成3个子项目，安装、配置、使用都比较复杂，尤其是出问题的时候，都不知道具体是哪个子系统出问题了；而Keepalived只有1个安装文件、1个配置文件，配置文件也简单很多；
2）Heartbeat功能更强大：Heartbeat虽然复杂，但功能更强大，配套工具更全，适合做大型集群管理，而Keepalived主要用于集群倒换，基本没有管理功能；
3）协议不同：Keepalived使用VRRP协议进行通信和选举，Heartbeat使用心跳进行通信和选举；Heartbeat除了走网络外，还可以通过串口通信，貌似更可靠；
Keepalived使用的vrrp协议方式，虚拟路由冗余协议 ；Heartbeat是基于主机或网络的服务的高可用方式；
Keepalived的目的是模拟路由器的双机；Heartbeat的目的是用户service的双机
4）使用方式基本类似：如果要基于两者设计高可用方案，最终都要根据业务需要写自定义的脚本，Keepalived的脚本没有任何约束，随便怎么写都可以；Heartbeat的脚本有约束，即要支持service
start/stop/restart这种方式，而且Heartbeart提供了很多默认脚本，简单的绑定ip，启动apache等操作都已经有了；</p> <p>使用建议：
优先使用Keepalived，当Keepalived不够用的时候才选择Heartbeat
lvs的高可用建议用Keepavlived
业务的高可用用Heartbeat
--------------------------------------------------------------------------------------------------------------------------</p> <h2 id="keepalived的配置文件"><a href="#keepalived的配置文件" class="header-anchor">#</a> Keepalived的配置文件</h2> <p>keepalived只有一个配置文件keepalived.conf，配置文件里面主要包括以下几个配置项，分别是global_defs、static_ipaddress、static_routes、VRRP_script、VRRP_instance和virtual_server。</p> <p>总的来说，keepalived主要有三类区域配置，注意不是三种配置文件，是一个配置文件里面三种不同类别的配置区域：
1）全局配置(Global Configuration)
2）VRRPD配置
3）LVS配置</p> <p>下面就重点来说说这三类区域的配置：</p> <p>1）全局配置
全局配置又包括两个子配置：
全局定义(global definition)
静态路由配置(static ipaddress/routes)</p> <p>1--全局定义(global definition)配置范例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>global_defs
{
notification_email
{
admin@example.com
}
notification_email_from admin@example.com
smtp_server 127.0.0.1
stmp_connect_timeout 30
router_id node1
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>全局配置解析
global_defs全局配置标识，表面这个区域{}是全局配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>notification_email
{
admin@example.com
admin@ywlm.net
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>表示keepalived在发生诸如切换操作时需要发送email通知，以及email发送给哪些邮件地址，邮件地址可以多个，每行一个
notification_email_from admin@example.com
表示发送通知邮件时邮件源地址是谁
smtp_server 127.0.0.1
表示发送email时使用的smtp服务器地址，这里可以用本地的sendmail来实现
smtp_connect_timeout 30
连接smtp连接超时时间
router_id node1
机器标识</p> <p>2--静态地址和路由配置范例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>static_ipaddress
{
192.168.1.1/24 brd + dev eth0 scope global
192.168.1.2/24 brd + dev eth1 scope global
}
static_routes
{
src $SRC_IP to $DST_IP dev $SRC_DEVICE
src $SRC_IP to $DST_IP via $GW dev $SRC_DEVICE
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这里实际上和系统里面用命令配置IP地址和路由的曹一样，例如：
192.168.1.1/24 brd + dev eth0 scope global 相当于: ip addr add 192.168.1.1/24 brd + dev eth0 scope global
就是给eth0配置IP地址
路由同理
一般这个区域不需要配置
这里实际上就是给服务器配置真实的IP地址和路由的，在复杂的环境下可能需要配置，一般不会用这个来配置，我们可以直接用vi /etc/sysconfig/network-script/ifcfg-eth1来配置，切记这里可不是VIP哦，不要搞混淆了，切记切记！</p> <p>2）VRRPD配置
VRRPD配置包括三个类：
VRRP同步组(synchroization group)
VRRP实例(VRRP Instance)
VRRP脚本</p> <p>1--VRRP同步组(synchroization group)配置范例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vrrp_sync_group VG_1 {
group {
http
mysql
}
notify_master /path/to/to_master.sh
notify_backup /path_to/to_backup.sh
notify_fault “/path/fault.sh VG_1”
notify /path/to/notify.sh
smtp_alert
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>其中：
group {
http
mysql
}
http和mysql是实例名和下面的实例名一致</p> <p>notify_master /path/to/to_master.sh：表示当切换到master状态时，要执行的脚本
notify_backup /path_to/to_backup.sh：表示当切换到backup状态时，要执行的脚本
notify_fault “/path/fault.sh VG_1”
notify /path/to/notify.sh：
smtp alter表示切换时给global defs中定义的邮件地址发送右键通知</p> <p>2--VRRP实例(instance)配置范例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vrrp_instance http {
state MASTER
interface eth0
dont_track_primary
track_interface {
eth0
eth1
}
mcast_src_ip &lt;IPADDR&gt;
garp_master_delay 10
virtual_router_id 51
priority 100
advert_int 1
authentication {
auth_type PASS
autp_pass 1234
}
virtual_ipaddress {
#&lt;IPADDR&gt;/&lt;MASK&gt; brd &lt;IPADDR&gt; dev &lt;STRING&gt; scope &lt;SCOPT&gt; label &lt;LABEL&gt;
192.168.200.17/24 dev eth1
192.168.200.18/24 dev eth2 label eth2:1
}
virtual_routes {
# src &lt;IPADDR&gt; [to] &lt;IPADDR&gt;/&lt;MASK&gt; via|gw &lt;IPADDR&gt; dev &lt;STRING&gt; scope &lt;SCOPE&gt; tab
src 192.168.100.1 to 192.168.109.0/24 via 192.168.200.254 dev eth1
192.168.110.0/24 via 192.168.200.254 dev eth1
192.168.111.0/24 dev eth2
192.168.112.0/24 via 192.168.100.254
}
nopreempt
preemtp_delay 300
debug
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>state：state指定instance(Initial)的初始状态，就是说在配置好后，这台服务器的初始状态就是这里指定的，但这里指定的不算，还是得要通过竞选通过优先级来确定，里如果这里设置为master，但如若他的优先级不及另外一台，那么这台在发送通告时，会发送自己的优先级，另外一台发现优先级不如自己的高，那么他会就回抢占为master
interface：实例绑定的网卡，因为在配置虚拟IP的时候必须是在已有的网卡上添加的
dont track primary：忽略VRRP的interface错误
track interface：跟踪接口，设置额外的监控，里面任意一块网卡出现问题，都会进入故障(FAULT)状态，例如，用nginx做均衡器的时候，内网必须正常工作，如果内网出问题了，这个均衡器也就无法运作了，所以必须对内外网同时做健康检查
mcast
src
ip：发送多播数据包时的源IP地址，这里注意了，这里实际上就是在那个地址上发送VRRP通告，这个非常重要，一定要选择稳定的网卡端口来发送，这里相当于heartbeat的心跳端口，如果没有设置那么就用默认的绑定的网卡的IP，也就是interface指定的IP地址
garp master delay：在切换到master状态后，延迟进行免费的ARP(gratuitous ARP)请求
virtual router id：这里设置VRID，这里非常重要，相同的VRID为一个组，他将决定多播的MAC地址
priority 100：设置本节点的优先级，优先级高的为master
advert int：检查间隔，默认为1秒
virtual</p> <p>ipaddress：这里设置的就是VIP，也就是虚拟IP地址，他随着state的变化而增加删除，当state为master的时候就添加，当state为backup的时候删除，这里主要是有优先级来决定的，和state设置的值没有多大关系，这里可以设置多个IP地址
virtual routes：原理和virtual ipaddress一样，只不过这里是增加和删除路由
lvs sync daemon interface：lvs syncd绑定的网卡
authentication：这里设置认证
auth type：认证方式，可以是PASS或AH两种认证方式
auth pass：认证密码
nopreempt：设置不抢占，这里只能设置在state为backup的节点上，而且这个节点的优先级必须别另外的高
preempt delay：抢占延迟
debug：debug级别
notify master：和sync group这里设置的含义一样，可以单独设置，例如不同的实例通知不同的管理人员，http实例发给网站管理员，mysql的就发邮件给DBA</p> <p>3--VRRP脚本范例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vrrp_script check_running {
   script “/usr/local/bin/check_running”
   interval 10
   weight 10
}
vrrp_instance http {
   state BACKUP
   smtp_alert
   interface eth0
   virtual_router_id 101
   priority 90
   advert_int 3
   authentication {
   auth_type PASS
   auth_pass whatever
   }
   virtual_ipaddress {
   1.1.1.1
   }
   track_script {
   check_running weight 20
   }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>首先在vrrp_script区域定义脚本名字和脚本执行的间隔和脚本执行的优先级变更</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>vrrp_script check_running {
script “/usr/local/bin/check_running”
interval 10     #脚本执行间隔
weight 10      #脚本结果导致的优先级变更：10表示优先级+10；-10则表示优先级-10
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>然后在实例(vrrp_instance)里面引用，有点类似脚本里面的函数引用一样：先定义，后引用函数名</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>track_script {
check_running weight 20
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注意：VRRP脚本(vrrp_script)和VRRP实例(vrrp_instance)属于同一个级别</p> <p>3)LVS配置
如果你没有配置LVS+keepalived，那么无需配置这段区域，如果你用的是nginx来代替LVS，这无需配置这款，这里的LVS配置是专门为keepalived+LVS集成准备的。
注意了，这里LVS配置并不是指真的安装LVS然后用ipvsadm来配置它，而是用keepalived的配置文件来代替ipvsadm来配置LVS，这样会方便很多，一个配置文件搞定这些，维护方便，配置方便是也！
这里LVS配置也有两个配置
一个是虚拟主机组配置
一个是虚拟主机配置</p> <p>1--虚拟主机组配置文件详解
这个配置是可选的，根据需求来配置吧，这里配置主要是为了让一台realserver上的某个服务可以属于多个Virtual Server，并且只做一次健康检查:
virtual_server_group <STRING> { # VIP port <IPADDR><PORT><IPADDR><PORT> fwmark <INT> }</INT></PORT></IPADDR></PORT></IPADDR></STRING></p> <p>2--虚拟主机配置
virtual server可以以下面三种的任意一种来配置:
a）virtual server IP port
b）virtual server fwmark int
c）virtual server group string</p> <p>下面以第一种比较常用的方式来配详细解说一下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>virtual_server 192.168.1.2 80 {                     #设置一个virtual server: VIP:Vport
delay_loop 3                                                  # service polling的delay时间，即服务轮询的时间间隔
 
lb_algo rr|wrr|lc|wlc|lblc|sh|dh                        #LVS调度算法
lb_kind NAT|DR|TUN                                      #LVS集群模式                     
persistence_timeout 120                                #会话保持时间（秒为单位），即以用户在120秒内被分配到同一个后端realserver
persistence_granularity &lt;NETMASK&gt;              #LVS会话保持粒度，ipvsadm中的-M参数，默认是0xffffffff，即每个客户端都做会话保持
protocol TCP                                                  #健康检查用的是TCP还是UDP
ha_suspend                                                   #suspendhealthchecker’s activity
virtualhost &lt;string&gt;                                       #HTTP_GET做健康检查时，检查的web服务器的虚拟主机（即host：头）
 
sorry_server &lt;IPADDR&gt; &lt;PORT&gt;                 #备用机，就是当所有后端realserver节点都不可用时，就用这里设置的，也就是临时把所有的请求都发送到这里啦
 
real_server &lt;IPADDR&gt; &lt;PORT&gt;                    #后端真实节点主机的权重等设置，主要，后端有几台这里就要设置几个
{
weight 1                                                         #给每台的权重，0表示失效(不知给他转发请求知道他恢复正常)，默认是1
inhibit_on_failure                                            #表示在节点失败后，把他权重设置成0，而不是冲IPVS中删除
 
notify_up &lt;STRING&gt; | &lt;QUOTED-STRING&gt;  #检查服务器正常(UP)后，要执行的脚本
notify_down &lt;STRING&gt; | &lt;QUOTED-STRING&gt; #检查服务器失败(down)后，要执行的脚本
HTTP_GET                                                     #健康检查方式
{
url {                                                                #要坚持的URL，可以有多个
path /                                                             #具体路径
digest &lt;STRING&gt;                                           
status_code 200                                            #返回状态码
}
connect_port 80                                            #监控检查的端口
 
bindto &lt;IPADD&gt;                                             #健康检查的IP地址
connect_timeout   3                                       #连接超时时间
nb_get_retry 3                                               #重连次数
delay_before_retry 2                                      #重连间隔
} # END OF HTTP_GET|SSL_GET
 
#下面是常用的健康检查方式，健康检查方式一共有HTTP_GET|SSL_GET|TCP_CHECK|SMTP_CHECK|MISC_CHECK这些
#TCP方式
TCP_CHECK {
connect_port 80
bindto 192.168.1.1
connect_timeout 4
} # TCP_CHECK
 
# SMTP方式，这个可以用来给邮件服务器做集群
SMTP_CHECK
host {
connect_ip &lt;IP ADDRESS&gt;
connect_port &lt;PORT&gt;                                     #默认检查25端口
14 KEEPALIVED
bindto &lt;IP ADDRESS&gt;
}
connect_timeout &lt;INTEGER&gt;
retry &lt;INTEGER&gt;
delay_before_retry &lt;INTEGER&gt;
# “smtp HELO
helo_name &lt;STRING&gt;|&lt;QUOTED-STRING&gt;
} #SMTP_CHECK
 
#MISC方式，这个可以用来检查很多服务器只需要自己会些脚本即可
MISC_CHECK
{
misc_path &lt;STRING&gt;|&lt;QUOTED-STRING&gt; #外部程序或脚本
misc_timeout &lt;INT&gt;                                    #脚本或程序执行超时时间
 
misc_dynamic                                               #这个就很好用了，可以非常精确的来调整权重，是后端每天服务器的压力都能均衡调配，这个主要是通过执行的程序或脚本返回的状态代码来动态调整weight值，使权重根据真实的后端压力来适当调整，不过这需要有过硬的脚本功夫才行哦
#返回0：健康检查没问题，不修改权重
#返回1：健康检查失败，权重设置为0
#返回2-255：健康检查没问题，但是权重却要根据返回代码修改为返回码-2，例如如果程序或脚本执行后返回的代码为200，#那么权重这回被修改为 200-2
}
} # Realserver
} # Virtual Server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>转载地址：</p> <p>https://www.cnblogs.com/kevingrace/p/6248941.html</p></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/clay-wangzhi/wiki/edit/main/other/待整理/blog-knowledge/集群-keepalived.md" target="_blank" rel="noopener noreferrer">Edit this page</a></div> <div class="meta-item update-time"><span class="label">Last update:</span> <span class="info">April 2, 2021 14:48</span></div> <!----></footer> <!----> <div class="comments-wrapper"><div class="valine-wrapper"><div id="valine"></div></div></div> </main> <footer class="footer-wrapper"><div class="media-links-wrapper"><a href="mailto:clay_wangzhi@163.com" rel="noopener noreferrer" target="_blank" aria-label="Email" data-balloon-pos="up" class="media-link"><span class="sr-only">Email</span> <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon icon-email"><path d="M0 512a512 512 0 101024 0A512 512 0 100 512z" fill="#1384FF"></path> <path d="M299.372 313.572H722.93c28.945 0 52.61 21.845 52.975 48.787L511.333 500.35 246.76 362.481c.182-27.003 23.666-48.97 52.611-48.97zm-52.671 101.702l-.243 244.121c0 27.186 23.848 49.395 52.914 49.395H722.93c29.127 0 52.975-22.21 52.975-49.395V415.152L517.522 546.71a13.957 13.957 0 01-12.682 0L246.7 415.274z" fill="#FFF"></path></svg></a></div> <!----> <div class="copyright">Copyright © 2021 Clay</div></footer></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="Close" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">This app can be installed on your PC or mobile device.  This will allow this web app to look and behave like any other installed app.  You will find it in your app lists and be able to pin it to your home screen, start menus or task bars.  This installed web app will also be able to safely interact with other apps and your operating system. </p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>Description</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        Install <span></span></button> <button class="cancel-button">
        Cancel
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close (Esc)" class="pswp__button pswp__button--close"></button> <button title="Share" class="pswp__button pswp__button--share"></button> <button title="Toggle fullscreen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Previous (arrow left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (arrow right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.8a92dcc3.js" defer></script><script src="/assets/js/layout-Layout.3b564286.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.25725a2a.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.cf79f7df.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.cbd798c5.js" defer></script><script src="/assets/js/page-keepalived详解.6376a09a.js" defer></script>
  </body>
</html>

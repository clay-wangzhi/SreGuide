import{_ as e,r as p,c as o,a as s,b as t,F as r,d as n,e as c,o as l}from"./app.200bae49.js";const k={},u=s("h1",{id:"\u901A\u8FC7\u5907\u4EFD-etcd-\u6765\u5B8C\u7F8E\u6062\u590D-kubernetes-\u4E2D\u7684\u8BEF\u5220\u6570\u636E",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u901A\u8FC7\u5907\u4EFD-etcd-\u6765\u5B8C\u7F8E\u6062\u590D-kubernetes-\u4E2D\u7684\u8BEF\u5220\u6570\u636E","aria-hidden":"true"},"#"),n(" \u901A\u8FC7\u5907\u4EFD Etcd \u6765\u5B8C\u7F8E\u6062\u590D Kubernetes \u4E2D\u7684\u8BEF\u5220\u6570\u636E")],-1),b=n("\u8F6C\u8F7D\u81EA\uFF1A"),d={href:"https://kubesphere.com.cn/forum/d/3532-etcdkubernetes",target:"_blank",rel:"noopener noreferrer"},i=n("Etcd\u5907\u4EFD\u6570\u636E\u5982\u4F55\u505A\u5230\u5B8C\u7F8E\u6062\u590DKubernetes\u4E2D\u8BEF\u5220\u6570\u636E\u5462"),m=c(`<p>\u8BEF\u5220\u6216\u8005\u673A\u5668\u5B95\u673A\uFF0C\u4F1A\u5BFC\u81F4etcd\u6570\u636E\u7684\u4E22\u5931\u6216\u67D0\u4E2A\u8282\u70B9\u7684etcd\u6570\u636E\u5F02\u5E38\u65F6\uFF0C<strong>\u8BF7\u4E0D\u8981\u614C\uFF0C\u8BA4\u771F\u770B\u5B8C\u6B64\u6587\uFF0C\u7EDD\u5BF9\u6709\u6536\u83B7</strong>\u3002\u5F53\u8BEF\u5220\u65F6\uFF0C\u5982\u4F55\u6062\u590D\u6570\u636E\uFF0C\u8FD9\u4E2A\u64CD\u4F5C\u9700\u6C42\u5728\u5B9E\u9645\u73AF\u5883\u5F53\u4E2D\u662F\u4E0D\u53EF\u907F\u514D\u7684\u3002\u4EE5\u4E0B\u63CF\u8FF0\u5220\u9664\u4E24\u4E2Anamespace\u4E0B\u7684pod\uFF0C\u5982\u4F55\u6062\u590D\u5BF9\u5E94namespace\u7684\u6570\u636E\u3002</p><h2 id="_1-\u64CD\u4F5C\u73AF\u5883\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_1-\u64CD\u4F5C\u73AF\u5883\u4FE1\u606F" aria-hidden="true">#</a> 1 \u64CD\u4F5C\u73AF\u5883\u4FE1\u606F</h2><p>3\u4E2A\uFF08master\u3001etcd\uFF09+1\u4E2Anode\u3001\u65B0\u5EFA1\u4E2Anamespace\u4E0B\u4E14\u521B\u5EFApod\u548Cdefault namespace\u4E0B\u521B\u5EFApod\u3002</p><h2 id="_2-\u524D\u63D0\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#_2-\u524D\u63D0\u6761\u4EF6" aria-hidden="true">#</a> 2 \u524D\u63D0\u6761\u4EF6</h2><p>\u8BEF\u5220\u9664\u7684\u6570\u636E\u5DF2\u5728etcd\u5907\u4EFD</p><h2 id="_3-\u6570\u636E\u73AF\u5883\u7684\u6A21\u62DF" tabindex="-1"><a class="header-anchor" href="#_3-\u6570\u636E\u73AF\u5883\u7684\u6A21\u62DF" aria-hidden="true">#</a> 3 \u6570\u636E\u73AF\u5883\u7684\u6A21\u62DF</h2><h3 id="_3-1-\u65B0\u5EFA-test-namespace-\u5728\u8BE5ns\u4E0B\u521B\u5EFApod-\u521B\u5EFA\u6210\u529F\u4E4B\u540E-\u6B64\u65F6\u8FD9\u4E9B\u6570\u636E\u5DF2\u5B58\u5728etcd\u4E2D\u3002" tabindex="-1"><a class="header-anchor" href="#_3-1-\u65B0\u5EFA-test-namespace-\u5728\u8BE5ns\u4E0B\u521B\u5EFApod-\u521B\u5EFA\u6210\u529F\u4E4B\u540E-\u6B64\u65F6\u8FD9\u4E9B\u6570\u636E\u5DF2\u5B58\u5728etcd\u4E2D\u3002" aria-hidden="true">#</a> 3.1 \u65B0\u5EFA test namespace\uFF0C\u5728\u8BE5ns\u4E0B\u521B\u5EFApod\uFF0C\u521B\u5EFA\u6210\u529F\u4E4B\u540E\uFF0C\u6B64\u65F6\u8FD9\u4E9B\u6570\u636E\u5DF2\u5B58\u5728etcd\u4E2D\u3002</h3><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>kubectl get pod <span class="token operator">-</span>n test
NAME                              READY   <span class="token keyword">STATUS</span>    RESTARTS   AGE
details<span class="token operator">-</span>v1<span class="token operator">-</span><span class="token number">7</span>d78fc5688<span class="token operator">-</span>ntvtd       <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
productpage<span class="token operator">-</span>v1<span class="token operator">-</span><span class="token number">844495</span>cb4b<span class="token operator">-</span>qn6l9   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
ratings<span class="token operator">-</span>v1<span class="token operator">-</span><span class="token number">55</span>ccf46fb4<span class="token operator">-</span>pwqw7       <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
reviews<span class="token operator">-</span>v1<span class="token operator">-</span><span class="token number">68</span>bb7b8c4f<span class="token operator">-</span>h6vr9       <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-2-\u5728default-namespace-\u521B\u5EFApod-\u5982\u4E0B\u6240\u793A-\u521B\u5EFA\u6210\u529F\u4E4B\u540E-\u6B64\u65F6\u8FD9\u4E9B\u6570\u636E\u5DF2\u5B58\u5728etcd\u4E2D" tabindex="-1"><a class="header-anchor" href="#_3-2-\u5728default-namespace-\u521B\u5EFApod-\u5982\u4E0B\u6240\u793A-\u521B\u5EFA\u6210\u529F\u4E4B\u540E-\u6B64\u65F6\u8FD9\u4E9B\u6570\u636E\u5DF2\u5B58\u5728etcd\u4E2D" aria-hidden="true">#</a> 3.2 \u5728default namespace \u521B\u5EFApod\uFF0C\u5982\u4E0B\u6240\u793A\uFF0C\u521B\u5EFA\u6210\u529F\u4E4B\u540E\uFF0C\u6B64\u65F6\u8FD9\u4E9B\u6570\u636E\u5DF2\u5B58\u5728etcd\u4E2D</h3><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>kubectl get pod
NAME                      READY   <span class="token keyword">STATUS</span>    RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6</span>db489d4b7<span class="token operator">-</span>jdfkw    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
nginx1<span class="token operator">-</span><span class="token number">675</span>bf6c9f<span class="token operator">-</span>jndrx    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
nginx2<span class="token operator">-</span><span class="token number">6</span>dfc958b55<span class="token operator">-</span>vgsc4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
nginx3<span class="token operator">-</span><span class="token number">8</span>f65b44f9<span class="token operator">-</span><span class="token number">2</span>pk4l    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
nginx4<span class="token operator">-</span><span class="token number">9</span>bb966479<span class="token operator">-</span>svhs6    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
nginx5<span class="token operator">-</span><span class="token number">7</span>d4d998c6c<span class="token operator">-</span><span class="token number">7</span>xlp8   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
nginx6<span class="token operator">-</span><span class="token number">79444687</span>cf<span class="token operator">-</span>rc8vk   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">12</span>h
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-3-\u5728\u67D0\u76EE\u5F55\u4E0B\u5DF2\u5B58\u653E\u5305\u542B\u4E0A\u8FF0\u4EA7\u751F\u6570\u636E\u7684etcd\u5FEB\u7167" tabindex="-1"><a class="header-anchor" href="#_3-3-\u5728\u67D0\u76EE\u5F55\u4E0B\u5DF2\u5B58\u653E\u5305\u542B\u4E0A\u8FF0\u4EA7\u751F\u6570\u636E\u7684etcd\u5FEB\u7167" aria-hidden="true">#</a> 3.3 \u5728\u67D0\u76EE\u5F55\u4E0B\u5DF2\u5B58\u653E\u5305\u542B\u4E0A\u8FF0\u4EA7\u751F\u6570\u636E\u7684etcd\u5FEB\u7167</h3><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>ls
member  <span class="token keyword">snapshot</span><span class="token punctuation">.</span>db
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_4-\u6A21\u62DF\u6570\u636E\u7684\u5220\u9664" tabindex="-1"><a class="header-anchor" href="#_4-\u6A21\u62DF\u6570\u636E\u7684\u5220\u9664" aria-hidden="true">#</a> 4 \u6A21\u62DF\u6570\u636E\u7684\u5220\u9664</h2><p>default\u548Ctest namespace\u4E0Bpod\u90FD\u88AB\u5E72\u6389</p><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>kubectl <span class="token keyword">get</span> pod
No <span class="token class-name">resources</span> found <span class="token keyword">in</span> <span class="token keyword">default</span> <span class="token keyword">namespace</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span>root@node1 etcd<span class="token operator">-</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19_02</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">]</span># kubectl <span class="token keyword">get</span> pod <span class="token operator">-</span>n test
No <span class="token class-name">resources</span> found <span class="token keyword">in</span> test <span class="token keyword">namespace</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="_5-\u6570\u636E\u7684\u6062\u590D" tabindex="-1"><a class="header-anchor" href="#_5-\u6570\u636E\u7684\u6062\u590D" aria-hidden="true">#</a> 5 \u6570\u636E\u7684\u6062\u590D</h2><h3 id="_5-1-\u51C6\u5907\u5DE5\u4F5C" tabindex="-1"><a class="header-anchor" href="#_5-1-\u51C6\u5907\u5DE5\u4F5C" aria-hidden="true">#</a> 5.1 \u51C6\u5907\u5DE5\u4F5C</h3><p>\u505C\u6B62\u6240\u6709master\u4E0Akube-apiserver\u670D\u52A1\uFF0C\u56E0\u4E3A\u548Cetcd\u4EA4\u4E92\u662Fkube-apiserver\u3002\u6B64\u6B65\u9AA4\u4E0D\u4F1A\u5F71\u54CD\u6B63\u5E38\u8FD0\u884C\u7684pod\u3002</p><h4 id="_5-1-1-\u6240\u6709master\u673A\u5668\u4E0A\u64CD\u4F5C\u5982\u4E0B\u6307\u4EE4-\u5C06kube-apiserver-yaml\u6587\u4EF6\u79FB\u9664\u5F53\u524D\u76EE\u5F55\u4E0B-\u4F5C\u7528\u662F\u505C\u6B62kube-apiserver\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_5-1-1-\u6240\u6709master\u673A\u5668\u4E0A\u64CD\u4F5C\u5982\u4E0B\u6307\u4EE4-\u5C06kube-apiserver-yaml\u6587\u4EF6\u79FB\u9664\u5F53\u524D\u76EE\u5F55\u4E0B-\u4F5C\u7528\u662F\u505C\u6B62kube-apiserver\u670D\u52A1" aria-hidden="true">#</a> 5.1.1 \u6240\u6709master\u673A\u5668\u4E0A\u64CD\u4F5C\u5982\u4E0B\u6307\u4EE4,\u5C06kube-apiserver.yaml\u6587\u4EF6\u79FB\u9664\u5F53\u524D\u76EE\u5F55\u4E0B\uFF0C\u4F5C\u7528\u662F\u505C\u6B62kube-apiserver\u670D\u52A1</h4><div class="language-undefined ext-undefined line-numbers-mode"><pre class="language-undefined"><code>mv /etc/kubernetes/manifests/kube-apiserver.yaml .
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_5-1-2-\u68C0\u67E5kube-apiserver\u670D\u52A1\u5DF2\u505C\u6B62" tabindex="-1"><a class="header-anchor" href="#_5-1-2-\u68C0\u67E5kube-apiserver\u670D\u52A1\u5DF2\u505C\u6B62" aria-hidden="true">#</a> 5.1.2 \u68C0\u67E5kube-apiserver\u670D\u52A1\u5DF2\u505C\u6B62</h4><div class="language-perl ext-perl line-numbers-mode"><pre class="language-perl"><code>kubectl get pod <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token operator">|</span> grep kube<span class="token operator">-</span>apiserver
Unable to connect to the server<span class="token punctuation">:</span> EOF
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-1-3-\u6240\u6709etcd\u673A\u5668\u4E0A-\u505C\u6B62etcd\u8FD0\u884C-\u6B64\u6B65\u64CD\u4F5C\u4E0D\u4F1A\u5F71\u54CD\u73B0\u6709\u7684pod-\u53EA\u662F\u4E0D\u80FD\u65B0\u5EFA\u3001\u5220\u9664pod\u3002" tabindex="-1"><a class="header-anchor" href="#_5-1-3-\u6240\u6709etcd\u673A\u5668\u4E0A-\u505C\u6B62etcd\u8FD0\u884C-\u6B64\u6B65\u64CD\u4F5C\u4E0D\u4F1A\u5F71\u54CD\u73B0\u6709\u7684pod-\u53EA\u662F\u4E0D\u80FD\u65B0\u5EFA\u3001\u5220\u9664pod\u3002" aria-hidden="true">#</a> 5.1.3 \u6240\u6709etcd\u673A\u5668\u4E0A\uFF0C\u505C\u6B62etcd\u8FD0\u884C\uFF0C\u6B64\u6B65\u64CD\u4F5C\u4E0D\u4F1A\u5F71\u54CD\u73B0\u6709\u7684pod\uFF0C\u53EA\u662F\u4E0D\u80FD\u65B0\u5EFA\u3001\u5220\u9664pod\u3002</h4><div class="language-vbnet ext-vbnet line-numbers-mode"><pre class="language-vbnet"><code>systemctl <span class="token keyword">stop</span> etcd
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_5-1-4-\u67E5\u770Betcd\u670D\u52A1\u662F\u5426\u5DF2\u505C\u6B62" tabindex="-1"><a class="header-anchor" href="#_5-1-4-\u67E5\u770Betcd\u670D\u52A1\u662F\u5426\u5DF2\u505C\u6B62" aria-hidden="true">#</a> 5.1.4 \u67E5\u770Betcd\u670D\u52A1\u662F\u5426\u5DF2\u505C\u6B62</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>docker ps <span class="token operator">-</span>a <span class="token operator">|</span> grep etcd
<span class="token number">18d</span>fbbfb8317   kubesphere<span class="token operator">/</span>etcd<span class="token operator">:</span>v3<span class="token punctuation">.</span><span class="token number">3.12</span>            <span class="token string">&quot;/usr/local/bin/etcd&quot;</span>    <span class="token number">15</span> hours ago   <span class="token class-name">Exited</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">45</span> seconds ago             etcd3
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-1-5-\u79FB\u9664\u6240\u6709etcd\u5B58\u50A8\u76EE\u5F55\u4E0B\u6570\u636E-\u4E0D\u540C\u73AF\u5883\u4E0B-\u5B58\u50A8\u76EE\u5F55\u53EF\u80FD\u4E0D\u4E00\u6837-\u53EF\u4EE5\u901A\u8FC7systemctl-status-etcd\u67E5\u770Betcd-\u914D\u7F6E\u53C2\u6570\u3002" tabindex="-1"><a class="header-anchor" href="#_5-1-5-\u79FB\u9664\u6240\u6709etcd\u5B58\u50A8\u76EE\u5F55\u4E0B\u6570\u636E-\u4E0D\u540C\u73AF\u5883\u4E0B-\u5B58\u50A8\u76EE\u5F55\u53EF\u80FD\u4E0D\u4E00\u6837-\u53EF\u4EE5\u901A\u8FC7systemctl-status-etcd\u67E5\u770Betcd-\u914D\u7F6E\u53C2\u6570\u3002" aria-hidden="true">#</a> 5.1.5 \u79FB\u9664\u6240\u6709etcd\u5B58\u50A8\u76EE\u5F55\u4E0B\u6570\u636E\uFF0C\u4E0D\u540C\u73AF\u5883\u4E0B\uFF0C\u5B58\u50A8\u76EE\u5F55\u53EF\u80FD\u4E0D\u4E00\u6837\uFF0C\u53EF\u4EE5\u901A\u8FC7systemctl status etcd\u67E5\u770Betcd \u914D\u7F6E\u53C2\u6570\u3002</h4><div class="language-csharp ext-cs line-numbers-mode"><pre class="language-csharp"><code>mv <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd<span class="token punctuation">.</span>bak
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_5-1-6-\u5C06node1\u673A\u5668\u4E0A\u7684\u5FEB\u7167snapshot-db\u5206\u522B\u62F7\u8D1D\u5230\u53E6\u5916\u4E24\u53F0etcd\u673A\u5668\u4E0A\u3002" tabindex="-1"><a class="header-anchor" href="#_5-1-6-\u5C06node1\u673A\u5668\u4E0A\u7684\u5FEB\u7167snapshot-db\u5206\u522B\u62F7\u8D1D\u5230\u53E6\u5916\u4E24\u53F0etcd\u673A\u5668\u4E0A\u3002" aria-hidden="true">#</a> 5.1.6 \u5C06node1\u673A\u5668\u4E0A\u7684\u5FEB\u7167snapshot.db\u5206\u522B\u62F7\u8D1D\u5230\u53E6\u5916\u4E24\u53F0etcd\u673A\u5668\u4E0A\u3002</h4><div class="language-ruby ext-rb line-numbers-mode"><pre class="language-ruby"><code>scp snapshot<span class="token punctuation">.</span>db <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token operator">/</span>root


scp snapshot<span class="token punctuation">.</span>db <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token operator">/</span>root
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_5-2-\u6062\u590D\u5907\u4EFD" tabindex="-1"><a class="header-anchor" href="#_5-2-\u6062\u590D\u5907\u4EFD" aria-hidden="true">#</a> 5.2 \u6062\u590D\u5907\u4EFD</h3><p>\u4E0D\u540C\u73AF\u5883\u4E0B\uFF0C\u76EE\u5F55\u53EF\u80FD\u4E0D\u4E00\u6837\uFF0C\u53EF\u4EE5\u901A\u8FC7systemctl status etcd\u67E5\u770Betcd \u914D\u7F6E\u53C2\u6570\u3002\u7279\u522B\u9700\u8981\u6CE8\u610Fname\u3001initial-cluster\u3001initial-cluster-token\u3001initial-advertise-peer-urls\u548Cdata-dir\u53C2\u6570\u7684\u503C\u3002</p><h4 id="_5-2-1-\u5728\u7B2C\u4E00\u53F0etcd\u8282\u70B9\u4E0A-\u6CE8\u610F\u9700\u8981etcdctl-api-3\u3001name\u503C\u3001ip\u503C\u3001snapshot-db\u6587\u4EF6\u76EE\u5F55\u548Cdata-dir\u76EE\u5F55\u3002" tabindex="-1"><a class="header-anchor" href="#_5-2-1-\u5728\u7B2C\u4E00\u53F0etcd\u8282\u70B9\u4E0A-\u6CE8\u610F\u9700\u8981etcdctl-api-3\u3001name\u503C\u3001ip\u503C\u3001snapshot-db\u6587\u4EF6\u76EE\u5F55\u548Cdata-dir\u76EE\u5F55\u3002" aria-hidden="true">#</a> 5.2.1 \u5728\u7B2C\u4E00\u53F0etcd\u8282\u70B9\u4E0A\uFF0C\u6CE8\u610F\u9700\u8981ETCDCTL_API=3\u3001name\u503C\u3001ip\u503C\u3001snapshot.db\u6587\u4EF6\u76EE\u5F55\u548Cdata-dir\u76EE\u5F55\u3002</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token constant">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span> 
\u4E00\u6761\u6307\u4EE4\uFF0C\u53EF\u4EE5\u76F4\u63A5\u5728\u7EC8\u7AEF\u4E0A\u4FEE\u6539\u91CC\u9762\u53C2\u6570
etcdctl snapshot restore snapshot<span class="token punctuation">.</span>db <span class="token operator">--</span>name etcd1 <span class="token operator">--</span>initial<span class="token operator">-</span>cluster <span class="token string">&quot;etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380&quot;</span> <span class="token operator">--</span>initial<span class="token operator">-</span>cluster<span class="token operator">-</span>token k8s_etcd <span class="token operator">--</span>initial<span class="token operator">-</span>advertise<span class="token operator">-</span>peer<span class="token operator">-</span>urls https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.25</span><span class="token operator">:</span><span class="token number">2380</span> <span class="token operator">--</span>data<span class="token operator">-</span>dir<span class="token operator">=</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd
\u548C\u4E0A\u9762\u6307\u4EE4\u4E00\u6837\u4F5C\u7528\uFF0C\u628A\u957F\u7684\u6307\u4EE4\u4EE5\u6362\u884C\u5F62\u5F0F\u5C55\u73B0
etcdctl snapshot restore snapshot<span class="token punctuation">.</span>db <span class="token operator">--</span>name etcd1 \\
<span class="token operator">--</span>initial<span class="token operator">-</span>cluster <span class="token string">&quot;etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380&quot;</span> \\
<span class="token operator">--</span>initial<span class="token operator">-</span>cluster<span class="token operator">-</span>token k8s_etcd \\
<span class="token operator">--</span>initial<span class="token operator">-</span>advertise<span class="token operator">-</span>peer<span class="token operator">-</span>urls https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.25</span><span class="token operator">:</span><span class="token number">2380</span> \\
<span class="token operator">--</span>data<span class="token operator">-</span>dir<span class="token operator">=</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd

<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">06.773113</span> <span class="token constant">I</span> <span class="token operator">|</span> mvcc<span class="token operator">:</span> restore compact to <span class="token number">96139</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">06.800086</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 7370b1d3dc967c <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.25</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">06.800159</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 2ef3cfc4ca48ad38 <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">06.800190</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 3a0c86c4c744477c <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_5-2-2-\u7B2C\u4E8C\u53F0\u548C\u7B2C\u4E09\u53F0etcd\u6062\u590D\u6570\u636E-\u540C\u6837\u9700\u8981\u6539\u53D8etcdctl-api-3\u3001name\u503C\u3001ip\u503C\u3001snapshot-db\u6587\u4EF6\u76EE\u5F55\u548Cdata-dir\u76EE\u5F55\u3002" tabindex="-1"><a class="header-anchor" href="#_5-2-2-\u7B2C\u4E8C\u53F0\u548C\u7B2C\u4E09\u53F0etcd\u6062\u590D\u6570\u636E-\u540C\u6837\u9700\u8981\u6539\u53D8etcdctl-api-3\u3001name\u503C\u3001ip\u503C\u3001snapshot-db\u6587\u4EF6\u76EE\u5F55\u548Cdata-dir\u76EE\u5F55\u3002" aria-hidden="true">#</a> 5.2.2 \u7B2C\u4E8C\u53F0\u548C\u7B2C\u4E09\u53F0etcd\u6062\u590D\u6570\u636E\uFF0C\u540C\u6837\u9700\u8981\u6539\u53D8ETCDCTL_API=3\u3001name\u503C\u3001ip\u503C\u3001snapshot.db\u6587\u4EF6\u76EE\u5F55\u548Cdata-dir\u76EE\u5F55\u3002</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token constant">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span>
\u4E00\u6761\u6307\u4EE4\uFF0C\u53EF\u4EE5\u76F4\u63A5\u5728\u7EC8\u7AEF\u4E0A\u4FEE\u6539\u91CC\u9762\u53C2\u6570
etcdctl snapshot restore snapshot<span class="token punctuation">.</span>db <span class="token operator">--</span>name etcd2 <span class="token operator">--</span>initial<span class="token operator">-</span>cluster <span class="token string">&quot;etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380&quot;</span> <span class="token operator">--</span>initial<span class="token operator">-</span>cluster<span class="token operator">-</span>token k8s_etcd <span class="token operator">--</span>initial<span class="token operator">-</span>advertise<span class="token operator">-</span>peer<span class="token operator">-</span>urls https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token number">2380</span> <span class="token operator">--</span>data<span class="token operator">-</span>dir<span class="token operator">=</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd
\u548C\u4E0A\u9762\u6307\u4EE4\u4E00\u6837\u4F5C\u7528\uFF0C\u628A\u957F\u7684\u6307\u4EE4\u4EE5\u6362\u884C\u5F62\u5F0F\u5C55\u73B0
etcdctl snapshot restore snapshot<span class="token punctuation">.</span>db <span class="token operator">--</span>name etcd2 \\
<span class="token operator">--</span>initial<span class="token operator">-</span>cluster <span class="token string">&quot;etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380&quot;</span> \\
<span class="token operator">--</span>initial<span class="token operator">-</span>cluster<span class="token operator">-</span>token k8s_etcd \\
<span class="token operator">--</span>initial<span class="token operator">-</span>advertise<span class="token operator">-</span>peer<span class="token operator">-</span>urls https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token number">2380</span> \\
<span class="token operator">--</span>data<span class="token operator">-</span>dir<span class="token operator">=</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd

<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">59.857363</span> <span class="token constant">I</span> <span class="token operator">|</span> mvcc<span class="token operator">:</span> restore compact to <span class="token number">96139</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">59.873793</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 7370b1d3dc967c <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.25</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">59.873837</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 2ef3cfc4ca48ad38 <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">19</span><span class="token operator">:</span><span class="token number">59.873852</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 3a0c86c4c744477c <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71

<span class="token keyword">export</span> <span class="token constant">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span>
\u4E00\u6761\u6307\u4EE4\uFF0C\u53EF\u4EE5\u76F4\u63A5\u5728\u7EC8\u7AEF\u4E0A\u4FEE\u6539\u91CC\u9762\u53C2\u6570
etcdctl snapshot restore snapshot<span class="token punctuation">.</span>db <span class="token operator">--</span>name etcd3 <span class="token operator">--</span>initial<span class="token operator">-</span>cluster <span class="token string">&quot;etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380&quot;</span> <span class="token operator">--</span>initial<span class="token operator">-</span>cluster<span class="token operator">-</span>token k8s_etcd <span class="token operator">--</span>initial<span class="token operator">-</span>advertise<span class="token operator">-</span>peer<span class="token operator">-</span>urls https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token number">2380</span> <span class="token operator">--</span>data<span class="token operator">-</span>dir<span class="token operator">=</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd
\u548C\u4E0A\u9762\u6307\u4EE4\u4E00\u6837\u4F5C\u7528\uFF0C\u628A\u957F\u7684\u6307\u4EE4\u4EE5\u6362\u884C\u5F62\u5F0F\u5C55\u73B0
etcdctl snapshot restore snapshot<span class="token punctuation">.</span>db <span class="token operator">--</span>name etcd3 \\
<span class="token operator">--</span>initial<span class="token operator">-</span>cluster <span class="token string">&quot;etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380&quot;</span> \\
<span class="token operator">--</span>initial<span class="token operator">-</span>cluster<span class="token operator">-</span>token k8s_etcd \\
<span class="token operator">--</span>initial<span class="token operator">-</span>advertise<span class="token operator">-</span>peer<span class="token operator">-</span>urls https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token number">2380</span> \\
<span class="token operator">--</span>data<span class="token operator">-</span>dir<span class="token operator">=</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>etcd

<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">21.423215</span> <span class="token constant">I</span> <span class="token operator">|</span> mvcc<span class="token operator">:</span> restore compact to <span class="token number">96139</span>
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">21.438319</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 7370b1d3dc967c <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.25</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">21.438357</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 2ef3cfc4ca48ad38 <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71
<span class="token number">2021</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">19</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">21.438371</span> <span class="token constant">I</span> <span class="token operator">|</span> etcdserver<span class="token operator">/</span>membership<span class="token operator">:</span> added member 3a0c86c4c744477c <span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token number">2380</span><span class="token punctuation">]</span> to cluster e4d7f96e88cc9d71
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h4 id="_5-2-3-\u4E0A\u9762\u4E09\u53F0etcd\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#_5-2-3-\u4E0A\u9762\u4E09\u53F0etcd\u542F\u52A8" aria-hidden="true">#</a> 5.2.3 \u4E0A\u9762\u4E09\u53F0etcd\u542F\u52A8</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>systemctl <span class="token keyword">start</span> etcd
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_5-2-4-\u68C0\u67E5etcd\u96C6\u7FA4\u72B6\u6001-\u6CE8\u610F-\u5982\u679C\u6709\u8BC1\u4E66-\u9700\u8981\u52A0\u4E0A\u8BC1\u4E66-\u5728\u54EA\u53F0etcd\u673A\u5668\u6267\u884C-\u6CE8\u610F\u627E\u5230\u5BF9\u5E94\u7684\u8BC1\u4E66\u6587\u4EF6\u53CA\u6700\u540E\u9762\u52A0endpoint-health\u5B57\u6837\u3002" tabindex="-1"><a class="header-anchor" href="#_5-2-4-\u68C0\u67E5etcd\u96C6\u7FA4\u72B6\u6001-\u6CE8\u610F-\u5982\u679C\u6709\u8BC1\u4E66-\u9700\u8981\u52A0\u4E0A\u8BC1\u4E66-\u5728\u54EA\u53F0etcd\u673A\u5668\u6267\u884C-\u6CE8\u610F\u627E\u5230\u5BF9\u5E94\u7684\u8BC1\u4E66\u6587\u4EF6\u53CA\u6700\u540E\u9762\u52A0endpoint-health\u5B57\u6837\u3002" aria-hidden="true">#</a> 5.2.4 \u68C0\u67E5etcd\u96C6\u7FA4\u72B6\u6001\uFF0C\u6CE8\u610F\uFF1A\u5982\u679C\u6709\u8BC1\u4E66\uFF0C\u9700\u8981\u52A0\u4E0A\u8BC1\u4E66\uFF1B\u5728\u54EA\u53F0etcd\u673A\u5668\u6267\u884C\uFF0C\u6CE8\u610F\u627E\u5230\u5BF9\u5E94\u7684\u8BC1\u4E66\u6587\u4EF6\u53CA\u6700\u540E\u9762\u52A0endpoint health\u5B57\u6837\u3002</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>\u4E00\u6761\u6307\u4EE4\uFF0C\u53EF\u4EE5\u76F4\u63A5\u5728\u7EC8\u7AEF\u4E0A\u4FEE\u6539\u91CC\u9762\u53C2\u6570
etcdctl <span class="token operator">--</span>cacert<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>ssl<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>ca<span class="token punctuation">.</span>pem <span class="token operator">--</span>cert<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>ssl<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>node<span class="token operator">-</span>node3<span class="token punctuation">.</span>pem <span class="token operator">--</span>key<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>ssl<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>node<span class="token operator">-</span>node3<span class="token operator">-</span>key<span class="token punctuation">.</span>pem <span class="token operator">--</span>endpoints<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.25</span><span class="token operator">:</span><span class="token number">2379</span><span class="token punctuation">,</span><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token number">2379</span><span class="token punctuation">,</span><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token number">2379</span> endpoint health
\u548C\u4E0A\u9762\u6307\u4EE4\u4E00\u6837\u4F5C\u7528\uFF0C\u628A\u957F\u7684\u6307\u4EE4\u4EE5\u6362\u884C\u5F62\u5F0F\u5C55\u73B0
etcdctl <span class="token operator">--</span>cacert<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>ssl<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>ca<span class="token punctuation">.</span>pem \\
<span class="token operator">--</span>cert<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>ssl<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>node<span class="token operator">-</span>node3<span class="token punctuation">.</span>pem \\
<span class="token operator">--</span>key<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>ssl<span class="token operator">/</span>etcd<span class="token operator">/</span>ssl<span class="token operator">/</span>node<span class="token operator">-</span>node3<span class="token operator">-</span>key<span class="token punctuation">.</span>pem \\
<span class="token operator">--</span>endpoints<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.25</span><span class="token operator">:</span><span class="token number">2379</span><span class="token punctuation">,</span><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token number">2379</span><span class="token punctuation">,</span><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token number">2379</span> \\
endpoint health

<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.28</span><span class="token operator">:</span><span class="token number">2379</span> is healthy<span class="token operator">:</span> successfully committed proposal<span class="token operator">:</span> took <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">.</span>664519ms
<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.26</span><span class="token operator">:</span><span class="token number">2379</span> is healthy<span class="token operator">:</span> successfully committed proposal<span class="token operator">:</span> took <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">.</span>04665ms
<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.25</span><span class="token operator">:</span><span class="token number">2379</span> is healthy<span class="token operator">:</span> successfully committed proposal<span class="token operator">:</span> took <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span>837265ms
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_5-2-5-\u4E09\u53F0etcd\u5168\u90E8\u6B63\u5E38-\u5206\u522B\u5230\u6BCF\u53F0master\u542F\u52A8kube-apiserver" tabindex="-1"><a class="header-anchor" href="#_5-2-5-\u4E09\u53F0etcd\u5168\u90E8\u6B63\u5E38-\u5206\u522B\u5230\u6BCF\u53F0master\u542F\u52A8kube-apiserver" aria-hidden="true">#</a> 5.2.5 \u4E09\u53F0etcd\u5168\u90E8\u6B63\u5E38\uFF0C\u5206\u522B\u5230\u6BCF\u53F0master\u542F\u52A8kube-apiserver</h4><div class="language-undefined ext-undefined line-numbers-mode"><pre class="language-undefined"><code>mv /root/kube-apiserver.yaml /etc/kubernetes/manifests/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_5-2-6-\u68C0\u67E5kubernetes\u96C6\u7FA4\u548C\u521B\u5EFA\u7684pod\u662F\u5426\u6062\u590D\u6B63\u5E38-\u5305\u62ECetcd\u670D\u52A1\u3001kube-apiserver\u670D\u52A1\u53CA\u5BF9\u5E94ns\u4E0B\u5220\u9664\u7684pod\u3002" tabindex="-1"><a class="header-anchor" href="#_5-2-6-\u68C0\u67E5kubernetes\u96C6\u7FA4\u548C\u521B\u5EFA\u7684pod\u662F\u5426\u6062\u590D\u6B63\u5E38-\u5305\u62ECetcd\u670D\u52A1\u3001kube-apiserver\u670D\u52A1\u53CA\u5BF9\u5E94ns\u4E0B\u5220\u9664\u7684pod\u3002" aria-hidden="true">#</a> 5.2.6 \u68C0\u67E5kubernetes\u96C6\u7FA4\u548C\u521B\u5EFA\u7684pod\u662F\u5426\u6062\u590D\u6B63\u5E38\uFF0C\u5305\u62ECetcd\u670D\u52A1\u3001kube-apiserver\u670D\u52A1\u53CA\u5BF9\u5E94ns\u4E0B\u5220\u9664\u7684pod\u3002</h4><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>kubectl get pod <span class="token operator">-</span>n kube<span class="token operator">-</span>system <span class="token operator">|</span> grep kube<span class="token operator">-</span>apiserver
kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>node1                           <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">16</span>h
kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>node2                           <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">16</span>h
kube<span class="token operator">-</span>apiserver<span class="token operator">-</span>node3                           <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">16</span>h
<span class="token punctuation">[</span>root<span class="token variable">@node1</span> ssl<span class="token punctuation">]</span><span class="token comment"># docker ps -a | grep etcd</span>
<span class="token number">156</span>b19a72bf0   kubesphere<span class="token operator">/</span>etcd:v3<span class="token punctuation">.</span><span class="token number">3.12</span>      <span class="token string">&quot;/usr/local/bin/etcd&quot;</span>    <span class="token number">15</span> minutes ago   Up <span class="token number">15</span> minutes                           etcd1


kubectl get pod
NAME                      READY   <span class="token keyword">STATUS</span>              RESTARTS   AGE
nginx<span class="token operator">-</span><span class="token number">6</span>db489d4b7<span class="token operator">-</span>jdfkw    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          <span class="token number">13</span>h
nginx1<span class="token operator">-</span><span class="token number">675</span>bf6c9f<span class="token operator">-</span>jndrx    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          <span class="token number">13</span>h
nginx2<span class="token operator">-</span><span class="token number">6</span>dfc958b55<span class="token operator">-</span>vgsc4   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          <span class="token number">13</span>h
nginx3<span class="token operator">-</span><span class="token number">8</span>f65b44f9<span class="token operator">-</span><span class="token number">2</span>pk4l    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          <span class="token number">13</span>h
nginx4<span class="token operator">-</span><span class="token number">9</span>bb966479<span class="token operator">-</span>svhs6    <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          <span class="token number">13</span>h
nginx5<span class="token operator">-</span><span class="token number">7</span>d4d998c6c<span class="token operator">-</span><span class="token number">7</span>xlp8   <span class="token number">0</span><span class="token operator">/</span><span class="token number">1</span>     ContainerCreating   <span class="token number">0</span>          <span class="token number">13</span>h
nginx6<span class="token operator">-</span><span class="token number">79444687</span>cf<span class="token operator">-</span>rc8vk   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running             <span class="token number">0</span>          <span class="token number">13</span>h
<span class="token punctuation">[</span>root<span class="token variable">@node1</span> ssl<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n test</span>
NAME                              READY   <span class="token keyword">STATUS</span>    RESTARTS   AGE
details<span class="token operator">-</span>v1<span class="token operator">-</span><span class="token number">7</span>d78fc5688<span class="token operator">-</span>ntvtd       <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">13</span>h
productpage<span class="token operator">-</span>v1<span class="token operator">-</span><span class="token number">844495</span>cb4b<span class="token operator">-</span>qn6l9   <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">13</span>h
ratings<span class="token operator">-</span>v1<span class="token operator">-</span><span class="token number">55</span>ccf46fb4<span class="token operator">-</span>pwqw7       <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">13</span>h
reviews<span class="token operator">-</span>v1<span class="token operator">-</span><span class="token number">68</span>bb7b8c4f<span class="token operator">-</span>h6vr9       <span class="token number">1</span><span class="token operator">/</span><span class="token number">1</span>     Running   <span class="token number">0</span>          <span class="token number">13</span>h
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="_6-\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_6-\u603B\u7ED3" aria-hidden="true">#</a> 6 \u603B\u7ED3</h2><p>Kubernetes \u96C6\u7FA4\u5907\u4EFD\u4E3B\u8981\u662F\u5907\u4EFDetcd\u96C6\u7FA4\u3002\u800C\u6062\u590D\u65F6\uFF0C\u4E3B\u8981\u8003\u8651\u6062\u590D\u6574\u4E2A\u987A\u5E8F\uFF1A</p><p>\u505C\u6B62Kube-apiserver\u2013&gt; \u505C\u6B62etcd\u2013&gt; \u6062\u590D\u6570\u636E\u2013&gt;\u542F\u52A8etcd\u2013&gt;\u542F\u52A8kube-apiserver</p><p>\u6CE8\u610F\uFF1A\u5907\u4EFDetcd\u96C6\u7FA4\u65F6\uFF0C\u53EA\u9700\u8981\u5907\u4EFD\u4E00\u4E2Aetcd\u5C31\u884C\uFF0C\u6062\u590D\u65F6\uFF0C\u62FF\u540C\u4E00\u4EFD\u5907\u4EFD\u6570\u636E\u6062\u590D\u3002</p>`,48);function h(v,g){const a=p("ExternalLinkIcon");return l(),o(r,null,[u,s("blockquote",null,[s("p",null,[b,s("a",d,[i,t(a)])])]),m],64)}var _=e(k,[["render",h],["__file","etcd-restore.html.vue"]]);export{_ as default};

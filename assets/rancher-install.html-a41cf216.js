import{_ as r}from"./plugin-vue_export-helper-c27b6911.js";import{r as t,o as l,c,a as e,b as s,d as n,e as i}from"./app-fb0a644a.js";const p={},d=i(`<h1 id="rancher-安装配置" tabindex="-1"><a class="header-anchor" href="#rancher-安装配置" aria-hidden="true">#</a> Rancher 安装配置</h1><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h2><p>添加 Helm Chart 仓库</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>helm repo <span class="token function">add</span> rancher-stable http://rancher-mirror.oss-cn-beijing.aliyuncs.com/server-charts/stable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>为 Rancher 创建 Namespace</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl create namespace cattle-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加 TLS 密文</p><blockquote><p>下载 nginx 使用的 key 和 pem 传到服务器，并重命名为 tls.xxx</p><p>使用openssl把pem证书转换为crt</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>openssl x509 <span class="token parameter variable">-in</span>  tls.pem <span class="token parameter variable">-out</span> tls.crt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl <span class="token parameter variable">-n</span> cattle-system create secret tls tls-rancher-ingress   <span class="token parameter variable">--cert</span><span class="token operator">=</span>tls.crt   <span class="token parameter variable">--key</span><span class="token operator">=</span>tls.key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通过 helm 安装 rancher</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>helm pull rancher-stable/rancher <span class="token parameter variable">--version</span> <span class="token number">2.5</span>.12
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> rancher-2.5.12.tgz
<span class="token builtin class-name">cd</span> rancher/
<span class="token comment"># rancher.xxx.xxx 为申请的域名</span>
helm <span class="token parameter variable">-n</span> cattle-system <span class="token function">install</span> rancher ./ <span class="token parameter variable">--set</span> <span class="token assign-left variable">hostname</span><span class="token operator">=</span>rancher.xxx.xxx <span class="token parameter variable">--set</span> <span class="token assign-left variable">replicas</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--set</span> <span class="token assign-left variable">ingress.tls.source</span><span class="token operator">=</span>secret
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证 Rancher Server 是否安成功</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl <span class="token parameter variable">-n</span> cattle-system rollout status deploy/rancher
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>保存使用选项</p><p>请保存您使用的全部<code>--set</code>选项。使用 Helm 升级 Rancher 到新版本时，您将需要使用相同的选项。</p><blockquote><p>⚠️</p><p>如果外层还有nginx，proxy_pass 协议用https 并加上 websocket 的一些参数</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>proxy_set_header Host <span class="token equation string">$host;
proxy_set_header X-Real_IP $</span>remote_addr;
proxy_http_version 1.1;
proxy_set_header Upgrade <span class="token equation string">$http_upgrade;
proxy_set_header Connection $</span>http_connection;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h2 id="小技巧" tabindex="-1"><a class="header-anchor" href="#小技巧" aria-hidden="true">#</a> 小技巧</h2><p>重置 rancher admin密码</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> rancher-xxxxxx-xxxx <span class="token parameter variable">-n</span> cattle-system -- reset-password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>参考文章：</p>`,20),o={href:"http://docs.rancher.cn/docs/rancher2/installation/install-rancher-on-k8s/_index",target:"_blank",rel:"noopener noreferrer"},h={href:"http://docs.rancher.cn/docs/rancher2.5/installation/resources/tls-secrets/_index/",target:"_blank",rel:"noopener noreferrer"};function m(u,v){const a=t("ExternalLinkIcon");return l(),c("div",null,[d,e("p",null,[e("a",o,[s("Rnacher 高可用安装 | Rancher Doc"),n(a)])]),e("p",null,[e("a",h,[s("添加 TLS 密文 | Rancher Doc "),n(a)])])])}const k=r(p,[["render",m],["__file","rancher-install.html.vue"]]);export{k as default};

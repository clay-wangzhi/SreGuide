const s=JSON.parse(`{"key":"v-0e29a549","path":"/devops/jumpserver/podshell.html","title":"","lang":"zh-CN","frontmatter":{"category":"自动化工具","tag":["jumpserver"],"description":"二开 jumpserver podshell 登录 目的： 控制开发人员可以登录的权限 版本： v2.19.2 修改如下文件内容 diff -r old-apps/apps/applications/api/mixin.py new-apps/apps/applications/api/mixin.py 42c42 &lt; def serialize_applications_with_org(self, applications, tree_id, parent_info, user): --- &gt; def serialize_applications_with_org(self, applications, tree_id, parent_info, user, login_username): 84c84 &lt; tree_nodes = KubernetesTree(tree_id).async_tree_node(parent_info) --- &gt; tree_nodes = KubernetesTree(tree_id).async_tree_node(parent_info, login_username) diff -r old-apps/apps/applications/utils/kubernetes_util.py new-apps/apps/applications/utils/kubernetes_util.py 14a15,16 &gt; import requests &gt; import json 59,60c61,92 &lt; def get_pods(self): &lt; api = self.get_api() --- &gt; #def get_pods(self): &gt; # api = self.get_api() &gt; # try: &gt; # ret = api.list_pod_for_all_namespaces(watch=False, _request_timeout=(3, 3)) &gt; # except MaxRetryError: &gt; # logger.warning('Kubernetes connection timed out') &gt; # return &gt; # except ApiException as e: &gt; # if e.status == 401: &gt; # logger.warning('Kubernetes User not authenticated') &gt; # else: &gt; # logger.warning(e) &gt; # return &gt; # data = {} &gt; # for i in ret.items: &gt; # namespace = i.metadata.namespace &gt; # pod_info = { &gt; # 'pod_name': i.metadata.name, &gt; # 'containers': [j.name for j in i.spec.containers] &gt; # } &gt; # if namespace in data: &gt; # data[namespace].append(pod_info) &gt; # else: &gt; # data[namespace] = [pod_info, ] &gt; # return data &gt; def get_pods(self, login_username): &gt; # 调用 外部系统，查看 用户具有 appid 的权限列表 &gt; xxx_api = \\"https://xxx/xxx_api/v1/auth/user/\\" &gt; xxx_auth = \\"xxx\\" &gt; &gt; res = requests.get(xxx_api+login_username+\\"/appid\\", headers={\\"Authorization\\": xxx_auth}) &gt; xxx_apps = [] 62,64c94,102 &lt; ret = api.list_pod_for_all_namespaces(watch=False, _request_timeout=(3, 3)) &lt; except MaxRetryError: &lt; logger.warning('Kubernetes connection timed out') --- &gt; body = json.loads(res.text) &gt; data = body[\\"data\\"] &gt; msg = body[\\"message\\"] &gt; code = body[\\"code\\"] &gt; if code != 200: &gt; print(\\"调用 xxx 返回异常\\") &gt; return &gt; except Exception as e: &gt; print(\\"调用 xxx 获取appid列表解析失败:\\"+str(e)) 66,70c104,118 &lt; except ApiException as e: &lt; if e.status == 401: &lt; logger.warning('Kubernetes User not authenticated') &lt; else: &lt; logger.warning(e) --- &gt; finally: &gt; res.close() &gt; for app in data: &gt; xxx_apps.append(app[\\"id\\"]) &gt; &gt; # 调用k8s-resource-apis, 自封装的 api 接口 &gt; res_apps = set() &gt; k8s_resource_api = \\"http://xxxx\\" &gt; res = requests.get(k8s_resource_api+\\"/get-all-app-list/\\") &gt; try: &gt; body = json.loads(res.text) &gt; data = body[\\"data\\"] &gt; msg = body[\\"msg\\"] &gt; except Exception as e: &gt; print(\\"调用k8sResourceApi获取appid列表解析失败:\\"+str(e)) 72,80c120,157 &lt; data = {} &lt; for i in ret.items: &lt; namespace = i.metadata.namespace &lt; pod_info = { &lt; 'pod_name': i.metadata.name, &lt; 'containers': [j.name for j in i.spec.containers] &lt; } &lt; if namespace in data: &lt; data[namespace].append(pod_info) --- &gt; finally: &gt; res.close() &gt; &gt; if res.status_code == 200: &gt; for item in data: &gt; res_apps.add(item) &gt; &gt; # apps &gt; apps = [] &gt; for item in xxx_apps: &gt; if item in res_apps: &gt; apps.append(item) &gt; &gt; # get pods &gt; ctx = {} # {\\"namespace\\": [{podname:aaaa, containers}]} &gt; for appid in apps: &gt; res = requests.get(k8s_resource_api+\\"/get-pods-by-app/\\"+appid+\\"/\\") &gt; try: &gt; body = json.loads(res.text) &gt; data = body[\\"data\\"] &gt; msg = body[\\"msg\\"] &gt; except Exception as e: &gt; print(\\"调用k8sResourceApis获取appid-pods列表解析失败:\\"+str(e), appid) &gt; finally: &gt; res.close() &gt; &gt; if res.status_code == 200: &gt; try: &gt; for pod in data: # key: pod-name, 原始data结构：{\\"pod-name\\": {\\"Ns\\": \\"xxx\\", \\"Containers\\": {\\"c-name\\": \\"c-id\\"}}} &gt; ns = data[pod][\\"Ns\\"] # ns == \\"xxx\\" &gt; if ns not in ctx: &gt; ctx[ns] = [] &gt; containers = [] &gt; for c in data[pod][\\"Containers\\"]: &gt; containers.append(c) &gt; ctx[ns].append({\\"pod_name\\": pod, \\"containers\\": containers}) &gt; except Exception as e: &gt; print(\\"解析重组pod列表信息异常:\\"+str(e)) 82,83c159,160 &lt; data[namespace] = [pod_info, ] &lt; return data --- &gt; print(\\"调用k8sResourceApis获取pod列表返回状态异常:\\"+str(res.status_code)+\\" \\"+msg) &gt; return ctx 86c163 &lt; def get_kubernetes_data(app_id, system_user_id): --- &gt; def get_kubernetes_data(app_id, system_user_id, login_username): 91c168 &lt; return k8s.get_pods() --- &gt; return k8s.get_pods(login_username) 153c230 &lt; def async_tree_node(self, parent_info): --- &gt; def async_tree_node(self, parent_info, login_username): 160c237 &lt; data = KubernetesClient.get_kubernetes_data(app_id, system_user_id) --- &gt; data = KubernetesClient.get_kubernetes_data(app_id, system_user_id, login_username) diff -r old-apps/apps/perms/api/application/user_permission/user_permission_applications.py new-apps/apps/perms/api/application/user_permission/user_permission_applications.py 59a60,64 &gt; login_username = \\"\\" &gt; login_user = str(request.__dict__.get(\\"_user\\", \\"\\")) &gt; lft = login_user.split('(') &gt; if len(lft) == 2: &gt; login_username = lft[1].split(')')[0] 64c69 &lt; queryset, tree_id, parent_info, self.user --- &gt; queryset, tree_id, parent_info, self.user, login_username","head":[["meta",{"property":"og:url","content":"https://clay-wangzhi.com/devops/jumpserver/podshell.html"}],["meta",{"property":"og:site_name","content":"SRE运维进阶之路"}],["meta",{"property":"og:description","content":"二开 jumpserver podshell 登录 目的： 控制开发人员可以登录的权限 版本： v2.19.2 修改如下文件内容 diff -r old-apps/apps/applications/api/mixin.py new-apps/apps/applications/api/mixin.py 42c42 &lt; def serialize_applications_with_org(self, applications, tree_id, parent_info, user): --- &gt; def serialize_applications_with_org(self, applications, tree_id, parent_info, user, login_username): 84c84 &lt; tree_nodes = KubernetesTree(tree_id).async_tree_node(parent_info) --- &gt; tree_nodes = KubernetesTree(tree_id).async_tree_node(parent_info, login_username) diff -r old-apps/apps/applications/utils/kubernetes_util.py new-apps/apps/applications/utils/kubernetes_util.py 14a15,16 &gt; import requests &gt; import json 59,60c61,92 &lt; def get_pods(self): &lt; api = self.get_api() --- &gt; #def get_pods(self): &gt; # api = self.get_api() &gt; # try: &gt; # ret = api.list_pod_for_all_namespaces(watch=False, _request_timeout=(3, 3)) &gt; # except MaxRetryError: &gt; # logger.warning('Kubernetes connection timed out') &gt; # return &gt; # except ApiException as e: &gt; # if e.status == 401: &gt; # logger.warning('Kubernetes User not authenticated') &gt; # else: &gt; # logger.warning(e) &gt; # return &gt; # data = {} &gt; # for i in ret.items: &gt; # namespace = i.metadata.namespace &gt; # pod_info = { &gt; # 'pod_name': i.metadata.name, &gt; # 'containers': [j.name for j in i.spec.containers] &gt; # } &gt; # if namespace in data: &gt; # data[namespace].append(pod_info) &gt; # else: &gt; # data[namespace] = [pod_info, ] &gt; # return data &gt; def get_pods(self, login_username): &gt; # 调用 外部系统，查看 用户具有 appid 的权限列表 &gt; xxx_api = \\"https://xxx/xxx_api/v1/auth/user/\\" &gt; xxx_auth = \\"xxx\\" &gt; &gt; res = requests.get(xxx_api+login_username+\\"/appid\\", headers={\\"Authorization\\": xxx_auth}) &gt; xxx_apps = [] 62,64c94,102 &lt; ret = api.list_pod_for_all_namespaces(watch=False, _request_timeout=(3, 3)) &lt; except MaxRetryError: &lt; logger.warning('Kubernetes connection timed out') --- &gt; body = json.loads(res.text) &gt; data = body[\\"data\\"] &gt; msg = body[\\"message\\"] &gt; code = body[\\"code\\"] &gt; if code != 200: &gt; print(\\"调用 xxx 返回异常\\") &gt; return &gt; except Exception as e: &gt; print(\\"调用 xxx 获取appid列表解析失败:\\"+str(e)) 66,70c104,118 &lt; except ApiException as e: &lt; if e.status == 401: &lt; logger.warning('Kubernetes User not authenticated') &lt; else: &lt; logger.warning(e) --- &gt; finally: &gt; res.close() &gt; for app in data: &gt; xxx_apps.append(app[\\"id\\"]) &gt; &gt; # 调用k8s-resource-apis, 自封装的 api 接口 &gt; res_apps = set() &gt; k8s_resource_api = \\"http://xxxx\\" &gt; res = requests.get(k8s_resource_api+\\"/get-all-app-list/\\") &gt; try: &gt; body = json.loads(res.text) &gt; data = body[\\"data\\"] &gt; msg = body[\\"msg\\"] &gt; except Exception as e: &gt; print(\\"调用k8sResourceApi获取appid列表解析失败:\\"+str(e)) 72,80c120,157 &lt; data = {} &lt; for i in ret.items: &lt; namespace = i.metadata.namespace &lt; pod_info = { &lt; 'pod_name': i.metadata.name, &lt; 'containers': [j.name for j in i.spec.containers] &lt; } &lt; if namespace in data: &lt; data[namespace].append(pod_info) --- &gt; finally: &gt; res.close() &gt; &gt; if res.status_code == 200: &gt; for item in data: &gt; res_apps.add(item) &gt; &gt; # apps &gt; apps = [] &gt; for item in xxx_apps: &gt; if item in res_apps: &gt; apps.append(item) &gt; &gt; # get pods &gt; ctx = {} # {\\"namespace\\": [{podname:aaaa, containers}]} &gt; for appid in apps: &gt; res = requests.get(k8s_resource_api+\\"/get-pods-by-app/\\"+appid+\\"/\\") &gt; try: &gt; body = json.loads(res.text) &gt; data = body[\\"data\\"] &gt; msg = body[\\"msg\\"] &gt; except Exception as e: &gt; print(\\"调用k8sResourceApis获取appid-pods列表解析失败:\\"+str(e), appid) &gt; finally: &gt; res.close() &gt; &gt; if res.status_code == 200: &gt; try: &gt; for pod in data: # key: pod-name, 原始data结构：{\\"pod-name\\": {\\"Ns\\": \\"xxx\\", \\"Containers\\": {\\"c-name\\": \\"c-id\\"}}} &gt; ns = data[pod][\\"Ns\\"] # ns == \\"xxx\\" &gt; if ns not in ctx: &gt; ctx[ns] = [] &gt; containers = [] &gt; for c in data[pod][\\"Containers\\"]: &gt; containers.append(c) &gt; ctx[ns].append({\\"pod_name\\": pod, \\"containers\\": containers}) &gt; except Exception as e: &gt; print(\\"解析重组pod列表信息异常:\\"+str(e)) 82,83c159,160 &lt; data[namespace] = [pod_info, ] &lt; return data --- &gt; print(\\"调用k8sResourceApis获取pod列表返回状态异常:\\"+str(res.status_code)+\\" \\"+msg) &gt; return ctx 86c163 &lt; def get_kubernetes_data(app_id, system_user_id): --- &gt; def get_kubernetes_data(app_id, system_user_id, login_username): 91c168 &lt; return k8s.get_pods() --- &gt; return k8s.get_pods(login_username) 153c230 &lt; def async_tree_node(self, parent_info): --- &gt; def async_tree_node(self, parent_info, login_username): 160c237 &lt; data = KubernetesClient.get_kubernetes_data(app_id, system_user_id) --- &gt; data = KubernetesClient.get_kubernetes_data(app_id, system_user_id, login_username) diff -r old-apps/apps/perms/api/application/user_permission/user_permission_applications.py new-apps/apps/perms/api/application/user_permission/user_permission_applications.py 59a60,64 &gt; login_username = \\"\\" &gt; login_user = str(request.__dict__.get(\\"_user\\", \\"\\")) &gt; lft = login_user.split('(') &gt; if len(lft) == 2: &gt; login_username = lft[1].split(')')[0] 64c69 &lt; queryset, tree_id, parent_info, self.user --- &gt; queryset, tree_id, parent_info, self.user, login_username"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-04-19T13:50:36.000Z"}],["meta",{"property":"article:author","content":"Clay"}],["meta",{"property":"article:tag","content":"jumpserver"}],["meta",{"property":"article:modified_time","content":"2023-04-19T13:50:36.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-04-19T13:50:36.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Clay\\",\\"url\\":\\"https://clay-wangzhi.com\\"}]}"]]},"headers":[{"level":2,"title":"二开 jumpserver  podshell 登录","slug":"二开-jumpserver-podshell-登录","link":"#二开-jumpserver-podshell-登录","children":[]}],"git":{"createdTime":1681912236000,"updatedTime":1681912236000,"contributors":[{"name":"clay-wangzhi","email":"clay.wangzhi@gmail.com","commits":1}]},"readingTime":{"minutes":2.04,"words":611},"filePathRelative":"devops/jumpserver/podshell.md","localizedDate":"2023年4月19日","excerpt":"<h2> 二开 jumpserver  podshell 登录</h2>\\n<p>目的： 控制开发人员可以登录的权限</p>\\n<p>版本： <strong>v2.19.2</strong></p>\\n<p>修改如下文件内容</p>\\n<div class=\\"language-python line-numbers-mode\\" data-ext=\\"py\\"><pre class=\\"language-python\\"><code>diff <span class=\\"token operator\\">-</span>r old<span class=\\"token operator\\">-</span>apps<span class=\\"token operator\\">/</span>apps<span class=\\"token operator\\">/</span>applications<span class=\\"token operator\\">/</span>api<span class=\\"token operator\\">/</span>mixin<span class=\\"token punctuation\\">.</span>py new<span class=\\"token operator\\">-</span>apps<span class=\\"token operator\\">/</span>apps<span class=\\"token operator\\">/</span>applications<span class=\\"token operator\\">/</span>api<span class=\\"token operator\\">/</span>mixin<span class=\\"token punctuation\\">.</span>py\\n42c42\\n<span class=\\"token operator\\">&lt;</span>     <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">serialize_applications_with_org</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">,</span> applications<span class=\\"token punctuation\\">,</span> tree_id<span class=\\"token punctuation\\">,</span> parent_info<span class=\\"token punctuation\\">,</span> user<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">serialize_applications_with_org</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">,</span> applications<span class=\\"token punctuation\\">,</span> tree_id<span class=\\"token punctuation\\">,</span> parent_info<span class=\\"token punctuation\\">,</span> user<span class=\\"token punctuation\\">,</span> login_username<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n84c84\\n<span class=\\"token operator\\">&lt;</span>         tree_nodes <span class=\\"token operator\\">=</span> KubernetesTree<span class=\\"token punctuation\\">(</span>tree_id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>async_tree_node<span class=\\"token punctuation\\">(</span>parent_info<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>         tree_nodes <span class=\\"token operator\\">=</span> KubernetesTree<span class=\\"token punctuation\\">(</span>tree_id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>async_tree_node<span class=\\"token punctuation\\">(</span>parent_info<span class=\\"token punctuation\\">,</span> login_username<span class=\\"token punctuation\\">)</span>\\n\\ndiff <span class=\\"token operator\\">-</span>r old<span class=\\"token operator\\">-</span>apps<span class=\\"token operator\\">/</span>apps<span class=\\"token operator\\">/</span>applications<span class=\\"token operator\\">/</span>utils<span class=\\"token operator\\">/</span>kubernetes_util<span class=\\"token punctuation\\">.</span>py new<span class=\\"token operator\\">-</span>apps<span class=\\"token operator\\">/</span>apps<span class=\\"token operator\\">/</span>applications<span class=\\"token operator\\">/</span>utils<span class=\\"token operator\\">/</span>kubernetes_util<span class=\\"token punctuation\\">.</span>py\\n14a15<span class=\\"token punctuation\\">,</span><span class=\\"token number\\">16</span>\\n<span class=\\"token operator\\">&gt;</span> <span class=\\"token keyword\\">import</span> requests\\n<span class=\\"token operator\\">&gt;</span> <span class=\\"token keyword\\">import</span> json\\n<span class=\\"token number\\">59</span><span class=\\"token punctuation\\">,</span>60c61<span class=\\"token punctuation\\">,</span><span class=\\"token number\\">92</span>\\n<span class=\\"token operator\\">&lt;</span>     <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">get_pods</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&lt;</span>         api <span class=\\"token operator\\">=</span> self<span class=\\"token punctuation\\">.</span>get_api<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#def get_pods(self):</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#    api = self.get_api()</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#    try:</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        ret = api.list_pod_for_all_namespaces(watch=False, _request_timeout=(3, 3))</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#    except MaxRetryError:</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        logger.warning('Kubernetes connection timed out')</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        return</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#    except ApiException as e:</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        if e.status == 401:</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#            logger.warning('Kubernetes User not authenticated')</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        else:</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#            logger.warning(e)</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        return</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#    data = {}</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#    for i in ret.items:</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        namespace = i.metadata.namespace</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        pod_info = {</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#            'pod_name': i.metadata.name,</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#            'containers': [j.name for j in i.spec.containers]</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        }</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        if namespace in data:</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#            data[namespace].append(pod_info)</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#        else:</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#            data[namespace] = [pod_info, ]</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token comment\\">#    return data</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">get_pods</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">,</span> login_username<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token comment\\"># 调用 外部系统，查看 用户具有 appid 的权限列表</span>\\n<span class=\\"token operator\\">&gt;</span>         xxx_api <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"https://xxx/xxx_api/v1/auth/user/\\"</span>\\n<span class=\\"token operator\\">&gt;</span>         xxx_auth <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"xxx\\"</span>\\n<span class=\\"token operator\\">&gt;</span>\\n<span class=\\"token operator\\">&gt;</span>         res <span class=\\"token operator\\">=</span> requests<span class=\\"token punctuation\\">.</span>get<span class=\\"token punctuation\\">(</span>xxx_api<span class=\\"token operator\\">+</span>login_username<span class=\\"token operator\\">+</span><span class=\\"token string\\">\\"/appid\\"</span><span class=\\"token punctuation\\">,</span> headers<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"Authorization\\"</span><span class=\\"token punctuation\\">:</span> xxx_auth<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>         xxx_apps <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token number\\">62</span><span class=\\"token punctuation\\">,</span>64c94<span class=\\"token punctuation\\">,</span><span class=\\"token number\\">102</span>\\n<span class=\\"token operator\\">&lt;</span>             ret <span class=\\"token operator\\">=</span> api<span class=\\"token punctuation\\">.</span>list_pod_for_all_namespaces<span class=\\"token punctuation\\">(</span>watch<span class=\\"token operator\\">=</span><span class=\\"token boolean\\">False</span><span class=\\"token punctuation\\">,</span> _request_timeout<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">3</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">3</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&lt;</span>         <span class=\\"token keyword\\">except</span> MaxRetryError<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&lt;</span>             logger<span class=\\"token punctuation\\">.</span>warning<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Kubernetes connection timed out'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>             body <span class=\\"token operator\\">=</span> json<span class=\\"token punctuation\\">.</span>loads<span class=\\"token punctuation\\">(</span>res<span class=\\"token punctuation\\">.</span>text<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>             data <span class=\\"token operator\\">=</span> body<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"data\\"</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>             msg <span class=\\"token operator\\">=</span> body<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"message\\"</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>             code <span class=\\"token operator\\">=</span> body<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"code\\"</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">if</span> code <span class=\\"token operator\\">!=</span> <span class=\\"token number\\">200</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                 <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"调用 xxx 返回异常\\"</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>                 <span class=\\"token keyword\\">return</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">except</span> Exception <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"调用 xxx 获取appid列表解析失败:\\"</span><span class=\\"token operator\\">+</span><span class=\\"token builtin\\">str</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token number\\">66</span><span class=\\"token punctuation\\">,</span>70c104<span class=\\"token punctuation\\">,</span><span class=\\"token number\\">118</span>\\n<span class=\\"token operator\\">&lt;</span>         <span class=\\"token keyword\\">except</span> ApiException <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&lt;</span>             <span class=\\"token keyword\\">if</span> e<span class=\\"token punctuation\\">.</span>status <span class=\\"token operator\\">==</span> <span class=\\"token number\\">401</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&lt;</span>                 logger<span class=\\"token punctuation\\">.</span>warning<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Kubernetes User not authenticated'</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&lt;</span>             <span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&lt;</span>                 logger<span class=\\"token punctuation\\">.</span>warning<span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">finally</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             res<span class=\\"token punctuation\\">.</span>close<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">for</span> app <span class=\\"token keyword\\">in</span> data<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             xxx_apps<span class=\\"token punctuation\\">.</span>append<span class=\\"token punctuation\\">(</span>app<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"id\\"</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token comment\\"># 调用k8s-resource-apis, 自封装的 api 接口</span>\\n<span class=\\"token operator\\">&gt;</span>         res_apps <span class=\\"token operator\\">=</span> <span class=\\"token builtin\\">set</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>         k8s_resource_api <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"http://xxxx\\"</span>\\n<span class=\\"token operator\\">&gt;</span>         res <span class=\\"token operator\\">=</span> requests<span class=\\"token punctuation\\">.</span>get<span class=\\"token punctuation\\">(</span>k8s_resource_api<span class=\\"token operator\\">+</span><span class=\\"token string\\">\\"/get-all-app-list/\\"</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             body <span class=\\"token operator\\">=</span> json<span class=\\"token punctuation\\">.</span>loads<span class=\\"token punctuation\\">(</span>res<span class=\\"token punctuation\\">.</span>text<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>             data <span class=\\"token operator\\">=</span> body<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"data\\"</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>             msg <span class=\\"token operator\\">=</span> body<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"msg\\"</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">except</span> Exception <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"调用k8sResourceApi获取appid列表解析失败:\\"</span><span class=\\"token operator\\">+</span><span class=\\"token builtin\\">str</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token number\\">72</span><span class=\\"token punctuation\\">,</span>80c120<span class=\\"token punctuation\\">,</span><span class=\\"token number\\">157</span>\\n<span class=\\"token operator\\">&lt;</span>         data <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>\\n<span class=\\"token operator\\">&lt;</span>         <span class=\\"token keyword\\">for</span> i <span class=\\"token keyword\\">in</span> ret<span class=\\"token punctuation\\">.</span>items<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&lt;</span>             namespace <span class=\\"token operator\\">=</span> i<span class=\\"token punctuation\\">.</span>metadata<span class=\\"token punctuation\\">.</span>namespace\\n<span class=\\"token operator\\">&lt;</span>             pod_info <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>\\n<span class=\\"token operator\\">&lt;</span>                 <span class=\\"token string\\">'pod_name'</span><span class=\\"token punctuation\\">:</span> i<span class=\\"token punctuation\\">.</span>metadata<span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">,</span>\\n<span class=\\"token operator\\">&lt;</span>                 <span class=\\"token string\\">'containers'</span><span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span>j<span class=\\"token punctuation\\">.</span>name <span class=\\"token keyword\\">for</span> j <span class=\\"token keyword\\">in</span> i<span class=\\"token punctuation\\">.</span>spec<span class=\\"token punctuation\\">.</span>containers<span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&lt;</span>             <span class=\\"token punctuation\\">}</span>\\n<span class=\\"token operator\\">&lt;</span>             <span class=\\"token keyword\\">if</span> namespace <span class=\\"token keyword\\">in</span> data<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&lt;</span>                 data<span class=\\"token punctuation\\">[</span>namespace<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span>append<span class=\\"token punctuation\\">(</span>pod_info<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">finally</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             res<span class=\\"token punctuation\\">.</span>close<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">if</span> res<span class=\\"token punctuation\\">.</span>status_code <span class=\\"token operator\\">==</span> <span class=\\"token number\\">200</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">for</span> item <span class=\\"token keyword\\">in</span> data<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                 res_apps<span class=\\"token punctuation\\">.</span>add<span class=\\"token punctuation\\">(</span>item<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token comment\\"># apps</span>\\n<span class=\\"token operator\\">&gt;</span>         apps <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">for</span> item <span class=\\"token keyword\\">in</span> xxx_apps<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">if</span> item <span class=\\"token keyword\\">in</span> res_apps<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                 apps<span class=\\"token punctuation\\">.</span>append<span class=\\"token punctuation\\">(</span>item<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token comment\\"># get pods</span>\\n<span class=\\"token operator\\">&gt;</span>         ctx <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>    <span class=\\"token comment\\"># {\\"namespace\\": [{podname:aaaa, containers}]}</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">for</span> appid <span class=\\"token keyword\\">in</span> apps<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>             res <span class=\\"token operator\\">=</span> requests<span class=\\"token punctuation\\">.</span>get<span class=\\"token punctuation\\">(</span>k8s_resource_api<span class=\\"token operator\\">+</span><span class=\\"token string\\">\\"/get-pods-by-app/\\"</span><span class=\\"token operator\\">+</span>appid<span class=\\"token operator\\">+</span><span class=\\"token string\\">\\"/\\"</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                 body <span class=\\"token operator\\">=</span> json<span class=\\"token punctuation\\">.</span>loads<span class=\\"token punctuation\\">(</span>res<span class=\\"token punctuation\\">.</span>text<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>                 data <span class=\\"token operator\\">=</span> body<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"data\\"</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>                 msg <span class=\\"token operator\\">=</span> body<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"msg\\"</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">except</span> Exception <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                 <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"调用k8sResourceApis获取appid-pods列表解析失败:\\"</span><span class=\\"token operator\\">+</span><span class=\\"token builtin\\">str</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> appid<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">finally</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                 res<span class=\\"token punctuation\\">.</span>close<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>\\n<span class=\\"token operator\\">&gt;</span>             <span class=\\"token keyword\\">if</span> res<span class=\\"token punctuation\\">.</span>status_code <span class=\\"token operator\\">==</span> <span class=\\"token number\\">200</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                 <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                     <span class=\\"token keyword\\">for</span> pod <span class=\\"token keyword\\">in</span> data<span class=\\"token punctuation\\">:</span>            <span class=\\"token comment\\"># key: pod-name, 原始data结构：{\\"pod-name\\": {\\"Ns\\": \\"xxx\\", \\"Containers\\": {\\"c-name\\": \\"c-id\\"}}}</span>\\n<span class=\\"token operator\\">&gt;</span>                         ns <span class=\\"token operator\\">=</span> data<span class=\\"token punctuation\\">[</span>pod<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"Ns\\"</span><span class=\\"token punctuation\\">]</span>    <span class=\\"token comment\\"># ns == \\"xxx\\"</span>\\n<span class=\\"token operator\\">&gt;</span>                         <span class=\\"token keyword\\">if</span> ns <span class=\\"token keyword\\">not</span> <span class=\\"token keyword\\">in</span> ctx<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                             ctx<span class=\\"token punctuation\\">[</span>ns<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>                         containers <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&gt;</span>                         <span class=\\"token keyword\\">for</span> c <span class=\\"token keyword\\">in</span> data<span class=\\"token punctuation\\">[</span>pod<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"Containers\\"</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                             containers<span class=\\"token punctuation\\">.</span>append<span class=\\"token punctuation\\">(</span>c<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>                         ctx<span class=\\"token punctuation\\">[</span>ns<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span>append<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"pod_name\\"</span><span class=\\"token punctuation\\">:</span> pod<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"containers\\"</span><span class=\\"token punctuation\\">:</span> containers<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>                 <span class=\\"token keyword\\">except</span> Exception <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>                     <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"解析重组pod列表信息异常:\\"</span><span class=\\"token operator\\">+</span><span class=\\"token builtin\\">str</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token number\\">82</span><span class=\\"token punctuation\\">,</span>83c159<span class=\\"token punctuation\\">,</span><span class=\\"token number\\">160</span>\\n<span class=\\"token operator\\">&lt;</span>                 data<span class=\\"token punctuation\\">[</span>namespace<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>pod_info<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">]</span>\\n<span class=\\"token operator\\">&lt;</span>         <span class=\\"token keyword\\">return</span> data\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>                 <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"调用k8sResourceApis获取pod列表返回状态异常:\\"</span><span class=\\"token operator\\">+</span><span class=\\"token builtin\\">str</span><span class=\\"token punctuation\\">(</span>res<span class=\\"token punctuation\\">.</span>status_code<span class=\\"token punctuation\\">)</span><span class=\\"token operator\\">+</span><span class=\\"token string\\">\\" \\"</span><span class=\\"token operator\\">+</span>msg<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">return</span> ctx\\n86c163\\n<span class=\\"token operator\\">&lt;</span>     <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">get_kubernetes_data</span><span class=\\"token punctuation\\">(</span>app_id<span class=\\"token punctuation\\">,</span> system_user_id<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">get_kubernetes_data</span><span class=\\"token punctuation\\">(</span>app_id<span class=\\"token punctuation\\">,</span> system_user_id<span class=\\"token punctuation\\">,</span> login_username<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n91c168\\n<span class=\\"token operator\\">&lt;</span>         <span class=\\"token keyword\\">return</span> k8s<span class=\\"token punctuation\\">.</span>get_pods<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">return</span> k8s<span class=\\"token punctuation\\">.</span>get_pods<span class=\\"token punctuation\\">(</span>login_username<span class=\\"token punctuation\\">)</span>\\n153c230\\n<span class=\\"token operator\\">&lt;</span>     <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">async_tree_node</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">,</span> parent_info<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>     <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">async_tree_node</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">,</span> parent_info<span class=\\"token punctuation\\">,</span> login_username<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n160c237\\n<span class=\\"token operator\\">&lt;</span>         data <span class=\\"token operator\\">=</span> KubernetesClient<span class=\\"token punctuation\\">.</span>get_kubernetes_data<span class=\\"token punctuation\\">(</span>app_id<span class=\\"token punctuation\\">,</span> system_user_id<span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>         data <span class=\\"token operator\\">=</span> KubernetesClient<span class=\\"token punctuation\\">.</span>get_kubernetes_data<span class=\\"token punctuation\\">(</span>app_id<span class=\\"token punctuation\\">,</span> system_user_id<span class=\\"token punctuation\\">,</span> login_username<span class=\\"token punctuation\\">)</span>\\n\\ndiff <span class=\\"token operator\\">-</span>r old<span class=\\"token operator\\">-</span>apps<span class=\\"token operator\\">/</span>apps<span class=\\"token operator\\">/</span>perms<span class=\\"token operator\\">/</span>api<span class=\\"token operator\\">/</span>application<span class=\\"token operator\\">/</span>user_permission<span class=\\"token operator\\">/</span>user_permission_applications<span class=\\"token punctuation\\">.</span>py new<span class=\\"token operator\\">-</span>apps<span class=\\"token operator\\">/</span>apps<span class=\\"token operator\\">/</span>perms<span class=\\"token operator\\">/</span>api<span class=\\"token operator\\">/</span>application<span class=\\"token operator\\">/</span>user_permission<span class=\\"token operator\\">/</span>user_permission_applications<span class=\\"token punctuation\\">.</span>py\\n59a60<span class=\\"token punctuation\\">,</span><span class=\\"token number\\">64</span>\\n<span class=\\"token operator\\">&gt;</span>         login_username <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token operator\\">&gt;</span>         login_user <span class=\\"token operator\\">=</span> <span class=\\"token builtin\\">str</span><span class=\\"token punctuation\\">(</span>request<span class=\\"token punctuation\\">.</span>__dict__<span class=\\"token punctuation\\">.</span>get<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"_user\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>         lft <span class=\\"token operator\\">=</span> login_user<span class=\\"token punctuation\\">.</span>split<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'('</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token operator\\">&gt;</span>         <span class=\\"token keyword\\">if</span> <span class=\\"token builtin\\">len</span><span class=\\"token punctuation\\">(</span>lft<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">==</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">:</span>\\n<span class=\\"token operator\\">&gt;</span>            login_username <span class=\\"token operator\\">=</span> lft<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span>split<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">')'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">[</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">]</span>\\n64c69\\n<span class=\\"token operator\\">&lt;</span>             queryset<span class=\\"token punctuation\\">,</span> tree_id<span class=\\"token punctuation\\">,</span> parent_info<span class=\\"token punctuation\\">,</span> self<span class=\\"token punctuation\\">.</span>user\\n<span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span><span class=\\"token operator\\">-</span>\\n<span class=\\"token operator\\">&gt;</span>             queryset<span class=\\"token punctuation\\">,</span> tree_id<span class=\\"token punctuation\\">,</span> parent_info<span class=\\"token punctuation\\">,</span> self<span class=\\"token punctuation\\">.</span>user<span class=\\"token punctuation\\">,</span> login_username\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","copyright":{"author":"Clay"},"autoDesc":true}`);export{s as data};

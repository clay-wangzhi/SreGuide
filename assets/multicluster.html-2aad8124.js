import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as i,a as s,b as n,d as t,e as p}from"./app-4bb5a871.js";const l={},u=p(`<h1 id="k8s-å¤šé›†ç¾¤æ€è€ƒã€å®è·µå’Œæ¢ç´¢" tabindex="-1"><a class="header-anchor" href="#k8s-å¤šé›†ç¾¤æ€è€ƒã€å®è·µå’Œæ¢ç´¢" aria-hidden="true">#</a> K8s å¤šé›†ç¾¤æ€è€ƒã€å®è·µå’Œæ¢ç´¢</h1><h2 id="ä¸ºä»€ä¹ˆéœ€è¦å¤šé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦å¤šé›†ç¾¤" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆéœ€è¦å¤šé›†ç¾¤</h2><ul><li>å¤šæ´»å»ºè®¾ï¼šæé«˜ä¸šåŠ¡åº”ç”¨çš„å¯ç”¨æ€§ï¼Œé¿å…å•ä¸ªé›†ç¾¤æˆ–å•ä¸ªæ•°æ®ä¸­å¿ƒæ•…éšœå¯¼è‡´ä¸šåŠ¡åº”ç”¨æš‚æ—¶ä¸å¯ç”¨ã€‚</li><li>æ··åˆäº‘å»ºè®¾ï¼šå¼•å…¥å…¬æœ‰äº‘å¼¹æ€§èµ„æºè§£å†³ä¸šåŠ¡å¤§ä¿ƒèŠ‚å‡æ—¥èµ„æºæ´ªå³°</li><li>æ§åˆ¶æ•…éšœçˆ†ç‚¸åŠå¾„</li></ul><h2 id="å»ºè®¾å¤šé›†ç¾¤çš„å‰æœŸå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#å»ºè®¾å¤šé›†ç¾¤çš„å‰æœŸå‡†å¤‡" aria-hidden="true">#</a> å»ºè®¾å¤šé›†ç¾¤çš„å‰æœŸå‡†å¤‡</h2><ul><li><p>å¤šé›†ç¾¤ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆæ–°å»ºé›†ç¾¤ã€æ–°å¢èŠ‚ç‚¹ç­‰ï¼‰</p></li><li><p>å¤šé›†ç¾¤åº”ç”¨çš„åˆ†å‘éƒ¨ç½²</p></li><li><p>å¤šé›†ç¾¤ç›‘æ§å‘Šè­¦</p></li><li><p>å—åŒ—æµé‡å¦‚ä½•ç®¡ç†</p></li><li><p>ä¸œè¥¿æµé‡å¦‚ä½•ç®¡ç†</p></li><li><p>å¤šé›†ç¾¤åº”ç”¨è¿ç§»</p></li></ul><h2 id="å¤šé›†ç¾¤æ¢ç´¢-è”é‚¦" tabindex="-1"><a class="header-anchor" href="#å¤šé›†ç¾¤æ¢ç´¢-è”é‚¦" aria-hidden="true">#</a> å¤šé›†ç¾¤æ¢ç´¢ï¼ˆè”é‚¦ï¼‰</h2><h3 id="federation-v1" tabindex="-1"><a class="header-anchor" href="#federation-v1" aria-hidden="true">#</a> Federation v1</h3><p>æœ€æ—©çš„å¤šé›†ç¾¤é¡¹ç›®ï¼Œç”± K8s ç¤¾åŒºæå‡ºå’Œç»´æŠ¤ã€‚</p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20240509174747165.png" style="zoom:63%;"><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>us
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">federation.kubernetes.io/replica-set-preferences</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        {
            &quot;rebalance&quot;: true,
            &quot;clusters&quot;: {
                &quot;us-east1-b&quot;: {
                    &quot;minReplicas&quot;: 2,
                    &quot;maxReplicas&quot;: 4,
                    &quot;weight&quot;: 1
                },
                &quot;us-central1-b&quot;: {
                    &quot;minReplicas&quot;: 2,
                    &quot;maxReplicas&quot;: 4,
                    &quot;weight&quot;: 1
                }
            }
        }</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŠŠè”é‚¦çš„æ‰€æœ‰é…ç½®ä¿¡æ¯éƒ½å†™åˆ° annotations é‡Œï¼Œæ•´ä¸ªåˆ›å»ºæµç¨‹ä¸ K8s ç±»ä¼¼ã€‚é…ç½®ä¿¡æ¯å…ˆåˆ° Federated API Serverï¼ŒFederated Controller æŠŠåº”ç”¨åˆ›å»ºåˆ°å„å­é›†ç¾¤ã€‚</p><p>ç”±äºä¸‹é¢ä¸¤ä¸ªçªå‡ºé—®é¢˜ï¼Œåœ¨ K8s v1.11 å·¦å³æ­£å¼è¢«å¼ƒç”¨ã€‚</p><ul><li>åŸºäº Annotation çš„èµ„æºåˆ†å‘è®©æ•´ä¸ª API è¿‡äºè‡ƒè‚¿ï¼Œä¸å¤Ÿä¼˜é›…ã€‚</li><li>åœ¨ Kubernetes é‡Œä¸€ä¸ª API æ˜¯é€šè¿‡ Group/Version/Kind ç¡®å®šçš„ï¼Œä½†æ˜¯ Federation v1 é‡Œé¢å¯¹äºK8s åŸç”Ÿ APIã€GVK å›ºå®šï¼Œå¯¼è‡´å¯¹ä¸åŒç‰ˆæœ¬çš„é›†ç¾¤ API å…¼å®¹æ€§å¾ˆå·®ã€‚</li></ul><h3 id="federation-v2" tabindex="-1"><a class="header-anchor" href="#federation-v2" aria-hidden="true">#</a> Federation v2</h3><p>Federation v2 æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯åŸºäº CRD å’Œ Controller çš„æ–¹å¼æ›¿æ¢æ‰äº† Federation v1 åŸºäº Annotation åˆ†å‘èµ„æºçš„æ–¹æ¡ˆï¼Œæ²¡æœ‰ä¾µå…¥åŸç”Ÿçš„ K8s APIï¼Œä¹Ÿæ²¡æœ‰å¼•å…¥é¢å¤–çš„ API Serverã€‚</p><p>ä¸»è¦ç”±ä¸¤ä¸ªç»„ä»¶æ„æˆï¼š</p><ul><li>admission-webhook æä¾›äº†å‡†å…¥æ§åˆ¶</li><li>controller-manager å¤„ç†è‡ªå®šä¹‰èµ„æºä»¥åŠåè°ƒä¸åŒé›†ç¾¤é—´çš„çŠ¶æ€</li></ul><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20240509180316117.png" alt="image-20240509180316117" style="zoom:60%;"><p>ç”¨æˆ·é€šè¿‡kubefedctl enableå‘½ä»¤ç”ŸæˆæŒ‡å®šè¯¥èµ„æºç±»å‹çš„ FederatedTypeConfig CRDï¼Œä½¿ç”¨å®šä¹‰å¥½çš„yamlæ–‡ä»¶å¯¹èµ„æºè¿›è¡Œè”é‚¦éƒ¨ç½²ã€‚</p><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20240509192847799.png" alt=""></p><p>ä¸€ä¸ªå…¸å‹çš„ deployment çš„ FederatedTypeConfig ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> types.kubefed.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> FederatedDeployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fed<span class="token punctuation">-</span>deploy
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> fed<span class="token punctuation">-</span>ns
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token punctuation">{</span>deployment<span class="token punctuation">-</span>define<span class="token punctuation">}</span>  
  <span class="token key atrule">overrides</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">clusterName</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span><span class="token number">1</span>
    <span class="token key atrule">clusterOverrides</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /spec/replicas
      <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /spec/template/spec/containers/0/image
      <span class="token key atrule">value</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.0<span class="token punctuation">-</span>alpine
  <span class="token key atrule">placement</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span><span class="token number">1</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span><span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Federated Type CRDåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p><p>Template: è¯¥èµ„æºæœ¬èº«çš„å®šä¹‰ï¼Œç”¨äºé›†ç¾¤ä¸­è¯¥èµ„æºçš„åˆ›å»º</p><p>Placement: åˆ†å‘ç­–ç•¥ï¼Œå®šä¹‰è¯¥èµ„æºéƒ¨ç½²äºå“ªäº›é›†ç¾¤ä¸­</p><p>Overridesï¼šå¯¹ template ä¸­çš„å­—æ®µè¿›è¡Œè¦†ç›–é‡å†™ï¼Œç”¨äºå¯¹èµ„æºçš„é…ç½®æ›´æ–°ã€‚å¦‚ç¤ºä¾‹ä¸­å¯¹åç§°ä¸º cluster-1 çš„ member cluster ä¸­ deployment çš„å‰¯æœ¬æ•°å’Œé•œåƒè¿›è¡Œäº†é‡æ–°é…ç½®ã€‚Override ä¸­æœªé€‰æ‹©çš„é›†ç¾¤ä½¿ç”¨ template çš„å®šä¹‰ï¼Œä¿æŒä¸å˜ã€‚</p><p>å¯ä»¥å‘ç°ï¼Œä¸Šé¢é…ç½®æ–‡ä»¶åªæŒ‡å®šäº† åˆ†å‘åˆ°å“ªä¸ªé›†ç¾¤ï¼Œå¹¶æ²¡æœ‰å…·ä½“çš„åˆ†é…æ¯”ä¾‹ã€æ•°é‡ç­‰ï¼Œå¯ä»¥åˆ©ç”¨RSPï¼ˆReplicaSchedulingPreferenceï¼‰å¯¹Federated Type CRDä¸­placementå’ŒOverrideså­—æ®µå†…å®¹è¿›è¡Œé‡å†™ï¼Œrsé‡å†™æ•°æ®æ¥æºäºç”¨æˆ·é…ç½®çš„è°ƒåº¦æ–‡ä»¶ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„RSPæ–‡ä»¶å®šä¹‰ç¤ºä¾‹å¦‚ä¸‹ï¼Œè¯¥RSPæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªdeploymentåº”ç”¨è´Ÿè½½åœ¨éƒ¨ç½²æ—¶ï¼Œå„é›†ç¾¤çš„éƒ¨ç½²ç­–ç•¥ã€‚</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> scheduling.kubefed.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSchedulingPreference
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> fed<span class="token punctuation">-</span>deploy
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> fed<span class="token punctuation">-</span>ns
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">targetKind</span><span class="token punctuation">:</span> FederatedDeployment
  <span class="token key atrule">totalReplicas</span><span class="token punctuation">:</span> <span class="token number">20</span>
  <span class="token key atrule">clusters</span><span class="token punctuation">:</span>
   <span class="token key atrule">&quot;*&quot;</span><span class="token punctuation">:</span>
     <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>
     <span class="token key atrule">maxReplicas</span><span class="token punctuation">:</span> <span class="token number">15</span>
   <span class="token key atrule">cluster-1</span><span class="token punctuation">:</span>
     <span class="token key atrule">weight</span><span class="token punctuation">:</span>
     <span class="token key atrule">minReplicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
     <span class="token key atrule">maxReplicas</span><span class="token punctuation">:</span> <span class="token number">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RSP æ–‡ä»¶ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p><p>targetKindï¼šå®šä¹‰è¯¥RSPæ–‡ä»¶åº”ç”¨çš„è”é‚¦èµ„æºç±»å‹ï¼Œç›®å‰ä»…æ”¯æŒ FederatedDeployment å’Œ FederatedReplicaSetã€‚</p><p>totalReplicasï¼šèµ„æºçš„æ€»å‰¯æœ¬æ•°ï¼Œå„ä¸ªé›†ç¾¤æŒ‰ç…§ç”¨æˆ·é…ç½®çš„æƒé‡æˆ–è€…æ¯”ä¾‹è¿›è¡Œèµ„æºè®¡ç®—æ—¶ï¼Œä¼šå…ˆæ ¹æ®æ€»æ•°è¿›è¡Œè®¡ç®—å¾—åˆ°ä¸€ä¸ªåˆæ­¥ç»“æœï¼Œè‹¥é›†ç¾¤ä¸­é…ç½®äº†æœ€å¤§å€¼æˆ–æœ€å°å€¼ä¸è®¡ç®—å¾—åˆ°çš„å€¼å†²çªï¼Œåˆ™ä¼šä½¿ç”¨ç”¨æˆ·é…ç½®çš„æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼ã€‚å› æ­¤å®é™…çš„æ€»å‰¯æœ¬æ•°å¯èƒ½ä¼šå’Œé…ç½®çš„æ€»å‰¯æœ¬æ•°ä¸ä¸€è‡´ã€‚</p><p><strong>å·²ç»è¢«ç¤¾åŒºåºŸå¼ƒã€‚</strong></p><h3 id="karmada" tabindex="-1"><a class="header-anchor" href="#karmada" aria-hidden="true">#</a> Karmada</h3>`,34),r={href:"https://github.com/kubernetes-retired/federation",target:"_blank",rel:"noopener noreferrer"},k={href:"https://github.com/kubernetes-sigs/kubefed",target:"_blank",rel:"noopener noreferrer"},d=s("p",null,"Karmada æ—¨åœ¨ä¸ºå¤šäº‘å’Œæ··åˆäº‘åœºæ™¯ä¸‹çš„å¤šé›†ç¾¤åº”ç”¨ç¨‹åºç®¡ç†æä¾›å³æ’å³ç”¨çš„è‡ªåŠ¨åŒ–ï¼Œå…·æœ‰é›†ä¸­å¼å¤šäº‘ç®¡ç†ã€é«˜å¯ç”¨æ€§ã€æ•…éšœæ¢å¤å’Œæµé‡è°ƒåº¦ç­‰å…³é”®åŠŸèƒ½ã€‚",-1),v={href:"https://cncf.io/",target:"_blank",rel:"noopener noreferrer"},m=p(`<p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20240510111516451.png" alt=""></p><p>å’Œ Federation v1 ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¸‹å‘ä¸€ä¸ªèµ„æºä¹Ÿæ˜¯è¦å†™å…¥åˆ° Karmada è‡ªå·±çš„ API Server ä¸­ï¼Œä¹‹å‰ controller-manager æ ¹æ®ä¸€äº› policy æŠŠèµ„æºä¸‹å‘åˆ°å„ä¸ªé›†ç¾¤ä¸­ï¼›ä¸è¿‡è¿™ä¸ª API Server ç›´æ¥ä½¿ç”¨ Kubernetes çš„ kube-apiserver å®ç°çš„ï¼Œæ‰€ä»¥æ”¯æŒä»»ä½•èµ„æºï¼Œä¸ä¼šå‡ºç°ä¹‹å‰ v1 ç‰ˆæœ¬ä¸­çš„é—®é¢˜ï¼Œç„¶åè”é‚¦æ‰˜ç®¡èµ„æºçš„åˆ†å‘ç­–ç•¥ä¹Ÿæ˜¯ç”±ä¸€ä¸ªå•ç‹¬çš„ CRD æ¥æ§åˆ¶çš„ï¼Œä¹Ÿä¸éœ€è¦é…ç½® v2 ä¸­çš„ Federated Resource CRD å’Œ Type Configureã€‚</p><p>åˆ†å‘åº”ç”¨ç¨‹åº Demo</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> policy.karmada.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PropagationPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>propagation
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">resourceSelectors</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">placement</span><span class="token punctuation">:</span>
    <span class="token key atrule">clusterAffinity</span><span class="token punctuation">:</span>
      <span class="token key atrule">clusterNames</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> member1
        <span class="token punctuation">-</span> member2
    <span class="token key atrule">replicaScheduling</span><span class="token punctuation">:</span>
      <span class="token key atrule">replicaDivisionPreference</span><span class="token punctuation">:</span> Weighted
      <span class="token key atrule">replicaSchedulingType</span><span class="token punctuation">:</span> Divided
      <span class="token key atrule">weightPreference</span><span class="token punctuation">:</span>
        <span class="token key atrule">staticWeightList</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">targetCluster</span><span class="token punctuation">:</span>
              <span class="token key atrule">clusterNames</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> member1
            <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>
          <span class="token punctuation">-</span> <span class="token key atrule">targetCluster</span><span class="token punctuation">:</span>
              <span class="token key atrule">clusterNames</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> member2
            <span class="token key atrule">weight</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> policy.karmada.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> OverridePolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>op
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">resourceSelectors</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
      <span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
      <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">overrideRules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">targetCluster</span><span class="token punctuation">:</span>
        <span class="token key atrule">clusterNames</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> member2
      <span class="token key atrule">overriders</span><span class="token punctuation">:</span>
        <span class="token key atrule">labelsOverrider</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> add
            <span class="token key atrule">value</span><span class="token punctuation">:</span>
              <span class="token key atrule">env</span><span class="token punctuation">:</span> skoala<span class="token punctuation">-</span>dev
          <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> add
            <span class="token key atrule">value</span><span class="token punctuation">:</span>
              <span class="token key atrule">env-stat</span><span class="token punctuation">:</span> skoala<span class="token punctuation">-</span>stage
          <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> remove
            <span class="token key atrule">value</span><span class="token punctuation">:</span>
              <span class="token key atrule">for</span><span class="token punctuation">:</span> for
          <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> replace
            <span class="token key atrule">value</span><span class="token punctuation">:</span>
              <span class="token key atrule">bar</span><span class="token punctuation">:</span> test
    <span class="token punctuation">-</span> <span class="token key atrule">targetCluster</span><span class="token punctuation">:</span>
        <span class="token key atrule">clusterNames</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> member1
      <span class="token key atrule">overriders</span><span class="token punctuation">:</span>
        <span class="token key atrule">annotationsOverrider</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> add
            <span class="token key atrule">value</span><span class="token punctuation">:</span>
              <span class="token key atrule">env</span><span class="token punctuation">:</span> skoala<span class="token punctuation">-</span>stage
          <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> remove
            <span class="token key atrule">value</span><span class="token punctuation">:</span>
              <span class="token key atrule">bom</span><span class="token punctuation">:</span> bom
          <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> replace
            <span class="token key atrule">value</span><span class="token punctuation">:</span>
              <span class="token key atrule">emma</span><span class="token punctuation">:</span> sophia
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20240510161505970.png" alt=" "> Policy Controller: ç›‘å¬PropagationPolicy å¯¹è±¡ï¼ŒPropagationPolicy å¯¹è±¡è¢«åˆ›å»ºåï¼ŒPolicy Controllerä¼šé€‰æ‹©ä¸€ç»„åŒ¹é…resourceSelector çš„èµ„æºï¼Œç„¶åä¸ºæ¯ä¸ªå•ç‹¬åˆ™èµ„æºåˆ›å»ºResourceBindingã€‚</p><p>Binding Controller: ç›‘å¬ResourceBinding å¯¹è±¡ï¼Œç„¶ååˆ›å»ºæ¯ä¸ªé›†ç¾¤å¯¹åº”çš„work å¯¹è±¡ã€‚work å¯¹è±¡é‡Œé¢åŒ…å«äº†ä¸€ä¸ªå…·ä½“çš„èµ„æºã€‚</p><p>Execution Controller: ç›‘å¬workå¯¹è±¡ï¼Œç„¶ååœ¨member cluster é‡Œåˆ›å»ºå¯¹åº”çš„èµ„æº</p><h3 id="å…¶ä»–" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–" aria-hidden="true">#</a> å…¶ä»–</h3><p>ä»¥ä¸Šå¤šé›†ç¾¤é¡¹ç›®ä¸»è¦åŠŸèƒ½ä¸ºèµ„æºåˆ†å‘å’Œè°ƒåº¦ï¼Œè¿˜æœ‰å¦‚å¤šäº‘åŸºç¡€è®¾æ–½ç®¡ç† cluster-apiï¼Œå¤šé›†ç¾¤æ£€ç´¢ Clusterpediaï¼Œå¤šé›†ç¾¤ pod äº’é€š submarinerï¼Œmulticluster-ingress è§£å†³å¤šé›†ç¾¤çš„ ingressï¼ŒæœåŠ¡æ²»ç†å’Œæµé‡è°ƒåº¦ Service Meshï¼Œå¦‚ istioã€cilium ç­‰ç½‘ç»œç»„ä»¶å®ç°çš„ multi cluster mesh è§£å†³è·¨é›†ç¾¤çš„ mesh ç½‘ç»œç®¡ç†ï¼Œä»¥åŠç»“åˆå­˜å‚¨ç›¸å…³é¡¹ç›®å®ç°è·¨é›†ç¾¤å­˜å‚¨ç®¡ç†å’Œè¿ç§»ç­‰ã€‚</p><h2 id="å¤šé›†ç¾¤è½åœ°å®è·µ-éè”é‚¦" tabindex="-1"><a class="header-anchor" href="#å¤šé›†ç¾¤è½åœ°å®è·µ-éè”é‚¦" aria-hidden="true">#</a> å¤šé›†ç¾¤è½åœ°å®è·µï¼ˆéè”é‚¦ï¼‰</h2><p>ä»‹ç»äº†åŠå¤©è”é‚¦é›†ç¾¤ï¼Œä½†~~~~~æ˜¯ï¼Œæˆ‘ä»¬è½åœ°ç”¨çš„éè”é‚¦æ–¹å¼ ğŸ¤£</p><h3 id="åº”ç”¨å¦‚ä½•åœ¨å¤šä¸ªé›†ç¾¤éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨å¦‚ä½•åœ¨å¤šä¸ªé›†ç¾¤éƒ¨ç½²" aria-hidden="true">#</a> åº”ç”¨å¦‚ä½•åœ¨å¤šä¸ªé›†ç¾¤éƒ¨ç½²</h3><p>å½“å•ä¸ªé›†ç¾¤æ—¶ï¼Œ å†…éƒ¨çš„ è‡ªåŠ¨åŒ–è¿ç»´å¹³å° å’Œ å‘å¸ƒç³»ç»Ÿ å·²ç»æ”¯æŒäº†ï¼Œå•é›†ç¾¤çš„ <code>å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</code>ã€<code>Ingress ç”Ÿå‘½å‘¨æœŸç®¡ç†</code>ã€<code>å‡é™é… &amp; æ‰©ç¼©å®¹</code>ã€<code>HPA &amp; HPC</code>ã€<code>æ»šåŠ¨å‘å¸ƒ &amp; ç°åº¦å‘å¸ƒ</code> ç­‰ã€‚</p><p>åœ¨å¤šçº³ç®¡å‡ ä¸ªé›†ç¾¤ï¼Œæ”¹åŠ¨å¾ˆå°ï¼Œ å‘å¸ƒç³»ç»Ÿæ”¯æŒ å¤šé›†ç¾¤ å®¹å™¨ç¼–æ’å‘å¸ƒå³å¯ ï¼ˆä¸²è¡Œ or å¹¶è¡Œï¼‰ç­‰ã€‚</p><h3 id="å¤šé›†ç¾¤ç›‘æ§å‘Šè­¦" tabindex="-1"><a class="header-anchor" href="#å¤šé›†ç¾¤ç›‘æ§å‘Šè­¦" aria-hidden="true">#</a> å¤šé›†ç¾¤ç›‘æ§å‘Šè­¦</h3><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/test.png" alt=""></p><p>å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</p><p>ä¿®æ”¹é»˜è®¤ monitoring.coreos.com/v1 Prometheus å¯¹è±¡</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># ä¿®æ”¹ alertmanagers ä¸º å¤–ç½® alertmanager é…ç½®ï¼Œ æå‰æ–°å»º svc å’Œ ep</span>
  <span class="token key atrule">alerting</span><span class="token punctuation">:</span>
    <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v2
      <span class="token key atrule">name</span><span class="token punctuation">:</span> xxx
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> xxx
      <span class="token key atrule">pathPrefix</span><span class="token punctuation">:</span> /
      <span class="token key atrule">port</span><span class="token punctuation">:</span> xxx
<span class="token comment"># æ·»åŠ é›†ç¾¤å”¯ä¸€æ ‡è¯†</span>
  <span class="token key atrule">externalLabels</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span> xxx
    <span class="token key atrule">environment</span><span class="token punctuation">:</span> xxx
    <span class="token key atrule">zone</span><span class="token punctuation">:</span> xxx
<span class="token comment"># è¿œç«¯å†™å…¥åˆ° VictoriaMetrics, é…ç½®å¤šå‰¯æœ¬å»é‡</span>
  <span class="token key atrule">remoteWrite</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//xxx/api/v1/write
    <span class="token key atrule">writeRelabelConfigs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">action</span><span class="token punctuation">:</span> labeldrop
      <span class="token key atrule">regex</span><span class="token punctuation">:</span> prometheus_replica
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å—åŒ—æµé‡å¦‚ä½•ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#å—åŒ—æµé‡å¦‚ä½•ç®¡ç†" aria-hidden="true">#</a> å—åŒ—æµé‡å¦‚ä½•ç®¡ç†</h3><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/ingress1.png" alt=""></p><p>å¤–å±‚ Nginx åå‘ä»£ç†å„é›†ç¾¤ Ingress Nodeï¼ŒIngress Node èŠ‚ç‚¹çš„æƒé‡ä¼šè‡ªåŠ¨è°ƒæ•´ï¼Œå½“æœ‰å®¹å™¨å’Œè™šæ‹Ÿæœºæ··å¸ƒæ—¶ï¼Œè§„åˆ™å¦‚ä¸‹ï¼Œä¸” Ingress Node ä¼šéš Pod æ•°é‡çš„å˜åŒ–å’Œ Ingress Node æ•°é‡çš„å˜åŒ–è‡ªåŠ¨è°ƒæ•´æƒé™ï¼Œåœ¨å†…å­˜ä¸­è°ƒæ•´ï¼Œæ— éœ€ reload å¤–å±‚Nginxï¼š</p><p>1ä¸ª pod = 1ä¸ª kvm åŸºç¡€æƒé‡éƒ½ä¸º10ï¼Œæ¯ä¸ª ingress node æƒé‡ ä¸º ï¼ˆpod æ•°é‡ * 10 / ingress èŠ‚ç‚¹æ•°ï¼‰ å–æ•´ï¼Œæœ€å°ä¸º1ã€‚</p><h3 id="ä¸œè¥¿æµé‡å¦‚ä½•ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ä¸œè¥¿æµé‡å¦‚ä½•ç®¡ç†" aria-hidden="true">#</a> ä¸œè¥¿æµé‡å¦‚ä½•ç®¡ç†</h3><p>ä¸‰å±‚ç½‘ç»œèµ° Calico BGP æ‹‰å¹³æ‰“é€šï¼Œ å¤šé›†ç¾¤ Pod ä¹‹é—´ï¼Œç½‘ç»œå¯ä»¥ç›´è¿ï¼Œ å®¹å™¨å’Œè™šæ‹Ÿæœºä¹‹é—´ï¼Œä¹Ÿå¯ä»¥ç›´è¿ã€‚</p><p>æœåŠ¡å‘ç°ç”¨çš„ Nacosï¼Œæ²¡èµ° Corednsã€‚</p><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20240510190151337.png" alt=""></p><h3 id="å¤šé›†ç¾¤åº”ç”¨è¿ç§»" tabindex="-1"><a class="header-anchor" href="#å¤šé›†ç¾¤åº”ç”¨è¿ç§»" aria-hidden="true">#</a> å¤šé›†ç¾¤åº”ç”¨è¿ç§»</h3><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20240510192111438.png" style="zoom:67%;"><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/migrate.png" alt=""></p><blockquote><p>å‰ç½®æ¡ä»¶ï¼Œæ‰€æœ‰é›†ç¾¤å¤‡ä»½é€šè¿‡ Velero å·¥å…·ï¼Œå¤‡ä»½åˆ°äº† ç»Ÿä¸€çš„ S3 æ¡¶é‡Œé¢ã€‚</p><p>å½“ A é›†ç¾¤å‘ç”Ÿ é›†ç¾¤å±‚æ•…éšœæ—¶ï¼Œ ä¸” B é›†ç¾¤ æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºä¸‹ï¼Œ è¿˜è¦è€ƒè™‘é™çº§æ–¹æ¡ˆï¼Œ æ¯”å¦‚å„ AppID è¿ç§»å‰¯æœ¬æ•°å‡åŠï¼Œä¼˜å…ˆè¿ç§»æ ¸å¿ƒæœåŠ¡ç­‰ç­–ç•¥ã€‚</p></blockquote><p>æ ¸å¿ƒä¼ªä»£ç å¦‚ä¸‹ï¼š</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// Handlek8sMigrate å¤„ç† K8s  è¿ç§»</span>
<span class="token keyword">func</span> <span class="token function">Handlek8sMigrate</span><span class="token punctuation">(</span>r migration<span class="token punctuation">.</span>K8sMigrationRequest<span class="token punctuation">,</span> k <span class="token operator">*</span>K8sController<span class="token punctuation">,</span> l <span class="token operator">*</span>store<span class="token punctuation">.</span>LogTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span><span class="token string">&quot;ä» %s é›†ç¾¤ %s ç¯å¢ƒ%sè¿ç§»å¦‚ä¸‹ AppID %s åˆ° %s é›†ç¾¤&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>SrcCluster<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>MigrateType<span class="token punctuation">,</span> strings<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Appid<span class="token punctuation">,</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>DestCluster<span class="token punctuation">)</span>

	<span class="token keyword">if</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>MigrateType <span class="token operator">==</span> <span class="token string">&quot;ç¦»çº¿&quot;</span> <span class="token punctuation">{</span>
		<span class="token comment">// velero ä¸‹è½½è§£å‹</span>
		<span class="token keyword">var</span> cluster <span class="token builtin">string</span>
		<span class="token keyword">if</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env <span class="token operator">==</span> <span class="token string">&quot;xxx&quot;</span> <span class="token operator">||</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env <span class="token operator">==</span> <span class="token string">&quot;xx&quot;</span> <span class="token punctuation">{</span>
			cluster <span class="token operator">=</span> <span class="token string">&quot;xxxx&quot;</span>
		<span class="token punctuation">}</span>
		commandStr <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;mkdir -p /tmp/backupdownload/ &amp;&amp; cd /tmp/backupdownload/ &amp;&amp; velero backup download $(velero backup get | grep &quot;</span> <span class="token operator">+</span> cluster <span class="token operator">+</span> <span class="token string">&quot;-k8s-&quot;</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env <span class="token operator">+</span> <span class="token string">&quot;| head -1 | awk &#39;{print $1}&#39;) &amp;&amp; tar -xvf *.tar.gz&quot;</span><span class="token punctuation">)</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">executeSSHCommand</span><span class="token punctuation">(</span>commandStr<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// è·å– k8sclient</span>
	srcK8sClient <span class="token operator">:=</span> k<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">GetK8sClient</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>SrcCluster<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">)</span>
	destK8sClient <span class="token operator">:=</span> k<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">GetK8sClient</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>DestCluster<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">)</span>

	<span class="token comment">// è®¡ç®—è¿ç§» Pod æ•°</span>
	<span class="token keyword">var</span> podNumSum <span class="token builtin">int32</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> appid <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Appid <span class="token punctuation">{</span>
		replicas<span class="token punctuation">,</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getReplicasAndAppid</span><span class="token punctuation">(</span>srcK8sClient<span class="token punctuation">,</span> appid<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>MigrateType<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; è·å–å‰¯æœ¬æ•°å‚¨å‡ºé”™&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		podNumSum <span class="token operator">=</span> podNumSum <span class="token operator">+</span> replicas
	<span class="token punctuation">}</span>
	l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span><span class="token string">&quot;æ€»å…±éœ€è¦è¿ç§» %d ä¸ª Pod&quot;</span><span class="token punctuation">,</span> podNumSum<span class="token punctuation">)</span>

	<span class="token comment">// è·å–ç›®æ ‡é›†ç¾¤å‰©ä½™å¯åˆ›å»º pod æ•°</span>
	destRemainingData<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getRemainingData</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		l<span class="token punctuation">.</span><span class="token function">WriteFineshedLog</span><span class="token punctuation">(</span><span class="token string">&quot;failed&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;è·å–ä¸åˆ°ç›®æ ‡é›†ç¾¤å¯åˆ›å»º Pod æ•°, ä»»åŠ¡ç»“æŸ&quot;</span><span class="token operator">+</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span><span class="token string">&quot;ç›®æ ‡é›†ç¾¤å¯åˆ›å»º Pod æ•°ä¸º %d&quot;</span><span class="token punctuation">,</span> destRemainingData<span class="token punctuation">)</span>

	<span class="token comment">// åˆ¤æ–­èµ„æºæ˜¯å¦å……è¶³</span>
	<span class="token keyword">if</span> destRemainingData <span class="token operator">&gt;</span> <span class="token function">int</span><span class="token punctuation">(</span>podNumSum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span><span class="token string">&quot;ç›®æ ‡é›†ç¾¤èµ„æºå……è¶³, ç»§ç»­è¿›è¡Œè¿ç§»&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		l<span class="token punctuation">.</span><span class="token function">WriteFineshedLog</span><span class="token punctuation">(</span><span class="token string">&quot;failed&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç›®æ ‡é›†ç¾¤èµ„æºä¸è¶³, è¿ç§»ç»ˆæ­¢&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// èµ„æºå……è¶³ï¼Œå¼€å§‹è¿ç§» rolloutã€serviceã€ingress å¯¹è±¡</span>
	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Appid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// åœ¨è¿ç§»å¼€å§‹ä¹‹å‰å¢åŠ  WaitGroup çš„è®¡æ•°</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> appid <span class="token operator">:=</span> <span class="token keyword">range</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Appid <span class="token punctuation">{</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>appid <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åœ¨ Goroutine å®Œæˆæ—¶å‡å°‘ WaitGroup çš„è®¡æ•°</span>
			<span class="token comment">// rollout è¿ç§»</span>
			l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; è¿ç§»ä¸­...&quot;</span><span class="token punctuation">)</span>
			msg<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">rolloutMigrate</span><span class="token punctuation">(</span>appid<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> srcK8sClient<span class="token punctuation">,</span> destK8sClient<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>MigrateType<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨ç›®æ ‡é›†ç¾¤ä¸­æ–°å¢ Rollouts å¤±è´¥&quot;</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span>

			<span class="token comment">// æ›´æ–°å…ƒæ•°æ®</span>
			count<span class="token punctuation">,</span> orginAppid<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> <span class="token function">getReplicasAndAppid</span><span class="token punctuation">(</span>destK8sClient<span class="token punctuation">,</span> appid<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>MigrateType<span class="token punctuation">)</span>
			err <span class="token operator">=</span> <span class="token function">UpdateDockerData</span><span class="token punctuation">(</span>orginAppid<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span><span class="token function">int</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> destZone<span class="token punctuation">,</span> typeID<span class="token punctuation">,</span> destClusterID<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; æ›´æ–°å…ƒæ®å¤±è´¥&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; æ›´æ–°å…ƒæ®å¤±è´¥æ•°æ®æˆåŠŸ&quot;</span><span class="token punctuation">)</span>

			<span class="token comment">// service è¿ç§»</span>
			err <span class="token operator">=</span> <span class="token function">serviceMigrate</span><span class="token punctuation">(</span>appid<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> srcK8sClient<span class="token punctuation">,</span> destK8sClient<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>MigrateType<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨ç›®æ ‡é›†ç¾¤ä¸­æ–°å¢ Service å¤±è´¥&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
			l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨ç›®æ ‡é›†ç¾¤ä¸­æ–°å¢ Service æˆåŠŸ&quot;</span><span class="token punctuation">)</span>

			<span class="token comment">// åˆ¤æ–­æ˜¯å¦å…³è”åŸŸå</span>
			<span class="token keyword">var</span> isExists <span class="token builtin">bool</span>
			<span class="token keyword">var</span> lbupstreamID <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
			isExists<span class="token punctuation">,</span> lbupstreamID<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">IsAssociateDomain</span><span class="token punctuation">(</span>orginAppid<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åˆ¤æ–­æ˜¯å¦å…³è”åŸŸåå‡ºé”™&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span>
			<span class="token punctuation">}</span>
      <span class="token comment">// ingress è¿ç§» &amp; upstream æ›´æ–°</span>
			<span class="token keyword">if</span> isExists <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; å…³è”äº† upstream&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> upstreamID <span class="token operator">:=</span> <span class="token keyword">range</span> lbupstreamID <span class="token punctuation">{</span>
					<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">ingressMigrate</span><span class="token punctuation">(</span>destClusterID<span class="token punctuation">,</span> upstreamID<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
						l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨ç›®æ ‡é›†ç¾¤ä¸­æ–°å¢ Ingress å¤±è´¥&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
						<span class="token keyword">return</span>
					<span class="token punctuation">}</span>
					l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨ç›®æ ‡é›†ç¾¤ä¸­æ–°å¢ Ingress &amp; æ›´æ–° Upstream æˆåŠŸ&quot;</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// upstream æ›´æ–° &amp; åˆ é™¤ ingress</span>
			srcClusterID<span class="token punctuation">,</span> srcZone <span class="token operator">:=</span> <span class="token function">getClusterIDAndZone</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>SrcCluster<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">)</span>
			<span class="token keyword">if</span> isExists <span class="token punctuation">{</span>
				err <span class="token operator">:=</span> <span class="token function">deleteIngress</span><span class="token punctuation">(</span>orginAppid<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> srcZone<span class="token punctuation">,</span> srcClusterID<span class="token punctuation">)</span>
				<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
					l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨æºé›†ç¾¤ä¸­åˆ é™¤ Ingress å¤±è´¥&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span>
				<span class="token punctuation">}</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨æºé›†ç¾¤ä¸­åˆ é™¤ Ingress æˆåŠŸ&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// åˆ é™¤ service</span>
			err <span class="token operator">=</span> srcK8sClient<span class="token punctuation">.</span>Clientset<span class="token punctuation">.</span><span class="token function">CoreV1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Services</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> appid<span class="token punctuation">,</span> metav1<span class="token punctuation">.</span>DeleteOptions<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨æºé›†ç¾¤ä¸­åˆ é™¤ Service å¤±è´¥&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨æºé›†ç¾¤ä¸­åˆ é™¤ Service æˆåŠŸ&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// åˆ é™¤ rollout</span>
			err <span class="token operator">=</span> srcK8sClient<span class="token punctuation">.</span>RolloutsClientset<span class="token punctuation">.</span><span class="token function">ArgoprojV1alpha1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Rollouts</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">TODO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> appid<span class="token punctuation">,</span> metav1<span class="token punctuation">.</span>DeleteOptions<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨æºé›†ç¾¤ä¸­åˆ é™¤ Rollouts å¤±è´¥&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åœ¨æºé›†ç¾¤ä¸­åˆ é™¤ Rollouts æˆåŠŸ&quot;</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// åˆ é™¤æºé›†ç¾¤ cmdb ä¸­æ•°æ®</span>
			err <span class="token operator">=</span> <span class="token function">UpdateDockerData</span><span class="token punctuation">(</span>orginAppid<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>Env<span class="token punctuation">,</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>SrcCluster<span class="token punctuation">,</span> srcClusterID<span class="token punctuation">)</span>
			<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åˆ é™¤æºé›†ç¾¤å…ƒæ•°æ®å¤±è´¥&quot;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; åˆ é™¤æºé›†ç¾¤å…ƒæ•°æ®æˆåŠŸ&quot;</span><span class="token punctuation">)</span>

			<span class="token comment">// è¿ç§»å®Œæˆ</span>
			l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span>appid <span class="token operator">+</span> <span class="token string">&quot; è¿ç§»æˆåŠŸ&quot;</span><span class="token punctuation">)</span>

			<span class="token comment">// æ¢è¡Œ</span>
			l<span class="token punctuation">.</span><span class="token function">WriteNewLog</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>appid<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç­‰å¾…æ‰€æœ‰ Goroutine å®Œæˆ</span>

	<span class="token keyword">if</span> r<span class="token punctuation">.</span>MigrationData<span class="token punctuation">.</span>MigrateType <span class="token operator">==</span> <span class="token string">&quot;ç¦»çº¿&quot;</span> <span class="token punctuation">{</span>
		<span class="token comment">// åˆ é™¤ velero è§£å‹æ•°æ®</span>
		commandStr <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;rm -rf /tmp/backupdownload/*&quot;</span><span class="token punctuation">)</span>
		<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">executeSSHCommand</span><span class="token punctuation">(</span>commandStr<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// è¿ç§»å®Œæˆ</span>
	l<span class="token punctuation">.</span><span class="token function">WriteFineshedLog</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æœ¬æ¬¡è¿ç§»å®Œæˆ&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç»“æŸè¯­</strong></p><p>ç»“åˆå…¬å¸å®é™…æƒ…å†µï¼Œé€‚åˆè‡ªå·±çš„ï¼Œå°±æ˜¯æœ€å¥½çš„ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><ul><li><p>Kuberneteså¤šé›†ç¾¤ç®¡ç†æ¶æ„æ¢ç´¢ | å¾ä¿¡é’Š KubeSphere Maintainer</p></li><li><p>Kuberneteså¤šé›†ç¾¤æ¶æ„çš„æ€è€ƒã€å®è·µå’Œæ¢ç´¢ | æ®µæœ¦ ç§»åŠ¨äº‘</p></li><li><p>æ··åˆäº‘ä¸‹çš„ Kubernetes å¤šé›†ç¾¤ç®¡ç†ä¸åº”ç”¨éƒ¨ç½² | æå®‡ï¼š https://mp.weixin.qq.com/s/ohZ-kSbU5AgxaksRt5rkCw</p></li><li><p>æ™ºæ±‡åäº‘ | Kuberneteså¤šé›†ç¾¤ç®¡ç†æ–¹æ¡ˆkubefedåŸç†è§£æï¼šhttps://mp.weixin.qq.com/s/_LjH6H-y63MPqwgF8pC0sg</p></li><li><p>K8s å¤šé›†ç¾¤å®è·µæ€è€ƒå’Œæ¢ç´¢ | vivoäº’è”ç½‘æŠ€æœ¯ï¼šhttps://mp.weixin.qq.com/s/vztX73tqfrx1r4suDQa9kw</p></li><li><p>karmadaå®˜æ–¹æ–‡æ¡£ï¼šhttps://karmada.io/zh/docs</p></li></ul><p>æˆ‘æ˜¯ Clayï¼Œä¸‹æœŸè§ ğŸ‘‹</p><hr><blockquote><ul><li><p>æ¬¢è¿è®¢é˜…æˆ‘çš„å…¬ä¼—å·ã€ŒSREè¿ç»´è¿›é˜¶ä¹‹è·¯ã€æˆ–å…³æ³¨æˆ‘çš„ Github https://github.com/clay-wangzhi/wiki æŸ¥çœ‹æœ€æ–°æ–‡ç« </p></li><li><p>æ¬¢è¿åŠ æˆ‘å¾®ä¿¡<code>sre-k8s-ai</code>ï¼Œä¸æˆ‘è®¨è®ºäº‘åŸç”Ÿã€ç¨³å®šæ€§ç›¸å…³å†…å®¹</p></li></ul></blockquote><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/weixin-20240220180036567.png" alt="weixin" style="zoom:50%;">`,41);function b(g,y){const a=o("ExternalLinkIcon");return c(),i("div",null,[u,s("p",null,[n("æ­¤é¡¹ç›®æ˜¯åœ¨ Kubernetes "),s("a",r,[n("Federation v1"),t(a)]),n("å’Œ"),s("a",k,[n("v2"),t(a)]),n("åŸºç¡€ä¹‹ä¸Šå¼€å‘çš„ã€‚æŸäº›åŸºæœ¬æ¦‚å¿µä»è¿™ä¸¤ä¸ªç‰ˆæœ¬ç»§æ‰¿è€Œæ¥ã€‚")]),d,s("p",null,[n("Karmada æ˜¯"),s("a",v,[n("Cloud Native Computing Foundation"),t(a)]),n("ï¼ˆCNCFï¼‰çš„å­µåŒ–é¡¹ç›®ã€‚")]),m])}const q=e(l,[["render",b],["__file","multicluster.html.vue"]]);export{q as default};

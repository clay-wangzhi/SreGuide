import{_ as r,r as t,c,a as e,b as a,F as l,e as i,d as n,o}from"./app.4792bd1f.js";const p={},u=i(`<h1 id="cpu-\u7ED1\u6838" tabindex="-1"><a class="header-anchor" href="#cpu-\u7ED1\u6838" aria-hidden="true">#</a> CPU \u7ED1\u6838</h1><p>\u80CC\u666F\uFF1A\u7B97\u6CD5\u96C6\u7FA4\uFF0C\u8DD1\u7684\u5E94\u7528\u4E3ACPU \u5BC6\u96C6\u578B\u5E94\u7528\uFF0Ck8s \u539F\u6765\u7684 CPU\u8C03\u5EA6\u7B97\u6CD5\u4E3A CFS\uFF08\u57FA\u4E8E\u65F6\u95F4\u7247\u7684\uFF09\uFF0C\u4F1A\u4EA7\u751F\u9650\u6D41\uFF0C\u4ECE\u800C\u5F71\u54CD\u6027\u80FD\uFF0C\u5F71\u54CD \u54CD\u5E94\u65F6\u95F4\uFF0C\u6240\u6709\u6539\u4E3A CPU \u7ED1\u6838</p><h2 id="\u5185\u6838\u542F\u52A8-numa" tabindex="-1"><a class="header-anchor" href="#\u5185\u6838\u542F\u52A8-numa" aria-hidden="true">#</a> \u5185\u6838\u542F\u52A8 NUMA</h2><p>\u4FEE\u6539 <code>/etc/default/grub</code> \u4E2D<code>numa=off</code> \u6539\u4E3A<code>numa=on</code></p><p>\u91CD\u65B0\u751F\u6210<code>grub.cfg</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>grub2-mkconfig -o /boot/efi/EFI/centos/grub.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u91CD\u542F\u68C0\u9A8C</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">shutdown</span> -r now
lscpu <span class="token operator">|</span> <span class="token function">grep</span> NUMA
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="k8s-\u7ED1\u6838\u914D\u7F6E\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#k8s-\u7ED1\u6838\u914D\u7F6E\u6B65\u9AA4" aria-hidden="true">#</a> k8s \u7ED1\u6838\u914D\u7F6E\u6B65\u9AA4</h2><p>\u524D\u63D0\u6761\u4EF6</p><ul><li>k8s 1.18 \u7248\u672C\u4EE5\u4E0A</li></ul><p>1\uFF09 \u4FEE\u6539 kubelet \u914D\u7F6E\u6587\u4EF6\uFF08Node \u8282\u70B9\uFF09</p><p><code>vim /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf</code>\uFF0C\u4FEE\u6539\u524D\u540E\u5BF9\u6BD4</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>9a10,11
&gt; ExecStartPre=/usr/bin/mkdir -p /sys/fs/cgroup/cpuset/system.slice/kubelet.service
&gt; ExecStartPre=/usr/bin/mkdir -p /sys/fs/cgroup/hugetlb/system.slice/kubelet.service
11c13,14
&lt; ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS
---
&gt; #ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS
&gt; ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS --kube-reserved=cpu=2,memory=250Mi --cpu-manager-policy=static --feature-gates=CPUManager=true --topology-manager-policy=single-numa-node
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>2\uFF09\u5220\u9664\u65E7\u7684 CPU \u7BA1\u7406\u5668\u72B6\u6001\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> -f /var/lib/kubelet/cpu_manager_state
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3\uFF09\u91CD\u542F kubelet</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl daemon-reload
systemctl restart kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="\u9A8C\u8BC1-pod-\u662F\u5426\u7ED1\u6838\u6210\u529F" tabindex="-1"><a class="header-anchor" href="#\u9A8C\u8BC1-pod-\u662F\u5426\u7ED1\u6838\u6210\u529F" aria-hidden="true">#</a> \u9A8C\u8BC1 pod \u662F\u5426\u7ED1\u6838\u6210\u529F</h2><p>1\uFF09\u5C06 \u5DE5\u4F5C\u8D1F\u8F7D \u8BBE\u7F6E\u4E3A Guaranteed Pod\uFF0C \u5373 \u8BBE\u7F6Elimit \u548C request \uFF0C\u5E76\u76F8\u7B49\uFF0CCPU \u4E3A\u6574\u6570</p><p>2\uFF09\u9A8C\u8BC1</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> inspect xxx <span class="token operator">|</span> <span class="token function">grep</span> Cpuset
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u53C2\u8003\u94FE\u63A5\uFF1A</p>`,23),d={href:"https://bbs.huaweicloud.com/blogs/181224",target:"_blank",rel:"noopener noreferrer"},b=n("\u9CB2\u9E4FKubernetes\u5E73\u53F0\u5982\u4F55\u4F7F\u7528CPU Manager + Topology Manager\u8FBE\u6210\u6700\u4F73\u7ED1\u6838\u5B9E\u4F8B"),m={href:"https://imroc.cc/kubernetes/best-practices/performance-optimization/cpu.html#cpu-%E7%BB%91%E6%A0%B8",target:"_blank",rel:"noopener noreferrer"},h=n("CPU \u7ED1\u6838");function g(_,E){const s=t("ExternalLinkIcon");return o(),c(l,null,[u,e("ul",null,[e("li",null,[e("a",d,[b,a(s)])]),e("li",null,[e("a",m,[h,a(s)])])])],64)}var f=r(p,[["render",g],["__file","numa.html.vue"]]);export{f as default};

import{_ as a,r as n,c as t,a as e,b as r,F as c,e as l,o}from"./app.189b7edd.js";const p={},i=l(`<h1 id="\u5B89\u88C5-kube-prometheus-stack" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5-kube-prometheus-stack" aria-hidden="true">#</a> \u5B89\u88C5 kube-prometheus-stack</h1><h2 id="helm-\u5B89\u88C5\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#helm-\u5B89\u88C5\u914D\u7F6E" aria-hidden="true">#</a> Helm \u5B89\u88C5\u914D\u7F6E</h2><p>\u4E0B\u8F7D\u4E8C\u8FDB\u5236\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">helmversion</span><span class="token operator">=</span><span class="token number">3.7</span>.2
<span class="token function">wget</span> https://get.helm.sh/helm-v<span class="token variable">\${helmversion}</span>-linux-amd64.tar.gz
<span class="token function">tar</span> -xvf helm-v<span class="token variable">\${helmversion}</span>-linux-amd64.tar.gz
<span class="token function">mv</span> linux-amd64/helm /usr/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>\u8BBE\u7F6E\u8865\u5168\u547D\u4EE4</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>helm completion <span class="token function">bash</span> <span class="token operator">&gt;</span> /etc/bash_completion.d/helm.sh
<span class="token builtin class-name">source</span> /etc/bash_completion.d/helm.sh
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="prometheus-\u5B89\u88C5\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#prometheus-\u5B89\u88C5\u914D\u7F6E" aria-hidden="true">#</a> Prometheus \u5B89\u88C5\u914D\u7F6E</h2><p>\u6DFB\u52A0 helm repo</p><blockquote><p>\u4E4B\u524D\u62C9\u53D6\u7684\u6700\u65B0\u7248\u672C\uFF0Ckube-state-metrisc \u7684 target \u6CA1\u6DFB\u52A0\u4E0A\u53BB\uFF0C\u6240\u4EE5\u7528\u7684 23.3.2</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>helm repo <span class="token function">add</span> prometheus-community https://prometheus-community.github.io/helm-charts
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u4E0B\u62C9\u538B\u7F29\u5305</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>helm pull prometheus-community/kube-prometheus-stack --version <span class="token number">23.3</span>.2
<span class="token function">tar</span> -xvf kube-prometheus-stack-23.3.2.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E3A prometheus \u521B\u5EFA Namespace</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create namespace cattle-prometheus
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u65B0\u589E etcd secret</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>kubectl create secret generic etcd-certs -n cattle-prometheus --from-file=/etc/kubernetes/pki/etcd/ca.crt --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.crt --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.key
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u4FEE\u6539 kube-proxy \u7684configmap</p><blockquote><p>\u5C06 metricsBindAddress \u4FEE\u6539\u4E3A &quot;0.0.0.0:10249&quot;</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl -n kube-system edit configmaps kube-proxy
kubectl rollout restart ds kube-proxy -n kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6CE8\u91CAsha \u6821\u9A8C</p><blockquote><p>prometheusOperator.admissionWebhooks.patch.image.sha</p></blockquote><p>\u90E8\u7F72</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>helm <span class="token function">install</span> monitoring -n cattle-prometheus --set prometheusOperator.createCustomResource<span class="token operator">=</span>false --set kubeEtcd.serviceMonitor.scheme<span class="token operator">=</span>https --set kubeEtcd.serviceMonitor.caFile<span class="token operator">=</span>/etc/prometheus/secrets/etcd-certs/ca.crt --set kubeEtcd.serviceMonitor.certFile<span class="token operator">=</span>/etc/prometheus/secrets/etcd-certs/healthcheck-client.crt --set kubeEtcd.serviceMonitor.keyFile<span class="token operator">=</span>/etc/prometheus/secrets/etcd-certs/healthcheck-client.key --set prometheus.prometheusSpec.secrets<span class="token operator">=</span><span class="token punctuation">{</span>etcd-certs<span class="token punctuation">}</span> ./
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u5982\u4F55\u5B98\u65B9\u955C\u50CF\u62C9\u4E0D\u4E0B\u6765\uFF0C\u53EF\u4EE5\u5148\u4ECE\u5176\u4ED6\u6E90\uFF0C\u4E0B\u8F7D\u4E0B\u6765\uFF0C\u7136\u540E\u6539tag</p><ul><li><p>k8s.gcr.io/kube-state-metrics/kube-state-metrics:v2.2.4</p></li><li><p>k8s.gcr.io/ingress-nginx/kube-webhook-certgen:v1.0</p></li></ul><p>\u53C2\u8003\u94FE\u63A5</p>`,26),u={href:"https://baijiahao.baidu.com/s?id=1715822973549386399&wfr=spider&for=pc",target:"_blank",rel:"noopener noreferrer"},h=e("strong",null,"Prometheus\u5B9A\u4E49\u6307\u5357\u4E4BOperator",-1);function m(d,b){const s=n("ExternalLinkIcon");return o(),t(c,null,[i,e("p",null,[e("a",u,[h,r(s)])])],64)}var g=a(p,[["render",m],["__file","kube-prometheus-stack.html.vue"]]);export{g as default};

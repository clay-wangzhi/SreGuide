import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as n,e}from"./app-94946260.js";const l={},r=e(`<h1 id="rocketmq集群的搭建" tabindex="-1"><a class="header-anchor" href="#rocketmq集群的搭建" aria-hidden="true">#</a> rocketmq集群的搭建</h1><p>环境</p><ul><li>JDK1.8</li><li>maven3.6.0</li><li>centos7.6主机两台</li></ul><h2 id="下载解压" tabindex="-1"><a class="header-anchor" href="#下载解压" aria-hidden="true">#</a> 下载解压</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://mirrors.tuna.tsinghua.edu.cn/apache/rocketmq/4.6.0/rocketmq-all-4.6.0-bin-release.zip
<span class="token function">unzip</span> rocketmq-all-4.6.0-bin-release.zip
<span class="token function">mv</span> rocketmq-all-4.6.0-bin-release /usr/local/rocketmq
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="修改配置文件" tabindex="-1"><a class="header-anchor" href="#修改配置文件" aria-hidden="true">#</a> 修改配置文件</h2><p>rocketmq默认给出了三种建议配置模式 2m-2s-async(主从异步),----本文采用这种 2m-2s-sync(主从同步) 2m-noslave(仅master)</p><ol><li>对主机一（192.168.163.196）进行操作</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/conf/2m-2s-async
<span class="token function">vim</span> broker-a.properties
<span class="token comment"># 向配置文件中追加如下内容</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span><span class="token number">192.168</span>.163.196:9876<span class="token punctuation">;</span><span class="token number">192.168</span>.163.197:9876
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/master/store
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/master/store/commitlog
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/master/store/consumequeue
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/master/store/index
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/master/store/checkpoint
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> broker-b-s.properties
<span class="token comment"># 向配置文件中追加如下内容</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span><span class="token number">192.168</span>.163.196:9876<span class="token punctuation">;</span><span class="token number">192.168</span>.163.197:9876
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">20911</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store/commitlog
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store/consumequeue
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store/index
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store/checkpoint
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>对主机二（192.168.163.197）进行操作</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/conf/2m-2s-async
<span class="token function">vim</span> broker-b.properties
<span class="token comment"># 向配置文件中追加如下内容</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span><span class="token number">192.168</span>.163.196:9876<span class="token punctuation">;</span><span class="token number">192.168</span>.163.197:9876
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/master/store
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/master/store/commitlog
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/master/store/consumequeue
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/master/store/index
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/master/store/checkpoint
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> broker-a-s.properties
<span class="token comment"># 向配置文件中追加如下内容</span>
<span class="token assign-left variable">namesrvAddr</span><span class="token operator">=</span><span class="token number">192.168</span>.163.196:9876<span class="token punctuation">;</span><span class="token number">192.168</span>.163.197:9876
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">20911</span>
<span class="token assign-left variable">storePathRootDir</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store
<span class="token assign-left variable">storePathCommitLog</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store/commitlog
<span class="token assign-left variable">storePathConsumeQueue</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store/consumequeue
<span class="token assign-left variable">storePathIndex</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store/index
<span class="token assign-left variable">storeCheckpoint</span><span class="token operator">=</span>/usr/local/rocketmq/slave/store/checkpoint
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>设置Rocketmq运行时的JVM内存</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/rocketmq/bin
<span class="token function">vim</span> runbroker.sh
<span class="token comment">#JAVA_OPT=&quot;\${JAVA_OPT} -server -Xms8g -Xmx8g -Xmn4g&quot;</span>
<span class="token comment">#改成：</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">\${JAVA_OPT}</span> -server -Xms512m -Xmx512m -Xmn256m&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> runserver.sh 
<span class="token comment"># JAVA_OPT=&quot;\${JAVA_OPT} -server -Xms4g -Xmx4g -Xmn2g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span>
<span class="token comment"># 改成</span>
<span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">\${JAVA_OPT}</span> -server -Xms512m -Xmx512m -Xmn256m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="启动rocketmq" tabindex="-1"><a class="header-anchor" href="#启动rocketmq" aria-hidden="true">#</a> 启动Rocketmq</h2><ol><li>主机一上操作</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>nohup sh mqnamesrv &amp;
nohup sh mqbroker -c ../conf/2m-2s-async/broker-a.properties &amp;
nohup sh mqbroker -c ../conf/2m-2s-async/broker-b-s.properties &amp;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>主机二上操作</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">nohup</span> <span class="token function">sh</span> mqnamesrv <span class="token operator">&amp;</span>
<span class="token function">nohup</span> <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> <span class="token punctuation">..</span>/conf/2m-2s-async/broker-a-s.properties <span class="token operator">&amp;</span>
<span class="token function">nohup</span>  <span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> <span class="token punctuation">..</span>/conf/2m-2s-async/broker-b.properties <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="搭建console可视化控制台" tabindex="-1"><a class="header-anchor" href="#搭建console可视化控制台" aria-hidden="true">#</a> 搭建Console可视化控制台</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/apache/rocketmq-externals.git
<span class="token builtin class-name">cd</span> rocketmq-externals/rocketmq-console/
<span class="token function">vim</span> src/main/resources/application.properties
<span class="token comment"># 添加两个namesvr的主机ip</span>
<span class="token assign-left variable">rocketmq.config.namesrvAddr</span><span class="token operator">=</span><span class="token number">192.168</span>.163.196:9876<span class="token punctuation">;</span><span class="token number">192.168</span>.163.197:9876
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 打包</span>
 mvn clean package <span class="token parameter variable">-Dmaven.test.skip</span><span class="token operator">=</span>true
 <span class="token function">scp</span> target/rocketmq-console-ng-1.0.1.jar <span class="token number">192.168</span>.163.196:/home/ncar/service/webapps
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 启动jar包，在主机一（192.168.163.196）上</span>
 <span class="token function">nohup</span> <span class="token function">java</span> <span class="token parameter variable">-jar</span> rocketmq-console-ng-1.0.1.jar <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>打开控制台查看集群启动状态</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://192.168.163.196:8080/#/cluster
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="关闭命令" tabindex="-1"><a class="header-anchor" href="#关闭命令" aria-hidden="true">#</a> 关闭命令</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sh bin/mqshutdown broker
sh bin/mqshutdown namesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,29),i=[r];function t(o,c){return a(),n("div",null,i)}const m=s(l,[["render",t],["__file","rocketmq-install.html.vue"]]);export{m as default};

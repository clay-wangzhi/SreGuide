import{_ as a,r as e,c as t,a as s,b as p,F as r,e as l,d as o,o as c}from"./app.958f2970.js";const i={},u=l(`<h1 id="harbor-\u5B89\u88C5\u914D\u7F6E-k8s" tabindex="-1"><a class="header-anchor" href="#harbor-\u5B89\u88C5\u914D\u7F6E-k8s" aria-hidden="true">#</a> Harbor \u5B89\u88C5\u914D\u7F6E(k8s)</h1><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u4E0B\u8F7D helm charts</span>
helm repo <span class="token function">add</span> harbor https://helm.goharbor.io
helm repo update
helm pull harbor/harbor --version<span class="token operator">=</span><span class="token number">1.9</span>.4
<span class="token function">tar</span> -xvf harbor-1.9.4.tgz

<span class="token comment"># \u914D\u7F6E tls secret</span>
<span class="token comment">## \u4E0B\u8F7Dnginx\u4F7F\u7528\u7684 key \u548C pem \u4F20\u5230\u670D\u52A1\u5668\uFF0C\u5E76\u91CD\u547D\u540D\u4E3A tls.xxx</span>
<span class="token comment">## \u4F7F\u7528 openssl \u628A pem \u8BC1\u4E66\u8F6C\u6362\u4E3A crt</span>
<span class="token function">mkdir</span> harbor-tls
<span class="token builtin class-name">cd</span> harbor-tls/
openssl x509 -in  tls.pem -out tls.crt
kubectl create ns harbor
kubectl -n harbor create secret tls harbor-secret   --cert<span class="token operator">=</span>tls.crt   --key<span class="token operator">=</span>tls.key
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>\u4FEE\u6539 <code>charts values.yaml</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>/harbor/
<span class="token function">cp</span> values.yaml<span class="token punctuation">{</span>,.bak<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u4E3B\u8981\u4FEE\u6539\u5982\u4E0B\u4F4D\u7F6E\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">expose.tls.certSource</span><span class="token punctuation">:</span> secret
<span class="token key atrule">expose.tls.secret.secretName</span><span class="token punctuation">:</span> <span class="token string">&quot;harbor-secret&quot;</span>
<span class="token key atrule">expose.ingress.hsots.core</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx.xxx.xx&quot;</span>
<span class="token key atrule">externalURL</span><span class="token punctuation">:</span> <span class="token string">&quot;xxx.xxx.xx&quot;</span>
<span class="token key atrule">ipFamily.ipv6.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># \u5173\u95ED ipv6</span>
<span class="token comment"># \u6240\u6709\u7684 storageClass \u6539\u4E3A &quot;longhorn&quot;,\u6211\u672C\u5730\u4F7F\u7528\u7684 longhorn \u4F5C\u4E3A\u6301\u4E45\u5316\u5B58\u50A8</span>
<span class="token key atrule">persistence.persistentVolumeClaim.registry.size</span><span class="token punctuation">:</span> 500Gi <span class="token comment"># \u53D8\u5927</span>
<span class="token key atrule">harborAdminPassword</span><span class="token punctuation">:</span> <span class="token string">&quot;xxxxxxx&quot;</span> <span class="token comment"># \u4FEE\u6539\u521D\u59CB\u5316\u5BC6\u7801</span>
<span class="token key atrule">metrics.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># \u66B4\u9732\u76D1\u63A7\u6307\u6807</span>
<span class="token key atrule">metrics.serviceMonitor.enabled</span><span class="token punctuation">:</span>  <span class="token boolean important">true</span> <span class="token comment"># \u6DFB\u52A0 servicemonitor</span>
<span class="token key atrule">metrics.serviceMonitor.additionalLabels</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">&quot;release&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;monitoring&quot;</span><span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>\u5B89\u88C5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>helm <span class="token function">install</span> harbor ./ -n harbor
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u67E5\u770B Prometheus \u662F\u5426\u6536\u5230\u6570\u636E\uFF0C\u67E5\u770B target</p><p>grafana \u5C55\u793A harbor \u6570\u636E\uFF0C\u5BFC\u5165 14075</p><p>\u53C2\u8003\u94FE\u63A5\uFF1A</p>`,11),b={href:"https://goharbor.io/docs/2.6.0/install-config/harbor-ha-helm/",target:"_blank",rel:"noopener noreferrer"},m=o("Deploying Harbor with High Availability via Helm");function k(d,h){const n=e("ExternalLinkIcon");return c(),t(r,null,[u,s("ul",null,[s("li",null,[s("a",b,[m,p(n)])])])],64)}var g=a(i,[["render",k],["__file","harbor.html.vue"]]);export{g as default};

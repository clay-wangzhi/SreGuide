const n=JSON.parse(`{"key":"v-1941575d","path":"/code/python/python-instance.html","title":"python 实际工作中的实例","lang":"zh-CN","frontmatter":{"category":"Python","tag":["工作脚本"],"description":"python 实际工作中的实例 让 windows 压测机 解析内网进行压测，避免占用外网带宽 1）生成 hosts 解析文件，将解析文件分成 N 份，解析到不同的 内网ip cat sync_xxx_hosts.py #!/usr/bin/env python3 import requests import json def get_hosts(): # 调用 api 获取所有 nginx 主机 ip 地址 try: response = requests.get( url=\\"https://xxx/api/v1/appid/xxx/hosts\\", headers={ \\"Authorization\\": \\"xxx\\", \\"Content-Type\\": \\"application/json; charset=utf-8\\", }, data=json.dumps({})) result = response.json()['data']['assets'] hosts = [host['ip'] for host in result] return hosts except requests.exceptions.RequestException: print('HTTP Request failed') def send_request(): # 调用 api 获取域名列表 try: response = requests.get( url= \\"xxx\\", headers={ \\"Authorization\\": \\"xxx\\", \\"Content-Type\\": \\"application/json; charset=utf-8\\", }, data=json.dumps({})) result = response.json()['data'] prod_domain_list = [ domain['name'] for domain in result if domain['lbcluster']['id'] == 1 ] ext_website_domain_list = [ domain['name'] for domain in result if domain['lbcluster']['id'] == 9 ] # 通过域名获取不到的 域名列表，和nginx地址 xx_domain_list = [ 'xxx.xxx.xx' ] ext_website_hosts = get_hosts() for i in range(0, 8): filename = f'/etc/ansible/files/hosts{i}' with open(filename, 'w') as f: for xx_domain in xx_domain_list: f.write('IP地址 ' + bi_domain + '\\\\n') for domain in prod_domain_list: f.write('IP地址 ' + domain + '\\\\n') for domain in ext_website_domain_list: host = ext_website_hosts[i] f.write(host + ' ' + domain + '\\\\n') except requests.exceptions.RequestException: print('HTTP Request failed') if __name__ == '__main__': send_request()","head":[["meta",{"property":"og:url","content":"https://clay-wangzhi.com/code/python/python-instance.html"}],["meta",{"property":"og:site_name","content":"SRE运维进阶之路"}],["meta",{"property":"og:title","content":"python 实际工作中的实例"}],["meta",{"property":"og:description","content":"python 实际工作中的实例 让 windows 压测机 解析内网进行压测，避免占用外网带宽 1）生成 hosts 解析文件，将解析文件分成 N 份，解析到不同的 内网ip cat sync_xxx_hosts.py #!/usr/bin/env python3 import requests import json def get_hosts(): # 调用 api 获取所有 nginx 主机 ip 地址 try: response = requests.get( url=\\"https://xxx/api/v1/appid/xxx/hosts\\", headers={ \\"Authorization\\": \\"xxx\\", \\"Content-Type\\": \\"application/json; charset=utf-8\\", }, data=json.dumps({})) result = response.json()['data']['assets'] hosts = [host['ip'] for host in result] return hosts except requests.exceptions.RequestException: print('HTTP Request failed') def send_request(): # 调用 api 获取域名列表 try: response = requests.get( url= \\"xxx\\", headers={ \\"Authorization\\": \\"xxx\\", \\"Content-Type\\": \\"application/json; charset=utf-8\\", }, data=json.dumps({})) result = response.json()['data'] prod_domain_list = [ domain['name'] for domain in result if domain['lbcluster']['id'] == 1 ] ext_website_domain_list = [ domain['name'] for domain in result if domain['lbcluster']['id'] == 9 ] # 通过域名获取不到的 域名列表，和nginx地址 xx_domain_list = [ 'xxx.xxx.xx' ] ext_website_hosts = get_hosts() for i in range(0, 8): filename = f'/etc/ansible/files/hosts{i}' with open(filename, 'w') as f: for xx_domain in xx_domain_list: f.write('IP地址 ' + bi_domain + '\\\\n') for domain in prod_domain_list: f.write('IP地址 ' + domain + '\\\\n') for domain in ext_website_domain_list: host = ext_website_hosts[i] f.write(host + ' ' + domain + '\\\\n') except requests.exceptions.RequestException: print('HTTP Request failed') if __name__ == '__main__': send_request()"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-04-19T13:08:31.000Z"}],["meta",{"property":"article:author","content":"Clay"}],["meta",{"property":"article:tag","content":"工作脚本"}],["meta",{"property":"article:modified_time","content":"2023-04-19T13:08:31.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"python 实际工作中的实例\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-04-19T13:08:31.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Clay\\",\\"url\\":\\"https://clay-wangzhi.com\\"}]}"]]},"headers":[{"level":2,"title":"让 windows 压测机 解析内网进行压测，避免占用外网带宽","slug":"让-windows-压测机-解析内网进行压测-避免占用外网带宽","link":"#让-windows-压测机-解析内网进行压测-避免占用外网带宽","children":[]},{"level":2,"title":"调用 alibabacloud_alidns 去操作 阿里云 dns 解析","slug":"调用-alibabacloud-alidns-去操作-阿里云-dns-解析","link":"#调用-alibabacloud-alidns-去操作-阿里云-dns-解析","children":[]},{"level":2,"title":"调用zabbixAPI批量添加web监控","slug":"调用zabbixapi批量添加web监控","link":"#调用zabbixapi批量添加web监控","children":[]},{"level":2,"title":"调用jenkinsAPI批量拷贝视图job","slug":"调用jenkinsapi批量拷贝视图job","link":"#调用jenkinsapi批量拷贝视图job","children":[]},{"level":2,"title":"解析 nginx 配置文件生成 Excel 表格","slug":"解析-nginx-配置文件生成-excel-表格","link":"#解析-nginx-配置文件生成-excel-表格","children":[{"level":3,"title":"导入nginx配置文件","slug":"导入nginx配置文件","link":"#导入nginx配置文件","children":[]},{"level":3,"title":"pip安装相关依赖模块","slug":"pip安装相关依赖模块","link":"#pip安装相关依赖模块","children":[]},{"level":3,"title":"编写python脚本","slug":"编写python脚本","link":"#编写python脚本","children":[]}]},{"level":2,"title":"监控 activemq 集群状态并自动重启","slug":"监控-activemq-集群状态并自动重启","link":"#监控-activemq-集群状态并自动重启","children":[]}],"git":{"createdTime":1681909711000,"updatedTime":1681909711000,"contributors":[{"name":"clay-wangzhi","email":"clay.wangzhi@gmail.com","commits":1}]},"readingTime":{"minutes":13.85,"words":4156},"filePathRelative":"code/python/python-instance.md","localizedDate":"2023年4月19日","excerpt":"<h1> python 实际工作中的实例</h1>\\n<h2> 让 windows 压测机 解析内网进行压测，避免占用外网带宽</h2>\\n<p>1）生成 hosts 解析文件，将解析文件分成 N 份，解析到不同的 内网ip</p>\\n<p><code>cat sync_xxx_hosts.py</code></p>\\n<div class=\\"language-python line-numbers-mode\\" data-ext=\\"py\\"><pre class=\\"language-python\\"><code><span class=\\"token comment\\">#!/usr/bin/env python3</span>\\n<span class=\\"token keyword\\">import</span> requests\\n<span class=\\"token keyword\\">import</span> json\\n\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">get_hosts</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token comment\\"># 调用 api 获取所有 nginx 主机 ip 地址</span>\\n    <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n        response <span class=\\"token operator\\">=</span> requests<span class=\\"token punctuation\\">.</span>get<span class=\\"token punctuation\\">(</span>\\n            url<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"https://xxx/api/v1/appid/xxx/hosts\\"</span><span class=\\"token punctuation\\">,</span>\\n            headers<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>\\n                <span class=\\"token string\\">\\"Authorization\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"xxx\\"</span><span class=\\"token punctuation\\">,</span>\\n                <span class=\\"token string\\">\\"Content-Type\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"application/json; charset=utf-8\\"</span><span class=\\"token punctuation\\">,</span>\\n            <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n            data<span class=\\"token operator\\">=</span>json<span class=\\"token punctuation\\">.</span>dumps<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n        result <span class=\\"token operator\\">=</span> response<span class=\\"token punctuation\\">.</span>json<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'data'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'assets'</span><span class=\\"token punctuation\\">]</span>\\n        hosts <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>host<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'ip'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token keyword\\">for</span> host <span class=\\"token keyword\\">in</span> result<span class=\\"token punctuation\\">]</span>\\n        <span class=\\"token keyword\\">return</span> hosts\\n\\n    <span class=\\"token keyword\\">except</span> requests<span class=\\"token punctuation\\">.</span>exceptions<span class=\\"token punctuation\\">.</span>RequestException<span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'HTTP Request failed'</span><span class=\\"token punctuation\\">)</span>\\n\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">send_request</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token comment\\"># 调用 api 获取域名列表</span>\\n    <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n        response <span class=\\"token operator\\">=</span> requests<span class=\\"token punctuation\\">.</span>get<span class=\\"token punctuation\\">(</span>\\n            url<span class=\\"token operator\\">=</span>\\n            <span class=\\"token string\\">\\"xxx\\"</span><span class=\\"token punctuation\\">,</span>\\n            headers<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>\\n                <span class=\\"token string\\">\\"Authorization\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"xxx\\"</span><span class=\\"token punctuation\\">,</span>\\n                <span class=\\"token string\\">\\"Content-Type\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"application/json; charset=utf-8\\"</span><span class=\\"token punctuation\\">,</span>\\n            <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n            data<span class=\\"token operator\\">=</span>json<span class=\\"token punctuation\\">.</span>dumps<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n        result <span class=\\"token operator\\">=</span> response<span class=\\"token punctuation\\">.</span>json<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'data'</span><span class=\\"token punctuation\\">]</span>\\n        prod_domain_list <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>\\n            domain<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token keyword\\">for</span> domain <span class=\\"token keyword\\">in</span> result\\n            <span class=\\"token keyword\\">if</span> domain<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'lbcluster'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'id'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">==</span> <span class=\\"token number\\">1</span>\\n        <span class=\\"token punctuation\\">]</span>\\n        ext_website_domain_list <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>\\n            domain<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token keyword\\">for</span> domain <span class=\\"token keyword\\">in</span> result\\n            <span class=\\"token keyword\\">if</span> domain<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'lbcluster'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'id'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">==</span> <span class=\\"token number\\">9</span>\\n        <span class=\\"token punctuation\\">]</span>\\n        <span class=\\"token comment\\"># 通过域名获取不到的 域名列表，和nginx地址</span>\\n        xx_domain_list <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>\\n            <span class=\\"token string\\">'xxx.xxx.xx'</span>\\n        <span class=\\"token punctuation\\">]</span>\\n        ext_website_hosts <span class=\\"token operator\\">=</span> get_hosts<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token keyword\\">for</span> i <span class=\\"token keyword\\">in</span> <span class=\\"token builtin\\">range</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">8</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n            filename <span class=\\"token operator\\">=</span> <span class=\\"token string-interpolation\\"><span class=\\"token string\\">f'/etc/ansible/files/hosts</span><span class=\\"token interpolation\\"><span class=\\"token punctuation\\">{</span>i<span class=\\"token punctuation\\">}</span></span><span class=\\"token string\\">'</span></span>\\n            <span class=\\"token keyword\\">with</span> <span class=\\"token builtin\\">open</span><span class=\\"token punctuation\\">(</span>filename<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'w'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">as</span> f<span class=\\"token punctuation\\">:</span>\\n                <span class=\\"token keyword\\">for</span> xx_domain <span class=\\"token keyword\\">in</span> xx_domain_list<span class=\\"token punctuation\\">:</span>\\n                    f<span class=\\"token punctuation\\">.</span>write<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'IP地址 '</span> <span class=\\"token operator\\">+</span> bi_domain <span class=\\"token operator\\">+</span> <span class=\\"token string\\">'\\\\n'</span><span class=\\"token punctuation\\">)</span>\\n                <span class=\\"token keyword\\">for</span> domain <span class=\\"token keyword\\">in</span> prod_domain_list<span class=\\"token punctuation\\">:</span>\\n                    f<span class=\\"token punctuation\\">.</span>write<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'IP地址 '</span> <span class=\\"token operator\\">+</span> domain <span class=\\"token operator\\">+</span> <span class=\\"token string\\">'\\\\n'</span><span class=\\"token punctuation\\">)</span>\\n                <span class=\\"token keyword\\">for</span> domain <span class=\\"token keyword\\">in</span> ext_website_domain_list<span class=\\"token punctuation\\">:</span>\\n                    host <span class=\\"token operator\\">=</span> ext_website_hosts<span class=\\"token punctuation\\">[</span>i<span class=\\"token punctuation\\">]</span>\\n                    f<span class=\\"token punctuation\\">.</span>write<span class=\\"token punctuation\\">(</span>host <span class=\\"token operator\\">+</span> <span class=\\"token string\\">' '</span> <span class=\\"token operator\\">+</span> domain <span class=\\"token operator\\">+</span> <span class=\\"token string\\">'\\\\n'</span><span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">except</span> requests<span class=\\"token punctuation\\">.</span>exceptions<span class=\\"token punctuation\\">.</span>RequestException<span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'HTTP Request failed'</span><span class=\\"token punctuation\\">)</span>\\n\\n\\n<span class=\\"token keyword\\">if</span> __name__ <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'__main__'</span><span class=\\"token punctuation\\">:</span>\\n    send_request<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","copyright":{"author":"Clay"},"autoDesc":true}`);export{n as data};

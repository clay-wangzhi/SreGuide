import{_ as i,r,c as o,a as e,b as a,F as t,d as n,e as s,o as c}from"./app.4792bd1f.js";const p={},d=e("h1",{id:"\u4F7F\u7528-ansible-\u5FEB\u901F\u5B89\u88C5-k8s-\u673A\u5668",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u4F7F\u7528-ansible-\u5FEB\u901F\u5B89\u88C5-k8s-\u673A\u5668","aria-hidden":"true"},"#"),n(" \u4F7F\u7528 ansible \u5FEB\u901F\u5B89\u88C5 k8s \u673A\u5668")],-1),h=e("p",null,"\u63A8\u8350\uFF1A",-1),u=n("kubeadm \u5B89\u88C5\u7528\uFF1A"),b={href:"https://github.com/kubernetes-sigs/kubespray",target:"_blank",rel:"noopener noreferrer"},m=n("kubespray"),_=n("\u4E8C\u8FDB\u5236\u5B89\u88C5\u7528\uFF1A"),k={href:"https://github.com/easzlab/kubeasz",target:"_blank",rel:"noopener noreferrer"},y=n("kubeasz"),f=s('<blockquote><p>\u6B64\u5B89\u88C5\u65B9\u5F0F\u53C2\u8003\u4E0A\u9762\u4E24\u4E2A\u9879\u76EE\u521B\u5EFA\uFF0C\u5982\u679C\u521A\u5F00\u59CB\u642D\u5EFA\uFF0C\u76F4\u63A5\u4F7F\u7528\u4E0A\u9762\u7684\u5B89\u88C5\u65B9\u5F0F\u5373\u53EF\uFF0C\u53EF\u6839\u636E\u5B9E\u9645\u60C5\u51B5\u5FAE\u8C03</p></blockquote><p>\u9879\u76EE\u5730\u5740\uFF1Ahttps://github.com/clay-wangzhi/ansible-collection-k8s</p><h2 id="\u76F8\u5173\u652F\u6301" tabindex="-1"><a class="header-anchor" href="#\u76F8\u5173\u652F\u6301" aria-hidden="true">#</a> \u76F8\u5173\u652F\u6301</h2><p><strong>\u652F\u6301 Linux \u7684\u7248\u672C</strong></p><ul><li><strong>CentOS/RHEL</strong> 7</li></ul><p><strong>\u652F\u6301\u7684\u7EC4\u4EF6</strong></p>',6),g=n("Core "),x={href:"https://github.com/kubernetes/kubernetes",target:"_blank",rel:"noopener noreferrer"},v=n("kubernetes"),N=n(" v1.18.10"),q={href:"https://github.com/coreos/etcd",target:"_blank",rel:"noopener noreferrer"},E=n("etcd"),S=n(" v3.4.3"),w={href:"https://www.docker.com/",target:"_blank",rel:"noopener noreferrer"},B=n("docker"),L=n(" v19.03.4"),P=n("Network Plugin "),R={href:"https://github.com/projectcalico/calico",target:"_blank",rel:"noopener noreferrer"},C=n("calico"),I=n(" v3.18.6"),z=n("Application "),A={href:"https://github.com/coredns/coredns",target:"_blank",rel:"noopener noreferrer"},D=n("coredns"),U=n(" v1.6.7"),V=s(`<h2 id="\u5FEB\u901F\u5F00\u59CB" tabindex="-1"><a class="header-anchor" href="#\u5FEB\u901F\u5F00\u59CB" aria-hidden="true">#</a> \u5FEB\u901F\u5F00\u59CB</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u66F4\u6362 yum \u6E90\uFF0C\u5982\u679C\u672C\u6765\u5C31\u662F\u56FD\u5185\u6E90\uFF0C\u65E0\u9700\u66F4\u6362</span>
<span class="token function">curl</span> -fsSL <span class="token string">&quot;https://gitee.com/clay-wangzhi/shell/raw/master/repo_replace.sh&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span>

<span class="token comment"># \u5B89\u88C5 python3</span>
yum -y <span class="token function">install</span> python3

<span class="token comment"># Install dependencies from \`\`requirements.txt\`\`</span>
pip3 <span class="token function">install</span> -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/

<span class="token builtin class-name">cd</span> ansible-collection-k8s
<span class="token comment"># \u6839\u636E\u5B9E\u9645\u60C5\u51B5\u4FEE\u6539 \u4E3B\u673A\u5217\u8868 \`\`inventory/hosts\`\`\u3001\u5168\u5C40\u53D8\u91CF \`\`group_vars/all.yml\`\`</span>

<span class="token comment"># \u4F9D\u6B21\u6267\u884C playbook</span>
ansible-playbook 01-preinstall.yml
ansible-playbook 02-docker.yml
ansible-playbook 03-ha.yml
ansible-playbook 04-master.yml
ansible-playbook 05-calico.yml
ansible-playbook 06-node.yml
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="roles-\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#roles-\u4ECB\u7ECD" aria-hidden="true">#</a> Roles \u4ECB\u7ECD</h2><h3 id="preinstall-\u5B89\u88C5\u524D\u51C6\u5907" tabindex="-1"><a class="header-anchor" href="#preinstall-\u5B89\u88C5\u524D\u51C6\u5907" aria-hidden="true">#</a> preinstall\uFF1A\u5B89\u88C5\u524D\u51C6\u5907</h3><ul><li>\u5173\u95ED swap \u5206\u533A</li><li>\u66F4\u6362 yum \u6E90\u3001\u5B89\u88C5 \u4F9D\u8D56\u5305</li><li>\u66F4\u65B0 \u7CFB\u7EDF\u7248\u672C \u5230 centos 7.9\u3001\u5185\u6838\u7248\u672C \u5230 \u957F\u671F\u652F\u6301\u7248\u672C kernel-lt 5.4.196</li><li>\u5982\u679C\u786C\u4EF6\u7F51\u5361\u9A71\u52A8\u4E0D\u652F\u6301\u65B0\u7248\u672C\u5185\u6838\uFF0C\u5347\u7EA7 \u7F51\u5361\u9A71\u52A8\uFF0C \u9488\u5BF9\u65B0\u5185\u6838\u91CD\u65B0\u7F16\u8BD1</li><li><strong>\u8C03\u8282 CPU \u6027\u80FD\u6A21\u5F0F\u4E3A\u9AD8\u6027\u80FD</strong></li><li>\u7981\u7528\u9632\u706B\u5899\u3001SELINUX</li><li>\u4FEE\u6539\u5185\u6838\u53C2\u6570\u3001\u52A0\u8F7D br_netfilter\u3001ip_conntrack\u3001ipvs \u7B49 modules</li><li>\u914D\u7F6E\u65F6\u95F4\u540C\u6B65</li><li>\u91CD\u542F\u670D\u52A1\u5668\uFF0C\u4F7F\u7528\u5185\u6838\u751F\u6548</li><li>\u68C0\u67E5 \u5185\u6838\u7248\u672C</li><li>\u68C0\u67E5 hostname \u662F\u5426\u7B26\u5408 DNS \u89C4\u8303</li><li>\u68C0\u67E5 kube_service_addresses \u548C kube_pods_subnet \u662F\u5426\u4E3A\u6B63\u786E\u7684\u7F51\u7EDC\u6BB5</li><li>\u68C0\u67E5 kube_service_addresses \u548C kube_pods_subnet \u7684\u7F51\u6BB5\u662F\u5426\u51B2\u7A81</li><li>\u68C0\u67E5\u65F6\u95F4\u662F\u5426\u540C\u6B65</li><li>\u68C0\u67E5 \u8BBF\u95EE\u5916\u7F51\u7684\u8FDE\u901A\u6027\uFF08DNS\u914D\u7F6E\u662F\u5426\u6B63\u786E\uFF09</li></ul><h3 id="docker-\u5B89\u88C5docker" tabindex="-1"><a class="header-anchor" href="#docker-\u5B89\u88C5docker" aria-hidden="true">#</a> docker\uFF1A\u5B89\u88C5Docker</h3><ul><li>\u66F4\u6362 yum \u4E0B\u8F7D\u6E90</li><li>\u5B89\u88C5 docker \u548C\u76F8\u5173\u4F9D\u8D56</li><li>\u65B0\u589E\u914D\u7F6E\u76EE\u5F55\uFF0C\u62F7\u8D1D\u914D\u7F6E\u6587\u4EF6</li><li>\u542F\u52A8\u5E76\u52A0\u5165\u5F00\u673A\u81EA\u542F</li></ul><h3 id="master-\u5B89\u88C5-master" tabindex="-1"><a class="header-anchor" href="#master-\u5B89\u88C5-master" aria-hidden="true">#</a> master: \u5B89\u88C5 master</h3><ul><li>\u66F4\u6362 yum \u4E0B\u8F7D\u6E90</li><li>\u4E0B\u8F7D kubelet\u3001kubeadm\u3001kubectl \u7B49</li><li>\u4E0B\u8F7D kube-apiserver\u3001kube-controller-manager\u3001kube-scheduler\u3001kube-proxy\u3001pause\u3001etcd\u3001coredns \u7B49\u955C\u50CF</li><li>\u542F\u52A8 kubelet \u670D\u52A1</li><li>\u914D\u7F6E kubeadm-config.yml \u521D\u59CB\u5316\u914D\u7F6E\u6587\u4EF6</li><li>\u4F7F\u7528<code>kubeadm init</code> \u8FDB\u884C\u521D\u59CB\u5316</li><li>master1 \u751F\u4EA7certificate key</li><li>\u5176\u4F59master \u4F7F\u7528 <code>kubeadm join</code> \u52A0\u5165master\u96C6\u7FA4</li></ul><h3 id="ha-\u4F7F\u7528-haproxy-keepalived-\u5B9E\u73B0master\u9AD8\u53EF\u7528-\u8D1F\u8F7D\u5747\u8861" tabindex="-1"><a class="header-anchor" href="#ha-\u4F7F\u7528-haproxy-keepalived-\u5B9E\u73B0master\u9AD8\u53EF\u7528-\u8D1F\u8F7D\u5747\u8861" aria-hidden="true">#</a> ha\uFF1A\u4F7F\u7528 <code>haproxy + keepalived</code> \u5B9E\u73B0master\u9AD8\u53EF\u7528\uFF0C\u8D1F\u8F7D\u5747\u8861</h3><blockquote><p>\u5148\u7533\u8BF7vip</p></blockquote><ul><li>\u5B89\u88C5 keepalived \u3001 haproxy</li><li>\u91CD\u5B9A\u5411\u65E5\u5FD7\u6587\u4EF6</li><li>keepalived \u65B0\u589E\u76D1\u63A7\u68C0\u67E5\u811A\u672C</li><li>\u914D\u7F6Ekeepalived\u3001haproxy</li><li>\u542F\u52A8 keepalived\u3001haproxy \uFF0C\u5E76\u914D\u7F6E\u5F00\u673A\u81EA\u542F</li></ul><h3 id="calico-\u5B89\u88C5\u914D\u7F6E-calico-bgp-rr\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#calico-\u5B89\u88C5\u914D\u7F6E-calico-bgp-rr\u6A21\u578B" aria-hidden="true">#</a> calico\uFF1A\u5B89\u88C5\u914D\u7F6E Calico BGP RR\u6A21\u578B</h3><blockquote><p>\u63D0\u524D\u8BBE\u7F6E\u597D LOCAL_AS\u3001AS_NUMBER\u3001PEER_IP\uFF0C\u5B89\u88C5\u597D\u540E\u8FD8\u9700\u8981\u7F51\u7EDC\u8BBE\u7F6E\u4E00\u4E0B\uFF0CBGP\u505A\u5BA3\u544A\u52A0\u90BB\u5C45\u7B49</p></blockquote><ul><li>\u62F7\u8D1D\u5B98\u65B9 yaml \u6587\u4EF6</li><li>\u66FF\u6362 PODSUBNET</li><li>\u8BBE\u7F6E NIC \u4E3A bond4 \u6216 eth0</li><li>apply calico yaml \u6587\u4EF6</li><li>\u5B89\u88C5 \u5E76\u914D\u7F6E calicoctl \u5DE5\u5177</li><li>\u62F7\u8D1D \u8BBE\u7F6E \u4E3A BGP RR \u6A21\u5F0F \u7684\u4E00\u4E9B\u5217 yaml \u6587\u4EF6</li><li>\u4F7F\u7528 calicoctl apply \u4E0A\u9762\u7684yaml\u6587\u4EF6</li></ul><h3 id="node-\u5B89\u88C5-node" tabindex="-1"><a class="header-anchor" href="#node-\u5B89\u88C5-node" aria-hidden="true">#</a> node\uFF1A\u5B89\u88C5 node</h3><ul><li>\u6B65\u9AA4\u548C master 2\uFF0C3 \u5B89\u88C5\u7C7B\u4F3C\uFF0C\u4E0B\u955C\u50CF\uFF0C\u751F\u4EA7\u51ED\u8BC1\uFF0C<code>kubeadm join</code></li></ul>`,17);function j(G,O){const l=r("ExternalLinkIcon");return c(),o(t,null,[d,h,e("ul",null,[e("li",null,[e("p",null,[u,e("a",b,[m,a(l)])])]),e("li",null,[e("p",null,[_,e("a",k,[y,a(l)])])])]),f,e("ul",null,[e("li",null,[g,e("ul",null,[e("li",null,[e("a",x,[v,a(l)]),N]),e("li",null,[e("a",q,[E,a(l)]),S]),e("li",null,[e("a",w,[B,a(l)]),L])])]),e("li",null,[P,e("ul",null,[e("li",null,[e("a",R,[C,a(l)]),I])])]),e("li",null,[z,e("ul",null,[e("li",null,[e("a",A,[D,a(l)]),U])])])]),V],64)}var T=i(p,[["render",j],["__file","ansible-k8s.html.vue"]]);export{T as default};

(window.webpackJsonp=window.webpackJsonp||[]).push([[404],{994:function(s,t,a){"use strict";a.r(t);var r=a(1),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"通过备份-etcd-来完美恢复-kubernetes-中的误删数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过备份-etcd-来完美恢复-kubernetes-中的误删数据"}},[s._v("#")]),s._v(" 通过备份 Etcd 来完美恢复 Kubernetes 中的误删数据")]),s._v(" "),a("blockquote",[a("p",[s._v("转载自："),a("a",{attrs:{href:"https://kubesphere.com.cn/forum/d/3532-etcdkubernetes",target:"_blank",rel:"noopener noreferrer"}},[s._v("Etcd备份数据如何做到完美恢复Kubernetes中误删数据呢"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("误删或者机器宕机，会导致etcd数据的丢失或某个节点的etcd数据异常时，"),a("strong",[s._v("请不要慌，认真看完此文，绝对有收获")]),s._v("。当误删时，如何恢复数据，这个操作需求在实际环境当中是不可避免的。以下描述删除两个namespace下的pod，如何恢复对应namespace的数据。")]),s._v(" "),a("h2",{attrs:{id:"_1-操作环境信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-操作环境信息"}},[s._v("#")]),s._v(" 1 操作环境信息")]),s._v(" "),a("p",[s._v("3个（master、etcd）+1个node、新建1个namespace下且创建pod和default namespace下创建pod。")]),s._v(" "),a("h2",{attrs:{id:"_2-前提条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-前提条件"}},[s._v("#")]),s._v(" 2 前提条件")]),s._v(" "),a("p",[s._v("误删除的数据已在etcd备份")]),s._v(" "),a("h2",{attrs:{id:"_3-数据环境的模拟"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-数据环境的模拟"}},[s._v("#")]),s._v(" 3 数据环境的模拟")]),s._v(" "),a("h3",{attrs:{id:"_3-1-新建-test-namespace-在该ns下创建pod-创建成功之后-此时这些数据已存在etcd中。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-新建-test-namespace-在该ns下创建pod-创建成功之后-此时这些数据已存在etcd中。"}},[s._v("#")]),s._v(" 3.1 新建 test namespace，在该ns下创建pod，创建成功之后，此时这些数据已存在etcd中。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("kubectl get pod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n test\nNAME                              READY   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v("    RESTARTS   AGE\ndetails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("d78fc5688"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ntvtd       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nproductpage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("844495")]),s._v("cb4b"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("qn6l9   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nratings"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("ccf46fb4"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pwqw7       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nreviews"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("bb7b8c4f"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h6vr9       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_3-2-在default-namespace-创建pod-如下所示-创建成功之后-此时这些数据已存在etcd中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-在default-namespace-创建pod-如下所示-创建成功之后-此时这些数据已存在etcd中"}},[s._v("#")]),s._v(" 3.2 在default namespace 创建pod，如下所示，创建成功之后，此时这些数据已存在etcd中")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("kubectl get pod\nNAME                      READY   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v("    RESTARTS   AGE\nnginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("db489d4b7"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jdfkw    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nnginx1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("675")]),s._v("bf6c9f"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jndrx    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nnginx2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("dfc958b55"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vgsc4   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nnginx3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("f65b44f9"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("pk4l    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nnginx4"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("bb966479"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("svhs6    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nnginx5"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("d4d998c6c"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("xlp8   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\nnginx6"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79444687")]),s._v("cf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rc8vk   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_3-3-在某目录下已存放包含上述产生数据的etcd快照"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-在某目录下已存放包含上述产生数据的etcd快照"}},[s._v("#")]),s._v(" 3.3 在某目录下已存放包含上述产生数据的etcd快照")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("ls\nmember  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("snapshot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_4-模拟数据的删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-模拟数据的删除"}},[s._v("#")]),s._v(" 4 模拟数据的删除")]),s._v(" "),a("p",[s._v("default和test namespace下pod都被干掉")]),s._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[s._v("kubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pod\nNo "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("resources")]),s._v(" found "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 etcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19_02")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# kubectl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("get")]),s._v(" pod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n test\nNo "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("resources")]),s._v(" found "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" test "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_5-数据的恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-数据的恢复"}},[s._v("#")]),s._v(" 5 数据的恢复")]),s._v(" "),a("h3",{attrs:{id:"_5-1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-准备工作"}},[s._v("#")]),s._v(" 5.1 准备工作")]),s._v(" "),a("p",[s._v("停止所有master上kube-apiserver服务，因为和etcd交互是kube-apiserver。此步骤不会影响正常运行的pod。")]),s._v(" "),a("h4",{attrs:{id:"_5-1-1-所有master机器上操作如下指令-将kube-apiserver-yaml文件移除当前目录下-作用是停止kube-apiserver服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-所有master机器上操作如下指令-将kube-apiserver-yaml文件移除当前目录下-作用是停止kube-apiserver服务"}},[s._v("#")]),s._v(" 5.1.1 所有master机器上操作如下指令,将kube-apiserver.yaml文件移除当前目录下，作用是停止kube-apiserver服务")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mv /etc/kubernetes/manifests/kube-apiserver.yaml .\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_5-1-2-检查kube-apiserver服务已停止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-检查kube-apiserver服务已停止"}},[s._v("#")]),s._v(" 5.1.2 检查kube-apiserver服务已停止")]),s._v(" "),a("div",{staticClass:"language-perl line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-perl"}},[a("code",[s._v("kubectl get pod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\nUnable to connect to the server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" EOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_5-1-3-所有etcd机器上-停止etcd运行-此步操作不会影响现有的pod-只是不能新建、删除pod。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-3-所有etcd机器上-停止etcd运行-此步操作不会影响现有的pod-只是不能新建、删除pod。"}},[s._v("#")]),s._v(" 5.1.3 所有etcd机器上，停止etcd运行，此步操作不会影响现有的pod，只是不能新建、删除pod。")]),s._v(" "),a("div",{staticClass:"language-vbnet line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-vbnet"}},[a("code",[s._v("systemctl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("stop")]),s._v(" etcd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_5-1-4-查看etcd服务是否已停止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-4-查看etcd服务是否已停止"}},[s._v("#")]),s._v(" 5.1.4 查看etcd服务是否已停止")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("docker ps "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep etcd\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18d")]),s._v("fbbfb8317   kubesphere"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.12")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/etcd"')]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" hours ago   "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exited")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" seconds ago             etcd3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_5-1-5-移除所有etcd存储目录下数据-不同环境下-存储目录可能不一样-可以通过systemctl-status-etcd查看etcd-配置参数。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-5-移除所有etcd存储目录下数据-不同环境下-存储目录可能不一样-可以通过systemctl-status-etcd查看etcd-配置参数。"}},[s._v("#")]),s._v(" 5.1.5 移除所有etcd存储目录下数据，不同环境下，存储目录可能不一样，可以通过systemctl status etcd查看etcd 配置参数。")]),s._v(" "),a("div",{staticClass:"language-csharp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[s._v("mv "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bak\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_5-1-6-将node1机器上的快照snapshot-db分别拷贝到另外两台etcd机器上。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-6-将node1机器上的快照snapshot-db分别拷贝到另外两台etcd机器上。"}},[s._v("#")]),s._v(" 5.1.6 将node1机器上的快照snapshot.db分别拷贝到另外两台etcd机器上。")]),s._v(" "),a("div",{staticClass:"language-ruby line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ruby"}},[a("code",[s._v("scp snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root\n\n\nscp snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_5-2-恢复备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-恢复备份"}},[s._v("#")]),s._v(" 5.2 恢复备份")]),s._v(" "),a("p",[s._v("不同环境下，目录可能不一样，可以通过systemctl status etcd查看etcd 配置参数。特别需要注意name、initial-cluster、initial-cluster-token、initial-advertise-peer-urls和data-dir参数的值。")]),s._v(" "),a("h4",{attrs:{id:"_5-2-1-在第一台etcd节点上-注意需要etcdctl-api-3、name值、ip值、snapshot-db文件目录和data-dir目录。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-在第一台etcd节点上-注意需要etcdctl-api-3、name值、ip值、snapshot-db文件目录和data-dir目录。"}},[s._v("#")]),s._v(" 5.2.1 在第一台etcd节点上，注意需要ETCDCTL_API=3、name值、ip值、snapshot.db文件目录和data-dir目录。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCDCTL_API")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \n一条指令，可以直接在终端上修改里面参数\netcdctl snapshot restore snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name etcd1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token k8s_etcd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("peer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n和上面指令一样作用，把长的指令以换行形式展现\netcdctl snapshot restore snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name etcd1 \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380"')]),s._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token k8s_etcd \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("peer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06.773113")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mvcc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" restore compact to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96139")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06.800086")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7370")]),s._v("b1d3dc967c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06.800159")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("ef3cfc4ca48ad38 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06.800190")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("a0c86c4c744477c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"_5-2-2-第二台和第三台etcd恢复数据-同样需要改变etcdctl-api-3、name值、ip值、snapshot-db文件目录和data-dir目录。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-2-第二台和第三台etcd恢复数据-同样需要改变etcdctl-api-3、name值、ip值、snapshot-db文件目录和data-dir目录。"}},[s._v("#")]),s._v(" 5.2.2 第二台和第三台etcd恢复数据，同样需要改变ETCDCTL_API=3、name值、ip值、snapshot.db文件目录和data-dir目录。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCDCTL_API")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n一条指令，可以直接在终端上修改里面参数\netcdctl snapshot restore snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name etcd2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token k8s_etcd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("peer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n和上面指令一样作用，把长的指令以换行形式展现\netcdctl snapshot restore snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name etcd2 \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380"')]),s._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token k8s_etcd \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("peer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59.857363")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mvcc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" restore compact to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96139")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59.873793")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7370")]),s._v("b1d3dc967c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59.873837")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("ef3cfc4ca48ad38 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59.873852")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("a0c86c4c744477c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("ETCDCTL_API")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n一条指令，可以直接在终端上修改里面参数\netcdctl snapshot restore snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name etcd3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token k8s_etcd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("peer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n和上面指令一样作用，把长的指令以换行形式展现\netcdctl snapshot restore snapshot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("name etcd3 \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"etcd1=https://192.168.0.25:2380,etcd2=https://192.168.0.26:2380,etcd3=https://192.168.0.28:2380"')]),s._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("token k8s_etcd \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("initial"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("advertise"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("peer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("urls https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),s._v(" \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.423215")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mvcc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" restore compact to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("96139")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.438319")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7370")]),s._v("b1d3dc967c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.438357")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("ef3cfc4ca48ad38 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.438371")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("I")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" etcdserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("membership"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" added member "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("a0c86c4c744477c "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2380")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" to cluster e4d7f96e88cc9d71\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h4",{attrs:{id:"_5-2-3-上面三台etcd启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-3-上面三台etcd启动"}},[s._v("#")]),s._v(" 5.2.3 上面三台etcd启动")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("systemctl "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" etcd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_5-2-4-检查etcd集群状态-注意-如果有证书-需要加上证书-在哪台etcd机器执行-注意找到对应的证书文件及最后面加endpoint-health字样。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-4-检查etcd集群状态-注意-如果有证书-需要加上证书-在哪台etcd机器执行-注意找到对应的证书文件及最后面加endpoint-health字样。"}},[s._v("#")]),s._v(" 5.2.4 检查etcd集群状态，注意：如果有证书，需要加上证书；在哪台etcd机器执行，注意找到对应的证书文件及最后面加endpoint health字样。")]),s._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("一条指令，可以直接在终端上修改里面参数\netcdctl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cacert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("endpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(" endpoint health\n和上面指令一样作用，把长的指令以换行形式展现\netcdctl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cacert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ssl"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem \\\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("endpoints"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(" \\\nendpoint health\n\nhttps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".28")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(" is healthy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" successfully committed proposal"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" took "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.664519")]),s._v("ms\nhttps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(" is healthy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" successfully committed proposal"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" took "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.04665")]),s._v("ms\nhttps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".25")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v(" is healthy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" successfully committed proposal"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" took "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.837265")]),s._v("ms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"_5-2-5-三台etcd全部正常-分别到每台master启动kube-apiserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-5-三台etcd全部正常-分别到每台master启动kube-apiserver"}},[s._v("#")]),s._v(" 5.2.5 三台etcd全部正常，分别到每台master启动kube-apiserver")]),s._v(" "),a("div",{staticClass:"language-undefined line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mv /root/kube-apiserver.yaml /etc/kubernetes/manifests/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_5-2-6-检查kubernetes集群和创建的pod是否恢复正常-包括etcd服务、kube-apiserver服务及对应ns下删除的pod。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-6-检查kubernetes集群和创建的pod是否恢复正常-包括etcd服务、kube-apiserver服务及对应ns下删除的pod。"}},[s._v("#")]),s._v(" 5.2.6 检查kubernetes集群和创建的pod是否恢复正常，包括etcd服务、kube-apiserver服务及对应ns下删除的pod。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("kubectl get pod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" grep kube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver\nkube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node1                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("h\nkube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node2                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("h\nkube"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("apiserver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node3                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("h\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@node1")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps -a | grep etcd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("156")]),s._v("b19a72bf0   kubesphere"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etcd:v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.12")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/etcd"')]),s._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" minutes ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" minutes                           etcd1\n\n\nkubectl get pod\nNAME                      READY   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v("              RESTARTS   AGE\nnginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("db489d4b7"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jdfkw    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nnginx1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("675")]),s._v("bf6c9f"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jndrx    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nnginx2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("dfc958b55"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vgsc4   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nnginx3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("f65b44f9"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("pk4l    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nnginx4"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("bb966479"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("svhs6    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nnginx5"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("d4d998c6c"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("xlp8   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     ContainerCreating   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nnginx6"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("79444687")]),s._v("cf"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rc8vk   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@node1")]),s._v(" ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n test")]),s._v("\nNAME                              READY   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v("    RESTARTS   AGE\ndetails"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("d78fc5688"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ntvtd       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nproductpage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("844495")]),s._v("cb4b"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("qn6l9   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nratings"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("55")]),s._v("ccf46fb4"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("pwqw7       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\nreviews"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v("bb7b8c4f"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("h6vr9       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h2",{attrs:{id:"_6-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-总结"}},[s._v("#")]),s._v(" 6 总结")]),s._v(" "),a("p",[s._v("Kubernetes 集群备份主要是备份etcd集群。而恢复时，主要考虑恢复整个顺序：")]),s._v(" "),a("p",[s._v("停止Kube-apiserver–> 停止etcd–> 恢复数据–>启动etcd–>启动kube-apiserver")]),s._v(" "),a("p",[s._v("注意：备份etcd集群时，只需要备份一个etcd就行，恢复时，拿同一份备份数据恢复。")])])}),[],!1,null,null,null);t.default=e.exports}}]);
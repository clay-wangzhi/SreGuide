(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{1139:function(s,a,e){"use strict";e.r(a);var r=e(1),t=Object(r.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"harbor-搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#harbor-搭建"}},[s._v("#")]),s._v(" Harbor 搭建")]),s._v(" "),e("h1",{attrs:{id:"harbor创建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#harbor创建"}},[s._v("#")]),s._v(" Harbor创建")]),s._v(" "),e("h2",{attrs:{id:"安装依赖软件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖软件"}},[s._v("#")]),s._v(" 安装依赖软件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("yum -y install openssl\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"installation-steps"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installation-steps"}},[s._v("#")]),s._v(" Installation Steps")]),s._v(" "),e("p",[s._v("1）Offline installer:")]),s._v(" "),e("p",[s._v("从github上下载官方最新包，然后上传到服务器上")]),s._v(" "),e("p",[s._v("2）解压")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tar xvf harbor-offline-installer-<version>.tgz  -C /usr/local/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("3）修改配置文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# cd /usr/local/harbor\n# vim harbor.yml\n# 将hostname改为对应的本机地址（not localhost or 127.0.0.1）\n# 修改harbor_admin_password管理用户密码，只能在这里改，改后不可再改\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[s._v("hostname一定要用域名")])]),s._v(" "),e("p",[s._v("4）安装启动")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("./install\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"configuring-harbor-with-https-access"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuring-harbor-with-https-access"}},[s._v("#")]),s._v(" Configuring Harbor with HTTPS Access")]),s._v(" "),e("h2",{attrs:{id:"getting-certificate-authority"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getting-certificate-authority"}},[s._v("#")]),s._v(" Getting Certificate Authority")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# hostnamectl set-hostname sdqcharbor.com\n# echo "本机地址 sdqcharbor.com" >> /etc/hosts\n# mkdir -p /opt/certs\n# cd /opt/certs\n# openssl genrsa -out ca.key 4096\n# openssl req -x509 -new -nodes -sha512 -days 3650 \\\n  -subj "/CN=sdqcharbor.com" \\\n  -key ca.key \\\n  -out ca.crt\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h2",{attrs:{id:"getting-server-certificate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#getting-server-certificate"}},[s._v("#")]),s._v(" Getting Server Certificate")]),s._v(" "),e("p",[e("strong",[s._v("1) Create your own Private Key:")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("openssl genrsa -out sdqcharbor.com.key 4096\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("2) Generate a Certificate Signing Request:")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('openssl req -sha512 -new \\\n  -subj "/CN=sdqcharbor.com" \\\n  -key sdqcharbor.com.key \\\n  -out sdqcharbor.com.csr\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("strong",[s._v("3) Generate the certificate of your registry host:")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cat > v3.ext <<-EOF\nauthorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nextendedKeyUsage = serverAuth \nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1=sdqcharbor.com\nDNS.2=192.168.162.45\nEOF\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("openssl x509 -req -sha512 -days 3650     -extfile v3.ext     -CA ca.crt -CAkey ca.key -CAcreateserial     -in sdqcharbor.com.csr     -out sdqcharbor.com.crt\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"configuration-and-installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configuration-and-installation"}},[s._v("#")]),s._v(" Configuration and Installation")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir /data/cert\ncp sdqcharbor.com.crt /data/cert/\ncp sdqcharbor.com.key /data/cert/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("strong",[s._v("2) Configure Server Certificate, Key and CA for Docker")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("openssl x509 -inform PEM -in sdqcharbor.com.crt -out sdqcharbor.com.cert\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("Delpoy .com.cert"),e("code",[s._v(",")]),s._v("yourdomain.com.key"),e("code",[s._v(", and")]),s._v("ca.crt` for Docker:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("mkdir /etc/docker/certs.d/sdqcharbor.com\ncp sdqcharbor.com.cert sdqcharbor.com.key ca.crt /etc/docker/certs.d/sdqcharbor.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("strong",[s._v("3) Configure Harbor")])]),s._v(" "),e("p",[s._v("vim /usr/local/harbor/harbor.yml")]),s._v(" "),e("p",[s._v("修改为以下内容")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("hostname: sdqcharbor.com\nhttps:\n  certificate: /data/cert/sdqcharbor.com.crt\n  private_key: /data/cert/sdqcharbor.com.key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("If Harbor is already running, stop and remove the existing instance. Your image data remain in the file system")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose down -v\nrm -rf /data/database/\nrm -rf /data/registry/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("编辑docker中配置文件，"),e("code",[s._v("daemon.json")]),s._v("，去掉"),e("code",[s._v('"insecure-registries": ["sdqcharbor.com"]')]),s._v("这一行")]),s._v(" "),e("p",[s._v("重启docker")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("systemctl daemon-reload\nsystemctl restart docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("预编译")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("./prepare\ndocker-compose -f ./docker-compose.yml up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("登录")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker login sdqcharbor.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("上传镜像")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker tag centos:latest sdqcharbor.com/library/centos:latest\ndocker push sdqcharbor.com/library/centos:latest \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h1",{attrs:{id:"参考文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),e("blockquote",[e("p",[e("a",{attrs:{href:"https://goharbor.io/docs/1.10/install-config/download-installer/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=t.exports}}]);
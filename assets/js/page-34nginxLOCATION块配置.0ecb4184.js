(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{1308:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_3-4-nginxlocation块配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-nginxlocation块配置"}},[s._v("#")]),s._v(" 3.4 nginxLOCATION块配置")]),s._v(" "),t("p",[t("code",[s._v("nginx")]),s._v("中"),t("code",[s._v("location")]),s._v("的匹配模式有以下几种：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("精确匹配：以"),t("code",[s._v("=")]),s._v("开头，只有完全匹配才能生效，例子"),t("code",[s._v("location = /uri")])])]),s._v(" "),t("li",[t("p",[s._v("非正则匹配：以"),t("code",[s._v("^~")]),s._v("开头，"),t("code",[s._v("^")]),s._v("表示非、"),t("code",[s._v("~")]),s._v("表示正则，例子"),t("code",[s._v("location ^~ /uri")])])]),s._v(" "),t("li",[t("p",[s._v("正则匹配：")]),s._v(" "),t("ul",[t("li",[s._v("以"),t("code",[s._v("~")]),s._v("开头，表示区分大小写的正则匹配，例子"),t("code",[s._v("location ~ pattern")])]),s._v(" "),t("li",[s._v("以"),t("code",[s._v("!~")]),s._v("开头，表示区分大小写不匹配的正则，例子"),t("code",[s._v("location !~ pattern")])]),s._v(" "),t("li",[s._v("以"),t("code",[s._v("~*")]),s._v("开头，表示不区分大小写的正则匹配，例子"),t("code",[s._v("location ~* pattern")])]),s._v(" "),t("li",[s._v("以"),t("code",[s._v("!~*")]),s._v("开头，表示不区分大小写不匹配的正则，例子"),t("code",[s._v("location !~* pattern")])])])]),s._v(" "),t("li",[t("p",[s._v("普通匹配：不带任何修饰符，例子"),t("code",[s._v("location /uri")]),s._v("、"),t("code",[s._v("location /")])])])]),s._v(" "),t("blockquote",[t("p",[s._v("我们暂且把非正则匹配和普通匹配称为前缀匹配")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/nginx中location匹配流程图.png",alt:"nginx中location匹配流程图"}})]),s._v(" "),t("h2",{attrs:{id:"_1-匹配模式优先级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-匹配模式优先级"}},[s._v("#")]),s._v(" 1 匹配模式优先级")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/image-20200320195331145.png",alt:""}})]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("location = /uri 　　　=开头表示精确匹配，只有完全匹配上才能生效。\nlocation ^~ /uri 　　^~ 开头对URL路径进行前缀匹配，并且在正则之前。无正则普通匹配（^ 表示“非”，~ 表示“正则”，字符意思是：不要继续匹配正则）\nlocation ~ pattern 　~开头表示区分大小写的正则匹配。!~为区分大小写不匹配的正则\nlocation ~* pattern 　~*开头表示不区分大小写的正则匹配。!~*为不区分大小写不匹配的正则\nlocation /uri 　　　　不带任何修饰符，也表示前缀匹配，但是在正则匹配之后。\nlocation / 　　　　　通用匹配，任何未匹配到其它location的请求都会匹配到，相当于switch中的default。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("注意：\n前缀匹配，如果有包含关系时，按最大匹配原则进行匹配。比如在前缀匹配：location /dir1与location /dir1/dir2，如有请求http://localhost/dir1/dir2/file将最终匹配到location /dir1/dir2")]),s._v(" "),t("p",[s._v("优先级：\n(location =) > (location 完整路径) > (location ^~ 路径) > (location "),t("sub",[s._v(",")]),s._v("* 正则顺序) > (location 部分起始路径) > (/)")]),s._v(" "),t("blockquote",[t("p",[s._v("上述的优先级不完全正确")])]),s._v(" "),t("p",[s._v("具体规则：")]),s._v(" "),t("p",[s._v("等号类型（=）的优先级最高。一旦匹配成功，则不再查找其他location的匹配项")]),s._v(" "),t("p",[s._v("剩下的几种匹配优先级略复杂，具体可以查看Nginx官方文档（http://nginx.org/en/docs/http/ngx_http_core_module.html#location）")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("^~和普通匹配。")]),s._v(" "),t("p",[s._v("使用前缀匹配，不支持正则表达式，如果有多个location匹配成功的话，不会终止匹配过程，会记忆表达式最长的那个。")])]),s._v(" "),t("li",[t("p",[s._v("如果上一步得到的最长的location为^~类型，则表示阻断正则表达式，不再匹配正则表达式")])]),s._v(" "),t("li",[t("p",[s._v("如果上一步得到的最长的location不是^~类型，继续匹配正则表达式，只要有一个正则成功，则使用这个正则的location，立即返回结果，并结束解析过程")])])]),s._v(" "),t("p",[t("strong",[s._v("“最长”命中")])]),s._v(" "),t("p",[s._v("^~和普通命中，都是优先使用匹配最长的结果，示例如下：")]),s._v(" "),t("p",[t("strong",[s._v("例子1")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("401")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("如上如果path为/test_1，返回的是400，说明^~优先级并不比普通匹配高")]),s._v(" "),t("p",[t("strong",[s._v("例子2")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test_1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("^")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("401")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("402")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("如上如果path为/test_1，返回的是402，此时^~和普通匹配只记住了最长一个location /test_1，不会阻止正则")]),s._v(" "),t("p",[s._v("如果path为/test，返回401，此时^~和普通匹配只记住了最长一个location ^~ /test，会阻止正则")]),s._v(" "),t("h2",{attrs:{id:"_2-路径替换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-路径替换"}},[s._v("#")]),s._v(" 2 路径替换")]),s._v(" "),t("p",[t("strong",[s._v("规则")])]),s._v(" "),t("p",[s._v("配置proxy_pass时，可以实现URL路径的部分替换。")]),s._v(" "),t("p",[s._v("proxy_pass的目标地址，默认不带/，表示只代理域名，url和querystring部分不会变（把请求的path拼接到proxy_pass目标域名之后作为代理的URL）。")]),s._v(" "),t("p",[s._v("如果在目标地址后增加/，则表示把path中location匹配成功的部分剪切掉之后再拼接到proxy_pass目标地址。")]),s._v(" "),t("p",[s._v("比如请求 /a/b.html")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("如上两个匹配成功后，实际代理的目标url分别是")]),s._v(" "),t("p",[s._v("http://server/a/b.html (把/a/b.html拼接到http://server之后)")]),s._v(" "),t("p",[s._v("http://server/b.html (把/a/b.html的/a/去掉之后，拼接到http://server/之后)")]),s._v(" "),t("blockquote",[t("p",[s._v("通过 Nginx Server 访问 "),t("code",[s._v("http://nginx/nginx_location/some/path")])]),s._v(" "),t("p",[t("code",[s._v("proxy_pass")]),s._v("直接映射到主机的 "),t("code",[s._v("/test")])]),s._v(" "),t("p",[s._v("建议location和proxy_pass后面都加上/，否则容易引起混乱。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("location")]),s._v(" "),t("th",[s._v("proxy_pass")]),s._v(" "),t("th",[s._v("实际访问目标")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("/nginx_location/")])]),s._v(" "),t("td",[t("code",[s._v("http://server/test/")])]),s._v(" "),t("td",[t("code",[s._v("http://server/test/some/path")])])])])])]),s._v(" "),t("p",[t("strong",[s._v("要求")])]),s._v(" "),t("p",[s._v("注意的是，对于location为正则表达式的匹配，proxy_pass的目标地址不可以带/")]),s._v(" "),t("p",[s._v("比如，如下配置会报错：")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("abc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("如果是正则表达式，想要实现proxy_pass的路径替换，可以使用如下方式：")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("abc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"_3-root和alias的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-root和alias的使用"}},[s._v("#")]),s._v(" 3 root和alias的使用")]),s._v(" "),t("p",[s._v("nginx指定文件路径有两种方式root和alias，")]),s._v(" "),t("p",[s._v("root与alias主要区别在于nginx如何解释location后面的uri，")]),s._v(" "),t("p",[s._v("这会使两者分别以不同的方式将请求映射到服务器文件上。")]),s._v(" "),t("h3",{attrs:{id:"_3-1-最基本的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-最基本的区别"}},[s._v("#")]),s._v(" 3.1 最基本的区别")]),s._v(" "),t("p",[s._v("alias 指定的目录是准确的，给location指定一个目录。")]),s._v(" "),t("p",[s._v("root 指定目录的上级目录，并且该上级目录要含有locatoin指定名称的同名目录。")]),s._v(" "),t("p",[s._v("以root方式设置资源路径：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("语法: root path;\n配置块: http、server、location、if\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("以alias 方式设置资源路径")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("语法: alias path;\n配置块: location\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("Example:")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("location /img/ {\n\talias /var/www/image/;\n}\n#若按照上述配置的话，则访问/img/目录里面的文件时，ningx会自动去/var/www/image/目录找文件\nlocation /img/ {\n\troot /var/www/image;\n}\n#若按照这种配置的话，则访问/img/目录下的文件时，nginx会去/var/www/image/img/目录下找文件\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("注意：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("1.使用alias时，目录名后面一定要加”/“。\n2.使用alias标签的目录块中不能使用rewrite的break。\n3.alias在使用正则匹配时，必须捕捉要匹配的内容并在指定的内容处使用。\n4.alias只能位于location块中\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("所以使用nginx设置root时要注意一个问题，就是如果该root设置的前端目录不是根目录，那么在写root的绝对地址时，要把前端目录的部分省略掉。\n我们用设置虚拟目录指向的alias来和root比较一下就非常明显了")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("location /abc/ {   alias /home/html/abc/; }  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在这段配置下，http://test/abc/a.html就指定的是 /home/html/abc/a.html。这段配置亦可改成")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("location /abc/ {   root /home/html/;} \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("可以看到，使用root设置目录的绝对路径时，少了/abc,也就是说，使用root来设置前端非根目录时，nginx会组合root和location的路径,即 /home/html/abc/。")]),s._v(" "),t("h2",{attrs:{id:"_4-try-files指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-try-files指令"}},[s._v("#")]),s._v(" 4 try_files指令")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Syntax:\ttry_files file ... uri;\ntry_files file ... =code;\nDefault:\t—\nContext:\tserver, location\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("示例")])]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try_files")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$uri")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("功能：依次试图访问多个url对应的文件（由root或者alias指令指定），当文件存在是直接返回文件内容，如果所有文件都不存在，则按最后一个URL结果或者code返回")]),s._v(" "),t("h2",{attrs:{id:"_5-stub-status"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-stub-status"}},[s._v("#")]),s._v(" 5 stub_status")]),s._v(" "),t("p",[s._v("配置示例")]),s._v(" "),t("div",{staticClass:"language-nginx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-nginx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("basic_status "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("stub_status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("ngx_http_stub_status_module模块內建的状态页\n用于输出nginx的基本状态信息；")]),s._v(" "),t("div",{staticClass:"language-undefined line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("server{\n....\n\tlocation /ngxstatus {\n\t\tstub_status;\n\t}\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("信息页返回数值：")]),s._v(" "),t("div",{staticClass:"language-undefined line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Active connections: 291\nserver accepts handled requests\n16630948 16630948 31070465\nReading: 6 Writing: 179 Waiting: 106\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("Active connections: 活动状态的连接数；")]),s._v(" "),t("li",[s._v("accepts：已经接受的客户端请求的总数；")]),s._v(" "),t("li",[s._v("handled：已经处理完成的客户端请求的总数；")]),s._v(" "),t("li",[s._v("requests：客户端发来的总的请求数；")]),s._v(" "),t("li",[s._v("Reading：处于读取客户端请求报文首部的连接的连接数；")]),s._v(" "),t("li",[s._v("Writing：处于向客户端发送响应报文过程中的连接数；")]),s._v(" "),t("li",[s._v("Waiting：处于等待客户端发出请求的空闲连接数；")])])])}),[],!1,null,null,null);a.default=e.exports}}]);
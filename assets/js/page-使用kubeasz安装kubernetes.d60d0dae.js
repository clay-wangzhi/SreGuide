(window.webpackJsonp=window.webpackJsonp||[]).push([[309],{965:function(s,e,t){"use strict";t.r(e);var a=t(1),n=Object(a.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用-kubeasz-安装-kubernetes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-kubeasz-安装-kubernetes"}},[s._v("#")]),s._v(" 使用 kubeasz 安装 kubernetes")]),s._v(" "),t("blockquote",[t("p",[s._v("github 地址：https://github.com/easzlab/kubeasz")])]),s._v(" "),t("p",[s._v("项目致力于提供快速部署高可用"),t("code",[s._v("k8s")]),s._v("集群的工具, 同时也努力成为"),t("code",[s._v("k8s")]),s._v("实践、使用的参考书；基于二进制方式部署和利用"),t("code",[s._v("ansible-playbook")]),s._v("实现自动化；既提供一键安装脚本, 也可以根据"),t("code",[s._v("安装指南")]),s._v("分步执行安装各个组件。")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("集群特性")]),s._v(" "),t("code",[s._v("TLS")]),s._v("双向认证、"),t("code",[s._v("RBAC")]),s._v("授权、"),t("a",{attrs:{href:"https://github.com/easzlab/kubeasz/blob/master/docs/setup/00-planning_and_overall_intro.md#ha-architecture",target:"_blank",rel:"noopener noreferrer"}},[s._v("多Master高可用"),t("OutboundLink")],1),s._v("、支持"),t("code",[s._v("Network Policy")]),s._v("、备份恢复、"),t("a",{attrs:{href:"https://github.com/easzlab/kubeasz/blob/master/docs/setup/offline_install.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("离线安装"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("strong",[s._v("集群版本")]),s._v(" kubernetes v1.18, v1.19, v1.20, v1.21")]),s._v(" "),t("li",[t("strong",[s._v("操作系统")]),s._v(" CentOS/RedHat 7, Debian 9/10, Ubuntu 16.04/18.04/20.04")]),s._v(" "),t("li",[t("strong",[s._v("运行时")]),s._v(" docker 19.03.x, 20.10.x "),t("a",{attrs:{href:"https://github.com/easzlab/kubeasz/blob/master/docs/setup/containerd.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("containerd"),t("OutboundLink")],1),s._v(" v1.4.4")]),s._v(" "),t("li",[t("strong",[s._v("网络")]),s._v(" "),t("a",{attrs:{href:"https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/calico.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("calico"),t("OutboundLink")],1),s._v(", "),t("a",{attrs:{href:"https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/cilium.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("cilium"),t("OutboundLink")],1),s._v(", "),t("a",{attrs:{href:"https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/flannel.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("flannel"),t("OutboundLink")],1),s._v(", "),t("a",{attrs:{href:"https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/kube-ovn.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("kube-ovn"),t("OutboundLink")],1),s._v(", "),t("a",{attrs:{href:"https://github.com/easzlab/kubeasz/blob/master/docs/setup/network-plugin/kube-router.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("kube-router"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"集群规划和基础参数设定"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群规划和基础参数设定"}},[s._v("#")]),s._v(" 集群规划和基础参数设定")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/ha-2x.gif",alt:""}})]),s._v(" "),t("blockquote",[t("p",[s._v("⚠️ 注意：")]),s._v(" "),t("ul",[t("li",[s._v("时间同步")]),s._v(" "),t("li",[s._v("系统干净")]),s._v(" "),t("li",[s._v("新的稳定内核")]),s._v(" "),t("li",[s._v("worker 节点 "),t("code",[s._v("/var/lib/docker/")]),s._v("、"),t("code",[s._v("/var/lib/kubelet")]),s._v(" 目录磁盘空间要大一些")])])]),s._v(" "),t("h2",{attrs:{id:"部署步骤"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署步骤"}},[s._v("#")]),s._v(" 部署步骤")]),s._v(" "),t("h3",{attrs:{id:"_1-在部署节点安装ansible及准备ssh免密登陆"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-在部署节点安装ansible及准备ssh免密登陆"}},[s._v("#")]),s._v(" 1. 在部署节点安装ansible及准备ssh免密登陆")]),s._v(" "),t("ul",[t("li",[s._v("1.1 安装ansible")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意pip 21.0以后不再支持python2和python3.5，需要如下安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# To install pip for Python 2.7 install it from https://bootstrap.pypa.io/2.7/ :")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -O https://bootstrap.pypa.io/pip/2.7/get-pip.py\npython get-pip.py\npython -m pip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --upgrade "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pip < 21.0"')]),s._v("\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip安装ansible(国内如果安装太慢可以直接用pip阿里云加速)")]),s._v("\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ansible -i https://mirrors.aliyun.com/pypi/simple/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[s._v("1.2 在ansible控制端配置免密码登录")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("ssh-keygen -t rsa -b "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" -N "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v(" -f ~/.ssh/id_rsa\n\nssh-copy-id "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$IPs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#$IPs为所有节点地址包括自身，按照提示输入yes 和root密码")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2-在部署节点编排k8s安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-在部署节点编排k8s安装"}},[s._v("#")]),s._v(" 2. 在部署节点编排k8s安装")]),s._v(" "),t("ul",[t("li",[s._v("2.1 下载项目源码、二进制及离线镜像")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载工具脚本ezdown")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(".0\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -C- -fLO --retry "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" https://github.com/easzlab/kubeasz/releases/download/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${release}")]),s._v("/ezdown\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./ezdown\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用工具脚本下载")]),s._v("\n./ezdown -k v1.18.15 -D\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("上述脚本运行成功后，所有文件（kubeasz代码、二进制、离线镜像）均已整理好放入目录"),t("code",[s._v("/etc/kubeasz")])]),s._v(" "),t("ul",[t("li",[s._v("2.2 创建集群配置实例")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /etc/kubeasz/ezctl /usr/bin/ezctl\nezctl new k8s-test\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("然后根据提示配置"),t("code",[s._v("/etc/kubeasz/clusters/k8s-test/hosts")]),s._v("和 "),t("code",[s._v("/etc/kubeasz/clusters/k8s-test/config.yml")])]),s._v(" "),t("p",[s._v("根据前面节点规划修改hosts 文件和其他集群层面的主要配置选项；其他集群组件等配置项可以在"),t("code",[s._v("config.yml")]),s._v("文件中修改")]),s._v(" "),t("ul",[t("li",[s._v("2.3 开始安装")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一键安装")]),s._v("\nezctl setup k8s-test all\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);
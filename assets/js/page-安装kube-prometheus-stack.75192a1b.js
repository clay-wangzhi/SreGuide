(window.webpackJsonp=window.webpackJsonp||[]).push([[332],{999:function(e,t,s){"use strict";s.r(t);var r=s(1),a=Object(r.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"安装-kube-prometheus-stack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-kube-prometheus-stack"}},[e._v("#")]),e._v(" 安装 kube-prometheus-stack")]),e._v(" "),s("p",[e._v("添加 helm repo")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("helm repo "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("add")]),e._v(" prometheus-community https://prometheus-community.github.io/helm-charts\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("下拉压缩包")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("helm pull prometheus-community/kube-prometheus-stack\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -xvf kube-prometheus-stack-27.2.0.tgz\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("新增 etcd secret")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("kubectl create secret generic etcd-certs -n cattle-prometheus --from-file=/etc/kubernetes/pki/etcd/ca.crt --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.crt --from-file=/etc/kubernetes/pki/etcd/healthcheck-client.key\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("修改 kube-proxy 的configmap")]),e._v(" "),s("blockquote",[s("p",[e._v('将 metricsBindAddress 修改为  "0.0.0.0:10249"')])]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("kubectl -n kube-system edit configmaps kube-proxy\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("部署")]),e._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("helm "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" monitoring -n cattle-prometheus --set prometheusOperator.createCustomResource"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("false --set kubeEtcd.serviceMonitor.scheme"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("https --set kubeEtcd.serviceMonitor.caFile"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/etc/prometheus/secrets/etcd-certs/ca.crt --set kubeEtcd.serviceMonitor.certFile"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/etc/prometheus/secrets/etcd-certs/healthcheck-client.crt --set kubeEtcd.serviceMonitor.keyFile"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/etc/prometheus/secrets/etcd-certs/healthcheck-client.key --set prometheus.prometheusSpec.secrets"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("etcd-certs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" ./\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("参考链接")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://baijiahao.baidu.com/s?id=1715822973549386399&wfr=spider&for=pc",target:"_blank",rel:"noopener noreferrer"}},[e._v("Prometheus定义指南之Operator"),s("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=a.exports}}]);
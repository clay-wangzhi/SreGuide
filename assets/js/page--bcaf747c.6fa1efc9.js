(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{1086:function(s,a,n){"use strict";n.r(a);var t=n(1),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("sh远程脚本\nexpect非交互式")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('#!/usr/bin/expect  \nset timeout 30  \nspawn ssh -l username 192.168.1.1  \nexpect "password:"  \nsend "ispass\\r"  \ninteract  \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("［#!/usr/bin/expect］\n这一行告诉操作系统脚本里的代码使用那一个shell来执行。这里的expect其实和linux下的bash、windows下的cmd是一类东西。")]),s._v(" "),n("p",[s._v("注意：这一行需要在脚本的第一行。")]),s._v(" "),n("p",[s._v("［set timeout 30］")]),s._v(" "),n("p",[s._v("基本上认识英文的都知道这是设置超时时间的，现在你只要记住他的计时单位是：秒")]),s._v(" "),n("p",[s._v("[spawn ssh -l username 192.168.1.1］")]),s._v(" "),n("p",[s._v("spawn是进入expect环境后才可以执行的expect内部命令，如果没有装expect或者直接在默认的SHELL下执行是")]),s._v(" "),n("p",[s._v("找不到spawn命令的。")]),s._v(" "),n("p",[s._v("所以不要用 “which spawn“之类的命令去找spawn命令。好比windows里的dir就是一个内部命令，这个命令由")]),s._v(" "),n("p",[s._v("shell自带，你无法找到一个dir.com 或 dir.exe 的可执行文件。")]),s._v(" "),n("p",[s._v("它主要的功能是给ssh运行进程加个壳，用来传递交互指令。")]),s._v(" "),n("p",[s._v('[expect "password:"］\n这里的expect也是expect的一个内部命令，有点晕吧，expect的shell命令和内部命令是一样的，但不是一个功能，习惯就好了。')]),s._v(" "),n("p",[s._v("这个命令的意思是判断上次输出结果里是否包含“password:”的字符串，如果有则立即返回，否则就等待一段时间后返回，这里等待时长就是前面设置的30秒  。")]),s._v(" "),n("p",[s._v('［send "ispass\\r"］'),n("br"),s._v("\n这里就是执行交互动作，与手工输入密码的动作等效。")]),s._v(" "),n("p",[s._v("温馨提示： 命令字符串结尾别忘记加上 “\\r”，如果出现异常等待的状态可以核查一下。")]),s._v(" "),n("p",[s._v("[interact］\n执行完成后保持交互状态，把控制权交给控制台，这个时候就可以手工操作了。")]),s._v(" "),n("p",[s._v("如果没有这一句登录完成后会退出，而不是留在远程终端上。如果你只是登录过去执行一段命令就退出，可改为［expect eof］")]),s._v(" "),n("p",[s._v("shell脚本嵌套expect脚本")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pass")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n/usr/bin/expect "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\nset timeout 30\nspawn scp /root/install.log 192.168.1.1:/home\nexpect "password:"\nsend "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pass")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('"\nexpect eof\nEOF')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("integrate_ans_zbx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  /usr/bin/expect "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n  set timeout 180\n  spawn ssh root@192.168.162.119\n  expect {\n    "(yes/no)?" {\n      send "yes'),n("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('";\n      expect "password:";\n      send "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ANS_PASS}")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('";\n      exp_continue;\n    }\n    "password:" {\n      send "'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ANS_PASS}")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('";\n      exp_continue;\n    }\n    "*#" {\n      send "sed -i \'/# '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1}")]),s._v(" insert/i\\  "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${IP}")]),s._v(":' "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INVENTORY_FILE}")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('";\n      send "sed -i \'s/'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${IP}")]),s._v("/        "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${IP}")]),s._v("/g' "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INVENTORY_FILE}")]),n("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('";\n      send " ansible-playbook -i '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INVENTORY_FILE}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ZABBIX_PALYBOOK_FILE}")]),s._v(" \\\n             -l "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${IP}")]),s._v(" --skip-tags 'sangoma,debian,suse,windows,docker'"),n("span",{pre:!0,attrs:{class:"token entity",title:"\\r"}},[s._v("\\r")]),s._v('";\n    }\n  }\n  expect eof\nEOF')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  update_ssh\n  integrate_jms "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n  integrate_ans_zbx "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmain "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[214],{1246:function(s,a,n){"use strict";n.r(a);var e=n(1),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"centos7-搭建openldap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#centos7-搭建openldap"}},[s._v("#")]),s._v(" Centos7 搭建openldap")]),s._v(" "),e("p",[s._v("环境：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("centos7.6")])]),s._v(" "),e("li",[e("p",[s._v("openldap 2.4.44")])]),s._v(" "),e("li",[e("p",[s._v("phpldapadmin 1.2.3")])])]),s._v(" "),e("h2",{attrs:{id:"安装openldap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装openldap"}},[s._v("#")]),s._v(" 安装openldap")]),s._v(" "),e("p",[s._v("yum 安装相关包")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y openldap openldap-clients openldap-servers\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("复制一个默认配置到指定目录下,并授权，这一步一定要做，然后再启动服务，不然生产密码时会报错")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("授权给ldap用户,此用户yum安装时便会自动创建")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("chown -R ldap. /var/lib/ldap/DB_CONFIG\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动&加入开机自启")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl start slapd\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" slapd\nsystemctl status slapd\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"修改openldap配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改openldap配置"}},[s._v("#")]),s._v(" 修改openldap配置")]),s._v(" "),e("p",[s._v("这里就是重点中的重点了，从openldap2.4.23版本开始，所有配置都保存在/etc/openldap/slapd.d目录下的cn=config文件夹内，不再使用slapd.conf作为配置文件。配置文件的后缀为 ldif，且每个配置文件都是通过命令自动生成的，任意打开一个配置文件，在开头都会有一行注释，说明此为自动生成的文件，请勿编辑，使用ldapmodify命令进行修改")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("AUTO-GENERATED FILE - DO NOT EDIT!! Use ldapmodify.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("安装openldap后，会有三个命令用于修改配置文件，分别为ldapadd, ldapmodify, ldapdelete，顾名思义就是添加，修改和删除。而需要修改或增加配置时，则需要先写一个ldif后缀的配置文件，然后通过命令将写的配置更新到slapd.d目录下的配置文件中去，完整的配置过程如下，跟着我做就可以了：")]),s._v(" "),e("ol",[e("li",[s._v("生成管理员密码,记录下这个密码，后面需要用到")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# slappasswd -s 123456")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("SSHA"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("LSgYPTUW4zjGtIVtuZ8cRUqqFRv1tWpE\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("blockquote",[e("p",[s._v("密码目前只能是123456，设置其他的还是123456，不清楚原因目前")])]),s._v(" "),e("p",[s._v("新增修改密码文件,ldif为后缀，文件名随意，不要在/etc/openldap/slapd.d/目录下创建类似文件")]),s._v(" "),e("p",[s._v("生成的文件为需要通过命令去动态修改ldap现有配置，如下，我在家目录下，创建文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# cd ~\n# vim changepwd.ldif\ndn: olcDatabase={0}config,cn=config\nchangetype: modify\nadd: olcRootPW\nolcRootPW: {SSHA}LSgYPTUW4zjGtIVtuZ8cRUqqFRv1tWpE\n# ldapadd -Y EXTERNAL -H ldapi:/// -f changepwd.ldif\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("这里解释一下这个文件的内容：")]),s._v(" "),e("ul",[e("li",[s._v("第一行执行配置文件，这里就表示指定为 cn=config/olcDatabase={0}config 文件。你到/etc/openldap/slapd.d/目录下就能找到此文件")]),s._v(" "),e("li",[s._v("第二行 changetype 指定类型为修改")]),s._v(" "),e("li",[s._v("第三行 add 表示添加 olcRootPW 配置项")]),s._v(" "),e("li",[s._v("第四行指定 olcRootPW 配置项的值")])]),s._v(" "),e("p",[s._v("在执行下面的命令前，你可以先查看原本的olcDatabase={0}config文件，里面是没有olcRootPW这个项的，执行命令后，你再看就会新增了olcRootPW项，而且内容是我们文件中指定的值加密后的字符串。")]),s._v(" "),e("p",[s._v("执行修改命令后，有如下输出则为正常：")]),s._v(" "),e("p",[e("img",{attrs:{src:n(678),alt:"img"}})]),s._v(" "),e("p",[s._v("查看olcDatabase={0}config内容,新增了一个olcRootPW项。")]),s._v(" "),e("p",[e("img",{attrs:{src:n(679),alt:"img"}})]),s._v(" "),e("p",[s._v("上面就是一个完整的修改配置的过程，切记不能直接修改/etc/openldap/slapd.d/目录下的配置。")]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[s._v("我们需要向 LDAP 中导入一些基本的 Schema。")])]),s._v(" "),e("p",[s._v("这些 Schema 文件位于 /etc/openldap/schema/ 目录中，schema控制着条目拥有哪些对象类和属性，可以自行选择需要的进行导入。")]),s._v(" "),e("p",[s._v("依次执行下面的命令，导入基础的一些配置,我这里将所有的都导入一下，其中core.ldif是默认已经加载了的，不用导入。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/collective.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/corba.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/duaconf.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/dyngroup.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/java.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/misc.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/openldap.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/pmi.ldif\nldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/ppolicy.ldif\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("修改域名，新增changedomain.ldif, 这里我自定义的域名为 schengle.com，管理员用户账号为admin。")]),s._v(" "),e("p",[s._v("如果要修改，则修改文件中相应的dc=schengle,dc=com为自己的域名。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# vim changedomain.ldif\ndn: olcDatabase={1}monitor,cn=config\nchangetype: modify\nreplace: olcAccess\nolcAccess: {0}to * by dn.base="gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth" read by dn.base="cn=admin,dc=schengle,dc=com" read by * none\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcSuffix\nolcSuffix: dc=schengle,dc=com\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn=admin,dc=schengle,dc=com\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nreplace: olcRootPW\nolcRootPW: {SSHA}UyPmWBn2MeDFMFlJmyLycGZkNV8Mr8n9\n\ndn: olcDatabase={2}hdb,cn=config\nchangetype: modify\nadd: olcAccess\nolcAccess: {0}to attrs=userPassword,shadowLastChange by dn="cn=admin,dc=schengle,dc=com" write by anonymous auth by self write by * none\nolcAccess: {1}to dn.base="" by * read\nolcAccess: {2}to * by dn="cn=admin,dc=schengle,dc=com" write by * read\n# ldapmodify -Y EXTERNAL -H ldapi:/// -f changedomain.ldif\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br")])]),e("p",[s._v("最后这里有5个修改，所以执行会输出5行表示成功。")]),s._v(" "),e("p",[e("img",{attrs:{src:n(680),alt:"img"}})]),s._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[s._v("启用memberof功能")])]),s._v(" "),e("p",[s._v("新增add-memberof.ldif, 开启memberof支持并新增用户支持memberof配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# vim add-memberof.ldif\ndn: cn=module{0},cn=config\ncn: modulle{0}\nobjectClass: olcModuleList\nobjectclass: top\nolcModuleload: memberof.la\nolcModulePath: /usr/lib64/openldap\n\ndn: olcOverlay={0}memberof,olcDatabase={2}hdb,cn=config\nobjectClass: olcConfig\nobjectClass: olcMemberOf\nobjectClass: olcOverlayConfig\nobjectClass: top\nolcOverlay: memberof\nolcMemberOfDangling: ignore\nolcMemberOfRefInt: TRUE\nolcMemberOfGroupOC: groupOfUniqueNames\nolcMemberOfMemberAD: uniqueMember\nolcMemberOfMemberOfAD: memberOf\n# vim refint1.ldif\ndn: cn=module{0},cn=config\nadd: olcmoduleload\nolcmoduleload: refint\n# vim refint2.ldif\ndn: olcOverlay=refint,olcDatabase={2}hdb,cn=config\nobjectClass: olcConfig\nobjectClass: olcOverlayConfig\nobjectClass: olcRefintConfig\nobjectClass: top\nolcOverlay: refint\nolcRefintAttribute: memberof uniqueMember  manager owner\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])]),e("p",[s._v("依次执行下面命令，加载配置，顺序不能错")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ldapadd -Q -Y EXTERNAL -H ldapi:/// -f add-memberof.ldif\nldapmodify -Q -Y EXTERNAL -H ldapi:/// -f refint1.ldif\nldapadd -Q -Y EXTERNAL -H ldapi:/// -f refint2.ldif\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("创建组织和组织单元")])]),s._v(" "),e("p",[s._v("我们来创建一个叫做 schengle company 的组织，并在其下创建一个 admin 的组织角色（该组织角色内的用户具有管理整个 LDAP 的权限）和 People 和 Group 两个组织单元：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim base.ldif")]),s._v("\ndn: "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dc")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("schengle,dc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com\nobjectClass: "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\nobjectClass: dcObject\nobjectClass: organization\no: Schengle Company\ndc: schengle\n \ndn: "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("schengle,dc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com\nobjectClass: organizationalRole\ncn: admin\n \ndn: "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ou")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("People,dc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("schengle,dc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com\nobjectClass: organizationalUnit\nou: People\n \ndn: "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ou")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Group,dc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("schengle,dc"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("com\nobjectClass: organizationalRole\ncn: Group\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("blockquote",[e("p",[s._v("一共执行4次下面的命令，要不然会失败，每次只执行一段")])]),s._v(" "),e("p",[s._v("执行命令，添加配置, 这里要注意修改域名为自己配置的域名，然后需要输入上面我们生成的密码")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("ldapadd -x -D cn=admin,dc=schengle,dc=com -W -f base.ldif\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("通过以上的所有步骤，我们就设置好了一个 LDAP 目录树：其中基准 dc=schengle,dc=com 是该树的根节点，其下有一个管理域 cn=admin,dc=schengle,dc=com 和两个组织单元 ou=People,dc=schengle,dc=com 及 ou=Group,dc=schengle,dc=com。")]),s._v(" "),e("h2",{attrs:{id:"安装phpldapadmin"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装phpldapadmin"}},[s._v("#")]),s._v(" 安装phpldapadmin")]),s._v(" "),e("p",[s._v("ldap装好后，下面安装web界面phpldapadmin。登录phpldapadmin界面")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum安装时，会自动安装apache和php的依赖。")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意： phpldapadmin很多没更新了，只支持php5，如果你服务器的环境是php7，则会有问题，页面会有各种报错")]),s._v("\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y phpldapadmin\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改apache的phpldapadmin配置文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改如下内容，放开外网访问，这里只改了2.4版本的配置，因为centos7 默认安装的apache为2.4版本。所以只需要改2.4版本的配置就可以了")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果不知道自己apache版本，执行 rpm -qa|grep httpd 查看apache版本")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/httpd/conf.d/phpldapadmin.conf\n-----------------------------------------------------------------\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("IfModule mod_authz_core.c"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Apache 2.4")]),s._v("\n    Require all granted\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/IfModule"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n-----------------------------------------------------------------\n \n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置用DN登录ldap")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/phpldapadmin/config.php\n-----------------------------------------------------------------\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 398行，默认是使用uid进行登录，我这里改为cn，也就是用户名")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$servers")]),s._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("setValue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("‘login’,‘attr’,‘dn’"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n// "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$servers")]),s._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("setValue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("‘login’,‘attr’,‘uid’"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 460行，关闭匿名登录，否则任何人都可以直接匿名登录查看所有人的信息")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$servers")]),s._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("setValue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'login'")]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'anon_bind'")]),s._v(",false"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 519行，设置用户属性的唯一性，这里我将cn,sn加上了，以确保用户名的唯一性")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$servers")]),s._v("-"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("setValue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'unique'")]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'attrs'")]),s._v(",array"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mail'")]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uid'")]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uidNumber'")]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cn'")]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sn'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n-----------------------------------------------------------------\n \n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动apache")]),s._v("\nsystemctl start httpd\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" httpd\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br")])]),e("p",[s._v("登录phpldapadmin界面")]),s._v(" "),e("p",[s._v("上一步，启动了apache服务后，在浏览器上访问: http://ip/ldapadmin ，然后使用上面定义的用户，进行登录，如下：")]),s._v(" "),e("p",[e("img",{attrs:{src:n(681),alt:"image-20191210175624957"}}),s._v("\nOK，到此openldap和phpldapadmin 就安装完成了")]),s._v(" "),e("blockquote",[e("p",[s._v("参考链接：")]),s._v(" "),e("p",[s._v("https://blog.csdn.net/weixin_41004350/article/details/89521170")]),s._v(" "),e("p",[s._v("openldap系列文章：")]),s._v(" "),e("p",[s._v("https://www.ilanni.com/?tag=openldap")])])])}),[],!1,null,null,null);a.default=t.exports},678:function(s,a,n){s.exports=n.p+"assets/img/20190426144821449.8475b584.png"},679:function(s,a,n){s.exports=n.p+"assets/img/20190426145019794.3fed128a.png"},680:function(s,a,n){s.exports=n.p+"assets/img/20190426161145765.a9166386.png"},681:function(s,a,n){s.exports=n.p+"assets/img/image-20191210175624957.90e8fb52.png"}}]);
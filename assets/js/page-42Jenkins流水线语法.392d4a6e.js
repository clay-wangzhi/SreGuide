(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{921:function(s,n,a){"use strict";a.r(n);var e=a(1),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_4-2-jenkins流水线语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-jenkins流水线语法"}},[s._v("#")]),s._v(" 4.2 Jenkins流水线语法")]),s._v(" "),a("p",[s._v("您好，本模块主要学习声明式流水线的核心语法，掌握核心语法便于编写Jenkinsfile 😀")]),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"声明式流水线"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#声明式流水线"}},[s._v("#")]),s._v(" 声明式流水线")]),s._v(" "),a("p",[s._v("声明式Pipleine是官方推荐的语法，声明式语法更加简洁。所有的声明式Pipeline都必须包含一个 pipeline块中，比如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pipeline {\n    //run\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("在声明式Pipeline中的基本语句和表达式遵循Groovy的语法。但是有以下例外：")]),s._v(" "),a("ul",[a("li",[s._v("流水线顶层必须是一个块，特别是pipeline{}。")]),s._v(" "),a("li",[s._v("不需要分号作为分割符，是按照行分割的。")]),s._v(" "),a("li",[s._v("语句块只能由阶段、指令、步骤、赋值语句组成。例如: input被视为input()。")]),s._v(" "),a("li",[s._v("不能直接使用groovy语句（例如循环判断等），需要被script {}包裹")])]),s._v(" "),a("h2",{attrs:{id:"声明式核心概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#声明式核心概念"}},[s._v("#")]),s._v(" 声明式核心概念")]),s._v(" "),a("p",[s._v("核心概念用来组织pipeline的运行流程")]),s._v(" "),a("blockquote",[a("p",[s._v("1.pipeline :声明其内容为一个声明式的pipeline脚本")]),s._v(" "),a("p",[s._v("2.agent:执行节点（job运行的slave或者master节点）")]),s._v(" "),a("p",[s._v("3.stages:阶段集合，包裹所有的阶段（例如：打包，部署等各个阶段）")]),s._v(" "),a("p",[s._v("4.stage:阶段，被stages包裹，一个stages可以有多个stage")]),s._v(" "),a("p",[s._v("5.steps:步骤,为每个阶段的最小执行单元,被stage包裹")]),s._v(" "),a("p",[s._v("6.post:执行构建后的操作，根据构建结果来执行对应的操作")])]),s._v(" "),a("h3",{attrs:{id:"agent代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#agent代理"}},[s._v("#")]),s._v(" agent代理")]),s._v(" "),a("p",[a("code",[s._v("agent")]),s._v("指定了流水线的执行节点。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//运行在任意的可用节点上\nagent any\n//全局不指定运行节点，由各自stage来决定\nagent none\n//运行在指定标签的机器上,具体标签名称由agent配置决定\nagent { label 'master' }\n//node参数可以扩展节点信息\nagent { \n     node {\n         label 'master'\n         customWorkspace 'xxx'\n    } \n}\n//使用指定运行的容器\nagent { docker 'python'  }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("作用域：可用在全局与stage内")]),s._v(" "),a("p",[s._v("是否必须：是")]),s._v(" "),a("p",[s._v("参数："),a("code",[s._v("any、none、node、label、docker、dockerfile")])]),s._v(" "),a("ul",[a("li",[s._v("any 在任何可用的节点上执行pipeline。none 没有指定agent的时候默认。")]),s._v(" "),a("li",[s._v("label 在指定标签上的节点上运行Pipeline。 node 允许额外的选项(自定义workspace)。")])]),s._v(" "),a("h3",{attrs:{id:"stages阶段集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stages阶段集合"}},[s._v("#")]),s._v(" stages阶段集合")]),s._v(" "),a("p",[a("code",[s._v("stages")]),s._v("是流水线的整个运行阶段，包含一个或多个 "),a("code",[s._v("stage")]),s._v(" , 建议 "),a("code",[s._v("stages")]),s._v(" 至少包含一个 "),a("code",[s._v("stage")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('pipeline{\n    agent any\n    stages{\n        stage("first stage"){\n            stages{  //嵌套在stage里\n                stage("inside"){\n                    steps{\n                        echo "inside"\n                    }\n                }\n            }\n        }\n        stage("stage2"){\n            steps{\n                echo "outside"\n            }\n        }\n    }\n}\n# 看下运行结果,发现嵌套的stage也是能够展现在视图里面的\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("作用域：全局或者stage阶段内，每个作用域内只能使用一次")]),s._v(" "),a("p",[s._v("是否必须：全局必须")]),s._v(" "),a("h3",{attrs:{id:"stage阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stage阶段"}},[s._v("#")]),s._v(" stage阶段")]),s._v(" "),a("p",[s._v("作用域：被stages包裹，作用在自己的stage包裹范围内")]),s._v(" "),a("p",[s._v("是否必须：必须")]),s._v(" "),a("p",[s._v("参数：需要一个string参数，表示此阶段的工作内容")]),s._v(" "),a("p",[s._v("备注：stage内部可以嵌套stages，内部可单独制定运行的agent")]),s._v(" "),a("h3",{attrs:{id:"steps步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#steps步骤"}},[s._v("#")]),s._v(" steps步骤")]),s._v(" "),a("p",[s._v("作用域：被stage包裹，作用在stage内部")]),s._v(" "),a("p",[s._v("是否必须：必须")]),s._v(" "),a("p",[s._v("参数：无")]),s._v(" "),a("h3",{attrs:{id:"post运行后处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#post运行后处理"}},[s._v("#")]),s._v(" post运行后处理")]),s._v(" "),a("p",[s._v("当流水线完成后根据完成的状态做一些任务。例如：构建失败后邮件通知")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("post { \n    always { \n        echo 'I will always say Hello again!'\n    }\n\n    failure{\n        email : xxxx@dxx.com\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("常用的状态：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("always 无论流水线或者阶段的完成状态。")])]),s._v(" "),a("li",[a("p",[s._v("changed 只有当流水线或者阶段完成状态与之前不同时。")])]),s._v(" "),a("li",[a("p",[s._v('failure 只有当流水线或者阶段状态为"failure"运行。')])]),s._v(" "),a("li",[a("p",[s._v('success 只有当流水线或者阶段状态为"success"运行。')])]),s._v(" "),a("li",[a("p",[s._v('unstable 只有当流水线或者阶段状态为"unstable"运行。例如：测试失败。')])]),s._v(" "),a("li",[a("p",[s._v('aborted 只有当流水线或者阶段状态为"aborted “运行。例如：手动取消。')])])]),s._v(" "),a("h2",{attrs:{id:"声明式指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#声明式指令"}},[s._v("#")]),s._v(" 声明式指令")]),s._v(" "),a("p",[s._v("指令是帮助pipeline更容易的执行命令，可以理解为一个封装好的公共函数和方法，提供给pipeline使用")]),s._v(" "),a("h3",{attrs:{id:"environment环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#environment环境变量"}},[s._v("#")]),s._v(" environment环境变量")]),s._v(" "),a("p",[s._v("定义流水线环境变量，可以定义在全局变量或者步骤中的局部变量。这取决于 environment 指令在流水线内的位置。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("agent any\n\n//全局变量\nenvironment { \n    activeEnv = 'dev'\n}\nstages {\n    stage('Example') {\n\n        //局部变量\n        environment { \n            AN_ACCESS_KEY = credentials('my-prefined-secret-text') \n        }\n        steps {\n            sh 'printenv'\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"options运行选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#options运行选项"}},[s._v("#")]),s._v(" options运行选项")]),s._v(" "),a("p",[s._v("定义流水线运行时的配置选项，流水线提供了许多选项, 比如buildDiscarder,但也可以由插件提供, 比如 timestamps。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("agent any\noptions {\n    timeout(time: 1, unit: 'HOURS') \n}\nstages {\n    stage('Example') {\n        steps {\n            echo 'Hello World'\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("其他部分参数：")]),s._v(" "),a("ul",[a("li",[s._v("buildDiscarder: 为最近的流水线运行的特定数量保存组件和控制台输出。")]),s._v(" "),a("li",[s._v("disableConcurrentBuilds: 不允许同时执行流水线。 可被用来防止同时访问共享资源等。")]),s._v(" "),a("li",[s._v("overrideIndexTriggers: 允许覆盖分支索引触发器的默认处理。")]),s._v(" "),a("li",[s._v("skipDefaultCheckout: 在agent 指令中，跳过从源代码控制中检出代码的默认情况。")]),s._v(" "),a("li",[s._v("skipStagesAfterUnstable: 一旦构建状态变得UNSTABLE，跳过该阶段。")]),s._v(" "),a("li",[s._v("checkoutToSubdirectory: 在工作空间的子目录中自动地执行源代码控制检出。")]),s._v(" "),a("li",[s._v("timeout: 设置流水线运行的超时时间, 在此之后，Jenkins将中止流水线。")]),s._v(" "),a("li",[s._v("retry: 在失败时, 重新尝试整个流水线的指定次数。")]),s._v(" "),a("li",[s._v("timestamps 预测所有由流水线生成的控制台输出，与该流水线发出的时间一致。")])]),s._v(" "),a("h3",{attrs:{id:"parameters参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parameters参数"}},[s._v("#")]),s._v(" parameters参数")]),s._v(" "),a("p",[s._v("为流水线运行时设置项目相关的参数，就不用在UI界面上定义了，比较方便。")]),s._v(" "),a("p",[s._v("作用域：被最外层pipeline所包裹，并且只能出现一次，参数可被全局使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//string 字符串类型的参数, 例如:\nparameters { string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '') }\n\n//booleanParam 布尔参数, 例如:\nparameters { booleanParam(name: 'DEBUG_BUILD', defaultValue: true, description: '') }\nagent any\nparameters {\n    string(name: 'PERSON', defaultValue: 'Mr Jenkins', description: 'Who should I say hello to?')\n}\nstages {\n    stage('Example') {\n        steps {\n            echo \"Hello ${params.PERSON}\"\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"trigger触发器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trigger触发器"}},[s._v("#")]),s._v(" trigger触发器")]),s._v(" "),a("p",[s._v("构建触发器")]),s._v(" "),a("p",[s._v("作用域：被pipeline包裹，在符合条件下自动触发pipeline目前包含三种自动触发的方式：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//cron 计划任务定期执行构建\ntriggers { cron('H */4 * * 1-5') }\n\n\n//pollSCM 与cron定义类似，但是由jenkins定期检测源码变化。\ntriggers { pollSCM('H */4 * * 1-5') }\n\n// upstream 可以利用上游Job的运行状态来进行触发\ntriggers { upstream(upstreamProjects: 'job1,job2', threshold: hudson.model.Result.SUCCESS) }\n\nagent any\ntriggers {\n    cron('H */4 * * 1-5')\n}\nstages {\n    stage('Example') {\n        steps {\n            echo 'Hello World'\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"tool构建工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tool构建工具"}},[s._v("#")]),s._v(" tool构建工具")]),s._v(" "),a("p",[s._v("构建工具maven、ant、gradle,获取通过自动安装或手动放置工具的环境变量。支持maven/jdk/gradle。工具的名称必须在系统设置->全局工具配置中定义。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("agent any\ntools {\n    maven 'apache-maven-3.0.1' \n}\nstages {\n    stage('Example') {\n        steps {\n            sh 'mvn --version'\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"input交互输入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#input交互输入"}},[s._v("#")]),s._v(" input交互输入")]),s._v(" "),a("p",[s._v("input用户在执行各个阶段的时候，由人工确认是否继续进行。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("agent any\nstages {\n    stage('Example') {\n        input {\n            message \"Should we continue?\"\n            ok \"Yes, we should.\"\n            submitter \"alice,bob\"\n            parameters {\n                string(name: 'PERSON', defaultValue: 'Mr Jenkins', description: 'Who should I say hello to?')\n            }\n        }\n        steps {\n            echo \"Hello, ${PERSON}, nice to meet you.\"\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("参数解释：")]),s._v(" "),a("ul",[a("li",[s._v("message 呈现给用户的提示信息。")]),s._v(" "),a("li",[s._v("id 可选，默认为stage名称。")]),s._v(" "),a("li",[s._v("ok 默认表单上的ok文本。")]),s._v(" "),a("li",[s._v("submitter 可选的,以逗号分隔的用户列表或允许提交的外部组名。默认允许任何用户。")]),s._v(" "),a("li",[s._v("submitterParameter 环境变量的可选名称。如果存在，用submitter 名称设置。")]),s._v(" "),a("li",[s._v("parameters 提示提交者提供的一个可选的参数列表。")])]),s._v(" "),a("h3",{attrs:{id:"when条件判断"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#when条件判断"}},[s._v("#")]),s._v(" when条件判断")]),s._v(" "),a("p",[s._v("when 指令允许流水线根据给定的条件决定是否应该执行阶段。 when 指令必须包含至少一个条件。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("//branch: 当正在构建的分支与模式给定的分支匹配时，执行这个阶段,这只适用于多分支流水线例如:\nwhen { branch 'master' }\n\n\n//environment: 当指定的环境变量是给定的值时，执行这个步骤,例如:\nwhen { environment name: 'DEPLOY_TO', value: 'production' }\n\n//expression 当指定的Groovy表达式评估为true时，执行这个阶段, 例如:\nwhen { expression { return params.DEBUG_BUILD } }\n\n//not 当嵌套条件是错误时，执行这个阶段,必须包含一个条件，例如:\nwhen { not { branch 'master' } }\n\n//allOf 当所有的嵌套条件都正确时，执行这个阶段,必须包含至少一个条件，例如:\nwhen { allOf { branch 'master'; environment name: 'DEPLOY_TO', value: 'production' } }\n\n//anyOf 当至少有一个嵌套条件为真时，执行这个阶段,必须包含至少一个条件，例如:\nwhen { anyOf { branch 'master'; branch 'staging' } }\n\n\nstage('Example Deploy') {\n    when {\n        branch 'production'\n        environment name: 'DEPLOY_TO', value: 'production'\n    }\n    steps {\n        echo 'Deploying'\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h2",{attrs:{id:"parallel并行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parallel并行"}},[s._v("#")]),s._v(" parallel并行")]),s._v(" "),a("p",[s._v("声明式流水线的阶段可以在他们内部声明多隔嵌套阶段, 它们将并行执行。 注意，一个阶段必须只有一个 steps 或 parallel的阶段。 嵌套阶段本身不能包含 进一步的 parallel 阶段, 但是其他的阶段的行为与任何其他 stageparallel 的阶段不能包含 agent 或 tools阶段, 因为他们没有相关 steps。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" stage('Parallel Stage') {\n    when {\n        branch 'master'\n    }\n    failFast true\n    parallel {\n        stage('Branch A') {\n            agent {\n                label \"for-branch-a\"\n            }\n            steps {\n                echo \"On Branch A\"\n            }\n        }\n        stage('Branch B') {\n            agent {\n                label \"for-branch-b\"\n            }\n            steps {\n                echo \"On Branch B\"\n            }\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("failFast true 当其中一个进程失败时，强制所有的 parallel 阶段都被终止。")]),s._v(" "),a("h2",{attrs:{id:"script脚本标签"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#script脚本标签"}},[s._v("#")]),s._v(" script脚本标签")]),s._v(" "),a("p",[s._v("在声明式的pipeline中默认无法使用脚本语法，但是pipeline提供了一个脚本环境入口：script{},通过使用script来包裹脚本语句，即可使用脚本语法")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pipeline {\n    agent any\n    stages {\n        stage('stage 1') {\n            steps {\n                script{\n                    try {\n                        sh 'exit 1'\n                    }\n                    catch (exc) {\n                        echo 'Something failed'\n                        \n                    }\n                }\n            }\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h2",{attrs:{id:"参考文章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[s._v("#")]),s._v(" 参考文章")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://docs.idevops.site/jenkins/pipelinesyntax/chapter02/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Jenkins 流水线语法 | 泽阳"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/f1167e8850cd",target:"_blank",rel:"noopener noreferrer"}},[s._v("jenkins pipeline基础语法与示例 | MR_Hanjc | 简书"),a("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=t.exports}}]);
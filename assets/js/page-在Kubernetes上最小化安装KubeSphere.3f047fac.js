(window.webpackJsonp=window.webpackJsonp||[]).push([[327],{1002:function(e,s,t){"use strict";t.r(s);var r=t(1),a=Object(r.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"在-kubernetes-上最小化安装-kubesphere"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-kubernetes-上最小化安装-kubesphere"}},[e._v("#")]),e._v(" 在 Kubernetes 上最小化安装 KubeSphere")]),e._v(" "),t("h2",{attrs:{id:"前提条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[e._v("#")]),e._v(" 前提条件")]),e._v(" "),t("ul",[t("li",[e._v("如需在 Kubernetes 上安装 KubeSphere v3.1.1，您的 Kubernetes 版本必须为：1.17.x、1.18.x、1.19.x 或 1.20.x。")]),e._v(" "),t("li",[e._v("确保您的机器满足最低硬件要求：CPU > 1 核，内存 > 2 GB。")]),e._v(" "),t("li",[e._v("在安装之前，需要配置 Kubernetes 集群中的"),t("strong",[e._v("默认")]),e._v("存储类型。")])]),e._v(" "),t("p",[t("strong",[e._v("改变默认 StorageClass")])]),e._v(" "),t("p",[e._v("存储我们选用ceph，安装详见 "),t("a",{attrs:{href:"https://clay-wangzhi.com/cloudnative/kubernetes/deploy-ceph-cluster-with-rook/",target:"_blank",rel:"noopener noreferrer"}},[e._v("这里"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("kubectl patch storageclass rook-cephfs  -p "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'')]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("blockquote",[t("p",[e._v("不建议您在生产环境中使用 NFS 存储（尤其是在 Kubernetes 1.20 或以上版本），这可能会引起 "),t("code",[e._v("failed to obtain lock")]),e._v(" 和 "),t("code",[e._v("input/output error")]),e._v(" 等问题，从而导致 Pod "),t("code",[e._v("CrashLoopBackOff")]),e._v("。此外，部分应用不兼容 NFS，例如 "),t("a",{attrs:{href:"https://github.com/prometheus/prometheus/blob/03b354d4d9386e4b3bfbcd45da4bb58b182051a5/docs/storage.md#operational-aspects",target:"_blank",rel:"noopener noreferrer"}},[e._v("Prometheus"),t("OutboundLink")],1),e._v(" 等。")])]),e._v(" "),t("h2",{attrs:{id:"部署-kubesphere"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署-kubesphere"}},[e._v("#")]),e._v(" 部署 KubeSphere")]),e._v(" "),t("p",[e._v("确保您的机器满足安装的前提条件之后，可以按照以下步骤安装 KubeSphere。")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("执行以下命令开始安装：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.1.1/kubesphere-installer.yaml\n   \nkubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.1.1/cluster-configuration.yaml\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("检查安装日志：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app=ks-install -o jsonpath='{.items[0].metadata.name}') -f\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("使用 "),t("code",[e._v("kubectl get pod --all-namespaces")]),e._v(" 查看所有 Pod 是否在 KubeSphere 的相关命名空间中正常运行。如果是，请通过以下命令检查控制台的端口（默认为 "),t("code",[e._v("30880")]),e._v("）：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("kubectl get svc/ks-console -n kubesphere-system\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("确保在安全组中打开了端口 "),t("code",[e._v("30880")]),e._v("，并通过 NodePort "),t("code",[e._v("(IP:30880)")]),e._v(" 使用默认帐户和密码 "),t("code",[e._v("(admin/P@88w0rd)")]),e._v(" 访问 Web 控制台。")])]),e._v(" "),t("li",[t("p",[e._v("登录控制台后，您可以在"),t("strong",[e._v("服务组件")]),e._v("中检查不同组件的状态。如果要使用相关服务，可能需要等待某些组件启动并运行。")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://kubesphere.com.cn/images/docs/zh-cn/quickstart/minimal-kubesphere-on-k8s/kubesphere-components.png",alt:"kubesphere-components"}})])])]),e._v(" "),t("h2",{attrs:{id:"问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[e._v("#")]),e._v(" 问题")]),e._v(" "),t("p",[e._v("错误信息：")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Error creating: pods “ks-console-5576fccbb8-” is forbidden: error looking up service account kubesphere-system/kubesphere: serviceaccount “kubesphere” not found\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("解决办法：")]),e._v(" "),t("p",[e._v("用https://github.com/kubesphere/ks-installer/blob/master/scripts/kubesphere-delete.sh 这个脚本卸载")]),e._v(" "),t("p",[e._v("不能直接 "),t("code",[e._v("delete -f")])]),e._v(" "),t("h2",{attrs:{id:"参考链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[e._v("#")]),e._v(" 参考链接")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://kubesphere.com.cn/docs/quick-start/minimal-kubesphere-on-k8s/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在 Kubernetes 上最小化安装 KubeSphere | KubeSphere官网"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://kubesphere.com.cn/forum/d/4519-kubesphere-ks-apiserver-rs",target:"_blank",rel:"noopener noreferrer"}},[e._v("重现安装kubesphere 时候 ks-apiserver 的 rs 报错 | 开发者社区"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://kubernetes.io/zh/docs/tasks/administer-cluster/change-default-storage-class/",target:"_blank",rel:"noopener noreferrer"}},[e._v("改变默认 StorageClass | kubernetes官网"),t("OutboundLink")],1)])])])])}),[],!1,null,null,null);s.default=a.exports}}]);
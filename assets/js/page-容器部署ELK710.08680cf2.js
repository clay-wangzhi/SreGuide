(window.webpackJsonp=window.webpackJsonp||[]).push([[269],{1177:function(s,a,n){"use strict";n.r(a);var e=n(1),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"容器部署elk7-10"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器部署elk7-10"}},[s._v("#")]),s._v(" 容器部署ELK7.10")]),s._v(" "),n("blockquote",[n("p",[s._v("转载自 YP小站")])]),s._v(" "),n("h2",{attrs:{id:"一、elk架构简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一、elk架构简介"}},[s._v("#")]),s._v(" 一、elk架构简介")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/640.png",alt:"640"}})]),s._v(" "),n("ul",[n("li",[s._v("首先 "),n("code",[s._v("logstash")]),s._v(" 具有日志采集、过滤、筛选等功能，功能完善但同时体量也会比较大，消耗系统资源自然也多。"),n("code",[s._v("filebeat")]),s._v("作为一个轻量级日志采集工具，虽然没有过滤筛选功能，但是仅仅部署在应用服务器作为我们采集日志的工具可以是说最好的选择。但我们有些时候可能又需要logstash的过滤筛选功能，所以我们在采集日志时用filebeat，然后交给logstash过滤筛选。")]),s._v(" "),n("li",[s._v("其次，logstash的吞吐量是有限的，一旦短时间内filebeat传过来的日志过多会产生堆积和堵塞，对日志的采集也会受到影响，所以在filebeat与logstash中间又加了一层"),n("code",[s._v("kafka")]),s._v("消息队列来缓存或者说解耦，当然redis也是可以的。这样当众多filebeat节点采集大量日志直接放到kafka中，logstash慢慢的进行消费，两边互不干扰。")]),s._v(" "),n("li",[s._v("至于"),n("code",[s._v("zookeeper")]),s._v("，分布式服务管理神器，监控管理kafka的节点注册，"),n("code",[s._v("topic")]),s._v("管理等，同时弥补了kafka集群节点对外界无法感知的问题，kafka实际已经自带了zookeeper，这里将会使用独立的zookeeper进行管理，方便后期zookeeper集群的扩展。")])]),s._v(" "),n("h2",{attrs:{id:"二、环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二、环境"}},[s._v("#")]),s._v(" 二、环境")]),s._v(" "),n("ul",[n("li",[s._v("SUNCAR私有云：5台部署ES节点，3台分别部署logstash、kafka、zookeeper和kibana等服务。")]),s._v(" "),n("li",[s._v("SUNCAR私有云配置：5台 4核16G SSD磁盘。3台 4核16G SSD磁盘。都是 Centos7.6系统")]),s._v(" "),n("li",[s._v("安装 docker 和 docker-compose")]),s._v(" "),n("li",[s._v("ELK版本7.10.1；zookeeper版本3.6.2；kafka版本2.13-2.6.0；")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[s._v("IP地址")]),s._v(" "),n("th",{staticStyle:{"text-align":"left"}},[s._v("主机名称")]),s._v(" "),n("th",{staticStyle:{"text-align":"left"}},[s._v("用途")])])]),s._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.134.6")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es-master1")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es master 和 es 数据节点")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.134.103")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es-master2")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es master 和 es 数据节点")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.134.168")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es-master3")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es master 和 es 数据节点")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.134.240")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es-data1")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es数据节点")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.134.185")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es-data2")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("es数据节点")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.134.162")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("logstash1")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("logstash、kafka、zookeeper")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.134.186")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("logstash2")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("logstash、kafka、zookeeper")])]),s._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[s._v("192.168.134.40")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("logstash3")]),s._v(" "),n("td",{staticStyle:{"text-align":"left"}},[s._v("logstash、kafka、kafa-manager、zookeeper、kibana、curator")])])])]),s._v(" "),n("h2",{attrs:{id:"三、系统参数优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三、系统参数优化"}},[s._v("#")]),s._v(" 三、系统参数优化")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 最大用户打开进程数\n$ vim /etc/security/limits.d/20-nproc.conf\n\n*           soft   nproc       65535\n*           hard   nproc       65535\n\n# 优化内核，用于 docker 支持\n$ modprobe br_netfilter\n$ cat <<EOF >  /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nnet.ipv4.ip_forward = 1\nEOF\n$ sysctl -p /etc/sysctl.d/k8s.conf\n\n# 优化内核，对 es 支持\n$ echo 'vm.max_map_count=262144' >> /etc/sysctl.conf\n\n# 生效配置\n$ sysctl -p\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h2",{attrs:{id:"四、部署-docker-和-docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四、部署-docker-和-docker-compose"}},[s._v("#")]),s._v(" 四、部署 docker 和 docker-compose")]),s._v(" "),n("h3",{attrs:{id:"部署-docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署-docker"}},[s._v("#")]),s._v(" 部署 docker")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 安装必要的一些系统工具\n$ yum install -y yum-utils device-mapper-persistent-data lvm2\n\n# 添加软件源信息\n$ yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n# 更新并安装 Docker-CE\n$ yum makecache fast\n$ yum -y install docker-ce\n\n# 配置docker\n$ systemctl enable docker\n$ systemctl start docker\n$ vim /etc/docker/daemon.json\n{"data-root": "/var/lib/docker", "bip": "10.50.0.1/16", "default-address-pools": [{"base": "10.51.0.1/16", "size": 24}], "registry-mirrors": ["https://4xr1qpsp.mirror.aliyuncs.com"], "log-opts": {"max-size":"500m", "max-file":"3"}}\n$ sed  -i \'/ExecStart=/i ExecStartPost=\\/sbin\\/iptables -P FORWARD ACCEPT\' /usr/lib/systemd/system/docker.service\n$ systemctl enable docker.service\n$ systemctl daemon-reload\n$ systemctl restart docker\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h3",{attrs:{id:"部署-docker-compose"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署-docker-compose"}},[s._v("#")]),s._v(" 部署 docker-compose")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 安装 docker-compose\n$ sudo curl -L "https://github.com/docker/compose/releases/download/1.27.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n$ chmod +x /usr/local/bin/docker-compose\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"五、部署-es"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五、部署-es"}},[s._v("#")]),s._v(" 五、部署 ES")]),s._v(" "),n("h3",{attrs:{id:"es-master1-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es-master1-操作"}},[s._v("#")]),s._v(" es-master1 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 创建 es 目录\n$ mkdir -p /data/ELKStack\n$ cd /data/ELKStack\n$ mkdir elasticsearch elasticsearch-data elasticsearch-plugins\n\n# 容器es用户 uid 和 gid 都是 1000\n$ chown 1000.1000 elasticsearch-data elasticsearch-plugins\n\n# 临时启动一个es\n$ docker run --name es-test -it --rm elasticsearch:7.10.1 bash\n\n# 生成证书，证书有效期10年，证书输入的密码这里为空\n$ bin/elasticsearch-certutil ca --days 3660\n$ bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12 --days 3660\n\n# 打开新的窗口，拷贝生成的证书\n$ cd /data/ELKStack/elasticsearch\n$ mkdir es-p12\n$ docker cp es-test:/usr/share/elasticsearch/elastic-certificates.p12 ./es-p12\n$ docker cp es-test:/usr/share/elasticsearch/elastic-stack-ca.p12 ./es-p12\n$ chown -R 1000.1000 ./es-p12\n\n# 创建 docker-compose.yml\n$ vim docker-compose.yml\n\nversion: \'2.2\'\nservices:\n  elasticsearch:\n    image: elasticsearch:7.10.1\n    container_name: es01\n    environment:\n      - cluster.name=es-docker-cluster\n      - cluster.initial_master_nodes=192.168.134.6,192.168.134.103,192.168.134.168\n      - bootstrap.memory_lock=true\n      - "ES_JAVA_OPTS=-Xms10000m -Xmx10000m"\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n      nofile:\n        soft: 65536\n        hard: 65536\n    mem_limit: 13000m\n    cap_add:\n      - IPC_LOCK\n    restart: always\n    # 设置 docker host 网络模式\n    network_mode: "host"\n    volumes:\n       - /data/ELKStack/elasticsearch-data:/usr/share/elasticsearch/data\n       - /data/ELKStack/elasticsearch-plugins:/usr/share/elasticsearch/plugins\n       - /data/ELKStack/elasticsearch/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml\n       - /data/ELKStack/elasticsearch/es-p12:/usr/share/elasticsearch/config/es-p12\n\n# 创建 elasticsearch.yml 配置文件\n$ vim elasticsearch.yml\n\ncluster.name: "es-docker-cluster"\nnode.name: "es01"\nnetwork.host: 0.0.0.0\n\nnode.master: true\nnode.data: true\n\ndiscovery.zen.minimum_master_nodes: 2\nhttp.port: 9200\ntransport.tcp.port: 9300\n\n# 如果是多节点es，通过ping来健康检查\ndiscovery.zen.ping.unicast.hosts: ["192.168.134.6:9300", "192.168.134.103:9300", "192.168.134.168:9300", "192.168.134.240:9300", "192.168.134.185:9300"]\ndiscovery.zen.fd.ping_timeout: 120s\ndiscovery.zen.fd.ping_retries: 6\ndiscovery.zen.fd.ping_interval: 10s\n\ncluster.info.update.interval: 1m\nindices.fielddata.cache.size:  20%\nindices.breaker.fielddata.limit: 40%\nindices.breaker.request.limit: 40%\nindices.breaker.total.limit: 70%\nindices.memory.index_buffer_size: 20%\nscript.painless.regex.enabled: true\n\n# 磁盘分片分配\ncluster.routing.allocation.disk.watermark.low: 100gb\ncluster.routing.allocation.disk.watermark.high: 50gb\ncluster.routing.allocation.disk.watermark.flood_stage: 30gb\n\n# 本地数据分片恢复配置\ngateway.recover_after_nodes: 3\ngateway.recover_after_time: 5m\ngateway.expected_nodes: 3\ncluster.routing.allocation.node_initial_primaries_recoveries: 8\ncluster.routing.allocation.node_concurrent_recoveries: 2\n\n# 允许跨域请求\nhttp.cors.enabled: true\nhttp.cors.allow-origin: "*"\nhttp.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type\n\n# 开启xpack\nxpack.security.enabled: true\nxpack.monitoring.collection.enabled: true\n\n# 开启集群中https传输\nxpack.security.transport.ssl.enabled: true\nxpack.security.transport.ssl.verification_mode: certificate\nxpack.security.transport.ssl.keystore.path: es-p12/elastic-certificates.p12\nxpack.security.transport.ssl.truststore.path: es-p12/elastic-certificates.p12\n\n# 把 es 配置使用 rsync 同步到其它 es 节点\n$ rsync -avp -e ssh /data/ELKStack 192.168.134.103:/data/\n$ rsync -avp -e ssh /data/ELKStack 192.168.134.168:/data/\n$ rsync -avp -e ssh /data/ELKStack 192.168.134.240:/data/\n$ rsync -avp -e ssh /data/ELKStack 192.168.134.185:/data/\n\n# 启动 es\n$ docker-compose up -d\n\n# 查看 es\n$ docker-compose ps\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br")])]),n("blockquote",[n("p",[s._v("注意：磁盘分片分配参数，确定数据目录的磁盘空间大于"),n("code",[s._v("cluster.routing.allocation.disk.watermark.low")]),s._v("的值")])]),s._v(" "),n("h3",{attrs:{id:"es-master2-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es-master2-操作"}},[s._v("#")]),s._v(" es-master2 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cd /data/ELKStack/elasticsearch\n\n# 修改 docker-compose.yml elasticsearch.yml 两个配置\n$ sed -i 's/es01/es02/g' docker-compose.yml elasticsearch.yml\n\n# 启动 es\n$ docker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"es-master3-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es-master3-操作"}},[s._v("#")]),s._v(" es-master3 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cd /data/ELKStack/elasticsearch\n\n# 修改 docker-compose.yml elasticsearch.yml 两个配置\n$ sed -i 's/es01/es03/g' docker-compose.yml elasticsearch.yml\n\n# 启动 es\n$ docker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h3",{attrs:{id:"es-data1-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es-data1-操作"}},[s._v("#")]),s._v(" es-data1 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cd /data/ELKStack/elasticsearch\n\n# 修改 docker-compose.yml elasticsearch.yml 两个配置\n$ sed -i 's/es01/es04/g' docker-compose.yml elasticsearch.yml\n\n# 不做为 es master 节点，只做数据节点\n$ sed -i 's/node.master: true/node.master: false/g' elasticsearch.yml\n\n# 启动 es\n$ docker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"es-data2-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#es-data2-操作"}},[s._v("#")]),s._v(" es-data2 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cd /data/ELKStack/elasticsearch\n\n# 修改 docker-compose.yml elasticsearch.yml 两个配置\n$ sed -i 's/es01/es05/g' docker-compose.yml elasticsearch.yml\n\n# 不做为 es master 节点，只做数据节点\n$ sed -i 's/node.master: true/node.master: false/g' elasticsearch.yml\n\n# 启动 es\n$ docker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"设置-es-访问账号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设置-es-访问账号"}},[s._v("#")]),s._v(" 设置 es 访问账号")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# es-master1 操作\n$ docker exec -it es01 bash\n\n# 设置 elastic，apm_system，kibana，kibana_system，logstash_system，beats_system，remote_monitoring_user 等密码\n# 密码都设置为 elastic123，这里只是举例，具体根据需求设置\n$ ./bin/elasticsearch-setup-passwords interactive\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"六、部署-kibana"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六、部署-kibana"}},[s._v("#")]),s._v(" 六、部署 Kibana")]),s._v(" "),n("h3",{attrs:{id:"logstash3-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash3-操作"}},[s._v("#")]),s._v(" logstash3 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ mkdir -p /data/ELKStack/kibana\n$ cd /data/ELKStack/kibana\n\n# 创建 kibana 相关目录，用于容器挂载\n$ mkdir config data plugins\n$ chown 1000.1000 config data plugins\n\n# 创建 docker-compose.yml\n$ vim docker-compose.yml\n\nversion: \'2\'\nservices:\n  kibana:\n    image: docker.elastic.co/kibana/kibana:7.10.1\n    container_name: kibana\n    restart: always\n    network_mode: "bridge"\n    mem_limit: 2000m\n    environment:\n      SERVER_NAME: kibana.example.com\n    ports:\n      - "5601:5601"\n    volumes:\n       - /data/ELKStack/kibana/config:/usr/share/kibana/config\n       - /data/ELKStack/kibana/data:/usr/share/kibana/data\n       - /data/ELKStack/kibana/plugins:/usr/share/kibana/plugins\n\n# 创建 kibana.yml\n$ vim config/kibana.yml\n\nserver.name: kibana\nserver.host: "0"\nelasticsearch.hosts: ["http://192.168.134.6:9200","http://192.168.134.103:9200","http://192.168.134.168:9200"]\nelasticsearch.username: "kibana"\nelasticsearch.password: "elastic123"\nmonitoring.ui.container.elasticsearch.enabled: true\nxpack.security.enabled: true\nxpack.encryptedSavedObjects.encryptionKey: encryptedSavedObjects12345678909876543210\nxpack.security.encryptionKey: encryptionKeysecurity12345678909876543210\nxpack.reporting.encryptionKey: encryptionKeyreporting12345678909876543210\ni18n.locale: "zh-CN"\n\n# 启动 kibana\n$ docker-compose up -d\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("h2",{attrs:{id:"七、部署-zookeeper"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#七、部署-zookeeper"}},[s._v("#")]),s._v(" 七、部署 Zookeeper")]),s._v(" "),n("h3",{attrs:{id:"logstash1-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash1-操作"}},[s._v("#")]),s._v(" logstash1 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 创建 zookeeper 目录\n$ mkdir -p /data/ELKStack/zookeeper\n$ cd /data/ELKStack/zookeeper\n$ mkdir data datalog\n$ chown 1000.1000 data datalog\n\n# 创建 docker-compose.yml\n$ vim docker-compose.yml\n\nversion: '2'\nservices:\n  zoo1:\n    image: zookeeper:3.6.2\n    restart: always\n    hostname: zoo1\n    container_name: zoo1\n    network_mode: \"bridge\"\n    mem_limit: 2000m\n    ports:\n      - 2181:2181\n      - 3888:3888\n      - 2888:2888\n    volumes:\n      - /data/ELKStack/zookeeper/data:/data\n      - /data/ELKStack/zookeeper/datalog:/datalog\n      - /data/ELKStack/zookeeper/zoo.cfg:/conf/zoo.cfg\n    environment:\n      ZOO_MY_ID: 1  # 表示 ZK服务的 id, 它是1-255 之间的整数, 必须在集群中唯一\n      ZOO_SERVERS: server.1=0.0.0.0:2888:3888;2181 server.2=192.168.134.186:2888:3888;2181 server.3=192.168.134.40:2888:3888;2181\n      # ZOOKEEPER_CLIENT_PORT: 2181\n\n# 创建 zoo.cfg 配置\n$ vim zoo.cfg\n\ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/data\ndataLogDir=/datalog\nautopurge.snapRetainCount=3\nautopurge.purgeInterval=1\nmaxClientCnxns=60\nserver.1= 0.0.0.0:2888:3888;2181\nserver.2= 192.168.134.186:2888:3888;2181\nserver.3= 192.168.134.40:2888:3888;2181\n\n# 拷贝配置到 logstash2 logstash3 机器上\n$ rsync -avp -e ssh /data/ELKStack 192.168.134.186:/data/\n$ rsync -avp -e ssh /data/ELKStack 192.168.134.40:/data/\n\n# 启动 zookeeper\n$ docker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br")])]),n("h3",{attrs:{id:"logstash2-操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash2-操作"}},[s._v("#")]),s._v(" logstash2 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cd /data/ELKStack/zookeeper\n\n# 修改 docker-compose.yml 文件\n$ vim docker-compose.yml\n\nversion: '2'\nservices:\n  zoo2:\n    image: zookeeper:3.6.2\n    restart: always\n    hostname: zoo2\n    container_name: zoo2\n    network_mode: \"bridge\"\n    mem_limit: 2000m\n    ports:\n      - 2181:2181\n      - 3888:3888\n      - 2888:2888\n    volumes:\n      - /data/ELKStack/zookeeper/data:/data\n      - /data/ELKStack/zookeeper/datalog:/datalog\n      - /data/ELKStack/zookeeper/zoo.cfg:/conf/zoo.cfg\n    environment:\n      ZOO_MY_ID: 2  # 表示 ZK服务的 id, 它是1-255 之间的整数, 必须在集群中唯一\n      ZOO_SERVERS: server.1=192.168.134.162:2888:3888;2181 server.2=0.0.0.0:2888:3888;2181 server.3=192.168.134.40:2888:3888;2181\n      # ZOOKEEPER_CLIENT_PORT: 2181\n\n# 修改 zoo.cfg\n$ vim zoo.cfg\n\ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/data\ndataLogDir=/datalog\nautopurge.snapRetainCount=3\nautopurge.purgeInterval=1\nmaxClientCnxns=60\nserver.1= 192.168.134.162:2888:3888;2181\nserver.2= 0.0.0.0:2888:3888;2181\nserver.3= 192.168.134.40:2888:3888;2181\n\n# 启动 zookeeper\n$ docker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("h3",{attrs:{id:"logstash3-操作-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash3-操作-2"}},[s._v("#")]),s._v(" logstash3 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cd /data/ELKStack/zookeeper\n\n# 修改 docker-compose.yml 文件\n$ vim docker-compose.yml\n\nversion: '2'\nservices:\n  zoo3:\n    image: zookeeper:3.6.2\n    restart: always\n    hostname: zoo3\n    container_name: zoo3\n    network_mode: \"bridge\"\n    mem_limit: 2000m\n    ports:\n      - 2181:2181\n      - 3888:3888\n      - 2888:2888\n    volumes:\n      - /data/ELKStack/zookeeper/data:/data\n      - /data/ELKStack/zookeeper/datalog:/datalog\n      - /data/ELKStack/zookeeper/zoo.cfg:/conf/zoo.cfg\n    environment:\n      ZOO_MY_ID: 3  # 表示 ZK服务的 id, 它是1-255 之间的整数, 必须在集群中唯一\n      ZOO_SERVERS: server.1=192.168.134.162:2888:3888;2181 server.2=192.168.134.186:2888:3888;2181 server.3=0.0.0.0:2888:3888;2181\n      # ZOOKEEPER_CLIENT_PORT: 2181\n\n# 修改 zoo.cfg\n$ vim zoo.cfg\n\ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/data\ndataLogDir=/datalog\nautopurge.snapRetainCount=3\nautopurge.purgeInterval=1\nmaxClientCnxns=60\nserver.1= 192.168.134.162:2888:3888;2181\nserver.2= 192.168.134.186:2888:3888;2181\nserver.3= 0.0.0.0:2888:3888;2181\n\n# 启动 zookeeper\n$ docker-compose up -d\n\n# 操作 zookeeper\n$ docker exec -it zoo3 bash\n$ zkCli.sh -server 192.168.134.162:2181,192.168.134.186:2181,192.168.134.40:2181\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br")])]),n("h2",{attrs:{id:"八、部署-kafka"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#八、部署-kafka"}},[s._v("#")]),s._v(" 八、部署 Kafka")]),s._v(" "),n("h3",{attrs:{id:"logstash1-操作-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash1-操作-2"}},[s._v("#")]),s._v(" logstash1 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 创建 kafka 目录\n$ mkdir -p /data/ELKStack/kafka\n$ cd /data/ELKStack/kafka\n\n# 创建数据目录，用于存储kafka容器数据\n$ mkdir data\n\n# 把kafka配置拷贝到宿主机上\n$ docker run --name kafka-test -it --rm wurstmeister/kafka:2.13-2.6.0 bash\n$ cd /opt/kafka\n$ tar zcvf /tmp/config.tar.gz config\n\n# 打开一个新的窗口\n$ cd /data/ELKStack/kafka/\n$ docker cp kafka-test:/tmp/config.tar.gz ./\n\n# 解压配置文件\n$ tar xf config.tar.gz\n\n# 创建 docker-compose.yml\n$ vim docker-compose.yml\n\nversion: \'2\'\n\nservices:\n  kafka1:\n    image: wurstmeister/kafka:2.13-2.6.0\n    restart: always\n    hostname: kafka1\n    container_name: kafka1\n    network_mode: "bridge"\n    mem_limit: 5120m\n    ports:\n    - 9092:9092\n    - 9966:9966\n    environment:\n      KAFKA_BROKER_ID: 1\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.134.162:9092       # 宿主机的IP地址而非容器的IP，及暴露出来的端口\n      KAFKA_ADVERTISED_HOST_NAME: 192.168.134.162                        # 外网访问地址\n      KAFKA_ADVERTISED_PORT: 9092                                      # 端口\n      KAFKA_ZOOKEEPER_CONNECT: 192.168.134.162:2181,192.168.134.186:2181,192.168.134.40:2181           # 连接的zookeeper服务及端口\n      KAFKA_JMX_OPTS: "-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.134.162 -Dcom.sun.management.jmxremote.rmi.port=9966"\n      JMX_PORT: 9966 # kafka需要监控broker和topic的数据的时候,是需要开启jmx_port的\n      KAFKA_HEAP_OPTS: "-Xmx4096M -Xms4096M"\n    volumes:\n    - /data/ELKStack/kafka/data:/kafka                    # kafka数据文件存储目录\n    - /data/ELKStack/kafka/config:/opt/kafka/config\n\n# 优化 kafka server.properties 配置\n$ vim config/server.properties\n\n# 调大socket，防止报错\nsocket.send.buffer.bytes=1024000\nsocket.receive.buffer.bytes=1024000\nsocket.request.max.bytes=1048576000\n\n# topic 数据保留多久，默认168小时(7day)\nlog.retention.hours=72\nlog.cleanup.policy=delete\n\n# 拷贝配置到 logstash2 logstash3 机器上\n$ rsync -avp -e ssh /data/ELKStack/kafka 192.168.134.186:/data/ELKStack/\n$ rsync -avp -e ssh /data/ELKStack/kafka 192.168.134.40:/data/ELKStack/\n\n# 启动 kafka\n$ docker-compose up -d\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br")])]),n("h3",{attrs:{id:"logstash2-操作-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash2-操作-2"}},[s._v("#")]),s._v(" logstash2 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ cd /data/ELKStack/kafka\n\n# 修改 docker-compose.yml 文件\n$ vim docker-compose.yml\n\nversion: \'2\'\n\nservices:\n  kafka2:\n    image: wurstmeister/kafka:2.13-2.6.0\n    restart: always\n    hostname: kafka2\n    container_name: kafka2\n    network_mode: "bridge"\n    mem_limit: 5120m\n    ports:\n    - 9092:9092\n    - 9966:9966\n    environment:\n      KAFKA_BROKER_ID: 2\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.134.186:9092       # 宿主机的IP地址而非容器的IP，及暴露出来的端口\n      KAFKA_ADVERTISED_HOST_NAME: 192.168.134.186                        # 外网访问地址\n      KAFKA_ADVERTISED_PORT: 9092                                      # 端口\n      KAFKA_ZOOKEEPER_CONNECT: 192.168.134.162:2181,192.168.134.186:2181,192.168.134.40:2181           # 连接的zookeeper服务及端口\n      KAFKA_JMX_OPTS: "-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.134.186 -Dcom.sun.management.jmxremote.rmi.port=9966"\n      JMX_PORT: 9966  # kafka需要监控broker和topic的数据的时候,是需要开启jmx_port的\n      KAFKA_HEAP_OPTS: "-Xmx4096M -Xms4096M"\n    volumes:\n    - /data/ELKStack/kafka/data:/kafka                    # kafka数据文件存储目录\n    - /data/ELKStack/kafka/config:/opt/kafka/config\n\n# 启动 kafka\n$ docker-compose up -d\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("h3",{attrs:{id:"logstash3-操作-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash3-操作-3"}},[s._v("#")]),s._v(" logstash3 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ cd /data/ELKStack/kafka\n\n# 修改 docker-compose.yml 文件\n$ vim docker-compose.yml\n\nversion: \'2\'\n\nservices:\n  kafka3:\n    image: wurstmeister/kafka:2.13-2.6.0\n    restart: always\n    hostname: kafka3\n    container_name: kafka3\n    network_mode: "bridge"\n    mem_limit: 5120m\n    ports:\n    - 9092:9092\n    - 9966:9966\n    environment:\n      KAFKA_BROKER_ID: 3\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://192.168.134.40:9092       # 宿主机的IP地址而非容器的IP，及暴露出来的端口\n      KAFKA_ADVERTISED_HOST_NAME: 192.168.134.40                        # 外网访问地址\n      KAFKA_ADVERTISED_PORT: 9092                                      # 端口\n      KAFKA_ZOOKEEPER_CONNECT: 192.168.134.162:2181,192.168.134.186:2181,192.168.134.40:2181           # 连接的zookeeper服务及端口\n      KAFKA_JMX_OPTS: "-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=192.168.134.40 -Dcom.sun.management.jmxremote.rmi.port=9966"\n      JMX_PORT: 9966  # kafka需要监控broker和topic的数据的时候,是需要开启jmx_port的\n      KAFKA_HEAP_OPTS: "-Xmx4096M -Xms4096M"\n    volumes:\n    - /data/ELKStack/kafka/data:/kafka                    # kafka数据文件存储目录\n    - /data/ELKStack/kafka/config:/opt/kafka/config\n\n# 启动 kafka\n$ docker-compose up -d\n\n# 部署 kafka-manager 管理 kafka 平台\n$ mkdir /data/ELKStack/kafka-manager\n$ cd /data/ELKStack/kafka-manager\n$ vim docker-compose.yml\n\nversion: \'3.6\'\nservices:\n  kafka_manager:\n    restart: always\n    container_name: kafa-manager\n    hostname: kafka-manager\n    network_mode: "bridge"\n    mem_limit: 1024m\n    image: hlebalbau/kafka-manager:3.0.0.5-7e7a22e\n    ports:\n      - "9000:9000"\n    environment:\n      ZK_HOSTS: "192.168.134.162:2181,192.168.134.186:2181,192.168.134.40:2181"\n      APPLICATION_SECRET: "random-secret"\n      KAFKA_MANAGER_AUTH_ENABLED: "true"\n      KAFKA_MANAGER_USERNAME: admin\n      KAFKA_MANAGER_PASSWORD: elastic123\n      JMX_PORT: 9966\n      TZ: "Asia/Shanghai"\n\n# 启动 kafka-manager\n$ docker-compose up -d\n\n# 访问 http://192.168.134.40:9000 ，把上面创建的三台 kafka 加入管理，这里不在阐述，网上很多配置教程\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br")])]),n("h2",{attrs:{id:"九、部署-logstash"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#九、部署-logstash"}},[s._v("#")]),s._v(" 九、部署 logstash")]),s._v(" "),n("h3",{attrs:{id:"logstash1-操作-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash1-操作-3"}},[s._v("#")]),s._v(" logstash1 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('$ mkdir /data/ELKStack/logstash\n$ cd /data/ELKStack/logstash\n$ mkdir config data\n$ chown 1000.1000 config data\n\n# 创建 docker-compose.yml\n$ vim docker-compose.yml\n\nversion: \'2\'\nservices:\n  logstash1:\n    image: logstash:7.10.1\n    container_name: logstash1\n    hostname: logstash1\n    restart: always\n    network_mode: "bridge"\n    mem_limit: 4096m\n    environment:\n      TZ: "Asia/Shanghai"\n    ports:\n      - 5044:5044\n    volumes:\n      - /data/ELKStack/logstash/config:/config-dir\n      - /data/ELKStack/logstash/logstash.yml:/usr/share/logstash/config/logstash.yml\n      - /data/ELKStack/logstash/data:/usr/share/logstash/data\n      - /etc/localtime:/etc/localtime\n    user: logstash\n    command: bash -c "logstash -f /config-dir --config.reload.automatic"\n\n# 创建 logstash.yml\n$ vim logstash.yml\n\nhttp.host: "0.0.0.0"\n# 指发送到Elasticsearch的批量请求的大小，值越大，处理则通常更高效，但增加了内存开销\npipeline.batch.size: 3000\n# 指调整Logstash管道的延迟，过了该时间则logstash开始执行过滤器和输出\npipeline.batch.delay: 200\n\n# 创建 logstash 规则配置\n$ vim config/01-input.conf\n\ninput {                                        # 输入组件\n    kafka {                                    # 从kafka消费数据\n        bootstrap_servers => ["192.168.134.162:9092,192.168.134.186:9092,192.168.134.40:9092"]\n        #topics => "%{[@metadata][topic]}"     # 使用kafka传过来的topic\n        topics_pattern => "elk-.*"             # 使用正则匹配topic\n        codec => "json"                        # 数据格式\n        consumer_threads => 3                  # 消费线程数量\n        decorate_events => true                # 可向事件添加Kafka元数据，比如主题、消息大小的选项，这将向logstash事件中添加一个名为kafka的字段\n        auto_offset_reset => "latest"          # 自动重置偏移量到最新的偏移量\n        group_id => "logstash-node"            # 消费组ID，多个有相同group_id的logstash实例为一个消费组\n        client_id => "logstash1"               # 客户端ID\n        fetch_max_wait_ms => "1000"            # 指当没有足够的数据立即满足fetch_min_bytes时，服务器在回答fetch请求之前将阻塞的最长时间\n  }\n}\n\n$ vim config/02-output.conf\n\noutput {                                       # 输出组件\n    elasticsearch {\n        # Logstash输出到es\n        hosts => ["192.168.134.6:9200", "192.168.134.103:9200", "192.168.134.168:9200", "192.168.134.240:9200", "192.168.134.185:9200"]\n        index => "%{[fields][source]}-%{+YYYY-MM-dd}"      # 直接在日志中匹配，索引会去掉elk\n        # index => "%{[@metadata][topic]}-%{+YYYY-MM-dd}"  # 以日期建索引\n        user => "elastic"\n        password => "elastic123"\n    }\n    #stdout {\n    #    codec => rubydebug\n    #}\n}\n\n$ vim config/03-filter.conf\n\nfilter {\n   # 当非业务字段时，无traceId则移除\n   if ([message] =~ "traceId=null") {          # 过滤组件，这里只是展示，无实际意义，根据自己的业务需求进行过滤\n      drop {}\n   }\n}\n\n# 拷贝配置到 logstash2 logstash3 机器上\n$ rsync -avp -e ssh /data/ELKStack/logstash 192.168.134.186:/data/ELKStack/\n$ rsync -avp -e ssh /data/ELKStack/logstash 192.168.134.40:/data/ELKStack/\n\n# 启动 logstash\n$ docker-compose up -d\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br")])]),n("blockquote",[n("p",[n("code",[s._v("pipeline.batch")]),s._v(" 参数要看一下")])]),s._v(" "),n("h3",{attrs:{id:"logstash2-操作-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash2-操作-3"}},[s._v("#")]),s._v(" logstash2 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cd /data/ELKStack/logstash\n$ sed -i 's/logstash1/logstash2/g' docker-compose.yml\n$ sed -i 's/logstash1/logstash2/g' config/01-input.conf\n\n# 启动 logstash\n$ docker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"logstash3-操作-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash3-操作-4"}},[s._v("#")]),s._v(" logstash3 操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cd /data/ELKStack/logstash\n$ sed -i 's/logstash1/logstash3/g' docker-compose.yml\n$ sed -i 's/logstash1/logstash3/g' config/01-input.conf\n\n# 启动 logstash\n$ docker-compose up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"十、部署-filebeat"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十、部署-filebeat"}},[s._v("#")]),s._v(" 十、部署 filebeat")]),s._v(" "),n("blockquote",[n("p",[s._v("https://www.elastic.co/guide/en/logstash/current/use-filebeat-modules-kafka.html")]),s._v(" "),n("p",[s._v("以此链接为准")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 配置 filebeat yum源，这里以 centos7 为例\n$ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch\n\n$ vim /etc/yum.repos.d/elastic.repo\n\n[elastic-7.x]\nname=Elastic repository for 7.x packages\nbaseurl=https://artifacts.elastic.co/packages/7.x/yum\ngpgcheck=1\ngpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nautorefresh=1\ntype=rpm-md\n\n$ yum install -y filebeat-7.10.1\n$ systemctl enable filebeat\n\n# 配置\n$ cd /etc/filebeat/\n$ cp -a filebeat.yml filebeat.yml.old\n$ echo > filebeat.yml\n\n# 以收集nginx访问日志为例\n$ vim filebeat.yml\n\nfilebeat.inputs:                   # inputs为复数，表名type可以有多个\n- type: log                        # 输入类型\n  access:\n  enabled: true                    # 启用这个type配置\n  json.keys_under_root: true       # 默认这个值是FALSE的，也就是我们的json日志解析后会被放在json键上。设为TRUE，所有的keys就会被放到根节点\n  json.overwrite_keys: true        # 是否要覆盖原有的key，这是关键配置，将keys_under_root设为TRUE后，再将overwrite_keys也设为TRUE，就能把filebeat默认的key值给覆盖\n  max_bytes: 20480                 # 单条日志的大小限制,建议限制(默认为10M,queue.mem.events * max_bytes 将是占有内存的一部分)\n  paths:\n    - /var/log/nginx/access.log    # 监控nginx 的access日志\n\n  fields:                          # 额外的字段\n    source: nginx-access-prod      # 自定义source字段，用于es建议索引（字段名小写，我记得大写好像不行）\n\n# 自定义es的索引需要把ilm设置为false\nsetup.ilm.enabled: false\n\noutput.kafka:            # 输出到kafka\n  enabled: true          # 该output配置是否启用\n  hosts: ["192.168.134.162:9092", "192.168.134.186:9092", "192.168.134.40:9092"]  # kafka节点列表\n  topic: "elk-%{[fields.source]}"   # kafka会创建该topic，然后logstash(可以过滤修改)会传给es作为索引名称\n  partition.hash:\n    reachable_only: true # 是否只发往可达分区\n  compression: gzip      # 压缩\n  max_message_bytes: 1000000  # Event最大字节数。默认1000000。应小于等于kafka broker message.max.bytes值\n  required_acks: 1  # kafka ack等级\n  worker: 1  # kafka output的最大并发数\n  bulk_max_size: 2048    # 单次发往kafka的最大事件数\nlogging.to_files: true   # 输出所有日志到file，默认true， 达到日志文件大小限制时，日志文件会自动限制替换，详细配置：https://www.cnblogs.com/qinwengang/p/10982424.html\nclose_older: 30m         # 如果一个文件在某个时间段内没有发生过更新，则关闭监控的文件handle。默认1h\nforce_close_files: false # 这个选项关闭一个文件,当文件名称的变化。只在window建议为true\n\n# 没有新日志采集后多长时间关闭文件句柄，默认5分钟，设置成1分钟，加快文件句柄关闭\nclose_inactive: 1m\n\n# 传输了3h后荏没有传输完成的话就强行关闭文件句柄，这个配置项是解决以上案例问题的key point\nclose_timeout: 3h\n\n# 这个配置项也应该配置上，默认值是0表示不清理，不清理的意思是采集过的文件描述在registry文件里永不清理，在运行一段时间后，registry会变大，可能会带来问题\nclean_inactive: 72h\n\n# 设置了clean_inactive后就需要设置ignore_older，且要保证ignore_older < clean_inactive\nignore_older: 70h\n\n# 限制 CPU和内存资源\nmax_procs: 1 # 限制一个CPU核心,避免过多抢占业务资源\nqueue.mem.events: 256 # 存储于内存队列的事件数，排队发送 (默认4096)\nqueue.mem.flush.min_events: 128 # 小于 queue.mem.events ,增加此值可提高吞吐量 (默认值2048)\n\n# 启动 filebeat\n$ systemctl start filebeat\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br")])]),n("h2",{attrs:{id:"十一、部署-curator-定时清理es索引"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十一、部署-curator-定时清理es索引"}},[s._v("#")]),s._v(" 十一、部署 curator，定时清理es索引")]),s._v(" "),n("h3",{attrs:{id:"logstash3-机器操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#logstash3-机器操作"}},[s._v("#")]),s._v(" logstash3 机器操作")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 参考链接：https://www.elastic.co/guide/en/elasticsearch/client/curator/current/yum-repository.html\n\n# 安装 curator 服务，以 centos7 为例\n$ rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch\n\n$ vim /etc/yum.repos.d/elk-curator-5.repo\n\n[curator-5]\nname=CentOS/RHEL 7 repository for Elasticsearch Curator 5.x packages\nbaseurl=https://packages.elastic.co/curator/5/centos/7\ngpgcheck=1\ngpgkey=https://packages.elastic.co/GPG-KEY-elasticsearch\nenabled=1\n\n$ yum install elasticsearch-curator -y\n\n# 创建 curator 配置文件目录与输出日志目录\n$ mkdir -p /data/ELKStack/curator/logs\n$ cd /data/ELKStack/curator\n\n$ vim config.yml\n\n---\n# Remember, leave a key empty if there is no value.  None will be a string,\n# # not a Python \"NoneType\"\nclient:\n  hosts: [\"192.168.134.6\", \"192.168.134.103\", \"192.168.134.168\", \"192.168.134.240\", \"192.168.134.185\"]\n  port: 9200\n  url_prefix:\n  use_ssl: False\n  certificate:\n  client_cert:\n  client_key:\n  ssl_no_validate: False\n  http_auth: elastic:elastic123\n  timeout: 150\n  master_only: False\n\nlogging:\n  loglevel: INFO\n  logfile: /data/ELKStack/curator/logs/curator.log\n  logformat: default\n  blacklist: ['elasticsearch', 'urllib3']\n\n$ vim action.yml\n\n---\n# Remember, leave a key empty if there is no value.  None will be a string,\n# not a Python \"NoneType\"\n#\n# Also remember that all examples have 'disable_action' set to True.  If you\n# want to use this action as a template, be sure to set this to False after\n# copying it.\nactions:\n  1:\n    action: delete_indices\n    description: >-\n      Delete indices older than 30 days. Ignore the error if the filter does not result in an actionable list of indices (ignore_empty_list) and exit cleanly.\n    options:\n      ignore_empty_list: True\n      disable_action: False\n    filters:\n    - filtertype: pattern\n      kind: regex\n      value: '^((?!(kibana|json|monitoring|metadata|apm|async|transform|siem|security)).)*$'\n    - filtertype: age\n      source: creation_date\n      direction: older\n      #timestring: '%Yi-%m-%d'\n      unit: days\n      unit_count: 30\n  2:\n    action: delete_indices\n    description: >-\n      Delete indices older than 15 days. Ignore the error if the filter does not result in an actionable list of indices (ignore_empty_list) and exit cleanly.\n    options:\n      ignore_empty_list: True\n      disable_action: False\n    filters:\n    - filtertype: pattern\n      kind: regex\n      value: '^(nginx-).*$'\n    - filtertype: age\n      source: creation_date\n      direction: older\n      #timestring: '%Yi-%m-%d'\n      unit: days\n      unit_count: 15\n\n# 设置定时任务清理es索引\n$ crontab -e\n\n0 0 * * * /usr/bin/curator --config /data/ELKStack/curator/config.yml /data/ELKStack/curator/action.yml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br")])]),n("h2",{attrs:{id:"十二、参考链接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#十二、参考链接"}},[s._v("#")]),s._v(" 十二、参考链接")]),s._v(" "),n("ul",[n("li",[s._v("es证书配置：https://cloud.tencent.com/developer/article/1549834")]),s._v(" "),n("li",[s._v("es忘记密码找回：https://www.cnblogs.com/woshimrf/p/docker-es7.html")]),s._v(" "),n("li",[s._v("es设置密码：https://blog.csdn.net/extraordinarylife/article/details/107917764?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-2&spm=1001.2101.3001.4242")]),s._v(" "),n("li",[s._v("elk-kafka部署 1：https://www.codenong.com/cs106056710/")]),s._v(" "),n("li",[s._v("elk-kafka部署 2：https://www.cnblogs.com/lz0925/p/12061293.html")]),s._v(" "),n("li",[s._v("elk优化：https://www.clxz.top/2020/06/19/elk-kafka-optimization/")]),s._v(" "),n("li",[s._v("es7索引分片：https://www.elastic.co/guide/en/elasticsearch/reference/current/index-modules.html")]),s._v(" "),n("li",[s._v("filebeat优化：https://www.jianshu.com/p/389702465461")]),s._v(" "),n("li",[s._v("kafka数据与日志清理：https://blog.csdn.net/VIP099/article/details/106257561")])])])}),[],!1,null,null,null);a.default=t.exports}}]);
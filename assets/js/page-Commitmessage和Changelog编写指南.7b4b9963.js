(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{1169:function(s,a,e){"use strict";e.r(a);var t=e(1),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"commit-message-和-change-log-编写指南"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commit-message-和-change-log-编写指南"}},[s._v("#")]),s._v(" Commit message 和 Change log 编写指南")]),s._v(" "),e("p",[s._v("Git 每次提交代码，都要写 Commit message（提交说明），否则就不允许提交。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("p",[s._v("上面代码的"),e("code",[s._v("-m")]),s._v("参数，就是用来指定 commit mesage 的。")]),s._v(" "),e("p",[s._v("如果一行不够，可以只执行"),e("code",[s._v("git commit")]),s._v("，就会跳出文本编辑器，让你写多行。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("p",[s._v("但是，一般来说，commit message 应该清晰明了，说明本次提交的目的。")]),s._v(" "),e("p",[s._v("目前，社区有多种 Commit message 的"),e("a",{attrs:{href:"https://github.com/ajoslin/conventional-changelog/blob/master/conventions",target:"_blank",rel:"noopener noreferrer"}},[s._v("写法规范"),e("OutboundLink")],1),s._v("。本文介绍"),e("a",{attrs:{href:"https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#heading=h.greljkmo14y0",target:"_blank",rel:"noopener noreferrer"}},[s._v("Angular 规范"),e("OutboundLink")],1),s._v("（见上图），这是目前使用最广的写法，比较合理和系统化，并且有配套的工具。")]),s._v(" "),e("h2",{attrs:{id:"一、commit-message-的作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、commit-message-的作用"}},[s._v("#")]),s._v(" 一、Commit message 的作用")]),s._v(" "),e("p",[s._v("格式化的Commit message，有几个好处。")]),s._v(" "),e("p",[e("strong",[s._v("（1）提供更多的历史信息，方便快速浏览。")])]),s._v(" "),e("p",[s._v("比如，下面的命令显示上次发布后的变动，每个commit占据一行。你只看行首，就知道某次 commit 的目的。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" log "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("last tag"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" HEAD --pretty"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("format:%s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("p",[e("img",{attrs:{src:"http://www.ruanyifeng.com/blogimg/asset/2016/bg2016010604.png",alt:"img"}})]),s._v(" "),e("p",[e("strong",[s._v("（2）可以过滤某些commit（比如文档改动），便于快速查找信息。")])]),s._v(" "),e("p",[s._v("比如，下面的命令仅仅显示本次发布新增加的功能。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" log "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("last release"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" HEAD --grep feature\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("p",[e("strong",[s._v("（3）可以直接从commit生成Change log。")])]),s._v(" "),e("p",[s._v("Change Log 是发布新版本时，用来说明与上一个版本差异的文档，详见后文。")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://www.ruanyifeng.com/blogimg/asset/2016/bg2016010603.png",alt:"img"}})]),s._v(" "),e("h2",{attrs:{id:"二、commit-message-的格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、commit-message-的格式"}},[s._v("#")]),s._v(" 二、Commit message 的格式")]),s._v(" "),e("p",[s._v("每次提交，Commit message 都包括三个部分：Header，Body 和 Footer。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("type"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("scope"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("subject"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n// 空一行\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n// 空一行\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("footer"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])]),s._v(" "),e("p",[s._v("其中，Header 是必需的，Body 和 Footer 可以省略。")]),s._v(" "),e("p",[s._v("不管是哪一个部分，任何一行都不得超过72个字符（或100个字符）。这是为了避免自动换行影响美观。")]),s._v(" "),e("h3",{attrs:{id:"_2-1-header"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-header"}},[s._v("#")]),s._v(" 2.1 Header")]),s._v(" "),e("p",[s._v("Header部分只有一行，包括三个字段："),e("code",[s._v("type")]),s._v("（必需）、"),e("code",[s._v("scope")]),s._v("（可选）和"),e("code",[s._v("subject")]),s._v("（必需）。")]),s._v(" "),e("p",[e("strong",[s._v("（1）type")])]),s._v(" "),e("p",[e("code",[s._v("type")]),s._v("用于说明 commit 的类别，只允许使用下面7个标识。")]),s._v(" "),e("blockquote",[e("ul",[e("li",[s._v("feat：新功能（feature）")]),s._v(" "),e("li",[s._v("fix：修补bug")]),s._v(" "),e("li",[s._v("docs：文档（documentation）")]),s._v(" "),e("li",[s._v("style： 格式（不影响代码运行的变动）")]),s._v(" "),e("li",[s._v("refactor：重构（即不是新增功能，也不是修改bug的代码变动）")]),s._v(" "),e("li",[s._v("test：增加测试")]),s._v(" "),e("li",[s._v("chore：构建过程或辅助工具的变动")])])]),s._v(" "),e("p",[s._v("如果"),e("code",[s._v("type")]),s._v("为"),e("code",[s._v("feat")]),s._v("和"),e("code",[s._v("fix")]),s._v("，则该 commit 将肯定出现在 Change log 之中。其他情况（"),e("code",[s._v("docs")]),s._v("、"),e("code",[s._v("chore")]),s._v("、"),e("code",[s._v("style")]),s._v("、"),e("code",[s._v("refactor")]),s._v("、"),e("code",[s._v("test")]),s._v("）由你决定，要不要放入 Change log，建议是不要。")]),s._v(" "),e("p",[e("strong",[s._v("（2）scope")])]),s._v(" "),e("p",[e("code",[s._v("scope")]),s._v("用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。")]),s._v(" "),e("p",[e("strong",[s._v("（3）subject")])]),s._v(" "),e("p",[e("code",[s._v("subject")]),s._v("是 commit 目的的简短描述，不超过50个字符。")]),s._v(" "),e("blockquote",[e("ul",[e("li",[s._v("以动词开头，使用第一人称现在时，比如"),e("code",[s._v("change")]),s._v("，而不是"),e("code",[s._v("changed")]),s._v("或"),e("code",[s._v("changes")])]),s._v(" "),e("li",[s._v("第一个字母小写")]),s._v(" "),e("li",[s._v("结尾不加句号（"),e("code",[s._v(".")]),s._v("）")])])]),s._v(" "),e("h3",{attrs:{id:"_2-2-body"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-body"}},[s._v("#")]),s._v(" 2.2 Body")]),s._v(" "),e("p",[s._v("Body 部分是对本次 commit 的详细描述，可以分成多行。下面是一个范例。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("More detailed explanatory text, "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" necessary.  Wrap it to \nabout "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),s._v(" characters or so. \n\nFurther paragraphs come after blank lines.\n\n- Bullet points are okay, too\n- Use a hanging indent\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])])]),s._v(" "),e("p",[s._v("有两个注意点。")]),s._v(" "),e("p",[s._v("（1）使用第一人称现在时，比如使用"),e("code",[s._v("change")]),s._v("而不是"),e("code",[s._v("changed")]),s._v("或"),e("code",[s._v("changes")]),s._v("。")]),s._v(" "),e("p",[s._v("（2）应该说明代码变动的动机，以及与以前行为的对比。")]),s._v(" "),e("h3",{attrs:{id:"_2-3-footer"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-footer"}},[s._v("#")]),s._v(" 2.3 Footer")]),s._v(" "),e("p",[s._v("Footer 部分只用于两种情况。")]),s._v(" "),e("p",[e("strong",[s._v("（1）不兼容变动")])]),s._v(" "),e("p",[s._v("如果当前代码与上一个版本不兼容，则 Footer 部分以"),e("code",[s._v("BREAKING CHANGE")]),s._v("开头，后面是对变动的描述、以及变动理由和迁移方法。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("BREAKING CHANGE: isolate scope bindings definition has changed.\n\n    To migrate the code follow the example below:\n\n    Before:\n\n    scope: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      myAttr: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'attribute'")]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    After:\n\n    scope: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      myAttr: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@'")]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    The removed "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("inject"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" wasn't generaly useful "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" directives so there should be no code using it.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])])]),s._v(" "),e("p",[e("strong",[s._v("（2）关闭 Issue")])]),s._v(" "),e("p",[s._v("如果当前 commit 针对某个issue，那么可以在 Footer 部分关闭这个 issue 。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("Closes "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#234")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("p",[s._v("也可以一次关闭多个 issue 。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("Closes "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#123, #245, #992")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("h3",{attrs:{id:"_2-4-revert"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-revert"}},[s._v("#")]),s._v(" 2.4 Revert")]),s._v(" "),e("p",[s._v("还有一种特殊情况，如果当前 commit 用于撤销以前的 commit，则必须以"),e("code",[s._v("revert:")]),s._v("开头，后面跟着被撤销 Commit 的 Header。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("revert: feat"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pencil"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'graphiteWidth'")]),s._v(" option\n\nThis reverts commit 667ecc1654a317a13331b17617d973392f415f02.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])]),s._v(" "),e("p",[s._v("Body部分的格式是固定的，必须写成"),e("code",[s._v("This reverts commit <hash>.")]),s._v("，其中的"),e("code",[s._v("hash")]),s._v("是被撤销 commit 的 SHA 标识符。")]),s._v(" "),e("p",[s._v("如果当前 commit 与被撤销的 commit，在同一个发布（release）里面，那么它们都不会出现在 Change log 里面。如果两者在不同的发布，那么当前 commit，会出现在 Change log 的"),e("code",[s._v("Reverts")]),s._v("小标题下面。")]),s._v(" "),e("h2",{attrs:{id:"三、commitizen"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、commitizen"}},[s._v("#")]),s._v(" 三、Commitizen")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/commitizen/cz-cli",target:"_blank",rel:"noopener noreferrer"}},[s._v("Commitizen"),e("OutboundLink")],1),s._v("是一个撰写合格 Commit message 的工具。")]),s._v(" "),e("p",[s._v("安装命令如下。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g commitizen\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("p",[s._v("然后，在项目目录里，运行下面的命令，使其支持 Angular 的 Commit message 格式。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ commitizen init cz-conventional-changelog --save --save-exact\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("p",[s._v("以后，凡是用到"),e("code",[s._v("git commit")]),s._v("命令，一律改为使用"),e("code",[s._v("git cz")]),s._v("。这时，就会出现选项，用来生成符合格式的 Commit message。")]),s._v(" "),e("p",[e("img",{attrs:{src:"http://www.ruanyifeng.com/blogimg/asset/2016/bg2016010605.png",alt:"img"}})]),s._v(" "),e("h2",{attrs:{id:"四、validate-commit-msg"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、validate-commit-msg"}},[s._v("#")]),s._v(" 四、validate-commit-msg")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/kentcdodds/validate-commit-msg",target:"_blank",rel:"noopener noreferrer"}},[s._v("validate-commit-msg"),e("OutboundLink")],1),s._v(" 用于检查 Node 项目的 Commit message 是否符合格式。")]),s._v(" "),e("p",[s._v("它的安装是手动的。首先，拷贝下面这个"),e("a",{attrs:{href:"https://github.com/kentcdodds/validate-commit-msg/blob/master/index.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("JS文件"),e("OutboundLink")],1),s._v("，放入你的代码库。文件名可以取为"),e("code",[s._v("validate-commit-msg.js")]),s._v("。")]),s._v(" "),e("p",[s._v("接着，把这个脚本加入 Git 的 hook。下面是在"),e("code",[s._v("package.json")]),s._v("里面使用 "),e("a",{attrs:{href:"http://npm.im/ghooks",target:"_blank",rel:"noopener noreferrer"}},[s._v("ghooks"),e("OutboundLink")],1),s._v("，把这个脚本加为"),e("code",[s._v("commit-msg")]),s._v("时运行。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"config"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ghooks"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"commit-msg"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./validate-commit-msg.js"')]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])]),s._v(" "),e("p",[s._v("然后，每次"),e("code",[s._v("git commit")]),s._v("的时候，这个脚本就会自动检查 Commit message 是否合格。如果不合格，就会报错。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -A \n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"edit markdown"')]),s._v(" \nINVALID COMMIT MSG: does not match "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<type>(<scope>): <subject>"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" was: edit markdown\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])]),s._v(" "),e("h2",{attrs:{id:"五、生成-change-log"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、生成-change-log"}},[s._v("#")]),s._v(" 五、生成 Change log")]),s._v(" "),e("p",[s._v("如果你的所有 Commit 都符合 Angular 格式，那么发布新版本时， Change log 就可以用脚本自动生成（"),e("a",{attrs:{href:"https://github.com/ajoslin/conventional-changelog/blob/master/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("例1"),e("OutboundLink")],1),s._v("，"),e("a",{attrs:{href:"https://github.com/karma-runner/karma/blob/master/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("例2"),e("OutboundLink")],1),s._v("，"),e("a",{attrs:{href:"https://github.com/btford/grunt-conventional-changelog/blob/master/CHANGELOG.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("例3"),e("OutboundLink")],1),s._v("）。")]),s._v(" "),e("p",[s._v("生成的文档包括以下三个部分。")]),s._v(" "),e("blockquote",[e("ul",[e("li",[s._v("New features")]),s._v(" "),e("li",[s._v("Bug fixes")]),s._v(" "),e("li",[s._v("Breaking changes.")])])]),s._v(" "),e("p",[s._v("每个部分都会罗列相关的 commit ，并且有指向这些 commit 的链接。当然，生成的文档允许手动修改，所以发布前，你还可以添加其他内容。")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/ajoslin/conventional-changelog",target:"_blank",rel:"noopener noreferrer"}},[s._v("conventional-changelog"),e("OutboundLink")],1),s._v(" 就是生成 Change log 的工具，运行下面的命令即可。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g conventional-changelog\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" my-project\n$ conventional-changelog -p angular -i CHANGELOG.md -w\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])]),s._v(" "),e("p",[s._v("上面命令不会覆盖以前的 Change log，只会在"),e("code",[s._v("CHANGELOG.md")]),s._v("的头部加上自从上次发布以来的变动。")]),s._v(" "),e("p",[s._v("如果你想生成所有发布的 Change log，要改为运行下面的命令。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ conventional-changelog -p angular -i CHANGELOG.md -w -r "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("p",[s._v("为了方便使用，可以将其写入"),e("code",[s._v("package.json")]),s._v("的"),e("code",[s._v("scripts")]),s._v("字段。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-javascript line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scripts"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"changelog"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"conventional-changelog -p angular -i CHANGELOG.md -w -r 0"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])]),s._v(" "),e("p",[s._v("以后，直接运行下面的命令即可。")]),s._v(" "),e("blockquote",[e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run changelog\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("blockquote",[e("p",[s._v("转载自：阮一峰 Commit message 和 Change log 编写指南")]),s._v(" "),e("p",[s._v("https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html")])])])}),[],!1,null,null,null);a.default=n.exports}}]);
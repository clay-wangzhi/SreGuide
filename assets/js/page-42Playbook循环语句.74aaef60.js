(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{943:function(s,n,a){"use strict";a.r(n);var e=a(1),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_4-2-playbook循环语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-playbook循环语句"}},[s._v("#")]),s._v(" 4.2 Playbook循环语句")]),s._v(" "),a("h2",{attrs:{id:"_1-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[s._v("#")]),s._v(" 1 简介")]),s._v(" "),a("p",[s._v("我们在编写playbook的时候，不可避免的要执行一些重复性操作，比如指安装软件包，批量创建用户，操作某个目录下的所有文件等。正如我们所说，ansible一门简单的自动化语言，所以流程控制、循环语句这些编程语言的基本元素它同样都具备。")]),s._v(" "),a("p",[s._v("loop循环，它是在Ansible 2.5版本中新添加的循环结构，等价于with_list。大多数时候，with_xxx的循环都可以通过一定的手段转换成loop循环，所以从Ansible 2.5版本之后，原来经常使用的with_items循环都可以尝试转换成loop。")]),s._v(" "),a("p",[s._v("下面我们简单的说一说Playbook中循环语句。")]),s._v(" "),a("h2",{attrs:{id:"_2-loop关键字说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-loop关键字说明"}},[s._v("#")]),s._v(" 2 loop关键字说明")]),s._v(" "),a("p",[s._v("在playbook中使用循环，直接使用loop关键字即可。")]),s._v(" "),a("p",[s._v("如下示例，启动httpd和postfilx服务：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('tasks:\n  - name: postfix and httpd are running\n    service:\n      name: "{{ item }}"\n      state: started\n    loop:\n      - postfix\n      - httpd\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("也可以将loop循环的列表提前赋值给一个变量，然后在循环语句中调用：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#cat test_services.yml\ntest_services:\n  - postfix\n  - httpd\n\n# cat install_pkgs.yml \n- name: start services\n  hosts: test\n  vars_files:\n    - test_services.yml\n  tasks:\n    - name: postfix and httpd are running\n      service:\n        name: "{{ item }}"\n        state: started\n      loop: "{{ test_services }}"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("下面是一个循环更复杂类型数据的示例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# cat test_loop.yml \n- name: test loop\n  hosts: test\n  tasks:\n  - name: add www group\n    group: \n      name: www\n  - name: add several users\n    user: \n      name: \"{{ item.name }}\"\n      state: present \n      groups: \"{{ item.groups }}\"\n    loop:\n      - { name: 'testuser1', groups: 'wheel' }\n      - { name: 'testuser2', groups: 'www' }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"_3-循环的控制-loop-control"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-循环的控制-loop-control"}},[s._v("#")]),s._v(" 3 循环的控制：loop_control")]),s._v(" "),a("p",[s._v("后续补充")]),s._v(" "),a("h2",{attrs:{id:"_3-在循环语句中注册变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-在循环语句中注册变量"}},[s._v("#")]),s._v(" 3 在循环语句中注册变量")]),s._v(" "),a("p",[s._v("下面是一个register的变量在循环中使用的例子：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# cat register_loop.yml \n- name: registered variable usage as a loop list\n  hosts: test\n  tasks:\n      - name: ensure /mnt/bkspool exists\n        file:\n          path: /mnt/bkspool\n          state: directory\n      - name: retrieve the list of home directories\n        command: ls /home\n        register: home_dirs\n      - name: Show home_dirs results\n        debug:\n          var: home_dirs.stdout_lines\n      - name: add home dirs to the backup spooler\n        file: \n          path: /mnt/bkspool/{{ item }}\n          src: /home/{{ item }}\n          state: link\n          force: yes\n        loop: "{{ home_dirs.stdout_lines }}"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("在循环语句中注册变量：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('- name: Loop Register test\n  gather_facts: no\n  hosts: test\n  tasks:\n    - name: Looping Echo Task\n      shell: "echo this is my item: {{ item }}"\n      loop:\n        - one\n        - two\n      register: echo_results\n    - name: Show echo_results variable\n      debug:\n        var: echo_results\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("执行语句，可以看到变量的返回结果为一个字典列表：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('ok: [10.1.61.187] => {\n    "echo_results": {\n        "changed": true,\n        "msg": "All items completed",\n        "results": [\n            {\n                "ansible_loop_var": "item",\n                "changed": true,\n                "cmd": "echo this is my item: one",\n                "delta": "0:00:00.004905",\n                "end": "2019-06-10 00:23:51.814151",\n                "failed": false,\n                "invocation": {\n                    "module_args": {\n                        "_raw_params": "echo this is my item: one",\n                        "_uses_shell": true,\n                        "argv": null,\n                        "chdir": null,\n                        "creates": null,\n                        "executable": null,\n                        "removes": null,\n                        "stdin": null,\n                        "stdin_add_newline": true,\n                        "strip_empty_ends": true,\n                        "warn": true\n                    }\n                },\n                "item": "one",\n                "rc": 0,\n                "start": "2019-06-10 00:23:51.809246",\n                "stderr": "",\n                "stderr_lines": [],\n                "stdout": "this is my item: one",\n                "stdout_lines": [\n                    "this is my item: one"\n                ]\n            },\n            {\n                "ansible_loop_var": "item",\n                "changed": true,\n                "cmd": "echo this is my item: two",\n                "delta": "0:00:00.004736",\n                "end": "2019-06-10 00:23:52.008981",\n                "failed": false,\n                "invocation": {\n                    "module_args": {\n                        "_raw_params": "echo this is my item: two",\n                        "_uses_shell": true,\n                        "argv": null,\n                        "chdir": null,\n                        "creates": null,\n                        "executable": null,\n                        "removes": null,\n                        "stdin": null,\n                        "stdin_add_newline": true,\n                        "strip_empty_ends": true,\n                        "warn": true\n                    }\n                },\n                "item": "two",\n                "rc": 0,\n                "start": "2019-06-10 00:23:52.004245",\n                "stderr": "",\n                "stderr_lines": [],\n                "stdout": "this is my item: two",\n                "stdout_lines": [\n                    "this is my item: two"\n                ]\n            }\n        ]\n    }\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br")])]),a("h2",{attrs:{id:"_4-旧循环语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-旧循环语句"}},[s._v("#")]),s._v(" 4 旧循环语句")]),s._v(" "),a("p",[s._v("在Ansible 2.5以前，playbook通过不同的循环语句以实现不同的循环，这些语句使用"),a("code",[s._v("with_")]),s._v("作为前缀。这些语法目前仍然兼容，但在未来的某个时间点，会逐步废弃。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("循环语句关键字")]),s._v(" "),a("th",[s._v("描述")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("with_items")]),s._v(" "),a("td",[s._v("简单的列表循环")])]),s._v(" "),a("tr",[a("td",[s._v("with_nested")]),s._v(" "),a("td",[s._v("嵌套循环")])]),s._v(" "),a("tr",[a("td",[s._v("with_dict")]),s._v(" "),a("td",[s._v("循环字典")])]),s._v(" "),a("tr",[a("td",[s._v("with_fileglob")]),s._v(" "),a("td",[s._v("循环指定目录中的所有文件")])]),s._v(" "),a("tr",[a("td",[s._v("with_lines")]),s._v(" "),a("td",[s._v("循环一个文件中的所有行")])]),s._v(" "),a("tr",[a("td",[s._v("with_sequence")]),s._v(" "),a("td",[s._v("生成一个自增的整数序列，可以指定起始值和结束值以及步长。参数以key=value的形式指定，format指定输出的格式。数字可以是十进制、十六进制、八进制")])]),s._v(" "),a("tr",[a("td",[s._v("with_subelement")]),s._v(" "),a("td",[s._v("遍历子元素")])]),s._v(" "),a("tr",[a("td",[s._v("with_together")]),s._v(" "),a("td",[s._v("遍历数据并行集合")])])])]),s._v(" "),a("h3",{attrs:{id:"_4-1-with-items"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-with-items"}},[s._v("#")]),s._v(" 4.1 with_items")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('- hosts: test\n  vars:\n    data:\n      - user0\n      - user1\n      - user2\n  tasks:\n    - name: "with_items"\n      debug:\n        msg: "{{ item }}"\n      with_items: "{{ data }}"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"_4-2-with-nested"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-with-nested"}},[s._v("#")]),s._v(" 4.2 with_nested")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tasks: \n  - name: debug loops\n    debug: msg=\"name is {{ item[0] }}  vaule is {{ item[1] }} num is {{ item[2] }}\"\n    with_nested:\n      - ['alice','bob']\n      - ['a','b','c']\n      - ['1','2','3']\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("item[0]是循环的第一个列表的值['alice','bob']。item[1]是第二个列表的值；item[2]则是第三个列表的值，以上的执行输出如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# ansible-playbook with_nested_ex.yml \n\nPLAY [with_nested test] ******************************************************************************************\n\nTASK [Gathering Facts] *******************************************************************************************\nok: [10.1.61.187]\n\nTASK [debug loops] ***********************************************************************************************\nok: [10.1.61.187] => (item=['alice', 'a', '1']) => {\n    \"msg\": \"name is alice  vaule is a num is 1\"\n}\nok: [10.1.61.187] => (item=['alice', 'a', '2']) => {\n    \"msg\": \"name is alice  vaule is a num is 2\"\n}\nok: [10.1.61.187] => (item=['alice', 'a', '3']) => {\n    \"msg\": \"name is alice  vaule is a num is 3\"\n}\nok: [10.1.61.187] => (item=['alice', 'b', '1']) => {\n    \"msg\": \"name is alice  vaule is b num is 1\"\n}\nok: [10.1.61.187] => (item=['alice', 'b', '2']) => {\n    \"msg\": \"name is alice  vaule is b num is 2\"\n}\nok: [10.1.61.187] => (item=['alice', 'b', '3']) => {\n    \"msg\": \"name is alice  vaule is b num is 3\"\n}\nok: [10.1.61.187] => (item=['alice', 'c', '1']) => {\n    \"msg\": \"name is alice  vaule is c num is 1\"\n}\nok: [10.1.61.187] => (item=['alice', 'c', '2']) => {\n    \"msg\": \"name is alice  vaule is c num is 2\"\n}\nok: [10.1.61.187] => (item=['alice', 'c', '3']) => {\n    \"msg\": \"name is alice  vaule is c num is 3\"\n}\nok: [10.1.61.187] => (item=['bob', 'a', '1']) => {\n    \"msg\": \"name is bob  vaule is a num is 1\"\n}\nok: [10.1.61.187] => (item=['bob', 'a', '2']) => {\n    \"msg\": \"name is bob  vaule is a num is 2\"\n}\nok: [10.1.61.187] => (item=['bob', 'a', '3']) => {\n    \"msg\": \"name is bob  vaule is a num is 3\"\n}\nok: [10.1.61.187] => (item=['bob', 'b', '1']) => {\n    \"msg\": \"name is bob  vaule is b num is 1\"\n}\nok: [10.1.61.187] => (item=['bob', 'b', '2']) => {\n    \"msg\": \"name is bob  vaule is b num is 2\"\n}\nok: [10.1.61.187] => (item=['bob', 'b', '3']) => {\n    \"msg\": \"name is bob  vaule is b num is 3\"\n}\nok: [10.1.61.187] => (item=['bob', 'c', '1']) => {\n    \"msg\": \"name is bob  vaule is c num is 1\"\n}\nok: [10.1.61.187] => (item=['bob', 'c', '2']) => {\n    \"msg\": \"name is bob  vaule is c num is 2\"\n}\nok: [10.1.61.187] => (item=['bob', 'c', '3']) => {\n    \"msg\": \"name is bob  vaule is c num is 3\"\n}\n\nPLAY RECAP *******************************************************************************************************\n10.1.61.187 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br")])]),a("h3",{attrs:{id:"_4-3-with-dict"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-with-dict"}},[s._v("#")]),s._v(" 4.3 with_dict")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 假如有如下变量内容：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("users")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alice")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Alice Appleworth\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("telephone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 123"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("456"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7890")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bob")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Bob Bananarama\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("telephone")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 987"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("654"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3210")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 现在需要输出每个用户的用户名和手机号：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Print phone records\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' msg="User '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" item.key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" is "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" item.value.name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" ("),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" item.value.telephone "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(')"\n    '),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("with_dict")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ users }}"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"_4-4-with-fileglob"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-with-fileglob"}},[s._v("#")]),s._v(" 4.4 with_fileglob")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('- hosts: test\n  tasks:\n    - name: Make key directory     \n      file: \n        path: /root/.sshkeys \n        state: directory \n        mode: 0700 \n        owner: root \n        group: root \n        \n    - name: Upload public keys     \n      copy: \n        src: "{{ item }}"\n        dest: /root/.sshkeys\n        mode: 0600 \n        owner: root \n        group: root  \n      with_fileglob:\n        - /root/.ssh/*.pub \n        \n    - name: Assemble keys into authorized_keys file     \n      assemble: \n        src: /root/.sshkeys \n        dest: /root/.ssh/authorized_keys\n        mode: 0600 \n        owner: root \n        group: root\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("h3",{attrs:{id:"_4-5-with-lines"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-with-lines"}},[s._v("#")]),s._v(" 4.5 with_lines")]),s._v(" "),a("p",[s._v("with_lines循环结构会让你在控制主机上执行任意命令，并对命令的输出进行逐行迭代。假设我们有一个 文件test.txt包含如下行：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Breeze Yan\nBernie Yang\njerry Qing\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("我们可以通过如下方法进行逐行输出：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('- name: print all names\n  debug: msg="{{ item }}"\n  with_lines:\n    - cat test.txt\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_4-6-with-subelement"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-with-subelement"}},[s._v("#")]),s._v(" 4.6 with_subelement")]),s._v(" "),a("p",[s._v("假如现在需要遍历一个用户列表，并创建每个用户，而且还需要为每个用户配置以特定的SSH key登录。变量文件内容如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('users:\n  - name: alice\n    authorized:\n      - /tmp/alice/onekey.pub\n      - /tmp/alice/twokey.pub\n    mysql:\n        password: mysql-password\n        hosts:\n          - "%"\n          - "127.0.0.1"\n          - "::1"\n          - "localhost"\n        privs:\n          - "*.*:SELECT"\n          - "DB1.*:ALL"\n  - name: bob\n    authorized:\n      - /tmp/bob/id_rsa.pub\n    mysql:\n        password: other-mysql-password\n        hosts:\n          - "db1"\n        privs:\n          - "*.*:SELECT"\n          - "DB2.*:ALL"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v("playbook中定义如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("tasks:\n  - user: name={{ item.name }} state=present generate_ssh_key=yes\n    with_items: \"{{users}}\"\n  - authorized_key: \"user={{ item.0.name }} key='{{ lookup('file', item.1) }}'\"\n    with_subelements:\n     - users\n     - authorized\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("也可以遍历嵌套的子列表：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- name: Setup MySQL users\n  mysql_user: name={{ item.0.name }} password={{ item.0.mysql.password }} host={{ item.1 }} priv={{ item.0.mysql.privs | join('/') }}\n  with_subelements:\n    - users\n    - mysql.hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_4-7-with-sequence"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-with-sequence"}},[s._v("#")]),s._v(" 4.7 with_sequence")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- hosts: all\n  tasks:\n    # create groups\n    - group: name=evens state=present\n    - group: name=odds state=present\n    # create some test users\n    - user: name={{ item }} state=present groups=evens\n      with_sequence: start=0 end=32 format=testuser%02d\n    # create a series of directories with even numbers for some reason\n    - file: dest=/var/stuff/{{ item }} state=directory\n      with_sequence: start=4 end=16 stride=2    # stride用于指定步长\n    # a simpler way to use the sequence plugin\n    # create 4 groups\n    - group: name=group{{ item }} state=present\n      with_sequence: count=4\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_4-8-with-random-choice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-8-with-random-choice"}},[s._v("#")]),s._v(" 4.8 with_random_choice")]),s._v(" "),a("p",[s._v("从列表中随机取一个值：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('- debug: msg={{ item }}\n  with_random_choice:\n     - "go through the door"\n     - "drink from the goblet"\n     - "press the red button"\n     - "do nothing"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_4-9-do-util循环"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-9-do-util循环"}},[s._v("#")]),s._v(" 4.9 do-Util循环")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('- action: shell /usr/bin/foo\n  register: result\n  until: result.stdout.find("all systems go") != -1\n  retries: 5\n  delay: 10\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v('重复执行shell模块，当shell模块执行的命令输出内容包含"all systems go"的时候停止。重试5次，延迟时间10秒。retries默认值为3，delay默认值为5。任务的返回值为最后一次循环的返回结果。')]),s._v(" "),a("h3",{attrs:{id:"_4-10-with-together"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-10-with-together"}},[s._v("#")]),s._v(" 4.10 with_together")]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('- hosts: webservers\n  remote_user: root\n  vars:\n    alpha: [ \'a\',\'b\',\'c\',\'d\']\n    numbers: [ 1,2,3,4 ]\n  tasks:\n    - debug: msg="{{ item.0 }} and {{ item.1 }}"\n      with_together:\n         - "{{ alpha }}"\n         - "{{ numbers }}"\n# 输出的结果为：\nok: [192.168.1.65] => (item=[\'a\', 1]) => {\n    "item": [\n        "a",\n        1\n    ],\n    "msg": "a and 1"\n}\nok: [192.168.1.65] => (item=[\'b\', 2]) => {\n    "item": [\n        "b",\n        2\n    ],\n    "msg": "b and 2"\n}\nok: [192.168.1.65] => (item=[\'c\', 3]) => {\n    "item": [\n        "c",\n        3\n    ],\n    "msg": "c and 3"\n}\nok: [192.168.1.65] => (item=[\'d\', 4]) => {\n    "item": [\n        "d",\n        4\n    ],\n    "msg": "d and 4"\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("blockquote",[a("p",[s._v("参考链接：")]),s._v(" "),a("p",[s._v("https://www.cnblogs.com/breezey/p/10996629.html")]),s._v(" "),a("p",[s._v("https://blog.51cto.com/cloumn/blog/1544")])])])}),[],!1,null,null,null);n.default=t.exports}}]);
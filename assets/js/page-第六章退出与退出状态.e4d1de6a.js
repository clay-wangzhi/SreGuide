(window.webpackJsonp=window.webpackJsonp||[]).push([[352],{1065:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"第六章-退出与退出状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第六章-退出与退出状态"}},[s._v("#")]),s._v(" 第六章 退出与退出状态")]),s._v(" "),t("blockquote",[t("p",[s._v("Bourne shell里存在不明确之处，但人们也会使用它们。")]),s._v(" "),t("p",[s._v("—— Chat Ramey")])]),s._v(" "),t("p",[s._v("跟C程序类似，"),t("code",[s._v("exit")]),s._v(" 命令被用来结束脚本。同时，它也会返回一个值，返回值可以被交给父进程。")]),s._v(" "),t("p",[s._v("每个命令都会返回一个退出状态（exit status），有时也叫做返回状态（return status）或退出码（exit code）。命令执行成功返回0，如果返回一个非0值，通常情况下会被认为是一个错误代码。一个运行状态良好的UNIX命令、程序和工具在正常执行退出后都会返回一个0的退出码，当然也有例外。")]),s._v(" "),t("p",[s._v("同样地，脚本中的函数和脚本本身也会返回一个退出状态。在脚本或者脚本函数中执行的最后的命令会决定它们的退出状态。在脚本中，"),t("code",[s._v("exit nnn")]),s._v(" 命令将会把nnn退出状态码传递给shell（nnn 必须是 0-255 之间的整型数）。")]),s._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"http://tldp.org/LDP/abs/images/note.gif",alt:"note"}}),s._v(" 当一个脚本以不带参数的 "),t("code",[s._v("exit")]),s._v(" 来结束时，脚本的退出状态由脚本最后执行命令决定（"),t("code",[s._v("exit")]),s._v(" 命令之前）。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\nCOMMAND_1\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nCOMMAND_LAST\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将以最后的命令来决定退出状态")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("blockquote",[t("p",[t("code",[s._v("exit")]),s._v("，"),t("code",[s._v("exit $?")]),s._v(" 以及省略 "),t("code",[s._v("exit")]),s._v(" 效果等同。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash ")]),s._v("\n\nCOMMAND_1\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nCOMMAND_LAST\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将以最后的命令来决定退出状态")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\nCOMMAND_1\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nCOMMAND_LAST\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将以最后的命令来决定退出状态")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("code",[s._v("$?")]),s._v(" 读取上一个执行命令的退出状态。在一个函数返回后，"),t("code",[s._v("$?")]),s._v(' 给出函数最后执行的那条命令的退出状态。这就是Bash函数的"返回值"。'),t("sup",{staticClass:"footnote-ref"},[t("a",{attrs:{href:"#footnote1"}},[s._v("[1]")]),t("a",{staticClass:"footnote-anchor",attrs:{id:"footnote-ref1"}})])]),s._v(" "),t("p",[s._v("在"),t("a",{attrs:{href:"http://tldp.org/LDP/abs/html/special-chars.html#PIPEREF",target:"_blank",rel:"noopener noreferrer"}},[s._v("管道"),t("OutboundLink")],1),s._v("执行后，"),t("code",[s._v("$?")]),s._v(" 给出最后执行的那条命令的退出状态。")]),s._v(" "),t("p",[s._v("在脚本终止后，命令行下键入"),t("code",[s._v("$?")]),s._v("会给出脚本的退出状态，即在脚本中最后一条命令执行后的退出状态。一般情况下，0为成功，1-255为失败。")]),s._v(" "),t("p",[s._v("样例 6-1. 退出与退出状态")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" hello\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回值为0，因为执行成功。")]),s._v("\n\nlskdf      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不认识的命令。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回非0值，因为失败了。")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("113")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将返回113给shell")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为了验证这些，在脚本结束的地方使用“echo $?”")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  按照惯例，'exit 0' 意味着执行成功，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#+ 非0意味着错误或者异常情况。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  查看附录章节“退出码的特殊含义”")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[t("code",[s._v("$?")]),s._v(" 对于测试脚本中的命令的执行结果特别有用（查看样例 16-35和样例 16-20）。")]),s._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"http://tldp.org/LDP/abs/images/note.gif",alt:"note"}}),s._v(" 逻辑非操作符 "),t("a",{attrs:{href:"http://tldp.org/LDP/abs/html/special-chars.html#NOTREF",target:"_blank",rel:"noopener noreferrer"}},[s._v("!"),t("OutboundLink")],1),s._v(" 将会反转测试或命令的结果，并且这将会影响退出状态。")])]),s._v(" "),t("p",[s._v("样例 6-2. 否定一个条件使用!")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# true 是 shell 内建命令。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exit status of '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("true"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v('"')]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exit status of '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("! true"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(" = "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v('"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 注意在命令之间的 "!" 需要一个空格。')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# !true 将导致一个"command not found"错误。')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果一个命令以'!'开头，那么将调用 Bash 的历史机制，显示这个命令被使用的历史。")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("true\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这次就没有错误了，但是同样也没有反转。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 它不过是重复之前的命令（true）。")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ============================================================ #")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 _pipe_ 前使用 ! 将改变返回的退出状态。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" bogus_command      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#bash: bogus_command: command not found")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#127")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" bogus_command    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#bash: bogus_command:command not found")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意 ! 不会改变管道的执行。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只改变退出状态。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#============================================================  #")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 感谢 Stéphane Chazelas 和 Kristopher Newsome。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("blockquote",[t("p",[t("img",{attrs:{src:"http://tldp.org/LDP/abs/images/caution.gif",alt:"caution"}}),s._v(" 某些特定的退出码具有一些特定的"),t("a",{attrs:{href:"http://tldp.org/LDP/abs/html/exitcodes.html#EXITCODESREF",target:"_blank",rel:"noopener noreferrer"}},[s._v("保留含义"),t("OutboundLink")],1),s._v("，用户不应该在自己的脚本中重新定义它们。")])]),s._v(" "),t("hr",{staticClass:"footnotes-sep"}),s._v(" "),t("section",{staticClass:"footnotes"},[t("ol",{staticClass:"footnotes-list"},[t("li",{staticClass:"footnote-item",attrs:{id:"footnote1"}},[t("p",[s._v("在函数没有用"),t("a",{attrs:{href:"http://tldp.org/LDP/abs/html/complexfunct.html#RETURNREF",target:"_blank",rel:"noopener noreferrer"}},[s._v("return"),t("OutboundLink")],1),s._v("来结束这个函数的情况下。 "),t("a",{staticClass:"footnote-backref",attrs:{href:"#footnote-ref1"}},[s._v("↩︎")])])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);
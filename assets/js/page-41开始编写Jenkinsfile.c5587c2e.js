(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{970:function(s,n,t){"use strict";t.r(n);var a=t(1),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_4-1-开始编写jenkinsfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-开始编写jenkinsfile"}},[s._v("#")]),s._v(" 4.1 开始编写Jenkinsfile")]),s._v(" "),t("blockquote",[t("p",[s._v("本文转自："),t("a",{attrs:{href:"http://docs.idevops.site/jenkins/pipelinesyntax/chapter01/",target:"_blank",rel:"noopener noreferrer"}},[s._v("开始编写 Jenkinsfile | 泽阳"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("您好，还在疑惑什么是流水线吗？ 本章我们将告诉您如何运行一条流水线 赶快学习吧！ 😀")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"为什么使用pipeline"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么使用pipeline"}},[s._v("#")]),s._v(" 为什么使用pipeline?")]),s._v(" "),t("p",[s._v("本质上，jenkins是一个自动化引擎，它支持许多自动模式。流水线向Jenkins添加了一组强大的工具，支持用例、简单的持续集成到全面的持续交付流水线。 通过对一系列的发布任务建立标准的模板，用户可以利用更多流水线的特性，比如：")]),s._v(" "),t("ul",[t("li",[s._v("代码化: 流水线是在代码中实现的，通常会存放到源代码控制，使团队具有编辑、审查和更新他们项目的交付流水线的能力。")]),s._v(" "),t("li",[s._v("耐用性：流水线可以从Jenkins的master节点重启后继续运行。")]),s._v(" "),t("li",[s._v("可暂停的：流水线可以由人功输入或批准继续执行流水线。")]),s._v(" "),t("li",[s._v("解决复杂发布： 支持复杂的交付流程。例如循环、并行执行。")]),s._v(" "),t("li",[s._v("可扩展性： 支持扩展DSL和其他插件集成。")])]),s._v(" "),t("p",[s._v("构建一个可扩展是Jenkins的核心价值，流水线可以通过ShareLibrary的方式来扩展。")]),s._v(" "),t("h2",{attrs:{id:"pipeline定义"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pipeline定义"}},[s._v("#")]),s._v(" pipeline定义")]),s._v(" "),t("p",[s._v("关于Jenkins流水线的运行我们可以抽象一下，例如：可以把流水线(pipeline)想象成13号线地铁，把流水线的阶段(stage)想象成地铁的每一个站点，把流水线脚本(jenkinsfile)想象成地铁线路图。这就是流水线的多样性，每条线路都有不同的站点。")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://docs.idevops.site/jenkins/pipelinesyntax/chapter01/images/01-subwaybeijing.jpg",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"http://docs.idevops.site/jenkins/pipelinesyntax/chapter01/images/01-subwaybeijing.jpg",alt:"images"}}),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("现在地铁（Jenkins）已经有了，我们需要设计地铁的运行线路图（Jenkinsfile），在线路图中指定要经过的站点（stages）。这下你是否已经知道我们要运行一条流水线，需要先做什么呢？ –编写jenkinsfile")]),s._v(" "),t("p",[s._v("Pipeline")]),s._v(" "),t("ul",[t("li",[s._v("Jenkins的Pipeline通过Jenkinsfile进行描述（类似于Dockerfile）")]),s._v(" "),t("li",[s._v("Jenkinsfile是Jenkins的特性（pipeline as code）")]),s._v(" "),t("li",[s._v("Pipeline是Jenkins的核心功能，提供一组可扩展的工具。")]),s._v(" "),t("li",[s._v("通过Pipeline 的DSL（Pipeline Domain Specific Language）语法可以完成从简单到复杂的交付流水线实现。")])]),s._v(" "),t("p",[s._v("Jenkinsfile")]),s._v(" "),t("ul",[t("li",[s._v("Jenkinsfile使用两种语法进行编写，分别是声明式和脚本式。")]),s._v(" "),t("li",[s._v("声明式和脚本式的流水线从根本上是不同的。")]),s._v(" "),t("li",[s._v("声明式是jenkins流水线更友好的特性。")]),s._v(" "),t("li",[s._v("脚本式的流水线语法，提供更丰富的语法特性。")]),s._v(" "),t("li",[s._v("声明式流水线使编写和读取流水线代码更容易设计。")])]),s._v(" "),t("h2",{attrs:{id:"pipeline演示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pipeline演示"}},[s._v("#")]),s._v(" pipeline演示")]),s._v(" "),t("p",[s._v("来我们一起看下这里的配置，看下Jenkinsfile的组成及每个部分的功能含义。")]),s._v(" "),t("ul",[t("li",[s._v("使用agent{}，指定node节点/workspace（定义好此流水线在某节点运行）")]),s._v(" "),t("li",[s._v("指定options{}运行选项（定义好此流水线运行时的一些选项，例如输出日志的时间）")]),s._v(" "),t("li",[s._v("指定stages{}（stages包含多个stage，stage包含steps。是流水线的每个步骤)")]),s._v(" "),t("li",[s._v("指定post{}（定义好此流水线运行成功或者失败后，根据状态做一些任务）")])]),s._v(" "),t("div",{staticClass:"language-groovy line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[s._v("pipeline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//指定运行此流水线的节点")]),s._v("\n    agent "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" node "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" label "),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"build"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//流水线的阶段")]),s._v("\n    stages"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//阶段1 获取代码")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"CheckOut"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"获取代码"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"Build"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"运行构建"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    post "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        always"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"流水线结束后，经常做的事情"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n        success"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"流水线成功后，要做的事情"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        failure"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"流水线失败后，要做的事情"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n        aborted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"流水线取消后，要做的事情"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br")])]),t("h2",{attrs:{id:"验证流水线效果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证流水线效果"}},[s._v("#")]),s._v(" 验证流水线效果")]),s._v(" "),t("p",[s._v("查看Jenkins构建日志（正确效果）"),t("a",{attrs:{href:"http://docs.idevops.site/jenkins/pipelinesyntax/chapter01/images/03-jenkinslog.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"http://docs.idevops.site/jenkins/pipelinesyntax/chapter01/images/03-jenkinslog.png",alt:"images"}}),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("通过BlueOcean查看（如果没有BlueOcean图标，需要自行在插件中心安装插件）"),t("a",{attrs:{href:"http://docs.idevops.site/jenkins/pipelinesyntax/chapter01/images/02-blueocean.png",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"http://docs.idevops.site/jenkins/pipelinesyntax/chapter01/images/02-blueocean.png",alt:"images"}}),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("到此一个简单的Jenkinfile完成了！ 后面我们来详细分析每个步骤的作用。")])])}),[],!1,null,null,null);n.default=e.exports}}]);
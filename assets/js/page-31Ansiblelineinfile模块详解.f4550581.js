(window.webpackJsonp=window.webpackJsonp||[]).push([[103],{939:function(s,a,e){"use strict";e.r(a);var t=e(1),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"_3-1-ansible-lineinfile模块详解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-ansible-lineinfile模块详解"}},[s._v("#")]),s._v(" 3.1 Ansible lineinfile模块详解")]),s._v(" "),e("h2",{attrs:{id:"_1-简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[s._v("#")]),s._v(" 1 简介")]),s._v(" "),e("p",[s._v("之所以专门说一说这个模块，是因为lineinfile在实际使用中非常有用。")]),s._v(" "),e("p",[s._v("lineinfile模块用于在源文件中插入、删除、替换行，和sed命令的功能类似，也支持正则表达式匹配和替换。")]),s._v(" "),e("p",[s._v("实际上，在大多数时候，我们在linux上的操作，就是针对文件的操作，通过配置管理工具对配置文件作统一的配置修改是一个非常酷的功能。")]),s._v(" "),e("p",[s._v("下面是官方针对该模块的说明：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("lineinfile - Ensure a particular line is in a file, or replace an existing line using a back-referenced regular expression\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("简单讲，这个模块就是针对一个文件中行内容的操作。")]),s._v(" "),e("p",[s._v("下面我们详细说一说其具体可以做的事情。")]),s._v(" "),e("h2",{attrs:{id:"_2-修改匹配行"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改匹配行"}},[s._v("#")]),s._v(" 2 修改匹配行")]),s._v(" "),e("p",[s._v("下面是一个简单的task示例：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将/etc/selinux/config中匹配到以'SELINUX='开头的行，将其替换为'SELINUX=disabled'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" modify selinux to disabled\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lineinfile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/selinux/config\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^SELINUX='")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("line")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SELINUX=disabled'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h2",{attrs:{id:"_3-在匹配行前或后添加内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-在匹配行前或后添加内容"}},[s._v("#")]),s._v(" 3 在匹配行前或后添加内容")]),s._v(" "),e("blockquote",[e("p",[s._v("insertbefore和insertafter指定的正则表达式如果匹配了多行，则默认选中最后一个匹配行，然后在被选中的行前、行后插入。如果明确要指定选中第一次匹配的行，则指定参数firstmatch=yes：")])]),s._v(" "),e("p",[s._v("示例文件如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# cat /etc/http.conf\n\nListen 127.0.0.1:80\nListen 80\nPort\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_3-1-在匹配行前添加"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-在匹配行前添加"}},[s._v("#")]),s._v(" 3.1 在匹配行前添加")]),s._v(" "),e("p",[s._v("在http.conf文件的"),e("code",[s._v("Listen 80")]),s._v("前面添加一行"),e("code",[s._v("Listen 8080")]),s._v("，task示例如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- name: add line before Listen 80\n  lineinfile:\n    dest: /etc/http.conf\n    insertbefore: '^Listen 80'\n    line: 'Listen 8080'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_3-2-在匹配行后添加"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-在匹配行后添加"}},[s._v("#")]),s._v(" 3.2 在匹配行后添加")]),s._v(" "),e("p",[s._v("在http.conf文件的"),e("code",[s._v("Port")]),s._v("后面添加一行"),e("code",[s._v("just a test")]),s._v("，task示例如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- name: add line before Listen 80\n  lineinfile:\n    dest: /etc/http.conf\n    insertafter: '^Port'\n    line: 'just a test'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"_4-修改文件内容及权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改文件内容及权限"}},[s._v("#")]),s._v(" 4 修改文件内容及权限")]),s._v(" "),e("p",[s._v("示例文件：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/hosts")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1       localhost.localdomain localhost ::1       localhost6.localdomain6 localhost6\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".61.130     hub.dz11.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("修改/etc/hosts，将以"),e("code",[s._v("127.0.0.1")]),s._v("开头的行替换为"),e("code",[s._v("127.0.0.1 localhost")]),s._v("，并将/etc/hosts的属主和属组都修改为root，权限改为644，如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- name: modify hosts\n  lineinfile:\n    dest: /etc/hosts\n    regex: '^127\\.0\\.0\\.1'\n    line: '127.0.0.1 localhost'\n    owner: root\n    group: root\n    mode: 0644\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h2",{attrs:{id:"_5-删除行内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-删除行内容"}},[s._v("#")]),s._v(" 5 删除行内容")]),s._v(" "),e("p",[s._v("regexp结合state=absent时，表示删除所有匹配的行。")]),s._v(" "),e("p",[s._v("示例原文件：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/hosts")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1       localhost.localdomain localhost ::1       localhost6.localdomain6 localhost6\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".61.130     hub.dz11.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("删除以"),e("code",[s._v("10.1.61.130")]),s._v("开头的行：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- name: delete a line\n  lineinfile:\n    dest: /etc/hosts\n    regex: '^10\\.1\\.61'\n    state: absent\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"_6-文件存在则添加一行内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-文件存在则添加一行内容"}},[s._v("#")]),s._v(" 6 文件存在则添加一行内容")]),s._v(" "),e("p",[s._v("往/etc/hosts里添加一行"),e("code",[s._v("10.1.61.131 test.dz11.com")]),s._v("（多次执行，不会重复添加），示例如下：")]),s._v(" "),e("p",[s._v("如果再次执行，则不会再次追加此行。因为lineinfile模块的state参数默认值为present，它能保证幂等性，当要插入的行已经存在时则不会再插入。")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" add a line\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lineinfile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/hosts\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("line")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.1.61.131 test.dz11.com'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"_7-如果有匹配的行则修改该行-如果不匹配则添加"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-如果有匹配的行则修改该行-如果不匹配则添加"}},[s._v("#")]),s._v(" 7 如果有匹配的行则修改该行，如果不匹配则添加")]),s._v(" "),e("p",[s._v("示例原文件/tmp/test.txt内容如下：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# %wheel   ALL=(ALL)   ALL")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("下面的示例task中，匹配以"),e("code",[s._v("%wheel")]),s._v("开头的行，匹配到，则执行替换，未匹配，则添加。因为原文件中，没有以"),e("code",[s._v("%wheel")]),s._v("开头的行，所以会添加一行：")]),s._v(" "),e("div",{staticClass:"language-yaml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" add or modify a line\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lineinfile")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dest")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /tmp/test.txt\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^%wheel'")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("line")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%wheel  ALL=(ALL)       NOPASSWD: ALL'")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("修改后的文件如下：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /tmp/text.txt")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# %wheel   ALL=(ALL)   ALL")]),s._v("\n%wheel  "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       NOPASSWD: ALL\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"_8-参数backrefs-backup说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-参数backrefs-backup说明"}},[s._v("#")]),s._v(" 8 参数backrefs，backup说明")]),s._v(" "),e("ul",[e("li",[s._v("backup： 是否备份原文件，默认为no")]),s._v(" "),e("li",[s._v("backrefs：\n"),e("ul",[e("li",[s._v("当backrefs为no时，如果regex没有匹配到行，则添加一行，如果Regx匹配到行，则修改该行")]),s._v(" "),e("li",[s._v("当backrefs为yes时，如果regex没有匹配到行，则保持原文件不变，如果regex匹配到行，则修改该行")]),s._v(" "),e("li",[s._v("backrefs默认为no，所以上面那个示例中，我们没有配置backrefs，而默认没有匹配，则修改。")])])])]),s._v(" "),e("p",[s._v("下面我们看一看backrefs为yes时匹配到行的示例：")]),s._v(" "),e("p",[s._v("示例原文件：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /tmp/testfile")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# %wheel   ALL=(ALL)   ALL")]),s._v("\n%wheel  "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       NOPASSWD: ALL\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#?bar")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("task示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" - name: test backrefs\n  lineinfile:\n      backup: yes\n      state: present\n      dest: /tmp/testfile\n      regexp: '^#\\?bar'\n      backrefs: yes\n      line: 'bar'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[s._v("修改后的文件：")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /tmp/testfile")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# %wheel   ALL=(ALL)   ALL")]),s._v("\n%wheel  "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       NOPASSWD: ALL\nbar\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"_9-使用validate验证文件是否正确修改"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-使用validate验证文件是否正确修改"}},[s._v("#")]),s._v(" 9 使用validate验证文件是否正确修改")]),s._v(" "),e("p",[s._v("在一些场景下，我们修改完文件后，需要对文件做一下测试，用以检查文件修改之后，是否能正常运行。如http.conf、nginx.conf等，一旦改错，而不加以测试，可能会直接导致http服务挂掉。")]),s._v(" "),e("p",[s._v("可以使用validate关键字，在修改完成以后，对文件执行检测：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- name: test validate\n  lineinfile:\n      dest: /etc/sudoers\n      state: present\n      regexp: '^%ADMIN ALL='\n      line: '%ADMIN ALL=(ALL)'\n      validate: 'visudo -cf %s'\n  tags:\n    - testsudo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h2",{attrs:{id:"_10-regexp和insertxxx结合"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-regexp和insertxxx结合"}},[s._v("#")]),s._v(" 10 regexp和insertXXX结合")]),s._v(" "),e("p",[s._v("lineinfile最后一个比较常用的功能是regepx结合insertbefore或结合insertafter。这时候的行将根据insertXXX的位置来插入，而regexp参数则充当幂等性判断参数：只有regepx匹配失败时，insertXXX才会插入行。")]),s._v(" "),e("p",[s._v("例如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("- lineinfile:\npath: \"a.txt\"\nline: \"hello line\"\nregexp: '^hello'\ninsertbefore: '^para.* 2'\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v('这表示将"hello line"插入在paragraph 2行的前面，但如果再次执行，则不会再次插入，因为regexp参数指定的正则表达式已经能够已经存在的"hello line"行。所以，当regepx结合insertXXX使用时，regexp的参数通常都会设置为能够匹配插入之后的行的正则表达式，以便实现幂等性。')]),s._v(" "),e("blockquote",[e("p",[s._v("参考链接：")]),s._v(" "),e("p",[s._v("https://www.cnblogs.com/breezey/p/9297252.html")]),s._v(" "),e("p",[s._v("https://blog.51cto.com/cloumn/blog/1544")])])])}),[],!1,null,null,null);a.default=n.exports}}]);
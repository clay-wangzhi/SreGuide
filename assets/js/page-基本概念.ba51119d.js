(window.webpackJsonp=window.webpackJsonp||[]).push([[250],{1166:function(a,t,_){"use strict";_.r(t);var l=_(1),v=Object(l.a)({},(function(){var a=this,t=a.$createElement,_=a._self._c||t;return _("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[_("h1",{attrs:{id:"基本概念"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#基本概念"}},[a._v("#")]),a._v(" 基本概念")]),a._v(" "),_("ul",[_("li",[a._v("Index索引\n"),_("ul",[_("li",[a._v("Type类型")]),a._v(" "),_("li",[a._v("Document文档")])])]),a._v(" "),_("li",[a._v("Node节点\n"),_("ul",[_("li",[a._v("shard分片")])])])]),a._v(" "),_("p",[_("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/1567998428921.png",alt:"1567998428921"}})]),a._v(" "),_("h2",{attrs:{id:"文档-document"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#文档-document"}},[a._v("#")]),a._v(" 文档（Document）")]),a._v(" "),_("ul",[_("li",[a._v("Elasticsearch是面向文档的，文档时所有可搜索数据的最小单位\n"),_("ul",[_("li",[a._v("日志文件中的日志项")]),a._v(" "),_("li",[a._v("一本电影的具体信息/一张唱片的详细信息")]),a._v(" "),_("li",[a._v("MP3播放器里的一首歌/一篇PDF文档中的具体内容")])])]),a._v(" "),_("li",[a._v("文档会被序列化成JSON格式，保存在Elasticsearch中\n"),_("ul",[_("li",[a._v("JSON对象由字段组成")]),a._v(" "),_("li",[a._v("每个字段都有对应的字段类型（字符串/数值/布尔/日期/二进制/范围类型）")])])]),a._v(" "),_("li",[a._v("每个文档都有一个Unique ID\n"),_("ul",[_("li",[a._v("你可以自己制定ID")]),a._v(" "),_("li",[a._v("或者通过Elasticsearch自动生成")])])])]),a._v(" "),_("h3",{attrs:{id:"json文档"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#json文档"}},[a._v("#")]),a._v(" JSON文档")]),a._v(" "),_("ul",[_("li",[a._v("一篇文档包含了一系列的字段，类似数据库表中一条记录")]),a._v(" "),_("li",[a._v("JSON文档，格式灵活，不需要预先定义格式\n"),_("ul",[_("li",[a._v("字段的类型可以指定或通过Elasticsearch自动推算")]),a._v(" "),_("li",[a._v("支持数组/支持嵌套")])])])]),a._v(" "),_("h3",{attrs:{id:"文档的元数据"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#文档的元数据"}},[a._v("#")]),a._v(" 文档的元数据")]),a._v(" "),_("ul",[_("li",[a._v("元数据，用于标注文档的相关信息\n"),_("ul",[_("li",[a._v("_index : 文档所属的索引名")]),a._v(" "),_("li",[a._v("_type：文档所属的类型名")]),a._v(" "),_("li",[a._v("_id：文档唯一id")]),a._v(" "),_("li",[a._v("_source：文档的原始JSON数据")]),a._v(" "),_("li",[a._v("_all：整合所有字段内容到该字段，已被废除")]),a._v(" "),_("li",[a._v("_version：文档的版本信息")]),a._v(" "),_("li",[a._v("_score：相关性打分")])])])]),a._v(" "),_("p",[_("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/1567998936909.png",alt:""}})]),a._v(" "),_("h2",{attrs:{id:"索引-index"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#索引-index"}},[a._v("#")]),a._v(" 索引（Index）")]),a._v(" "),_("ul",[_("li",[a._v("索引时文档的容器，是一类文档的结合\n"),_("ul",[_("li",[a._v("Index体现了逻辑空间的概念：每个索引都有自己的Mapping定义，用于定义包含的文档的字段名和字段类型")]),a._v(" "),_("li",[a._v("shard体现了物理空间的概念：索引中的数据分散在Shard上")])])]),a._v(" "),_("li",[a._v("索引的Mapping与Settings\n"),_("ul",[_("li",[a._v("Mapping定义文档字段的类型")]),a._v(" "),_("li",[a._v("Setting定义不同的数据分布")])])])]),a._v(" "),_("p",[_("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/1567999265615.png",alt:""}})]),a._v(" "),_("h3",{attrs:{id:"索引的不通语意"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#索引的不通语意"}},[a._v("#")]),a._v(" 索引的不通语意")]),a._v(" "),_("ul",[_("li",[a._v("名词：一个Elasticsearch集群中，可以创建很多个不同的索引")]),a._v(" "),_("li",[a._v("动词：保存一个文档到Elasticsearch的过程也叫索引（Indexing）\n"),_("ul",[_("li",[a._v("ES中，创建一个倒排索引的过程")])])]),a._v(" "),_("li",[a._v("在日常中的名词的含义：一个B树索引，一个倒排索引")])]),a._v(" "),_("h3",{attrs:{id:"type"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#type"}},[a._v("#")]),a._v(" Type")]),a._v(" "),_("ul",[_("li",[a._v("在7.0之前，一个Index可以设置多个Types")]),a._v(" "),_("li",[a._v('6.0开始，Type已经被Deprecated。7.0开始，一个索引只能创建一个Type - "_doc"')])]),a._v(" "),_("h2",{attrs:{id:"与关系型数据库的类比"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#与关系型数据库的类比"}},[a._v("#")]),a._v(" 与关系型数据库的类比")]),a._v(" "),_("p",[_("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/1567999614563.png",alt:""}})]),a._v(" "),_("p",[a._v("区别：")]),a._v(" "),_("ul",[_("li",[a._v("Elasticsearch - Schemaless / 相关性（算分）/ 高性能全文检索")]),a._v(" "),_("li",[a._v("RDMS - 事务性 / Join")])]),a._v(" "),_("h2",{attrs:{id:"分布式相关概念"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分布式相关概念"}},[a._v("#")]),a._v(" 分布式相关概念")]),a._v(" "),_("h3",{attrs:{id:"可用性和扩展性"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#可用性和扩展性"}},[a._v("#")]),a._v(" 可用性和扩展性")]),a._v(" "),_("ul",[_("li",[a._v("高可用性\n"),_("ul",[_("li",[a._v("服务可用性 - 允许有节点停止服务")]),a._v(" "),_("li",[a._v("数据可用性 - 部分节点丢失，不会丢失数据")])])]),a._v(" "),_("li",[a._v("可扩展性\n"),_("ul",[_("li",[a._v("请求量提升  / 数据的不断增长 （将数据分布到所有节点上）")])])])]),a._v(" "),_("h3",{attrs:{id:"elasticsearch的分布式"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch的分布式"}},[a._v("#")]),a._v(" Elasticsearch的分布式")]),a._v(" "),_("ul",[_("li",[a._v("Elasticsearch的分布式架构的好处\n"),_("ul",[_("li",[a._v("存储的水平扩容")]),a._v(" "),_("li",[a._v("提高系统的可用性，部分节点停止服务，整个集群的服务不受影响")])])]),a._v(" "),_("li",[a._v("Elasticsearch的分布式架构\n"),_("ul",[_("li",[a._v('不同的集群通过不同的名字来区分，默认名字"Elasticsearch"')]),a._v(" "),_("li",[a._v("通过配置文件修改，或者在命令行中 -E cluster.name=geektime 进行设定")]),a._v(" "),_("li",[a._v("一个集群可以有一个或者多个节点")])])])]),a._v(" "),_("h2",{attrs:{id:"节点-node"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#节点-node"}},[a._v("#")]),a._v(" 节点（Node）")]),a._v(" "),_("ul",[_("li",[a._v("节点是一个Elasticsearch的实例\n"),_("ul",[_("li",[a._v("本质上就是一个JAVA进程")]),a._v(" "),_("li",[a._v("一台机器上可以运行多个Elasticsearch进程，但是生产环境一般建议一台机器上只运行一个Elasticsearch实例")])])]),a._v(" "),_("li",[a._v("每一个节点都有名字，通过配置文件配置，或者启动时候指定 -E node.m=name=node1")]),a._v(" "),_("li",[a._v("每一个节点在启动之后，会分配一个UID，保存在data目录下")])]),a._v(" "),_("h3",{attrs:{id:"master-eligible-nodes-和-masternode"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#master-eligible-nodes-和-masternode"}},[a._v("#")]),a._v(" Master-eligible nodes 和 Masternode")]),a._v(" "),_("ul",[_("li",[a._v("每个节点启动后，默认就是一个Master eligible节点\n"),_("ul",[_("li",[a._v("可以设置node.master：false禁止")])])]),a._v(" "),_("li",[a._v("Master-eligible节点可以参见选主流程，成为Master节点")]),a._v(" "),_("li",[a._v("当一个节点启动时候，它会将自己选举成Master节点")]),a._v(" "),_("li",[a._v("每个节点上都保存了集群的状态，只有Master节点才能修改集群的状态信息\n"),_("ul",[_("li",[a._v("集群状态（Cluster State），维护了一个集群中，必要的信息\n"),_("ul",[_("li",[a._v("所有的节点信息")]),a._v(" "),_("li",[a._v("所有的索引和其相关的Mapping与Setting信息")]),a._v(" "),_("li",[a._v("分片的路由信息")])])]),a._v(" "),_("li",[a._v("任意节点都能修改信息会导致数据的不一致性")])])])]),a._v(" "),_("h3",{attrs:{id:"data-node-coordinating-node"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#data-node-coordinating-node"}},[a._v("#")]),a._v(" Data node & Coordinating Node")]),a._v(" "),_("ul",[_("li",[a._v("Data Node\n"),_("ul",[_("li",[a._v("可以保存数据的节点，叫做Data Node。负责保存分片数据，在数据扩展上起到了至关重要的作用")])])]),a._v(" "),_("li",[a._v("Coordinating Node\n"),_("ul",[_("li",[a._v("负责接受Client的请求，将请求发到合适的节点，最终把结果汇集到一起")]),a._v(" "),_("li",[a._v("每个节点默认都起到了Coordinating Node的职责")])])])]),a._v(" "),_("h3",{attrs:{id:"其他的节点类型"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#其他的节点类型"}},[a._v("#")]),a._v(" 其他的节点类型")]),a._v(" "),_("ul",[_("li",[a._v("Hot & Warm Node\n"),_("ul",[_("li",[a._v("不通硬件配置的Data Node，用来实现Hot & Warm架构，降低集群部署的成本")])])]),a._v(" "),_("li",[a._v("Machine Learning Node\n"),_("ul",[_("li",[a._v("负责跑机器学习的Job，用来做异常检测")])])]),a._v(" "),_("li",[a._v("Tribe Node\n"),_("ul",[_("li",[a._v("（5.3 开始使用Cross Cluster Search）Tribe Node连接到不同的Elasticsearch集群，并且支持将这些集群当成一个单独的集群处理")])])])]),a._v(" "),_("h3",{attrs:{id:"配置节点类型"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#配置节点类型"}},[a._v("#")]),a._v(" 配置节点类型")]),a._v(" "),_("ul",[_("li",[a._v("开发环境中一个节点可以承担多种角色")]),a._v(" "),_("li",[a._v("生产环境中，应该设置单一的角色的节点（dedicated node）")])]),a._v(" "),_("p",[_("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/1568006607109.png",alt:""}})]),a._v(" "),_("h2",{attrs:{id:"分片-shard"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分片-shard"}},[a._v("#")]),a._v(" 分片（Shard）")]),a._v(" "),_("ul",[_("li",[a._v("主分片，用以解决数据水平扩展的问题。通过主分片，可以将数据分布到集群内的所有节点之上\n"),_("ul",[_("li",[a._v("一个分片是一个运行的Lucene的实例")]),a._v(" "),_("li",[a._v("主分片数在索引创建时指定，后续不允许修改，出发Reindex")])])]),a._v(" "),_("li",[a._v("副本，用以解决数据高可用的问题。分布是主分片的拷贝\n"),_("ul",[_("li",[a._v("副本分片数，可以动态调整")]),a._v(" "),_("li",[a._v("增加副本数，还可以在一定程度上提高服务的可用性（读取的吞吐）")])])])]),a._v(" "),_("p",[a._v("示例：一个三个节点的集群中，blogs索引的分片分布情况")]),a._v(" "),_("p",[_("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/1568007457411.png",alt:""}})]),a._v(" "),_("h3",{attrs:{id:"分片的设定"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#分片的设定"}},[a._v("#")]),a._v(" 分片的设定")]),a._v(" "),_("ul",[_("li",[_("p",[a._v("对于生产环境中分片的设定，需要提前做好容量规划")]),a._v(" "),_("ul",[_("li",[a._v("分片数设置过小\n"),_("ul",[_("li",[a._v("导致后续无法增加节点实现水平扩展")]),a._v(" "),_("li",[a._v("单个分片的数据量太大，导致数据重新分配耗时")])])]),a._v(" "),_("li",[a._v("分片数设置过大，7.0开始，默认主分片设置成1，解决了over-sharding的问题\n"),_("ul",[_("li",[a._v("影响搜索结果的相关性打分，影响统计结果的准确性")]),a._v(" "),_("li",[a._v("单个节点上过多的分片，会导致资源浪费，同时也会影响性能")])])])])])]),a._v(" "),_("h3",{attrs:{id:"查看集群的健康状况"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#查看集群的健康状况"}},[a._v("#")]),a._v(" 查看集群的健康状况")]),a._v(" "),_("p",[_("img",{attrs:{src:"https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/1568009261188.png",alt:""}})]),a._v(" "),_("ul",[_("li",[a._v("Green - 主分片与副本都正常分配")]),a._v(" "),_("li",[a._v("Yellow - 主分片全部正常分配，有副本分片未能正常分配")]),a._v(" "),_("li",[a._v("Red - 有主分片未能分配\n"),_("ul",[_("li",[a._v("例如，当服务器的磁盘容量超过85%时，去创建了一个新的索引")])])])])])}),[],!1,null,null,null);t.default=v.exports}}]);
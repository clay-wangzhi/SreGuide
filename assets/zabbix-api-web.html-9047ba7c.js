const n=JSON.parse(`{"key":"v-7de67fc4","path":"/monitor/zabbix/zabbix-api-web.html","title":"7 用zabbix api批量添加web监控","lang":"zh-CN","frontmatter":{"category":"监控","tag":["Zabbix"],"description":"7 用zabbix api批量添加web监控 python脚本如下： vim zabbix_agent.py # ~*~ coding:utf-8 ~*~ from zabbix_api import ZabbixAPI import sys import json ZABBIX_SREVER = \\"http://192.168.162.122\\" USERNAME = \\"Admin\\" PASSWORD = \\"zabbix\\" #HOSTNAME = \\"sh_ylf_15\\" #HOSTNAME = \\"h5_web_monitor\\" HOSTNAME = sys.argv[4] urlname = sys.argv[1] url = sys.argv[2] delay = sys.argv[3] # 登录 def login(ZABBIX_SREVER, USERNAME, PASSWORD): zapi = ZabbixAPI(ZABBIX_SREVER) zapi.login(USERNAME, PASSWORD) return zapi # 获取主机id def gethostid(auth, HOSTNAME): json_obj = ZabbixAPI.json_obj(auth, 'host.get', params={\\"filter\\": {\\"host\\": HOSTNAME}}) request = ZabbixAPI.do_request(auth, json_obj) if request['result']: return request['result'][0]['hostid'] else: print(\\"找不到该主机\\") sys.exit(1) # 获取应用级id def getapplicationid(auth, hostid): # try: # json_obj = ZabbixAPI.json_obj(auth, 'application.create', params={\\"name\\": \\"Web监测\\",\\"hostid\\": hostid}) # ZabbixAPI.do_request(auth, json_obj) # except Exception as e: # print(e) json_obj = ZabbixAPI.json_obj(auth, 'application.get', params={\\"hostids\\": hostid}) request = ZabbixAPI.do_request(auth, json_obj) for num in range(0, len(request['result'])): if request['result'][num]['name'] == 'Web': return request['result'][num]['applicationid'] # 增加web监控 def create_web_scenario(auth, urlname, url, hostid, applicationid, delay): json_obj = ZabbixAPI.json_obj(auth, 'httptest.get', params={\\"filter\\": {\\"name\\": urlname}}) request = ZabbixAPI.do_request(auth, json_obj) if request['result']: print('该web监控已经添加过了') else: try: json_obj = ZabbixAPI.json_obj(auth, 'httptest.create', params={\\"name\\": urlname, \\"hostid\\": hostid, \\"applicationid\\": applicationid, \\"delay\\": delay, \\"retries\\": '1', \\"steps\\": [ {'name': urlname, 'url': url, 'timeout': '10', 'status_codes': '200', 'no': '1'}]}) ZabbixAPI.do_request(auth, json_obj) except Exception as e: print(e) sys.exit(1) # 增加触发器 def create_trigger(auth, HOSTNAME, urlname, url): expression = \\"{\\" + \\"{0}:web.test.fail[{1}].avg(#3)\\".format(HOSTNAME, urlname) + \\"}\\" + \\"&gt;=1\\" try: json_obj = ZabbixAPI.json_obj(auth, 'trigger.create', params={\\"description\\": \\"{0}访问失败\\".format(urlname), \\"expression\\": expression, \\"priority\\": 5, \\"url\\": url}) ZabbixAPI.do_request(auth, json_obj) except Exception as e: print(e) sys.exit(1) expression = \\"{\\" + \\"{0}:web.test.rspcode[{1},{1}].last(0)\\".format(HOSTNAME, urlname) + \\"}\\" + \\"&lt;&gt;200\\" try: json_obj = ZabbixAPI.json_obj(auth, 'trigger.create', params={\\"description\\": \\"{0}访问异常\\".format(urlname), \\"expression\\": expression, \\"priority\\": 4, \\"url\\": url}) ZabbixAPI.do_request(auth, json_obj) except Exception as e: print(e) sys.exit(1) # 获取监控项id def getitem(auth, hostid, urlname): json_obj = ZabbixAPI.json_obj(auth, 'item.get', params={\\"hostids\\": hostid, \\"webitems\\": \\"1\\", \\"filter\\": {\\"name\\": \\"Response code for step \\\\\\"$2\\\\\\" of scenario \\\\\\"$1\\\\\\".\\", \\"key_\\": \\"web.test.rspcode[{0},{1}]\\".format(urlname, urlname)}}) request = ZabbixAPI.do_request(auth, json_obj) return request[\\"result\\"][0][\\"itemid\\"] # 增加图形 def create_graph(auth, urlname, hostid): try: itemid = getitem(auth, hostid, urlname) json_obj = ZabbixAPI.json_obj(auth, 'graph.create', params={\\"name\\": \\"h5_{0}状态显示\\".format(urlname), \\"width\\": 900, \\"height\\": 200, \\"gitems\\": [{\\"itemid\\": itemid, \\"color\\": \\"008800\\"}]}) ZabbixAPI.do_request(auth, json_obj) except Exception as e: print(e) sys.exit(1) def main(): auth = login(ZABBIX_SREVER, USERNAME, PASSWORD) hostid = gethostid(auth, HOSTNAME) applicationid = getapplicationid(auth, hostid) create_web_scenario(auth, urlname, url, hostid, applicationid, delay) create_trigger(auth, HOSTNAME, urlname, url) create_graph(auth, urlname, hostid) if __name__ == '__main__': main() # json_obj = ZabbixAPI.json_obj(auth, 'httptest.get', params={\\"applicationids\\": applicationid}) # request = ZabbixAPI.do_request(auth, json_obj) # print(json.dumps(request, ensure_ascii=False, indent=4))","head":[["meta",{"property":"og:url","content":"https://clay-wangzhi.com/monitor/zabbix/zabbix-api-web.html"}],["meta",{"property":"og:site_name","content":"SRE运维进阶之路"}],["meta",{"property":"og:title","content":"7 用zabbix api批量添加web监控"}],["meta",{"property":"og:description","content":"7 用zabbix api批量添加web监控 python脚本如下： vim zabbix_agent.py # ~*~ coding:utf-8 ~*~ from zabbix_api import ZabbixAPI import sys import json ZABBIX_SREVER = \\"http://192.168.162.122\\" USERNAME = \\"Admin\\" PASSWORD = \\"zabbix\\" #HOSTNAME = \\"sh_ylf_15\\" #HOSTNAME = \\"h5_web_monitor\\" HOSTNAME = sys.argv[4] urlname = sys.argv[1] url = sys.argv[2] delay = sys.argv[3] # 登录 def login(ZABBIX_SREVER, USERNAME, PASSWORD): zapi = ZabbixAPI(ZABBIX_SREVER) zapi.login(USERNAME, PASSWORD) return zapi # 获取主机id def gethostid(auth, HOSTNAME): json_obj = ZabbixAPI.json_obj(auth, 'host.get', params={\\"filter\\": {\\"host\\": HOSTNAME}}) request = ZabbixAPI.do_request(auth, json_obj) if request['result']: return request['result'][0]['hostid'] else: print(\\"找不到该主机\\") sys.exit(1) # 获取应用级id def getapplicationid(auth, hostid): # try: # json_obj = ZabbixAPI.json_obj(auth, 'application.create', params={\\"name\\": \\"Web监测\\",\\"hostid\\": hostid}) # ZabbixAPI.do_request(auth, json_obj) # except Exception as e: # print(e) json_obj = ZabbixAPI.json_obj(auth, 'application.get', params={\\"hostids\\": hostid}) request = ZabbixAPI.do_request(auth, json_obj) for num in range(0, len(request['result'])): if request['result'][num]['name'] == 'Web': return request['result'][num]['applicationid'] # 增加web监控 def create_web_scenario(auth, urlname, url, hostid, applicationid, delay): json_obj = ZabbixAPI.json_obj(auth, 'httptest.get', params={\\"filter\\": {\\"name\\": urlname}}) request = ZabbixAPI.do_request(auth, json_obj) if request['result']: print('该web监控已经添加过了') else: try: json_obj = ZabbixAPI.json_obj(auth, 'httptest.create', params={\\"name\\": urlname, \\"hostid\\": hostid, \\"applicationid\\": applicationid, \\"delay\\": delay, \\"retries\\": '1', \\"steps\\": [ {'name': urlname, 'url': url, 'timeout': '10', 'status_codes': '200', 'no': '1'}]}) ZabbixAPI.do_request(auth, json_obj) except Exception as e: print(e) sys.exit(1) # 增加触发器 def create_trigger(auth, HOSTNAME, urlname, url): expression = \\"{\\" + \\"{0}:web.test.fail[{1}].avg(#3)\\".format(HOSTNAME, urlname) + \\"}\\" + \\"&gt;=1\\" try: json_obj = ZabbixAPI.json_obj(auth, 'trigger.create', params={\\"description\\": \\"{0}访问失败\\".format(urlname), \\"expression\\": expression, \\"priority\\": 5, \\"url\\": url}) ZabbixAPI.do_request(auth, json_obj) except Exception as e: print(e) sys.exit(1) expression = \\"{\\" + \\"{0}:web.test.rspcode[{1},{1}].last(0)\\".format(HOSTNAME, urlname) + \\"}\\" + \\"&lt;&gt;200\\" try: json_obj = ZabbixAPI.json_obj(auth, 'trigger.create', params={\\"description\\": \\"{0}访问异常\\".format(urlname), \\"expression\\": expression, \\"priority\\": 4, \\"url\\": url}) ZabbixAPI.do_request(auth, json_obj) except Exception as e: print(e) sys.exit(1) # 获取监控项id def getitem(auth, hostid, urlname): json_obj = ZabbixAPI.json_obj(auth, 'item.get', params={\\"hostids\\": hostid, \\"webitems\\": \\"1\\", \\"filter\\": {\\"name\\": \\"Response code for step \\\\\\"$2\\\\\\" of scenario \\\\\\"$1\\\\\\".\\", \\"key_\\": \\"web.test.rspcode[{0},{1}]\\".format(urlname, urlname)}}) request = ZabbixAPI.do_request(auth, json_obj) return request[\\"result\\"][0][\\"itemid\\"] # 增加图形 def create_graph(auth, urlname, hostid): try: itemid = getitem(auth, hostid, urlname) json_obj = ZabbixAPI.json_obj(auth, 'graph.create', params={\\"name\\": \\"h5_{0}状态显示\\".format(urlname), \\"width\\": 900, \\"height\\": 200, \\"gitems\\": [{\\"itemid\\": itemid, \\"color\\": \\"008800\\"}]}) ZabbixAPI.do_request(auth, json_obj) except Exception as e: print(e) sys.exit(1) def main(): auth = login(ZABBIX_SREVER, USERNAME, PASSWORD) hostid = gethostid(auth, HOSTNAME) applicationid = getapplicationid(auth, hostid) create_web_scenario(auth, urlname, url, hostid, applicationid, delay) create_trigger(auth, HOSTNAME, urlname, url) create_graph(auth, urlname, hostid) if __name__ == '__main__': main() # json_obj = ZabbixAPI.json_obj(auth, 'httptest.get', params={\\"applicationids\\": applicationid}) # request = ZabbixAPI.do_request(auth, json_obj) # print(json.dumps(request, ensure_ascii=False, indent=4))"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-04-19T13:08:31.000Z"}],["meta",{"property":"article:author","content":"Clay"}],["meta",{"property":"article:tag","content":"Zabbix"}],["meta",{"property":"article:modified_time","content":"2023-04-19T13:08:31.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"7 用zabbix api批量添加web监控\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-04-19T13:08:31.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Clay\\",\\"url\\":\\"https://clay-wangzhi.com\\"}]}"]]},"headers":[],"git":{"createdTime":1681909711000,"updatedTime":1681909711000,"contributors":[{"name":"clay-wangzhi","email":"clay.wangzhi@gmail.com","commits":1}]},"readingTime":{"minutes":2.24,"words":673},"filePathRelative":"monitor/zabbix/zabbix-api-web.md","localizedDate":"2023年4月19日","excerpt":"<h1> 7 用zabbix api批量添加web监控</h1>\\n<p>python脚本如下：</p>\\n<p><code>vim zabbix_agent.py</code></p>\\n<div class=\\"language-python line-numbers-mode\\" data-ext=\\"py\\"><pre class=\\"language-python\\"><code><span class=\\"token comment\\"># ~*~ coding:utf-8 ~*~</span>\\n<span class=\\"token keyword\\">from</span> zabbix_api <span class=\\"token keyword\\">import</span> ZabbixAPI\\n<span class=\\"token keyword\\">import</span> sys\\n<span class=\\"token keyword\\">import</span> json\\n\\nZABBIX_SREVER <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"http://192.168.162.122\\"</span>\\nUSERNAME <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"Admin\\"</span>\\nPASSWORD <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"zabbix\\"</span>\\n<span class=\\"token comment\\">#HOSTNAME = \\"sh_ylf_15\\"</span>\\n<span class=\\"token comment\\">#HOSTNAME = \\"h5_web_monitor\\"</span>\\nHOSTNAME <span class=\\"token operator\\">=</span> sys<span class=\\"token punctuation\\">.</span>argv<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">4</span><span class=\\"token punctuation\\">]</span>\\nurlname <span class=\\"token operator\\">=</span> sys<span class=\\"token punctuation\\">.</span>argv<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">]</span>\\nurl <span class=\\"token operator\\">=</span> sys<span class=\\"token punctuation\\">.</span>argv<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">2</span><span class=\\"token punctuation\\">]</span>\\ndelay <span class=\\"token operator\\">=</span> sys<span class=\\"token punctuation\\">.</span>argv<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">3</span><span class=\\"token punctuation\\">]</span>\\n\\n\\n<span class=\\"token comment\\"># 登录</span>\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">login</span><span class=\\"token punctuation\\">(</span>ZABBIX_SREVER<span class=\\"token punctuation\\">,</span> USERNAME<span class=\\"token punctuation\\">,</span> PASSWORD<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    zapi <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">(</span>ZABBIX_SREVER<span class=\\"token punctuation\\">)</span>\\n    zapi<span class=\\"token punctuation\\">.</span>login<span class=\\"token punctuation\\">(</span>USERNAME<span class=\\"token punctuation\\">,</span> PASSWORD<span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">return</span> zapi\\n\\n\\n<span class=\\"token comment\\"># 获取主机id</span>\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">gethostid</span><span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> HOSTNAME<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    json_obj <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>json_obj<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'host.get'</span><span class=\\"token punctuation\\">,</span> params<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"filter\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"host\\"</span><span class=\\"token punctuation\\">:</span> HOSTNAME<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n    request <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>do_request<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> json_obj<span class=\\"token punctuation\\">)</span>\\n\\n    <span class=\\"token keyword\\">if</span> request<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'result'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">return</span> request<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'result'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'hostid'</span><span class=\\"token punctuation\\">]</span>\\n    <span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"找不到该主机\\"</span><span class=\\"token punctuation\\">)</span>\\n        sys<span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span>\\n\\n\\n<span class=\\"token comment\\"># 获取应用级id</span>\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">getapplicationid</span><span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> hostid<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token comment\\"># try:</span>\\n    <span class=\\"token comment\\">#     json_obj = ZabbixAPI.json_obj(auth, 'application.create', params={\\"name\\": \\"Web监测\\",\\"hostid\\": hostid})</span>\\n    <span class=\\"token comment\\">#     ZabbixAPI.do_request(auth, json_obj)</span>\\n    <span class=\\"token comment\\"># except Exception as e:</span>\\n    <span class=\\"token comment\\">#     print(e)</span>\\n    json_obj <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>json_obj<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'application.get'</span><span class=\\"token punctuation\\">,</span> params<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"hostids\\"</span><span class=\\"token punctuation\\">:</span> hostid<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n    request <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>do_request<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> json_obj<span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">for</span> num <span class=\\"token keyword\\">in</span> <span class=\\"token builtin\\">range</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">len</span><span class=\\"token punctuation\\">(</span>request<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'result'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">if</span> request<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'result'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span>num<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'Web'</span><span class=\\"token punctuation\\">:</span>\\n            <span class=\\"token keyword\\">return</span> request<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'result'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span>num<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'applicationid'</span><span class=\\"token punctuation\\">]</span>\\n\\n\\n<span class=\\"token comment\\"># 增加web监控</span>\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">create_web_scenario</span><span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">,</span> url<span class=\\"token punctuation\\">,</span> hostid<span class=\\"token punctuation\\">,</span> applicationid<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    json_obj <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>json_obj<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'httptest.get'</span><span class=\\"token punctuation\\">,</span> params<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"filter\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"name\\"</span><span class=\\"token punctuation\\">:</span> urlname<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n    request <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>do_request<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> json_obj<span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">if</span> request<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'result'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'该web监控已经添加过了'</span><span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n            json_obj <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>json_obj<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'httptest.create'</span><span class=\\"token punctuation\\">,</span>\\n                                          params<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"name\\"</span><span class=\\"token punctuation\\">:</span> urlname<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"hostid\\"</span><span class=\\"token punctuation\\">:</span> hostid<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"applicationid\\"</span><span class=\\"token punctuation\\">:</span> applicationid<span class=\\"token punctuation\\">,</span>\\n                                                  <span class=\\"token string\\">\\"delay\\"</span><span class=\\"token punctuation\\">:</span> delay<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"retries\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'1'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"steps\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span>\\n                                                  <span class=\\"token punctuation\\">{</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">:</span> urlname<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'url'</span><span class=\\"token punctuation\\">:</span> url<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'timeout'</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'10'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'status_codes'</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'200'</span><span class=\\"token punctuation\\">,</span>\\n                                                   <span class=\\"token string\\">'no'</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'1'</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n            ZabbixAPI<span class=\\"token punctuation\\">.</span>do_request<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> json_obj<span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token keyword\\">except</span> Exception <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n            <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span>\\n            sys<span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span>\\n\\n\\n<span class=\\"token comment\\"># 增加触发器</span>\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">create_trigger</span><span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> HOSTNAME<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">,</span> url<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    expression <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"{\\"</span> <span class=\\"token operator\\">+</span> <span class=\\"token string\\">\\"{0}:web.test.fail[{1}].avg(#3)\\"</span><span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">format</span><span class=\\"token punctuation\\">(</span>HOSTNAME<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">+</span> <span class=\\"token string\\">\\"}\\"</span> <span class=\\"token operator\\">+</span> <span class=\\"token string\\">\\"&gt;=1\\"</span>\\n    <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n        json_obj <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>json_obj<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'trigger.create'</span><span class=\\"token punctuation\\">,</span>\\n                                      params<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"description\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"{0}访问失败\\"</span><span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">format</span><span class=\\"token punctuation\\">(</span>urlname<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"expression\\"</span><span class=\\"token punctuation\\">:</span> expression<span class=\\"token punctuation\\">,</span>\\n                                              <span class=\\"token string\\">\\"priority\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">5</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"url\\"</span><span class=\\"token punctuation\\">:</span> url<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n        ZabbixAPI<span class=\\"token punctuation\\">.</span>do_request<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> json_obj<span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">except</span> Exception <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span>\\n        sys<span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span>\\n\\n    expression <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"{\\"</span> <span class=\\"token operator\\">+</span> <span class=\\"token string\\">\\"{0}:web.test.rspcode[{1},{1}].last(0)\\"</span><span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">format</span><span class=\\"token punctuation\\">(</span>HOSTNAME<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">+</span> <span class=\\"token string\\">\\"}\\"</span> <span class=\\"token operator\\">+</span> <span class=\\"token string\\">\\"&lt;&gt;200\\"</span>\\n    <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n        json_obj <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>json_obj<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'trigger.create'</span><span class=\\"token punctuation\\">,</span>\\n                                      params<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"description\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"{0}访问异常\\"</span><span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">format</span><span class=\\"token punctuation\\">(</span>urlname<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"expression\\"</span><span class=\\"token punctuation\\">:</span> expression<span class=\\"token punctuation\\">,</span>\\n                                              <span class=\\"token string\\">\\"priority\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">4</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"url\\"</span><span class=\\"token punctuation\\">:</span> url<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n        ZabbixAPI<span class=\\"token punctuation\\">.</span>do_request<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> json_obj<span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">except</span> Exception <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span>\\n        sys<span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span>\\n\\n\\n<span class=\\"token comment\\"># 获取监控项id</span>\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">getitem</span><span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> hostid<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    json_obj <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>json_obj<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'item.get'</span><span class=\\"token punctuation\\">,</span>\\n                                  params<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"hostids\\"</span><span class=\\"token punctuation\\">:</span> hostid<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"webitems\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"1\\"</span><span class=\\"token punctuation\\">,</span>\\n                                          <span class=\\"token string\\">\\"filter\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"name\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"Response code for step \\\\\\"$2\\\\\\" of scenario \\\\\\"$1\\\\\\".\\"</span><span class=\\"token punctuation\\">,</span>\\n                                                     <span class=\\"token string\\">\\"key_\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"web.test.rspcode[{0},{1}]\\"</span><span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">format</span><span class=\\"token punctuation\\">(</span>urlname<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n    request <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>do_request<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> json_obj<span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">return</span> request<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"result\\"</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"itemid\\"</span><span class=\\"token punctuation\\">]</span>\\n\\n\\n<span class=\\"token comment\\"># 增加图形</span>\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">create_graph</span><span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">,</span> hostid<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>\\n        itemid <span class=\\"token operator\\">=</span> getitem<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> hostid<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">)</span>\\n        json_obj <span class=\\"token operator\\">=</span> ZabbixAPI<span class=\\"token punctuation\\">.</span>json_obj<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'graph.create'</span><span class=\\"token punctuation\\">,</span>\\n                                      params<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"name\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"h5_{0}状态显示\\"</span><span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">format</span><span class=\\"token punctuation\\">(</span>urlname<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"width\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">900</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"height\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">200</span><span class=\\"token punctuation\\">,</span>\\n                                              <span class=\\"token string\\">\\"gitems\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span><span class=\\"token string\\">\\"itemid\\"</span><span class=\\"token punctuation\\">:</span> itemid<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"color\\"</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"008800\\"</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>\\n        ZabbixAPI<span class=\\"token punctuation\\">.</span>do_request<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> json_obj<span class=\\"token punctuation\\">)</span>\\n    <span class=\\"token keyword\\">except</span> Exception <span class=\\"token keyword\\">as</span> e<span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span>e<span class=\\"token punctuation\\">)</span>\\n        sys<span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">)</span>\\n\\n\\n<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">main</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>\\n    auth <span class=\\"token operator\\">=</span> login<span class=\\"token punctuation\\">(</span>ZABBIX_SREVER<span class=\\"token punctuation\\">,</span> USERNAME<span class=\\"token punctuation\\">,</span> PASSWORD<span class=\\"token punctuation\\">)</span>\\n    hostid <span class=\\"token operator\\">=</span> gethostid<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> HOSTNAME<span class=\\"token punctuation\\">)</span>\\n    applicationid <span class=\\"token operator\\">=</span> getapplicationid<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> hostid<span class=\\"token punctuation\\">)</span>\\n\\n    create_web_scenario<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">,</span> url<span class=\\"token punctuation\\">,</span> hostid<span class=\\"token punctuation\\">,</span> applicationid<span class=\\"token punctuation\\">,</span> delay<span class=\\"token punctuation\\">)</span>\\n    create_trigger<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> HOSTNAME<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">,</span> url<span class=\\"token punctuation\\">)</span>\\n    create_graph<span class=\\"token punctuation\\">(</span>auth<span class=\\"token punctuation\\">,</span> urlname<span class=\\"token punctuation\\">,</span> hostid<span class=\\"token punctuation\\">)</span>\\n\\n\\n<span class=\\"token keyword\\">if</span> __name__ <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'__main__'</span><span class=\\"token punctuation\\">:</span>\\n    main<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n\\n<span class=\\"token comment\\"># json_obj = ZabbixAPI.json_obj(auth, 'httptest.get', params={\\"applicationids\\": applicationid})</span>\\n<span class=\\"token comment\\"># request = ZabbixAPI.do_request(auth, json_obj)</span>\\n<span class=\\"token comment\\"># print(json.dumps(request, ensure_ascii=False, indent=4))</span>\\n\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","copyright":{"author":"Clay"},"autoDesc":true}`);export{n as data};

import{_ as p,r as l,c as t,a as s,b as r,F as o,d as n,e as a,o as c}from"./app.c279a5c9.js";const i={},d=s("h1",{id:"harbor-\u9AD8\u53EF\u7528\u642D\u5EFA",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#harbor-\u9AD8\u53EF\u7528\u642D\u5EFA","aria-hidden":"true"},"#"),n(" Harbor \u9AD8\u53EF\u7528\u642D\u5EFA")],-1),b=s("h2",{id:"harbor\u7B80\u4ECB",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#harbor\u7B80\u4ECB","aria-hidden":"true"},"#"),n(" Harbor\u7B80\u4ECB")],-1),u={href:"https://goharbor.io/",target:"_blank",rel:"noopener noreferrer"},m=n("Harbor"),h=n("\u662F\u4E00\u4E2A\u7528\u4E8E\u5B58\u50A8\u548C\u5206\u53D1"),g=s("code",null,"Docker\u955C\u50CF",-1),k=n("\u7684\u4F01\u4E1A\u7EA7"),v=s("code",null,"Registry",-1),_=n("\u670D\u52A1\u5668\uFF0C\u901A\u8FC7\u6DFB\u52A0\u4E00\u4E9B\u4F01\u4E1A\u5FC5\u9700\u7684\u529F\u80FD\u7279\u6027\uFF0C\u4F8B\u5982\u5B89\u5168\u3001\u6807\u8BC6\u548C\u7BA1\u7406\u7B49\uFF0C\u6269\u5C55\u4E86\u5F00\u6E90Docker Distribution\u3002"),y=a('<p>\u4F5C\u4E3A\u4E00\u4E2A\u4F01\u4E1A\u7EA7\u79C1\u6709Registry\u670D\u52A1\u5668\uFF0CHarbor\u63D0\u4F9B\u4E86\u66F4\u597D\u7684\u6027\u80FD\u548C\u5B89\u5168\u3002</p><p>\u63D0\u5347\u7528\u6237\u4F7F\u7528Registry\u6784\u5EFA\u548C\u8FD0\u884C\u73AF\u5883\u4F20\u8F93\u955C\u50CF\u7684\u6548\u7387\u3002</p><p>Harbor\u652F\u6301\u5B89\u88C5\u5728\u591A\u4E2ARegistry\u8282\u70B9\u7684\u955C\u50CF\u8D44\u6E90\u590D\u5236\uFF0C\u955C\u50CF\u5168\u90E8\u4FDD\u5B58\u5728\u79C1\u6709Registry\u4E2D\uFF0C \u786E\u4FDD\u6570\u636E\u548C\u77E5\u8BC6\u4EA7\u6743\u5728\u516C\u53F8\u5185\u90E8\u7F51\u7EDC\u4E2D\u7BA1\u63A7\u3002</p><p>\u53E6\u5916\uFF0CHarbor\u4E5F\u63D0\u4F9B\u4E86\u9AD8\u7EA7\u7684\u5B89\u5168\u7279\u6027\uFF0C\u8BF8\u5982\u7528\u6237\u7BA1\u7406\uFF0C\u8BBF\u95EE\u63A7\u5236\u548C\u6D3B\u52A8\u5BA1\u8BA1\u7B49\u3002</p><h2 id="\u9AD8\u53EF\u7528\u67B6\u6784-\u53CC\u4E3B\u590D\u5236" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u53EF\u7528\u67B6\u6784-\u53CC\u4E3B\u590D\u5236" aria-hidden="true">#</a> \u9AD8\u53EF\u7528\u67B6\u6784\uFF1A\u53CC\u4E3B\u590D\u5236</h2><h3 id="\u4E3B\u4ECE\u540C\u6B65" tabindex="-1"><a class="header-anchor" href="#\u4E3B\u4ECE\u540C\u6B65" aria-hidden="true">#</a> \u4E3B\u4ECE\u540C\u6B65</h3><p>harbor\u5B98\u65B9\u9ED8\u8BA4\u63D0\u4F9B\u4E3B\u4ECE\u590D\u5236\u7684\u65B9\u6848\u6765\u89E3\u51B3\u955C\u50CF\u540C\u6B65\u95EE\u9898\uFF0C\u901A\u8FC7\u590D\u5236\u7684\u65B9\u5F0F\uFF0C\u6211\u4EEC\u53EF\u4EE5\u5B9E\u65F6\u5C06\u6D4B\u8BD5\u73AF\u5883harbor\u4ED3\u5E93\u7684\u955C\u50CF\u540C\u6B65\u5230\u751F\u4EA7\u73AF\u5883harbor\uFF0C\u7C7B\u4F3C\u4E8E\u5982\u4E0B\u6D41\u7A0B\uFF1A</p><p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/harbor_CI.png" alt="img" loading="lazy"></p><p>\u5728\u5B9E\u9645\u751F\u4EA7\u8FD0\u7EF4\u7684\u4E2D\uFF0C\u5F80\u5F80\u9700\u8981\u628A\u955C\u50CF\u53D1\u5E03\u5230\u51E0\u5341\u6216\u4E0A\u767E\u53F0\u96C6\u7FA4\u8282\u70B9\u4E0A\u3002\u8FD9\u65F6\uFF0C\u5355\u4E2ARegistry\u5DF2\u7ECF\u65E0\u6CD5\u6EE1\u8DB3\u5927\u91CF\u8282\u70B9\u7684\u4E0B\u8F7D\u9700\u6C42\uFF0C\u56E0\u6B64\u8981\u914D\u7F6E\u591A\u4E2ARegistry\u5B9E\u4F8B\u505A\u8D1F\u8F7D\u5747\u8861\u3002\u624B\u5DE5\u7EF4\u62A4\u591A\u4E2ARegistry\u5B9E\u4F8B\u4E0A\u7684\u955C\u50CF\uFF0C\u5C06\u662F\u5341\u5206\u7E41\u7410\u7684\u4E8B\u60C5\u3002Harbor\u53EF\u4EE5\u652F\u6301\u4E00\u4E3B\u591A\u4ECE\u7684\u955C\u50CF\u53D1\u5E03\u6A21\u5F0F\uFF0C\u53EF\u4EE5\u89E3\u51B3\u5927\u89C4\u6A21\u955C\u50CF\u53D1\u5E03\u7684\u96BE\u9898\uFF1A</p><p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/harbor_ab.png" alt="img" loading="lazy"></p><p>\u53EA\u8981\u5F80\u4E00\u53F0Harbor\u4E0A\u53D1\u5E03\uFF0C\u955C\u50CF\u5C31\u4F1A\u50CF&quot;\u4ED9\u5973\u6563\u82B1&quot;\u822C\u5730\u540C\u6B65\u5230\u591A\u4E2ARegistry\u4E2D\uFF0C\u9AD8\u6548\u53EF\u9760\u3002</p><p>\u5982\u679C\u662F\u5730\u57DF\u5206\u5E03\u8F83\u5E7F\u7684\u96C6\u7FA4\uFF0C\u8FD8\u53EF\u4EE5\u91C7\u7528\u5C42\u6B21\u578B\u53D1\u5E03\u65B9\u5F0F\uFF0C\u6BD4\u5982\u4ECE\u96C6\u56E2\u603B\u90E8\u673A\u623F\u540C\u6B65\u5230\u5206\u516C\u53F81\u673A\u623F\uFF0C\u518D\u4ECE\u5206\u516C\u53F81\u673A\u623F\u540C\u6B65\u5230\u5206\u516C\u53F82\u673A\u623F\uFF1A</p><p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/harbor_cl.png" alt="img" loading="lazy"></p><p>\u7136\u800C\u5355\u9760\u4E3B\u4ECE\u540C\u6B65\uFF0C\u4ECD\u7136\u89E3\u51B3\u4E0D\u4E86harbor\u4E3B\u8282\u70B9\u7684\u5355\u70B9\u95EE\u9898\u3002</p><h3 id="\u53CC\u4E3B\u590D\u5236\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#\u53CC\u4E3B\u590D\u5236\u8BF4\u660E" aria-hidden="true">#</a> \u53CC\u4E3B\u590D\u5236\u8BF4\u660E</h3><p>\u6240\u8C13\u7684\u53CC\u4E3B\u590D\u5236\u5176\u5B9E\u5C31\u662F\u590D\u7528\u4E3B\u4ECE\u540C\u6B65\u5B9E\u73B0\u4E24\u4E2Aharbor\u8282\u70B9\u4E4B\u95F4\u7684\u53CC\u5411\u540C\u6B65\uFF0C\u6765\u4FDD\u8BC1\u6570\u636E\u7684\u4E00\u81F4\u6027\uFF0C\u7136\u540E\u5728\u4E24\u53F0harbor\u524D\u7AEF\u9876\u4E00\u4E2A\u8D1F\u8F7D\u5747\u8861\u5668\u5C06\u8FDB\u6765\u7684\u8BF7\u6C42\u5206\u6D41\u5230\u4E0D\u540C\u7684\u5B9E\u4F8B\u4E2D\u53BB\uFF0C\u53EA\u8981\u6709\u4E00\u4E2A\u5B9E\u4F8B\u4E2D\u6709\u4E86\u65B0\u7684\u955C\u50CF\uFF0C\u5C31\u662F\u81EA\u52A8\u7684\u540C\u6B65\u590D\u5236\u5230\u53E6\u5916\u7684\u7684\u5B9E\u4F8B\u4E2D\u53BB\uFF0C\u8FD9\u6837\u5B9E\u73B0\u4E86\u8D1F\u8F7D\u5747\u8861\uFF0C\u4E5F\u907F\u514D\u4E86\u5355\u70B9\u6545\u969C\uFF0C\u5728\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u5B9E\u73B0\u4E86Harbor\u7684\u9AD8\u53EF\u7528\u6027\uFF1A</p><p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/harbor_st.png" alt="img" loading="lazy"></p><p>\u8FD9\u4E2A\u65B9\u6848\u6709\u4E00\u4E2A\u95EE\u9898\u5C31\u662F\u6709\u53EF\u80FD\u4E24\u4E2AHarbor\u5B9E\u4F8B\u4E2D\u7684\u6570\u636E\u4E0D\u4E00\u81F4\u3002\u5047\u8BBE\u5982\u679C\u4E00\u4E2A\u5B9E\u4F8BA\u6302\u6389\u4E86\uFF0C\u8FD9\u4E2A\u65F6\u5019\u6709\u65B0\u7684\u955C\u50CF\u8FDB\u6765\uFF0C\u90A3\u4E48\u65B0\u7684\u955C\u50CF\u5C31\u4F1A\u5728\u53E6\u5916\u4E00\u4E2A\u5B9E\u4F8BB\u4E2D\uFF0C\u540E\u9762\u5373\u4F7F\u6062\u590D\u4E86\u6302\u6389\u7684A\u5B9E\u4F8B\uFF0CHarbor\u5B9E\u4F8BB\u4E5F\u4E0D\u4F1A\u81EA\u52A8\u53BB\u540C\u6B65\u955C\u50CF\uFF0C\u8FD9\u6837\u53EA\u80FD\u624B\u52A8\u7684\u5148\u5173\u6389Harbor\u5B9E\u4F8BB\u7684\u590D\u5236\u7B56\u7565\uFF0C\u7136\u540E\u518D\u5F00\u542F\u590D\u5236\u7B56\u7565\uFF0C\u624D\u80FD\u8BA9\u5B9E\u4F8BB\u6570\u636E\u540C\u6B65\uFF0C\u8BA9\u4E24\u4E2A\u5B9E\u4F8B\u7684\u6570\u636E\u4E00\u81F4\u3002\u53E6\u5916\uFF0C\u8FD9\u91CC\u8FD8\u9700\u8981\u591A\u5410\u69FD\u4E00\u53E5\uFF1A<strong>\u5728\u5B9E\u9645\u751F\u4EA7\u4F7F\u7528\u4E2D\uFF0C\u4E3B\u4ECE\u590D\u5236\u5341\u5206\u7684\u4E0D\u9760\u8C31\uFF01\uFF01<strong>\u6240\u4EE5\u8FD9\u91CC</strong>\u63A8\u8350\u4F7F\u7528\u4E0B\u9762\u8981\u8BF4\u7684\u8FD9\u79CD\u65B9\u6848</strong>\u3002</p><h2 id="\u9AD8\u53EF\u7528\u67B6\u6784-\u591A\u5B9E\u4F8B\u5171\u4EAB\u540E\u7AEF\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#\u9AD8\u53EF\u7528\u67B6\u6784-\u591A\u5B9E\u4F8B\u5171\u4EAB\u540E\u7AEF\u5B58\u50A8" aria-hidden="true">#</a> \u9AD8\u53EF\u7528\u67B6\u6784\uFF1A\u591A\u5B9E\u4F8B\u5171\u4EAB\u540E\u7AEF\u5B58\u50A8</h2><h3 id="\u65B9\u6848\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#\u65B9\u6848\u8BF4\u660E" aria-hidden="true">#</a> \u65B9\u6848\u8BF4\u660E</h3><p>\u5171\u4EAB\u540E\u7AEF\u5B58\u50A8\u7B97\u662F\u4E00\u79CD\u6BD4\u8F83\u6807\u51C6\u7684\u65B9\u6848\uFF0C\u5C31\u662F\u591A\u4E2AHarbor\u5B9E\u4F8B\u5171\u4EAB\u540C\u4E00\u4E2A\u540E\u7AEF\u5B58\u50A8\uFF0C\u4EFB\u4F55\u4E00\u4E2A\u5B9E\u4F8B\u6301\u4E45\u5316\u5230\u5B58\u50A8\u7684\u955C\u50CF\uFF0C\u90FD\u53EF\u88AB\u5176\u4ED6\u5B9E\u4F8B\u4E2D\u8BFB\u53D6\u3002\u901A\u8FC7\u524D\u7F6ELB\u8FDB\u6765\u7684\u8BF7\u6C42\uFF0C\u53EF\u4EE5\u5206\u6D41\u5230\u4E0D\u540C\u7684\u5B9E\u4F8B\u4E2D\u53BB\u5904\u7406\uFF0C\u8FD9\u6837\u5C31\u5B9E\u73B0\u4E86\u8D1F\u8F7D\u5747\u8861\uFF0C\u4E5F\u907F\u514D\u4E86\u5355\u70B9\u6545\u969C\u3002</p><p>\u672C\u6B21\u642D\u5EFA\u4EE5NFS\u4F5C\u4E3A\u5171\u4EAB\u5B58\u50A8\u5B58\u653EHarbor\u76F8\u5173data\uFF0C\u5E76\u5206\u79BBPostgreSQL\u4E0ERedis\u4E3A\u591A\u4E2AHarbor\u5171\u540C\u8FDE\u63A5\u4F7F\u7528\uFF0C\u4F7F\u7528Nginx\u505A\u8D1F\u8F7D\u5747\u8861\u3002</p><p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/harbor_ha_r.png" alt="img" loading="lazy"></p><p>\u5982\u679C\u6700\u7EC8\u751F\u4EA7\u73AF\u5883\u96C6\u7FA4\u4E2D\u670D\u52A1\u5668\u8F83\u591A\uFF0C\u4F9D\u8D56\u505A\u5B8CLB\u7684Harbor\u4E5F\u65E0\u6CD5\u5B8C\u5168\u8FBE\u5230\u9700\u6C42\u65F6\uFF0C\u53EF\u4EE5\u4F7F\u7528\u5982\u4E0B\u67B6\u6784\uFF0C\u90E8\u7F72\u4E0B\u7EA7Harbor\u8282\u70B9\u4ECE\u4E3B\u8282\u70B9\u540C\u6B65\u955C\u50CF\uFF0C\u7136\u540E\u518D\u5206\u53D1\u7ED9\u751F\u4EA7\u670D\u52A1\u5668\u3002</p><p><img src="https://gitee.com/clay-wangzhi/blogImg/raw/master/blogImg/harbor_ha_l.png" alt="img" loading="lazy"></p><p>\u8FD9\u4E2A\u65B9\u6848\u5728\u5B9E\u9645\u751F\u4EA7\u73AF\u5883\u4E2D\u90E8\u7F72\u9700\u8981\u8003\u8651\u4E09\u4E2A\u95EE\u9898\uFF1A</p><p><strong>1.</strong> \u5171\u4EAB\u5B58\u50A8\u7684\u9009\u53D6\uFF0CHarbor\u7684\u540E\u7AEF\u5B58\u50A8\u76EE\u524D\u652F\u6301AWS S3\u3001Openstack Swift, Ceph\u7B49\uFF0C\u5728\u4E0B\u9762\u7684\u5B9E\u9A8C\u73AF\u5883\u91CC\uFF0C\u6682\u4E14\u76F4\u63A5\u4F7F\u7528nfs\u3002</p><p><strong>2.</strong> Session\u5728\u4E0D\u540C\u7684\u5B9E\u4F8B\u4E0A\u5171\u4EAB\uFF0C\u8FD9\u4E2A\u73B0\u5728\u5176\u5B9E\u5DF2\u7ECF\u4E0D\u662F\u95EE\u9898\u4E86\uFF0C\u5728\u6700\u65B0\u7684harbor\u4E2D\uFF0C\u9ED8\u8BA4session\u4F1A\u5B58\u653E\u5728redis\u4E2D\uFF0C\u53EA\u9700\u8981\u5C06redis\u72EC\u7ACB\u51FA\u6765\u5373\u53EF\u3002\u53EF\u4EE5\u901A\u8FC7redis sentinel\u6216\u8005redis cluster\u7B49\u65B9\u5F0F\u6765\u4FDD\u8BC1redis\u7684\u53EF\u7528\u6027\u3002\u5728\u4E0B\u9762\u7684\u5B9E\u9A8C\u73AF\u5883\u91CC\uFF0C\u6682\u4E14\u4F7F\u7528\u5355\u53F0redis\u3002</p><p><strong>3.</strong> Harbor\u591A\u5B9E\u4F8B\u6570\u636E\u5E93\u95EE\u9898\uFF0C\u8FD9\u4E2A\u4E5F\u53EA\u9700\u8981\u5C06harbor\u4E2D\u7684\u6570\u636E\u5E93\u62C6\u51FA\u6765\u72EC\u7ACB\u90E8\u7F72\u5373\u53EF\u3002\u8BA9\u591A\u5B9E\u4F8B\u5171\u7528\u4E00\u4E2A\u5916\u90E8\u6570\u636E\u5E93\uFF0C\u6570\u636E\u5E93\u7684\u9AD8\u53EF\u7528\u4E5F\u53EF\u4EE5\u901A\u8FC7\u6570\u636E\u5E93\u7684\u9AD8\u53EF\u7528\u65B9\u6848\u4FDD\u8BC1\u3002</p><h3 id="\u73AF\u5883\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u8BF4\u660E" aria-hidden="true">#</a> \u73AF\u5883\u8BF4\u660E</h3><ul><li>\u64CD\u4F5C\u7CFB\u7EDF\uFF1A<code>CentOS 7.6</code></li><li>\u6F14\u793A\u73AF\u5883\u8F6F\u4EF6\u7248\u672C</li></ul><table><thead><tr><th>\u8F6F\u4EF6</th><th>\u7248\u672C</th></tr></thead><tbody><tr><td>Docker</td><td>20.10.7</td></tr><tr><td>docker-compose</td><td>1.27.4</td></tr><tr><td>Harbor</td><td>2.2.3</td></tr><tr><td>Nginx</td><td>1.14.0</td></tr><tr><td>PostgreSQL</td><td>9.6.22</td></tr><tr><td>Redis</td><td>3.2.12</td></tr></tbody></table><ul><li>\u6F14\u793A\u73AF\u5883\u7F51\u7EDC</li></ul><p>\u8FD9\u91CC\u4E3B\u8981\u505AHarbor\u9AD8\u53EF\u7528\u6F14\u793A\uFF0C\u771F\u5B9E\u751F\u4EA7\u73AF\u5883\u8BF7\u6309\u9700\u5206\u79BBNFS\u4E0EDB\u5355\u72EC\u90E8\u7F72\u3002</p><table><thead><tr><th>IP</th><th>\u4E3B\u673A\u540D</th></tr></thead><tbody><tr><td>192.168.16.141</td><td>Nginx</td></tr><tr><td>192.168.166.122</td><td>NFS</td></tr><tr><td>192.168.166.203</td><td>postgresql</td></tr><tr><td>192.168.166.245</td><td>Redis</td></tr><tr><td>192.168.166.81</td><td>Harbor-01</td></tr><tr><td>192.168.166.212</td><td>Harbor-02</td></tr></tbody></table><h2 id="\u591A\u5B9E\u4F8B\u5171\u4EAB\u540E\u7AEF\u5B58\u50A8-\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u591A\u5B9E\u4F8B\u5171\u4EAB\u540E\u7AEF\u5B58\u50A8-\u90E8\u7F72" aria-hidden="true">#</a> \u591A\u5B9E\u4F8B\u5171\u4EAB\u540E\u7AEF\u5B58\u50A8 \u90E8\u7F72</h2><h3 id="\u5B89\u88C5docker\u548Cdocker-compose" tabindex="-1"><a class="header-anchor" href="#\u5B89\u88C5docker\u548Cdocker-compose" aria-hidden="true">#</a> \u5B89\u88C5Docker\u548CDocker Compose</h3>',37),f=a(`<li><p>\u5B89\u88C5\u914D\u7F6EDocker</p><p>\u4F7F\u7528\u5B98\u65B9\u811A\u672C\u5B89\u88C5 Docker</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -fsSL <span class="token string">&quot;https://get.docker.com/&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span> -s -- --mirror Aliyun
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u52A0\u8F7Dbr_netfilter</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>modprobe br_netfilter
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u8BBE\u7F6E\u4E0B\u7CFB\u7EDF\u5185\u6838\u53C2\u6570</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>cat<span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/sysctl.d/docker.conf</span>
# \u8981\u6C42iptables\u4E0D\u5BF9bridge\u7684\u6570\u636E\u8FDB\u884C\u5904\u7406
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.bridge.bridge-nf-call-arptables = 1
# \u5F00\u542F\u8F6C\u53D1
net.ipv4.ip_forward = 1
EOF</span>
sysctl -p /etc/sysctl.d/docker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>\u26A0\uFE0F \u614E\u7528<code>sysctl --system</code>\u547D\u4EE4\uFF0C\u5982\u679C\u53C2\u6570\u5728\u4E0D\u540C\u6587\u4EF6\u4E2D\u8BBE\u7F6E\uFF0C\u4F1A\u6709\u4F18\u5148\u7EA7\u95EE\u9898\uFF0C\u76EE\u524D\u770B\u6765<code>/etc/sysctl.conf</code>\u7684\u4F18\u5148\u7EA7\u6700\u9AD8</p></blockquote><p>\u914D\u7F6Edocker\u955C\u50CF\u7AD9</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -sSL https://get.daocloud.io/daotools/set_mirror.sh <span class="token operator">|</span> <span class="token function">sh</span> -s http://f1361db2.m.daocloud.io
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u542F\u52A8docker\u670D\u52A1</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> systemctl start <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div></li>`,1),x=s("p",null,"\u5B89\u88C5\u914D\u7F6EDocker Compose",-1),w={href:"https://github.com/docker/compose/releases",target:"_blank",rel:"noopener noreferrer"},q=n("compose"),S=n("\u662FDocker\u63D0\u4F9B\u7684\u4E00\u4E2A\u547D\u4EE4\u884C\u5DE5\u5177\uFF0C\u7528\u6765\u5B9A\u4E49\u548C\u8FD0\u884C\u7531\u591A\u4E2A\u5BB9\u5668\u7EC4\u6210\u7684\u5E94\u7528\u3002\u4F7F\u7528compose\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7YAML\u6587\u4EF6\u58F0\u660E\u5F0F\u7684\u5B9A\u4E49\u5E94\u7528\u7A0B\u5E8F\u7684\u5404\u4E2A\u670D\u52A1\uFF0C\u5E76\u7531\u5355\u4E2A\u547D\u4EE4\u5B8C\u6210\u5E94\u7528\u7684\u521B\u5EFA\u548C\u542F\u52A8\u3002"),H=a(`<p>\u4E8C\u8FDB\u5236\u65B9\u5F0F \u5B89\u88C5Docker Compose</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u914D\u7F6Ebash\u8865\u5168\u547D\u4EE4\uFF0C\u91CD\u65B0\u8FDE\u63A5\u7EC8\u7AEF\u5373\u751F\u6548</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -L https://raw.githubusercontent.com/docker/compose/1.27.4/contrib/completion/bash/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>\u5982\u679C\u7F51\u7EDC\u4E0D\u53EF\u8FBE\uFF0C\u53EF\u5148\u4E0B\u8F7D\u5230\u672C\u5730\uFF0C\u7136\u540E\u4E0A\u4F20\u5230\u5185\u7F51ftp\u670D\u52A1\u5668\u4E0A\uFF0C\u8FDB\u884C\u4E0B\u8F7D\uFF0C\u4EE5\u4E0B\u662F\u7B14\u8005\u81EA\u5DF1\u7684\u5185\u7F51ftp\u4E0B\u8F7D\u5730\u5740</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -L ftp://192.168.166.21/docker-compose <span class="token operator">&gt;</span> /etc/bash_completion.d/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,6),L=a(`<h3 id="nfs" tabindex="-1"><a class="header-anchor" href="#nfs" aria-hidden="true">#</a> NFS</h3><h4 id="\u670D\u52A1\u7AEF" tabindex="-1"><a class="header-anchor" href="#\u670D\u52A1\u7AEF" aria-hidden="true">#</a> \u670D\u52A1\u7AEF</h4><p>1\uFF09\u5B89\u88C5\u5FC5\u9700\u7684RPM\u5305</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> nfs-utils rpcbind   
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2\uFF09\u521B\u5EFANFS\u5171\u4EAB\u76EE\u5F55</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /data/harbor_data
<span class="token function">chown</span> nobody:nobody /data/harbor_data/ 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>3\uFF09\u4FEE\u6539NFS\u670D\u52A1\u914D\u7F6E\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;/data/harbor_data 192.168.166.0/24(rw,sync,no_root_squash)&quot;</span>  <span class="token operator">&gt;&gt;</span> /etc/exports
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>4\uFF09\u542F\u52A8NFS\u670D\u52A1\u5668</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> rpcbind <span class="token operator">&amp;&amp;</span> systemctl restart rpcbind
systemctl <span class="token builtin class-name">enable</span> nfs <span class="token operator">&amp;&amp;</span> systemctl restart nfs
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="\u5BA2\u6237\u7AEF" tabindex="-1"><a class="header-anchor" href="#\u5BA2\u6237\u7AEF" aria-hidden="true">#</a> \u5BA2\u6237\u7AEF</h4><p>1\uFF09\u5B89\u88C5nfs-utils</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> nfs-utils
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2\uFF09\u5728NFS\u5BA2\u6237\u7AEF\u4E0A\u67E5\u770BNFS\u7684\u8FDE\u901A\u6027</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># showmount -e 192.168.166.122</span>
Export list <span class="token keyword">for</span> <span class="token number">192.168</span>.166.122:
/data/harbor_data <span class="token number">192.168</span>.166.0/24
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>3\uFF09\u6302\u8F7DNFS\u5171\u4EAB\u5B58\u50A8</p><p>\u521B\u5EFA\u6302\u8F7D\u76EE\u5F55</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mkdir /data
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>\u4FEE\u6539/etc/fstab\u914D\u7F6E\u6587\u4EF6\u52A0\u5165\u4EE5\u4E0B\u5185\u5BB9</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>192.168.166.122:/data/harbor_data  /data  nfs defaults 0 0
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>mount\u6302\u8F7D</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>mount -a
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="postgresql" tabindex="-1"><a class="header-anchor" href="#postgresql" aria-hidden="true">#</a> PostgreSQL</h3><p>1\uFF09\u4E0B\u8F7DPostgreSQL\u5B98\u65B9YUM\u6E90\u914D\u7F6E\u6587\u4EF6\u5305\u5E76\u5B89\u88C5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
<span class="token function">rpm</span> -ivh pgdg-redhat-repo-latest.noarch.rpm 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>2\uFF09\u5B89\u88C5PostgreSQL</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum  -y <span class="token function">install</span> postgresql96-server postgresql96-contrib 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3\uFF09\u521D\u59CB\u5316\u6570\u636E\u5E93</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>/usr/pgsql-9.6/bin/postgresql96-setup initdb  
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>4\uFF09\u542F\u52A8\u6570\u636E\u5E93</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> postgresql-9.6 <span class="token operator">&amp;&amp;</span> systemctl restart postgresql-9.6
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>5\uFF09PostgreSQL\u6570\u636E\u5E93\u914D\u7F6E</p><ol><li><p>\u4FEE\u6539\u5BC6\u7801</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># su - postgres</span>
-bash-4.2$ psql
psql <span class="token punctuation">(</span><span class="token number">9.6</span>.17<span class="token punctuation">)</span>
Type <span class="token string">&quot;help&quot;</span> <span class="token keyword">for</span> help.
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># ALTER USER postgres WITH PASSWORD &#39;postgres&#39;;</span>
ALTER ROLE
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p>\u5F00\u542F\u8FDC\u7A0B\u8BBF\u95EE</p><p><code>vi /var/lib/pgsql/9.6/data/postgresql.conf</code></p><p># listen_addresses = &#39;localhost&#39; \u6539\u4E3A listen_addresses=&#39;*&#39;</p></li><li><p>\u4FE1\u4EFB\u8FDC\u7A0B\u8FDE\u63A5</p><p><code>vim /var/lib/pgsql/9.6/data/pg_hba.conf</code></p><p>\u52A0\u5165:</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">host</span>    all  all  <span class="token number">192.168</span>.166.203/32 trust
<span class="token function">host</span>    all  all  <span class="token number">192.168</span>.166.81/32 trust
<span class="token function">host</span>    all  all  <span class="token number">192.168</span>.166.212/32 trust
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol><p>6\uFF09\u91CD\u542FPostgreSQL\u670D\u52A1</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl restart postgresql-9.6
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>7\uFF09\u9A8C\u8BC1\u670D\u52A1</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>psql -h 192.168.166.203 -p 5432 -U postgres
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>8\uFF09\u8FC1\u79FB\u6570\u636E\u5E93</p><ol><li><p>\u5728postgresql\u6240\u5728\u670D\u52A1\u5668\uFF0C\u5148\u542F\u52A8\u4E00\u5957harbor\u73AF\u5883</p><p>\u7B80\u8981\u6B65\u9AA4\u5982\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span> -fsSL <span class="token string">&quot;https://get.docker.com/&quot;</span> <span class="token operator">|</span> <span class="token function">bash</span> -s -- --mirror Aliyun
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> <span class="token operator">&amp;&amp;</span> systemctl start <span class="token function">docker</span>
<span class="token function">curl</span> -L https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span> <span class="token operator">&gt;</span> /usr/local/bin/docker-compose
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
<span class="token function">wget</span> https://github.com/goharbor/harbor/releases/download/v2.2.3/harbor-offline-installer-v2.2.3.tgz
<span class="token function">tar</span> -xvf harbor-offline-installer-v2.2.3.tgz -C /usr/local/
<span class="token builtin class-name">cd</span> /usr/local/harbor/
<span class="token function">cp</span> harbor.yml.tmpl harbor.yml
<span class="token function">vim</span> harbor.yml <span class="token comment">###\u4FEE\u6539hostname: 192.168.166.203  ####\u6CE8\u91CA\u6389https\u6BB5\u5373\u53EF</span>
./prepare
./install.sh
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><p>\u8FDB\u5165harbor-db\u5BB9\u5668\u5BFC\u51FA\u76F8\u5173\u8868\u53CA\u6570\u636E</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># docker container exec -it harbor-db /bin/bash</span>
pg_dump -U postgres registry <span class="token operator">&gt;</span> /tmp/registry.sql 
pg_dump -U postgres notarysigner <span class="token operator">&gt;</span> /tmp/notarysigner.sql  
pg_dump -U postgres notaryserver <span class="token operator">&gt;</span> /tmp/notaryserver.sql
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p>\u5BFC\u51FA\u6570\u636E\u5E93</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> container <span class="token function">cp</span> harbor-db:/tmp/registry.sql /tmp
<span class="token function">docker</span> container <span class="token function">cp</span> harbor-db:/tmp/notarysigner.sql /tmp
<span class="token function">docker</span> container <span class="token function">cp</span> harbor-db:/tmp/notaryserver.sql /tmp
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>\u5C06\u6570\u636E\u5BFC\u5165\u81F3\u5916\u90E8PostgreSQL\u6570\u636E\u5E93</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># psql -h 192.168.166.203 -U postgres</span>
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># create database registry;</span>
CREATE DATABASE
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># create database notarysigner;</span>
CREATE DATABASE
<span class="token assign-left variable">postgres</span><span class="token operator">=</span><span class="token comment"># create database notaryserver;</span>
CREATE DATABASE
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>psql -h <span class="token number">192.168</span>.166.203 -U postgres registry <span class="token operator">&lt;</span> /tmp/registry.sql
psql -h <span class="token number">192.168</span>.166.203 -U postgres notarysigner  <span class="token operator">&lt;</span> /tmp/notarysigner.sql
psql -h <span class="token number">192.168</span>.166.203 -U postgres notaryserver <span class="token operator">&lt;</span> /tmp/notaryserver.sql
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol><h3 id="redis" tabindex="-1"><a class="header-anchor" href="#redis" aria-hidden="true">#</a> Redis</h3><p>1\uFF09\u5B89\u88C5redis</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum -y <span class="token function">install</span> redis
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2\uFF09 \u4FEE\u6539\u914D\u7F6E\u53C2\u6570</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">sed</span> -i <span class="token string">&#39;s/bind 127.0.0.1/bind 0.0.0.0/g&#39;</span> /etc/redis.conf   
<span class="token function">sed</span> -i <span class="token string">&#39;s/daemonize no/daemonize yes/g&#39;</span> /etc/redis.conf   
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>3\uFF09\u542F\u52A8\u5E76\u6D4B\u8BD5redis\u8FDE\u63A5</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> redis <span class="token operator">&amp;&amp;</span> systemctl restart redis
redis-cli 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="harbor" tabindex="-1"><a class="header-anchor" href="#harbor" aria-hidden="true">#</a> Harbor</h3>`,47),R=n("\u4E0B\u8F7D"),A={href:"https://github.com/goharbor/harbor/releases",target:"_blank",rel:"noopener noreferrer"},z=n("Harbor"),E=n("\u79BB\u7EBF\u5B89\u88C5\u5305\uFF0C\u79BB\u7EBF\u5B89\u88C5\u5305\u6587\u4EF6\u8F83\u5927\uFF08\u7EA6\u4E3A\uFF1A590M\uFF09\uFF0C\u5EFA\u8BAE\u5728\u672C\u5730\u4F7F\u7528\u591A\u7EBF\u7A0B\u5DE5\u5177\u4E0B\u8F7D\u540E\u4E0A\u4F20\u670D\u52A1\u5668\u4F7F\u7528\u3002"),F=a(`<p>1\uFF09\u4E0B\u8F7D</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/goharbor/harbor/releases/download/v2.2.3/harbor-offline-installer-v2.2.3.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2\uFF09\u89E3\u538B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -xvf harbor-offline-installer-v2.2.3.tgz -C /usr/local/
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3\uFF09\u4FEE\u6539\u914D\u7F6E\u6587\u4EF6</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/harbor/
<span class="token function">cp</span> harbor.yml.tmpl harbor.yml
<span class="token function">vim</span> harbor.yml
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u4FEE\u6539\u7684\u5185\u5BB9\u6709</p><ul><li><code>hostname</code>\u4FEE\u6539\u4E3A\u672C\u673Aip</li><li>\u6CE8\u91CA\u6389https</li><li>\u4FEE\u6539harbor\u9ED8\u8BA4\u7684admin\u8D26\u53F7\u5BC6\u7801</li><li>\u6570\u636E\u5B58\u50A8\u4F4D\u7F6E\uFF0C\u6539\u4E3Anfs\u6302\u8F7D\u76EE\u5F55\uFF0C\u56E0\u4E3A\u6211\u4EEC\u672C\u6765\u5C31\u6302\u8F7D\u5230\u4E86<code>/data</code>\u76EE\u5F55\u4E0B\uFF0C\u6240\u4EE5\u4E0D\u7528\u52A8</li><li>\u6CE8\u91CA\u6389<code>database</code></li><li>\u6CE8\u91CA\u6389<code>clair</code></li><li>\u6253\u5F00<code>external_database</code>\u548C<code>external_redis</code>\u5757\u7684\u6CE8\u91CA\uFF0C\u5E76\u6539\u4E3A\u521A\u521A\u90E8\u7F72\u7684\u5730\u5740</li></ul><p>\u4FEE\u6539\u5B8C\u7684\u6837\u4F8B\u6587\u4EF6\uFF0C\u5982\u4E0B</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hostname: 192.168.166.81
http:
  port: 80
harbor_admin_password: Harbor12345
data_volume: /data
jobservice:
  max_job_workers: 10
notification:
  webhook_job_max_retry: 10
chart:
  absolute_url: disabled
log:
  level: info
  local:
    rotate_count: 50
    rotate_size: 200M
    location: /var/log/harbor
_version: 1.10.0
external_database:
  harbor:
    host: 192.168.166.203
    port: 5432
    db_name: registry
    username: postgres
    password: postgres
    ssl_mode: disable
    max_idle_conns: 2
    max_open_conns: 0
  notary_signer:
    host: 192.168.166.203
    port: 5432
    db_name: notarysigner
    username: postgres
    password: postgres
    ssl_mode: disable
  notary_server:
    host: 192.168.166.203
    port: 5432
    db_name: notaryserver
    username: postgres
    password: postgres
    ssl_mode: disable
external_redis:
  host: 192.168.166.245:6379
  password:
  registry_db_index: 1
  jobservice_db_index: 2
  chartmuseum_db_index: 3
  trivy_db_index: 5
  idle_timeout_seconds: 30

proxy:
  http_proxy:
  https_proxy:
  no_proxy:
  components:
    - core
    - jobservice
    - trivy
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>4\uFF09\u751F\u6210harbor\u8FD0\u884C\u7684\u5FC5\u8981\u6587\u4EF6\uFF08\u73AF\u5883\uFF09\u4EE5\u53CA<code>docker-compose.yml</code>\u6587\u4EF6\uFF1B\u6267\u884C\u540E\u4F1A\u901A\u8FC7\u7F51\u7EDC\u83B7\u53D6Docker Image\uFF0C\u5EFA\u8BAE\u63D0\u524D\u4FEE\u6539\u597D\u56FD\u5185\u955C\u50CF\u7AD9\u52A0\u901F\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./prepare 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>5\uFF09\u5B89\u88C5Harbor</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./install.sh 
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><blockquote><p>\u26A0\uFE0F \u521D\u8BC6\u5BC6\u7801\u5DF2\u5B58\u5728 PostgreSQL \u4E2D\uFF0C\u8BB0\u5F97\u767B\u5F55\u5148 \u66F4\u6539\u4E3A\u590D\u6742\u5BC6\u7801</p></blockquote><h3 id="nginx" tabindex="-1"><a class="header-anchor" href="#nginx" aria-hidden="true">#</a> Nginx</h3><p>1\uFF09\u5B89\u88C5nginx\uFF08\u7565\uFF09</p><p>2\uFF09\u7F16\u5199\u914D\u7F6E\u6587\u4EF6</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> harbor</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.166.81:80</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.168.166.212:80</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span>  harbor.***.com</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^(.*) https://<span class="token variable">$server_name</span><span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>  <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> xxx.xxx.com</span><span class="token punctuation">;</span>
    
    <span class="token directive"><span class="token keyword">ssl_certificate</span> ***.crt</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> ***.key</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">0</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">chunked_transfer_encoding</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto https</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_ssl_verify</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_ssl_session_reuse</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://harbor</span><span class="token punctuation">;</span>
		<span class="token directive"><span class="token keyword">proxy_redirect</span> default</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">location</span> /v2/</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">proxy_pass</span> http://harbor/v2/</span><span class="token punctuation">;</span>
		<span class="token directive"><span class="token keyword">proxy_redirect</span> default</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_ssl_verify</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_ssl_session_reuse</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_buffering</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">proxy_request_buffering</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>3\uFF09\u5E73\u6ED1\u91CD\u542Fnginx</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>nginx -s reload
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="\u53C2\u8003\u6587\u7AE0" tabindex="-1"><a class="header-anchor" href="#\u53C2\u8003\u6587\u7AE0" aria-hidden="true">#</a> \u53C2\u8003\u6587\u7AE0</h2><blockquote><p>https://www.cnblogs.com/kevingrace/p/11422710.html</p><p>https://juejin.im/post/5d973e246fb9a04dfa0963fb#heading-18</p><p>https://mp.weixin.qq.com/s/h2fXmKeQeAkKLjUhd8sUBg</p></blockquote>`,23);function I(N,D){const e=l("ExternalLinkIcon");return c(),t(o,null,[d,b,s("p",null,[s("a",u,[m,r(e)]),h,g,k,v,_]),y,s("ol",null,[f,s("li",null,[x,s("p",null,[s("a",w,[q,r(e)]),S]),H])]),L,s("p",null,[R,s("a",A,[z,r(e)]),E]),F],64)}var B=p(i,[["render",I],["__file","docker_harbor_ha.html.vue"]]);export{B as default};

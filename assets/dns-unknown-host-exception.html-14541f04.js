import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as s,e}from"./app-6b705441.js";const c={},i=e(`<h1 id="é«˜å¹¶å‘ä¸‹æŠ¥é”™-java-net-unknownhostexception-æ¡ˆä¾‹åˆ†æ" tabindex="-1"><a class="header-anchor" href="#é«˜å¹¶å‘ä¸‹æŠ¥é”™-java-net-unknownhostexception-æ¡ˆä¾‹åˆ†æ" aria-hidden="true">#</a> é«˜å¹¶å‘ä¸‹æŠ¥é”™ &quot;java.net.UnknownHostException&quot; æ¡ˆä¾‹åˆ†æ</h1><h2 id="æµé‡èµ°å‘" tabindex="-1"><a class="header-anchor" href="#æµé‡èµ°å‘" aria-hidden="true">#</a> æµé‡èµ°å‘</h2><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20241118194858350.png" alt=""></p><h2 id="é”™è¯¯æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æ—¥å¿—" aria-hidden="true">#</a> é”™è¯¯æ—¥å¿—</h2><p><strong>Client æŠ¥é”™</strong></p><p>åº”ç”¨çš„æŠ¥é”™æ—¥å¿—ä¸ºï¼š<code>java.net.UnknownHostException:</code></p><p><strong>ä»£ç†æœåŠ¡æŠ¥é”™</strong></p><p>æŸ¥çœ‹ <code>Nginx</code> çš„ <code>access</code> ã€ <code>error</code> æ—¥å¿—</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tail</span> <span class="token parameter variable">-f</span> xxx_dns_error.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20241118193148851.png" alt=""></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tail</span> <span class="token parameter variable">-f</span> stream-test-udp-dns_access.log <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;$5!=200&#39;</span>
<span class="token comment"># æ— å¼‚å¸¸</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹æ“ä½œç³»ç»Ÿæ—¥å¿—</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>journalctl <span class="token parameter variable">-f</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20241118193436883.png" alt=""></p><p><strong>DNS æœåŠ¡ç«¯æŠ¥é”™</strong>ï¼š æ— </p><h2 id="åˆ†æ" tabindex="-1"><a class="header-anchor" href="#åˆ†æ" aria-hidden="true">#</a> åˆ†æ</h2><p>é”™è¯¯å…³é”®è¯ <code>Operation not permitted</code>ã€<code>nf_conntrack: table full, dropping packet</code>ï¼Œé—®é¢˜å‡ºç°åœ¨ ä»£ç†å±‚ï¼Œ<code>conntrack table</code>æ»¡äº†ã€‚</p><p>æŸ¥çœ‹å½“å‰ <code>nf_conntrack_count</code> å’Œ <code>nf_conntrack_max</code> å€¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sysctl</span> net.netfilter.nf_conntrack_count
<span class="token function">sysctl</span> net.netfilter.nf_conntrack_max
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20241118194015232.png" alt=""></p><p>ç¡®å®æ»¡äº†ï¼Œ è°ƒå¤§å‘—ï¼Œæ¯æ¬¡å¢åŠ 50% ï¼Œè§‚å¯Ÿä¸€ä¸‹ï¼Œç›´è‡³æœ‰ç©ºé—²</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åœ¨ /etc/sysctl.conf æ–‡ä»¶ä¸­æ–°å¢ä¸€è¡Œ</span>
<span class="token assign-left variable">net.netfilter.nf_conntrack_max</span><span class="token operator">=</span><span class="token punctuation">[</span>æ–°çš„å€¼<span class="token punctuation">]</span>
<span class="token comment"># åº”ç”¨</span>
<span class="token function">sysctl</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒæ•´å®Œåï¼Œå†æ¬¡æŸ¥çœ‹ç›¸å…³æ—¥å¿—ï¼Œå‘ç°ç³»ç»Ÿæ—¥å¿—æ— æ–°æŠ¥é”™ï¼Œä½†æ˜¯ <code>Nginx</code> çš„ <code>access</code> ã€ <code>error</code> æ—¥å¿—æœ‰æ–°çš„æŠ¥é”™ï¼Œæ¥ç€ç›˜ä»–ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><p><code>error</code> æ—¥å¿—</p><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20241118195505182.png" alt=""></p><p><code>access</code> æ—¥å¿—</p><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20241118195648741.png" alt=""></p><h2 id="å†åˆ†æ" tabindex="-1"><a class="header-anchor" href="#å†åˆ†æ" aria-hidden="true">#</a> å†åˆ†æ</h2><p>é”™è¯¯å…³é”®è¯<code>Resource temporarily unavailable</code>ï¼Œç»™çš„ä¸å…·ä½“å•Šï¼Œä¸€æ­¥æ­¥æ’æŸ¥å§</p><p><strong>æ£€æŸ¥ç³»ç»Ÿèµ„æºé™åˆ¶</strong>ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</span>
<span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-n</span>
<span class="token function">sysctl</span> fs.file-max
<span class="token comment"># æŸ¥çœ‹å·²ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡,è¿™ä¸ªæ–‡ä»¶æ˜¾ç¤ºäº†ä¸‰ä¸ªå€¼ï¼šå½“å‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°ã€åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦æ•°ï¼ˆä¸€èˆ¬ä¸º0ï¼‰ï¼Œä»¥åŠç³»ç»Ÿå…è®¸çš„æ–‡ä»¶æè¿°ç¬¦æœ€å¤§å€¼ã€‚</span>
<span class="token function">cat</span> /proc/sys/fs/file-nr

<span class="token comment"># æ£€æŸ¥è¿›ç¨‹æˆ–çº¿ç¨‹é™åˆ¶</span>
<span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-u</span>
<span class="token function">cat</span> /etc/security/limits.conf
<span class="token function">cat</span> /etc/security/limits.d/20-nproc.conf
<span class="token function">cat</span> /proc/sys/kernel/pid_max
<span class="token function">cat</span> /proc/sys/kernel/threads-max

<span class="token comment"># æŸ¥çœ‹å½“å‰çº¿ç¨‹æ•°</span>
<span class="token function">ps</span> <span class="token parameter variable">-eLf</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šæ£€æŸ¥å‡æ­£å¸¸ã€‚</p><p><strong>æ£€æŸ¥ç½‘ç»œé—®é¢˜</strong></p><p>å› ä¸ºæ˜¯ UDP åè®®ï¼Œæ‰€ä»¥ å…¨è¿æ¥ï¼ˆ<code>net.core.somaxconn</code>ï¼‰ã€åŠè¿æ¥ï¼ˆ<code>net.ipv4.tcp_max_syn_backlog</code>ï¼‰ã€åº”ç”¨ backlog å¯ä»¥å¿½ç•¥</p><p>æŸ¥çœ‹ æœ¬åœ°ç«¯å£èŒƒå›´é™åˆ¶ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sysctl</span> net.ipv4.ip_local_port_range
<span class="token comment"># ç»“æœä¸ºé»˜è®¤é…ç½®ï¼šnet.ipv4.ip_local_port_range = 32768	60999</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹è§‚å¯Ÿå½“å‰ UDP è¿æ¥æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">watch</span> <span class="token parameter variable">-n</span> <span class="token number">0.5</span> <span class="token string">&quot;ss -s | grep -i udp&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è§‚å¯Ÿäº†ä¸€ä¼šï¼Œå‘ç°æ¥è¿‘ 28232 ï¼Œåˆæ»¡äº†ï¼Œemoäº†</p><p><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/image-20241118202020493.png" alt=""></p><p>å†è°ƒå¤§å‘—ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># åœ¨ /etc/sysctl.conf æ–‡ä»¶ä¸­æ–°å¢ä¸€è¡Œ</span>
<span class="token assign-left variable">net.ipv4.ip_local_port_range</span><span class="token operator">=</span><span class="token number">1024</span> <span class="token number">65535</span>
<span class="token comment"># åº”ç”¨</span>
<span class="token function">sysctl</span> <span class="token parameter variable">-p</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è°ƒæ•´å®Œåï¼Œå†æ¬¡è§‚å¯Ÿï¼Œåº”ç”¨æ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ï¼Œç½‘ç»œå‡æ­£å¸¸ï¼Œ å®¢æˆ·ç«¯è®¿é—®ä¸å†æŠ¥é”™ã€‚</p><p>Nice~~</p><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“ï¼š</h2><p>æœ¬æ¬¡é«˜å¹¶å‘ä¸‹ï¼Œè°ƒæ•´äº†ä¸¤ä¸ªå†…æ ¸å‚æ•°ï¼š <code>net.netfilter.nf_conntrack_max</code> å’Œ <code>net.ipv4.ip_local_port_range</code></p><p>æˆ‘æ˜¯ Clayï¼Œä¸‹æœŸè§ ğŸ‘‹</p><hr><blockquote><ul><li><p>æ¬¢è¿è®¢é˜…æˆ‘çš„å…¬ä¼—å·ã€ŒSREè¿ç»´è¿›é˜¶ä¹‹è·¯ã€æˆ–å…³æ³¨æˆ‘çš„ Github https://github.com/clay-wangzhi/SreGuide æŸ¥çœ‹æœ€æ–°æ–‡ç« </p></li><li><p>æ¬¢è¿åŠ æˆ‘å¾®ä¿¡<code>sre-k8s-ai</code>ï¼Œä¸æˆ‘è®¨è®ºäº‘åŸç”Ÿã€ç¨³å®šæ€§ç›¸å…³å†…å®¹</p></li></ul></blockquote><img src="https://clay-blog.oss-cn-shanghai.aliyuncs.com/img/weixin-20240615194414355.png" alt="weixin" style="zoom:50%;">`,50),l=[i];function t(o,p){return a(),s("div",null,l)}const m=n(c,[["render",t],["__file","dns-unknown-host-exception.html.vue"]]);export{m as default};

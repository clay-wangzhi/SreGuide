import{_ as t,r as n,c,a as e,b as r,w as p,F as i,d as s,e as a,o as u}from"./app.cb2299af.js";const d={},m=e("h1",{id:"velero-\u5907\u4EFD\u6062\u590D",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#velero-\u5907\u4EFD\u6062\u590D","aria-hidden":"true"},"#"),s(" velero \u5907\u4EFD\u6062\u590D")],-1),b=e("h2",{id:"\u65B9\u6848\u5236\u5B9A",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#\u65B9\u6848\u5236\u5B9A","aria-hidden":"true"},"#"),s(" \u65B9\u6848\u5236\u5B9A")],-1),h=e("ol",null,[e("li",null,"\u7269\u7406\u5907\u4EFD\uFF1Aetcd \u5907\u4EFD\uFF0C\u4FDD\u5B58\u67D0\u4E00\u4E2A\u65F6\u523B\u7684\u5FEB\u7167\uFF0C\u5FEB\u6377\u65B9\u4FBF\u3002"),e("li",null,"\u903B\u8F91\u5907\u4EFD\uFF1Avelero \u5907\u4EFD \uFF0C\u5141\u8BB8\u7528\u6237\u81EA\u5DF1\u9009\u62E9\u5907\u4EFD\u7684\u5185\u5BB9\uFF0C\u6BD4\u5982\u5355\u4E2A namespace\u3001\u6307\u5B9A\u8D44\u6E90\u7C7B\u578B\u7B49")],-1),v=e("p",null,"\u7269\u7406\u5907\u4EFD\u7684\u4F18\u70B9\u662F\u901F\u5EA6\u5FEB\uFF0C\u65E0\u8BBA\u662F\u5907\u4EFD\u8FD8\u662F\u56DE\u6062\u590D\uFF0C\u4F46\u7F3A\u70B9\u662F\u5143\u6570\u636E\u4E0D\u53EF\u8BFB\uFF0C\u53EA\u80FD\u5168\u90E8\u6062\u590D\u3002\u800C\u903B\u8F91\u5907\u4EFD\u6B63\u597D\u76F8\u53CD\uFF0C\u56E0\u6B64\u4E24\u8005\u53EF\u4EE5\u7ED3\u5408\u4F7F\u7528\uFF0C\u65E2\u80FD\u5FEB\uFF0C\u53C8\u80FD\u6709\u7EC6\u7C92\u5EA6\u63A7\u5236\u7684\u80FD\u529B\u3002",-1),k=s("etcd \u5907\u4EFD\u6062\u590D\u89C1"),g=s("\u4E0A\u6587"),f=a(`<h2 id="\u5907\u4EFD\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#\u5907\u4EFD\u4FE1\u606F" aria-hidden="true">#</a> \u5907\u4EFD\u4FE1\u606F</h2><p>volumes \u5EFA\u8BAE\u6709 csi \u8FDB\u884C\u5907\u4EFD\uFF0C\u8017\u65F6\u8F83\u957F\uFF0C\u5BB9\u6613\u5931\u8D25</p><p>\u5907\u4EFD\u7B56\u7565\u5982\u4E0B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">## \u5907\u4EFD</span>
velero backup create offline-k8s-work --include-namespaces<span class="token operator">=</span>work --snapshot-volumes<span class="token operator">=</span>false --default-volumes-to-restic<span class="token operator">=</span>false
<span class="token comment">## \u5468\u671F\u5907\u4EFD</span>
velero create schedule offline-k8s-work --schedule<span class="token operator">=</span><span class="token string">&quot;30 23 * * *&quot;</span> --include-namespaces<span class="token operator">=</span>work --snapshot-volumes<span class="token operator">=</span>false --default-volumes-to-restic<span class="token operator">=</span>false --ttl<span class="token operator">=</span>168h
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="velero-\u5907\u4EFD\u6062\u590D\u64CD\u4F5C\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#velero-\u5907\u4EFD\u6062\u590D\u64CD\u4F5C\u6B65\u9AA4" aria-hidden="true">#</a> velero \u5907\u4EFD\u6062\u590D\u64CD\u4F5C\u6B65\u9AA4</h2><h3 id="velero-\u5907\u4EFD" tabindex="-1"><a class="header-anchor" href="#velero-\u5907\u4EFD" aria-hidden="true">#</a> velero \u5907\u4EFD</h3>`,6),_=s("\u914D\u7F6E COS \u5BF9\u8C61\u5B58\u50A8 \u53C2\u8003\uFF1A"),x={href:"https://cloud.tencent.com/document/product/457/50122",target:"_blank",rel:"noopener noreferrer"},q=s("\u4F7F\u7528\u5BF9\u8C61\u5B58\u50A8 COS \u4F5C\u4E3A Velero \u5B58\u50A8\u5B9E\u73B0\u96C6\u7FA4\u8D44\u6E90\u5907\u4EFD\u548C\u8FD8\u539F"),w=a(`<li><p>\u5B89\u88C5 velero</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u4E0B\u8F7D\u7248\u672C\uFF1Ahttps://github.com/vmware-tanzu/velero/releases \u6700\u65B0\u7A33\u5B9A\u7248\uFF0C\u6CE8\u610Fk8s\u7248\u672C\u517C\u5BB9\u6027\uFF0C1.8.1\u7248\u672C\u8981\u6C42k8s\u7248\u672C\u81F3\u5C111.16</span>
<span class="token function">wget</span> https://github.com/vmware-tanzu/velero/releases/download/v1.8.1/velero-v1.8.1-linux-amd64.tar.gz
<span class="token comment"># \u89E3\u538B</span>
<span class="token function">tar</span> -xvf velero-v1.8.1-linux-amd64.tar.gz
<span class="token comment"># \u52A0\u5165\u73AF\u5883\u53D8\u91CF</span>
<span class="token function">cp</span> velero-v1.8.1-linux-amd64/velero /usr/bin/
<span class="token comment"># \u8BBE\u7F6E\u8865\u5168\u547D\u4EE4</span>
velero completion <span class="token function">bash</span> <span class="token operator">&gt;</span> /etc/bash_completion.d/velero.sh
<span class="token builtin class-name">source</span> /etc/bash_completion.d/velero.sh
<span class="token comment"># \u5B89\u88C5</span>
velero <span class="token function">install</span>  --provider aws --plugins velero/velero-plugin-for-aws:v1.1.0 --bucket  velero-xxx --secret-file ./credentials-velero --use-volume-snapshots<span class="token operator">=</span>false --use-restic --default-volumes-to-restic --backup-location-config <span class="token assign-left variable">region</span><span class="token operator">=</span>ap-shanghai,s3ForcePathStyle<span class="token operator">=</span><span class="token string">&quot;true&quot;</span>,s3Url<span class="token operator">=</span>https://cos.ap-shanghai.myqcloud.com --restic-pod-cpu-request<span class="token operator">=</span>1000m --restic-pod-cpu-limit<span class="token operator">=</span>2000m --restic-pod-mem-request<span class="token operator">=</span>1024Mi --restic-pod-mem-limit<span class="token operator">=</span>4096Mi  --velero-pod-cpu-request<span class="token operator">=</span>1000m --velero-pod-cpu-limit<span class="token operator">=</span>2000m --velero-pod-mem-request<span class="token operator">=</span>1024Mi --velero-pod-mem-limit<span class="token operator">=</span>4096Mi
<span class="token comment"># \u67E5\u770B\u914D\u7F6E\u7684\u5B58\u50A8\u4F4D\u7F6E\u662F\u5426\u53EF\u7528</span>
velero backup-location get
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li><li><p>\u5907\u4EFD \u6839\u636E\u5B9E\u9645\u60C5\u51B5\u5907\u4EFD\u6307\u5B9Anamespace \u6216 \u6307\u5B9A\u8D44\u6E90\u7C7B\u578B</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>velero backup create test-backup \u4E00\u6B21\u6027\u5907\u4EFD
velero create schedule NAME --schedule<span class="token operator">=</span><span class="token string">&quot;0 */6 * * *\u201D
velero create schedule NAME --schedule=&quot;</span>@every 6h<span class="token string">&quot; \u5B9A\u65F6\u5907\u4EFD
velero create schedule NAME --schedule=&quot;</span>@every 6h<span class="token string">&quot; --exclude-resources persistentvolumeclaims,persistentvolumes
velero create schedule NAME --schedule=&quot;</span>@every 24h<span class="token string">&quot; --include-namespaces web
velero create schedule NAME --schedule=&quot;</span>@every 168h&quot; --ttl 2160h0m0s
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li>`,2),M=a(`<h3 id="velero-\u6062\u590D" tabindex="-1"><a class="header-anchor" href="#velero-\u6062\u590D" aria-hidden="true">#</a> velero \u6062\u590D</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>velero restore create restore-1 --from-backup backup-1
velero restore create --from-backup backup-1
velero restore create --from-schedule NAME \u6216\u901A\u8FC7namespace\u548Ctype\u6307\u5B9A\u6062\u590D\u7684\u5185\u5BB9
velero restore create --from-schedule schedule-1 --allow-partially-failed
velero restore create --from-backup backup-2 --include-resources persistentvolumeclaims,persistentvolumes
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u5176\u4ED6" tabindex="-1"><a class="header-anchor" href="#\u5176\u4ED6" aria-hidden="true">#</a> \u5176\u4ED6</h3><ul><li><p>velero \u5907\u4EFD\u5220\u9664</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>velero backup delete test-backup
velero schedule delete test-schedule
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>velero \u5378\u8F7D</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl delete namespace/velero clusterrolebinding/velero
kubectl delete crds -l <span class="token assign-left variable">component</span><span class="token operator">=</span>velero
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul>`,4);function N(E,y){const l=n("RouterLink"),o=n("ExternalLinkIcon");return u(),c(i,null,[m,b,h,v,e("blockquote",null,[e("p",null,[k,r(l,{to:"/cloudnative/kubernetes/etcd-backup-restore.html"},{default:p(()=>[g]),_:1})])]),f,e("ol",null,[e("li",null,[e("p",null,[_,e("a",x,[q,r(o)])])]),w]),M],64)}var V=t(d,[["render",N],["__file","velero.html.vue"]]);export{V as default};

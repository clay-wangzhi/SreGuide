import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{o as s,c as a,e as p}from"./app-f1a45f61.js";const t={},o=p(`<h2 id="二开-jumpserver-podshell-登录" tabindex="-1"><a class="header-anchor" href="#二开-jumpserver-podshell-登录" aria-hidden="true">#</a> 二开 jumpserver podshell 登录</h2><p>目的： 控制开发人员可以登录的权限</p><p>版本： <strong>v2.19.2</strong></p><p>修改如下文件内容</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>diff <span class="token operator">-</span>r old<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>applications<span class="token operator">/</span>api<span class="token operator">/</span>mixin<span class="token punctuation">.</span>py new<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>applications<span class="token operator">/</span>api<span class="token operator">/</span>mixin<span class="token punctuation">.</span>py
42c42
<span class="token operator">&lt;</span>     <span class="token keyword">def</span> <span class="token function">serialize_applications_with_org</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> applications<span class="token punctuation">,</span> tree_id<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>     <span class="token keyword">def</span> <span class="token function">serialize_applications_with_org</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> applications<span class="token punctuation">,</span> tree_id<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> user<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span><span class="token punctuation">:</span>
84c84
<span class="token operator">&lt;</span>         tree_nodes <span class="token operator">=</span> KubernetesTree<span class="token punctuation">(</span>tree_id<span class="token punctuation">)</span><span class="token punctuation">.</span>async_tree_node<span class="token punctuation">(</span>parent_info<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>         tree_nodes <span class="token operator">=</span> KubernetesTree<span class="token punctuation">(</span>tree_id<span class="token punctuation">)</span><span class="token punctuation">.</span>async_tree_node<span class="token punctuation">(</span>parent_info<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span>

diff <span class="token operator">-</span>r old<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>applications<span class="token operator">/</span>utils<span class="token operator">/</span>kubernetes_util<span class="token punctuation">.</span>py new<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>applications<span class="token operator">/</span>utils<span class="token operator">/</span>kubernetes_util<span class="token punctuation">.</span>py
14a15<span class="token punctuation">,</span><span class="token number">16</span>
<span class="token operator">&gt;</span> <span class="token keyword">import</span> requests
<span class="token operator">&gt;</span> <span class="token keyword">import</span> json
<span class="token number">59</span><span class="token punctuation">,</span>60c61<span class="token punctuation">,</span><span class="token number">92</span>
<span class="token operator">&lt;</span>     <span class="token keyword">def</span> <span class="token function">get_pods</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">&lt;</span>         api <span class="token operator">=</span> self<span class="token punctuation">.</span>get_api<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>     <span class="token comment">#def get_pods(self):</span>
<span class="token operator">&gt;</span>     <span class="token comment">#    api = self.get_api()</span>
<span class="token operator">&gt;</span>     <span class="token comment">#    try:</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        ret = api.list_pod_for_all_namespaces(watch=False, _request_timeout=(3, 3))</span>
<span class="token operator">&gt;</span>     <span class="token comment">#    except MaxRetryError:</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        logger.warning(&#39;Kubernetes connection timed out&#39;)</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        return</span>
<span class="token operator">&gt;</span>     <span class="token comment">#    except ApiException as e:</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        if e.status == 401:</span>
<span class="token operator">&gt;</span>     <span class="token comment">#            logger.warning(&#39;Kubernetes User not authenticated&#39;)</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        else:</span>
<span class="token operator">&gt;</span>     <span class="token comment">#            logger.warning(e)</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        return</span>
<span class="token operator">&gt;</span>     <span class="token comment">#    data = {}</span>
<span class="token operator">&gt;</span>     <span class="token comment">#    for i in ret.items:</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        namespace = i.metadata.namespace</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        pod_info = {</span>
<span class="token operator">&gt;</span>     <span class="token comment">#            &#39;pod_name&#39;: i.metadata.name,</span>
<span class="token operator">&gt;</span>     <span class="token comment">#            &#39;containers&#39;: [j.name for j in i.spec.containers]</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        }</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        if namespace in data:</span>
<span class="token operator">&gt;</span>     <span class="token comment">#            data[namespace].append(pod_info)</span>
<span class="token operator">&gt;</span>     <span class="token comment">#        else:</span>
<span class="token operator">&gt;</span>     <span class="token comment">#            data[namespace] = [pod_info, ]</span>
<span class="token operator">&gt;</span>     <span class="token comment">#    return data</span>
<span class="token operator">&gt;</span>     <span class="token keyword">def</span> <span class="token function">get_pods</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>         <span class="token comment"># 调用 外部系统，查看 用户具有 appid 的权限列表</span>
<span class="token operator">&gt;</span>         xxx_api <span class="token operator">=</span> <span class="token string">&quot;https://xxx/xxx_api/v1/auth/user/&quot;</span>
<span class="token operator">&gt;</span>         xxx_auth <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span>
<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span>         res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>xxx_api<span class="token operator">+</span>login_username<span class="token operator">+</span><span class="token string">&quot;/appid&quot;</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">:</span> xxx_auth<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>         xxx_apps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">62</span><span class="token punctuation">,</span>64c94<span class="token punctuation">,</span><span class="token number">102</span>
<span class="token operator">&lt;</span>             ret <span class="token operator">=</span> api<span class="token punctuation">.</span>list_pod_for_all_namespaces<span class="token punctuation">(</span>watch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> _request_timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>         <span class="token keyword">except</span> MaxRetryError<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>             logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&#39;Kubernetes connection timed out&#39;</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>             body <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token operator">&gt;</span>             data <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>             msg <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>             code <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>             <span class="token keyword">if</span> code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用 xxx 返回异常&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>                 <span class="token keyword">return</span>
<span class="token operator">&gt;</span>         <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用 xxx 获取appid列表解析失败:&quot;</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">66</span><span class="token punctuation">,</span>70c104<span class="token punctuation">,</span><span class="token number">118</span>
<span class="token operator">&lt;</span>         <span class="token keyword">except</span> ApiException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>             <span class="token keyword">if</span> e<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">:</span>
<span class="token operator">&lt;</span>                 logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&#39;Kubernetes User not authenticated&#39;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>             <span class="token keyword">else</span><span class="token punctuation">:</span>
<span class="token operator">&lt;</span>                 logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>         <span class="token keyword">finally</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             res<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>         <span class="token keyword">for</span> app <span class="token keyword">in</span> data<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             xxx_apps<span class="token punctuation">.</span>append<span class="token punctuation">(</span>app<span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span>         <span class="token comment"># 调用k8s-resource-apis, 自封装的 api 接口</span>
<span class="token operator">&gt;</span>         res_apps <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>         k8s_resource_api <span class="token operator">=</span> <span class="token string">&quot;http://xxxx&quot;</span>
<span class="token operator">&gt;</span>         res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k8s_resource_api<span class="token operator">+</span><span class="token string">&quot;/get-all-app-list/&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>         <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             body <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token operator">&gt;</span>             data <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>             msg <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>         <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用k8sResourceApi获取appid列表解析失败:&quot;</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">72</span><span class="token punctuation">,</span>80c120<span class="token punctuation">,</span><span class="token number">157</span>
<span class="token operator">&lt;</span>         data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>         <span class="token keyword">for</span> i <span class="token keyword">in</span> ret<span class="token punctuation">.</span>items<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>             namespace <span class="token operator">=</span> i<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>namespace
<span class="token operator">&lt;</span>             pod_info <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token operator">&lt;</span>                 <span class="token string">&#39;pod_name&#39;</span><span class="token punctuation">:</span> i<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
<span class="token operator">&lt;</span>                 <span class="token string">&#39;containers&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>j<span class="token punctuation">.</span>name <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>containers<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>             <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>             <span class="token keyword">if</span> namespace <span class="token keyword">in</span> data<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>                 data<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>pod_info<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>         <span class="token keyword">finally</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             res<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span>         <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                 res_apps<span class="token punctuation">.</span>add<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span>         <span class="token comment"># apps</span>
<span class="token operator">&gt;</span>         apps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>         <span class="token keyword">for</span> item <span class="token keyword">in</span> xxx_apps<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             <span class="token keyword">if</span> item <span class="token keyword">in</span> res_apps<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                 apps<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span>         <span class="token comment"># get pods</span>
<span class="token operator">&gt;</span>         ctx <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment"># {&quot;namespace&quot;: [{podname:aaaa, containers}]}</span>
<span class="token operator">&gt;</span>         <span class="token keyword">for</span> appid <span class="token keyword">in</span> apps<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>             res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k8s_resource_api<span class="token operator">+</span><span class="token string">&quot;/get-pods-by-app/&quot;</span><span class="token operator">+</span>appid<span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>             <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                 body <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token operator">&gt;</span>                 data <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>                 msg <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>             <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用k8sResourceApis获取appid-pods列表解析失败:&quot;</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> appid<span class="token punctuation">)</span>
<span class="token operator">&gt;</span>             <span class="token keyword">finally</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                 res<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span>             <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                 <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                     <span class="token keyword">for</span> pod <span class="token keyword">in</span> data<span class="token punctuation">:</span>            <span class="token comment"># key: pod-name, 原始data结构：{&quot;pod-name&quot;: {&quot;Ns&quot;: &quot;xxx&quot;, &quot;Containers&quot;: {&quot;c-name&quot;: &quot;c-id&quot;}}}</span>
<span class="token operator">&gt;</span>                         ns <span class="token operator">=</span> data<span class="token punctuation">[</span>pod<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;Ns&quot;</span><span class="token punctuation">]</span>    <span class="token comment"># ns == &quot;xxx&quot;</span>
<span class="token operator">&gt;</span>                         <span class="token keyword">if</span> ns <span class="token keyword">not</span> <span class="token keyword">in</span> ctx<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                             ctx<span class="token punctuation">[</span>ns<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>                         containers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span>                         <span class="token keyword">for</span> c <span class="token keyword">in</span> data<span class="token punctuation">[</span>pod<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;Containers&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                             containers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token operator">&gt;</span>                         ctx<span class="token punctuation">[</span>ns<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;pod_name&quot;</span><span class="token punctuation">:</span> pod<span class="token punctuation">,</span> <span class="token string">&quot;containers&quot;</span><span class="token punctuation">:</span> containers<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>                 <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">&gt;</span>                     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;解析重组pod列表信息异常:&quot;</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">82</span><span class="token punctuation">,</span>83c159<span class="token punctuation">,</span><span class="token number">160</span>
<span class="token operator">&lt;</span>                 data<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>pod_info<span class="token punctuation">,</span> <span class="token punctuation">]</span>
<span class="token operator">&lt;</span>         <span class="token keyword">return</span> data
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>                 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;调用k8sResourceApis获取pod列表返回状态异常:&quot;</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token operator">+</span>msg<span class="token punctuation">)</span>
<span class="token operator">&gt;</span>         <span class="token keyword">return</span> ctx
86c163
<span class="token operator">&lt;</span>     <span class="token keyword">def</span> <span class="token function">get_kubernetes_data</span><span class="token punctuation">(</span>app_id<span class="token punctuation">,</span> system_user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>     <span class="token keyword">def</span> <span class="token function">get_kubernetes_data</span><span class="token punctuation">(</span>app_id<span class="token punctuation">,</span> system_user_id<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span><span class="token punctuation">:</span>
91c168
<span class="token operator">&lt;</span>         <span class="token keyword">return</span> k8s<span class="token punctuation">.</span>get_pods<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>         <span class="token keyword">return</span> k8s<span class="token punctuation">.</span>get_pods<span class="token punctuation">(</span>login_username<span class="token punctuation">)</span>
153c230
<span class="token operator">&lt;</span>     <span class="token keyword">def</span> <span class="token function">async_tree_node</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>     <span class="token keyword">def</span> <span class="token function">async_tree_node</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span><span class="token punctuation">:</span>
160c237
<span class="token operator">&lt;</span>         data <span class="token operator">=</span> KubernetesClient<span class="token punctuation">.</span>get_kubernetes_data<span class="token punctuation">(</span>app_id<span class="token punctuation">,</span> system_user_id<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>         data <span class="token operator">=</span> KubernetesClient<span class="token punctuation">.</span>get_kubernetes_data<span class="token punctuation">(</span>app_id<span class="token punctuation">,</span> system_user_id<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span>

diff <span class="token operator">-</span>r old<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>perms<span class="token operator">/</span>api<span class="token operator">/</span>application<span class="token operator">/</span>user_permission<span class="token operator">/</span>user_permission_applications<span class="token punctuation">.</span>py new<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>perms<span class="token operator">/</span>api<span class="token operator">/</span>application<span class="token operator">/</span>user_permission<span class="token operator">/</span>user_permission_applications<span class="token punctuation">.</span>py
59a60<span class="token punctuation">,</span><span class="token number">64</span>
<span class="token operator">&gt;</span>         login_username <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
<span class="token operator">&gt;</span>         login_user <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;_user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>         lft <span class="token operator">=</span> login_user<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;(&#39;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>         <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lft<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
<span class="token operator">&gt;</span>            login_username <span class="token operator">=</span> lft<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&#39;)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
64c69
<span class="token operator">&lt;</span>             queryset<span class="token punctuation">,</span> tree_id<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> self<span class="token punctuation">.</span>user
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">&gt;</span>             queryset<span class="token punctuation">,</span> tree_id<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> self<span class="token punctuation">.</span>user<span class="token punctuation">,</span> login_username
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),e=[o];function c(l,i){return s(),a("div",null,e)}const k=n(t,[["render",c],["__file","podshell.html.vue"]]);export{k as default};
